!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l="1.11.2",m=function(a,b){return new m.fn.init(a,b)},n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o=/^-ms-/,p=/-([\da-z])/gi,q=function(a,b){return b.toUpperCase()};m.fn=m.prototype={jquery:l,constructor:m,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=m.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return m.each(this,a,b)},map:function(a){return this.pushStack(m.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},m.extend=m.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},m.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===m.type(a)},isArray:Array.isArray||function(a){return"array"===m.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!m.isArray(a)&&a-parseFloat(a)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==m.type(a)||a.nodeType||m.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(k.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&m.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(o,"ms-").replace(p,q)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=r(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(n,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(r(Object(a))?m.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=r(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),m.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||m.guid++,e):void 0},now:function(){return+new Date},support:k}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function r(a){var b=a.length,c=m.type(a);return"function"===c||m.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var s=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=hb(),z=hb(),A=hb(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N=M.replace("w","w#"),O="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+N+"))|)"+L+"*\\]",P=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",Q=new RegExp(L+"+","g"),R=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),S=new RegExp("^"+L+"*,"+L+"*"),T=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),U=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),V=new RegExp(P),W=new RegExp("^"+N+"$"),X={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+P),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},eb=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fb){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function gb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,"string"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+rb(o[l]);w=ab.test(a)&&pb(b.parentNode)||b,x=o.join(",")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function hb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ib(a){return a[u]=!0,a}function jb(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function kb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function lb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function nb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function ob(a){return ib(function(b){return b=+b,ib(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pb(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=gb.support={},f=gb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=gb.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener("unload",eb,!1):e.attachEvent&&e.attachEvent("onunload",eb)),p=!f(g),c.attributes=jb(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=jb(function(a){return a.appendChild(g.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=jb(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(jb(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),jb(function(a){var b=g.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&jb(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",P)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return lb(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?lb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},gb.matches=function(a,b){return gb(a,null,null,b)},gb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return gb(b,n,null,[a]).length>0},gb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},gb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},gb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},gb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=gb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=gb.selectors={cacheLength:50,createPseudo:ib,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||gb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&gb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=gb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(Q," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||gb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ib(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ib(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?ib(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ib(function(a){return function(b){return gb(a,b).length>0}}),contains:ib(function(a){return a=a.replace(cb,db),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ib(function(a){return W.test(a||"")||gb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do{if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-")}while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:ob(function(){return[0]}),last:ob(function(a,b){return[b-1]}),eq:ob(function(a,b,c){return[0>c?c+b:c]}),even:ob(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:ob(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:ob(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:ob(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=mb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=nb(b);function qb(){}qb.prototype=d.filters=d.pseudos,d.setFilters=new qb,g=gb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?gb.error(a):z(a,i).slice(0)};function rb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function tb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ub(a,b,c){for(var d=0,e=b.length;e>d;d++)gb(a,b[d],c);return c}function vb(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wb(a,b,c,d,e,f){return d&&!d[u]&&(d=wb(d)),e&&!e[u]&&(e=wb(e,f)),ib(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ub(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:vb(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=vb(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=vb(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=sb(function(a){return a===b},h,!0),l=sb(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sb(tb(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wb(i>1&&tb(m),i>1&&rb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&xb(a.slice(i,e)),f>e&&xb(a=a.slice(e)),f>e&&rb(a))}m.push(c)}return tb(m)}function yb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=vb(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&gb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ib(f):f}return h=gb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xb(b[c]),f[u]?d.push(f):e.push(f);f=A(a,yb(e,d)),f.selector=a}return f},i=gb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&pb(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&rb(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&pb(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=jb(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),jb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||kb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&jb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||kb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),jb(function(a){return null==a.getAttribute("disabled")})||kb(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),gb}(a);m.find=s,m.expr=s.selectors,m.expr[":"]=m.expr.pseudos,m.unique=s.uniqueSort,m.text=s.getText,m.isXMLDoc=s.isXML,m.contains=s.contains;var t=m.expr.match.needsContext,u=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,v=/^.[^:#\[\.,]*$/;function w(a,b,c){if(m.isFunction(b))return m.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return m.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(v.test(b))return m.filter(b,a,c);b=m.filter(b,a)}return m.grep(a,function(a){return m.inArray(a,b)>=0!==c})}m.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?m.find.matchesSelector(d,a)?[d]:[]:m.find.matches(a,m.grep(b,function(a){return 1===a.nodeType}))},m.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(m(a).filter(function(){for(b=0;e>b;b++)if(m.contains(d[b],this))return!0}));for(b=0;e>b;b++)m.find(a,d[b],c);return c=this.pushStack(e>1?m.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(w(this,a||[],!1))},not:function(a){return this.pushStack(w(this,a||[],!0))},is:function(a){return!!w(this,"string"==typeof a&&t.test(a)?m(a):a||[],!1).length}});var x,y=a.document,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=m.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||x).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof m?b[0]:b,m.merge(this,m.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:y,!0)),u.test(c[1])&&m.isPlainObject(b))for(c in b)m.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=y.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return x.find(a);this.length=1,this[0]=d}return this.context=y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):m.isFunction(a)?"undefined"!=typeof x.ready?x.ready(a):a(m):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),m.makeArray(a,this))};A.prototype=m.fn,x=m(y);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!m(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),m.fn.extend({has:function(a){var b,c=m(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(m.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=t.test(a)||"string"!=typeof a?m(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&m.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?m.unique(f):f)},index:function(a){return a?"string"==typeof a?m.inArray(this[0],m(a)):m.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(m.unique(m.merge(this.get(),m(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){do{a=a[b]}while(a&&1!==a.nodeType);return a}m.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return m.dir(a,"parentNode")},parentsUntil:function(a,b,c){return m.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return m.dir(a,"nextSibling")},prevAll:function(a){return m.dir(a,"previousSibling")},nextUntil:function(a,b,c){return m.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return m.dir(a,"previousSibling",c)},siblings:function(a){return m.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return m.sibling(a.firstChild)},contents:function(a){return m.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:m.merge([],a.childNodes)}},function(a,b){m.fn[a]=function(c,d){var e=m.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=m.filter(d,e)),this.length>1&&(C[a]||(e=m.unique(e)),B.test(a)&&(e=e.reverse())),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return m.each(a.match(E)||[],function(a,c){b[c]=!0}),b}m.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):m.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){m.each(b,function(b,c){var d=m.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&m.each(arguments,function(a,c){var d;while((d=m.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?m.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},m.extend({Deferred:function(a){var b=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return m.Deferred(function(c){m.each(b,function(b,f){var g=m.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&m.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?m.extend(a,d):d}},e={};return d.pipe=d.then,m.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&m.isFunction(a.promise)?e:0,g=1===f?a:m.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&m.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;m.fn.ready=function(a){return m.ready.promise().done(a),this},m.extend({isReady:!1,readyWait:1,holdReady:function(a){a?m.readyWait++:m.ready(!0)},ready:function(a){if(a===!0?!--m.readyWait:!m.isReady){if(!y.body)return setTimeout(m.ready);m.isReady=!0,a!==!0&&--m.readyWait>0||(H.resolveWith(y,[m]),m.fn.triggerHandler&&(m(y).triggerHandler("ready"),m(y).off("ready")))}}});function I(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",J,!1),a.removeEventListener("load",J,!1)):(y.detachEvent("onreadystatechange",J),a.detachEvent("onload",J))}function J(){(y.addEventListener||"load"===event.type||"complete"===y.readyState)&&(I(),m.ready())}m.ready.promise=function(b){if(!H)if(H=m.Deferred(),"complete"===y.readyState)setTimeout(m.ready);else if(y.addEventListener)y.addEventListener("DOMContentLoaded",J,!1),a.addEventListener("load",J,!1);else{y.attachEvent("onreadystatechange",J),a.attachEvent("onload",J);var c=!1;try{c=null==a.frameElement&&y.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!m.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}I(),m.ready()}}()}return H.promise(b)};var K="undefined",L;for(L in m(k))break;k.ownLast="0"!==L,k.inlineBlockNeedsLayout=!1,m(function(){var a,b,c,d;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",k.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=y.createElement("div");if(null==k.deleteExpando){k.deleteExpando=!0;try{delete a.test}catch(b){k.deleteExpando=!1}}a=null}(),m.acceptData=function(a){var b=m.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var M=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,N=/([A-Z])/g;function O(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(N,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:M.test(c)?m.parseJSON(c):c}catch(e){}m.data(a,b,c)}else c=void 0}return c}function P(a){var b;for(b in a)if(("data"!==b||!m.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function Q(a,b,d,e){if(m.acceptData(a)){var f,g,h=m.expando,i=a.nodeType,j=i?m.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||m.guid++:h),j[k]||(j[k]=i?{}:{toJSON:m.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=m.extend(j[k],b):j[k].data=m.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[m.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[m.camelCase(b)])):f=g,f}}function R(a,b,c){if(m.acceptData(a)){var d,e,f=a.nodeType,g=f?m.cache:a,h=f?a[m.expando]:m.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){m.isArray(b)?b=b.concat(m.map(b,m.camelCase)):b in d?b=[b]:(b=m.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!P(d):!m.isEmptyObject(d))return}(c||(delete g[h].data,P(g[h])))&&(f?m.cleanData([a],!0):k.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}m.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?m.cache[a[m.expando]]:a[m.expando],!!a&&!P(a)},data:function(a,b,c){return Q(a,b,c)},removeData:function(a,b){return R(a,b)},_data:function(a,b,c){return Q(a,b,c,!0)},_removeData:function(a,b){return R(a,b,!0)}}),m.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=m.data(f),1===f.nodeType&&!m._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=m.camelCase(d.slice(5)),O(f,d,e[d])));m._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){m.data(this,a)}):arguments.length>1?this.each(function(){m.data(this,a,b)}):f?O(f,a,m.data(f,a)):void 0},removeData:function(a){return this.each(function(){m.removeData(this,a)})}}),m.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=m._data(a,b),c&&(!d||m.isArray(c)?d=m._data(a,b,m.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=m.queue(a,b),d=c.length,e=c.shift(),f=m._queueHooks(a,b),g=function(){m.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return m._data(a,c)||m._data(a,c,{empty:m.Callbacks("once memory").add(function(){m._removeData(a,b+"queue"),m._removeData(a,c)})})}}),m.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?m.queue(this[0],a):void 0===b?this:this.each(function(){var c=m.queue(this,a,b);m._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&m.dequeue(this,a)})},dequeue:function(a){return this.each(function(){m.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=m.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=m._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=["Top","Right","Bottom","Left"],U=function(a,b){return a=b||a,"none"===m.css(a,"display")||!m.contains(a.ownerDocument,a)},V=m.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===m.type(c)){e=!0;for(h in c)m.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,m.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(m(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},W=/^(?:checkbox|radio)$/i;!function(){var a=y.createElement("input"),b=y.createElement("div"),c=y.createDocumentFragment();if(b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",k.leadingWhitespace=3===b.firstChild.nodeType,k.tbody=!b.getElementsByTagName("tbody").length,k.htmlSerialize=!!b.getElementsByTagName("link").length,k.html5Clone="<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,a.type="checkbox",a.checked=!0,c.appendChild(a),k.appendChecked=a.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,c.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,k.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){k.noCloneEvent=!1}),b.cloneNode(!0).click()),null==k.deleteExpando){k.deleteExpando=!0;try{delete b.test}catch(d){k.deleteExpando=!1}}}(),function(){var b,c,d=y.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(k[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),k[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var X=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|pointer|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=/^([^.]*)(?:\.(.+)|)$/;function ab(){return!0}function bb(){return!1}function cb(){try{return y.activeElement}catch(a){}}m.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=m.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof m===K||a&&m.event.triggered===a.type?void 0:m.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(E)||[""],h=b.length;while(h--)f=_.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=m.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=m.event.special[o]||{},l=m.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&m.expr.match.needsContext.test(e),namespace:p.join(".")},i),(n=g[o])||(n=g[o]=[],n.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?n.splice(n.delegateCount++,0,l):n.push(l),m.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m.hasData(a)&&m._data(a);if(r&&(k=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=_.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=m.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,n=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=n.length;while(f--)g=n[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(n.splice(f,1),g.selector&&n.delegateCount--,l.remove&&l.remove.call(a,g));i&&!n.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||m.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)m.event.remove(a,o+b[j],c,d,!0);m.isEmptyObject(k)&&(delete r.handle,m._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,o=[d||y],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||y,3!==d.nodeType&&8!==d.nodeType&&!$.test(p+m.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[m.expando]?b:new m.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:m.makeArray(c,[b]),k=m.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!m.isWindow(d)){for(i=k.delegateType||p,$.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||y)&&o.push(l.defaultView||l.parentWindow||a)}n=0;while((h=o[n++])&&!b.isPropagationStopped())b.type=n>1?i:k.bindType||p,f=(m._data(h,"events")||{})[b.type]&&m._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&m.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&m.acceptData(d)&&g&&d[p]&&!m.isWindow(d)){l=d[g],l&&(d[g]=null),m.event.triggered=p;try{d[p]()}catch(r){}m.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=m.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(m._data(this,"events")||{})[a.type]||[],k=m.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=m.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((m.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?m(c,this).index(i)>=0:m.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[m.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=Z.test(e)?this.mouseHooks:Y.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new m.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==cb()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===cb()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return m.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return m.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=m.extend(new m.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?m.event.trigger(e,null,b):m.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},m.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===K&&(a[d]=null),a.detachEvent(d,c))},m.Event=function(a,b){return this instanceof m.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ab:bb):this.type=a,b&&m.extend(this,b),this.timeStamp=a&&a.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(a,b)},m.Event.prototype={isDefaultPrevented:bb,isPropagationStopped:bb,isImmediatePropagationStopped:bb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ab,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ab,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ab,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){m.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!m.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.submitBubbles||(m.event.special.submit={setup:function(){return m.nodeName(this,"form")?!1:void m.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=m.nodeName(b,"input")||m.nodeName(b,"button")?b.form:void 0;c&&!m._data(c,"submitBubbles")&&(m.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),m._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&m.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return m.nodeName(this,"form")?!1:void m.event.remove(this,"._submit")}}),k.changeBubbles||(m.event.special.change={setup:function(){return X.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(m.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),m.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),m.event.simulate("change",this,a,!0)})),!1):void m.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!m._data(b,"changeBubbles")&&(m.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||m.event.simulate("change",this.parentNode,a,!0)}),m._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return m.event.remove(this,"._change"),!X.test(this.nodeName)}}),k.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){m.event.simulate(b,a.target,m.event.fix(a),!0)};m.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=m._data(d,b);e||d.addEventListener(a,c,!0),m._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=m._data(d,b)-1;e?m._data(d,b,e):(d.removeEventListener(a,c,!0),m._removeData(d,b))}}}),m.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=bb;else if(!d)return this;return 1===e&&(g=d,d=function(a){return m().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=m.guid++)),this.each(function(){m.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,m(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=bb),this.each(function(){m.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){m.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?m.event.trigger(a,b,c,!0):void 0}});function db(a){var b=eb.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var eb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fb=/ jQuery\d+="(?:null|\d+)"/g,gb=new RegExp("<(?:"+eb+")[\\s/>]","i"),hb=/^\s+/,ib=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,jb=/<([\w:]+)/,kb=/<tbody/i,lb=/<|&#?\w+;/,mb=/<(?:script|style|link)/i,nb=/checked\s*(?:[^=]|=\s*.checked.)/i,ob=/^$|\/(?:java|ecma)script/i,pb=/^true\/(.*)/,qb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,rb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:k.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},sb=db(y),tb=sb.appendChild(y.createElement("div"));rb.optgroup=rb.option,rb.tbody=rb.tfoot=rb.colgroup=rb.caption=rb.thead,rb.th=rb.td;function ub(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==K?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==K?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||m.nodeName(d,b)?f.push(d):m.merge(f,ub(d,b));return void 0===b||b&&m.nodeName(a,b)?m.merge([a],f):f}function vb(a){W.test(a.type)&&(a.defaultChecked=a.checked)}function wb(a,b){return m.nodeName(a,"table")&&m.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function xb(a){return a.type=(null!==m.find.attr(a,"type"))+"/"+a.type,a}function yb(a){var b=pb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function zb(a,b){for(var c,d=0;null!=(c=a[d]);d++)m._data(c,"globalEval",!b||m._data(b[d],"globalEval"))}function Ab(a,b){if(1===b.nodeType&&m.hasData(a)){var c,d,e,f=m._data(a),g=m._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)m.event.add(b,c,h[c][d])}g.data&&(g.data=m.extend({},g.data))}}function Bb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!k.noCloneEvent&&b[m.expando]){e=m._data(b);for(d in e.events)m.removeEvent(b,d,e.handle);b.removeAttribute(m.expando)}"script"===c&&b.text!==a.text?(xb(b).text=a.text,yb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),k.html5Clone&&a.innerHTML&&!m.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&W.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}m.extend({clone:function(a,b,c){var d,e,f,g,h,i=m.contains(a.ownerDocument,a);if(k.html5Clone||m.isXMLDoc(a)||!gb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(tb.innerHTML=a.outerHTML,tb.removeChild(f=tb.firstChild)),!(k.noCloneEvent&&k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||m.isXMLDoc(a)))for(d=ub(f),h=ub(a),g=0;null!=(e=h[g]);++g)d[g]&&Bb(e,d[g]);if(b)if(c)for(h=h||ub(a),d=d||ub(f),g=0;null!=(e=h[g]);g++)Ab(e,d[g]);else Ab(a,f);return d=ub(f,"script"),d.length>0&&zb(d,!i&&ub(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,l,n=a.length,o=db(b),p=[],q=0;n>q;q++)if(f=a[q],f||0===f)if("object"===m.type(f))m.merge(p,f.nodeType?[f]:f);else if(lb.test(f)){h=h||o.appendChild(b.createElement("div")),i=(jb.exec(f)||["",""])[1].toLowerCase(),l=rb[i]||rb._default,h.innerHTML=l[1]+f.replace(ib,"<$1></$2>")+l[2],e=l[0];while(e--)h=h.lastChild;if(!k.leadingWhitespace&&hb.test(f)&&p.push(b.createTextNode(hb.exec(f)[0])),!k.tbody){f="table"!==i||kb.test(f)?"<table>"!==l[1]||kb.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)m.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}m.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),k.appendChecked||m.grep(ub(p,"input"),vb),q=0;while(f=p[q++])if((!d||-1===m.inArray(f,d))&&(g=m.contains(f.ownerDocument,f),h=ub(o.appendChild(f),"script"),g&&zb(h),c)){e=0;while(f=h[e++])ob.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=m.expando,j=m.cache,l=k.deleteExpando,n=m.event.special;null!=(d=a[h]);h++)if((b||m.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)n[e]?m.event.remove(d,e):m.removeEvent(d,e,g.handle);j[f]&&(delete j[f],l?delete d[i]:typeof d.removeAttribute!==K?d.removeAttribute(i):d[i]=null,c.push(f))}}}),m.fn.extend({text:function(a){return V(this,function(a){return void 0===a?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?m.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||m.cleanData(ub(c)),c.parentNode&&(b&&m.contains(c.ownerDocument,c)&&zb(ub(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&m.cleanData(ub(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&m.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return m.clone(this,a,b)})},html:function(a){return V(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(fb,""):void 0;if(!("string"!=typeof a||mb.test(a)||!k.htmlSerialize&&gb.test(a)||!k.leadingWhitespace&&hb.test(a)||rb[(jb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ib,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(m.cleanData(ub(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,m.cleanData(ub(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,n=this,o=l-1,p=a[0],q=m.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&nb.test(p))return this.each(function(c){var d=n.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(i=m.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=m.map(ub(i,"script"),xb),f=g.length;l>j;j++)d=i,j!==o&&(d=m.clone(d,!0,!0),f&&m.merge(g,ub(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,m.map(g,yb),j=0;f>j;j++)d=g[j],ob.test(d.type||"")&&!m._data(d,"globalEval")&&m.contains(h,d)&&(d.src?m._evalUrl&&m._evalUrl(d.src):m.globalEval((d.text||d.textContent||d.innerHTML||"").replace(qb,"")));i=c=null}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){m.fn[a]=function(a){for(var c,d=0,e=[],g=m(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),m(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Cb,Db={};function Eb(b,c){var d,e=m(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:m.css(e[0],"display");return e.detach(),f}function Fb(a){var b=y,c=Db[a];return c||(c=Eb(a,b),"none"!==c&&c||(Cb=(Cb||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Cb[0].contentWindow||Cb[0].contentDocument).document,b.write(),b.close(),c=Eb(a,b),Cb.detach()),Db[a]=c),c}!function(){var a;k.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return c=y.getElementsByTagName("body")[0],c&&c.style?(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(y.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Gb=/^margin/,Hb=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ib,Jb,Kb=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ib=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||m.contains(a.ownerDocument,a)||(g=m.style(a,b)),Hb.test(g)&&Gb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):y.documentElement.currentStyle&&(Ib=function(a){return a.currentStyle},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Hb.test(g)&&!Kb.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Lb(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h;if(b=y.createElement("div"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=d&&d.style){c.cssText="float:left;opacity:.5",k.opacity="0.5"===c.opacity,k.cssFloat=!!c.cssFloat,b.style.backgroundClip="content-box",b.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===b.style.backgroundClip,k.boxSizing=""===c.boxSizing||""===c.MozBoxSizing||""===c.WebkitBoxSizing,m.extend(k,{reliableHiddenOffsets:function(){return null==g&&i(),g},boxSizingReliable:function(){return null==f&&i(),f},pixelPosition:function(){return null==e&&i(),e},reliableMarginRight:function(){return null==h&&i(),h}});function i(){var b,c,d,i;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),b.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",e=f=!1,h=!0,a.getComputedStyle&&(e="1%"!==(a.getComputedStyle(b,null)||{}).top,f="4px"===(a.getComputedStyle(b,null)||{width:"4px"}).width,i=b.appendChild(y.createElement("div")),i.style.cssText=b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",b.style.width="1px",h=!parseFloat((a.getComputedStyle(i,null)||{}).marginRight),b.removeChild(i)),b.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=b.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",g=0===i[0].offsetHeight,g&&(i[0].style.display="",i[1].style.display="none",g=0===i[0].offsetHeight),c.removeChild(d))}}}(),m.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Mb=/alpha\([^)]*\)/i,Nb=/opacity\s*=\s*([^)]*)/,Ob=/^(none|table(?!-c[ea]).+)/,Pb=new RegExp("^("+S+")(.*)$","i"),Qb=new RegExp("^([+-])=("+S+")","i"),Rb={position:"absolute",visibility:"hidden",display:"block"},Sb={letterSpacing:"0",fontWeight:"400"},Tb=["Webkit","O","Moz","ms"];function Ub(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Tb.length;while(e--)if(b=Tb[e]+c,b in a)return b;return d}function Vb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=m._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&U(d)&&(f[g]=m._data(d,"olddisplay",Fb(d.nodeName)))):(e=U(d),(c&&"none"!==c||!e)&&m._data(d,"olddisplay",e?c:m.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Wb(a,b,c){var d=Pb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Xb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=m.css(a,c+T[f],!0,e)),d?("content"===c&&(g-=m.css(a,"padding"+T[f],!0,e)),"margin"!==c&&(g-=m.css(a,"border"+T[f]+"Width",!0,e))):(g+=m.css(a,"padding"+T[f],!0,e),"padding"!==c&&(g+=m.css(a,"border"+T[f]+"Width",!0,e)));return g}function Yb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ib(a),g=k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Jb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Hb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Xb(a,b,c||(g?"border":"content"),d,f)+"px"}m.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Jb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:k.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=m.camelCase(b),i=a.style;if(b=m.cssProps[h]||(m.cssProps[h]=Ub(i,h)),g=m.cssHooks[b]||m.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Qb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(m.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||m.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=m.camelCase(b);return b=m.cssProps[h]||(m.cssProps[h]=Ub(a.style,h)),g=m.cssHooks[b]||m.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Jb(a,b,d)),"normal"===f&&b in Sb&&(f=Sb[b]),""===c||c?(e=parseFloat(f),c===!0||m.isNumeric(e)?e||0:f):f}}),m.each(["height","width"],function(a,b){m.cssHooks[b]={get:function(a,c,d){return c?Ob.test(m.css(a,"display"))&&0===a.offsetWidth?m.swap(a,Rb,function(){return Yb(a,b,d)}):Yb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ib(a);return Wb(a,c,d?Xb(a,b,d,k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,e),e):0)}}}),k.opacity||(m.cssHooks.opacity={get:function(a,b){return Nb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=m.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===m.trim(f.replace(Mb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Mb.test(f)?f.replace(Mb,e):f+" "+e)}}),m.cssHooks.marginRight=Lb(k.reliableMarginRight,function(a,b){return b?m.swap(a,{display:"inline-block"},Jb,[a,"marginRight"]):void 0}),m.each({margin:"",padding:"",border:"Width"},function(a,b){m.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+T[d]+b]=f[d]||f[d-2]||f[0];return e}},Gb.test(a)||(m.cssHooks[a+b].set=Wb)}),m.fn.extend({css:function(a,b){return V(this,function(a,b,c){var d,e,f={},g=0;if(m.isArray(b)){for(d=Ib(a),e=b.length;e>g;g++)f[b[g]]=m.css(a,b[g],!1,d);return f}return void 0!==c?m.style(a,b,c):m.css(a,b)},a,b,arguments.length>1)},show:function(){return Vb(this,!0)},hide:function(){return Vb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){U(this)?m(this).show():m(this).hide()})}});function Zb(a,b,c,d,e){return new Zb.prototype.init(a,b,c,d,e)}m.Tween=Zb,Zb.prototype={constructor:Zb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(m.cssNumber[c]?"":"px")},cur:function(){var a=Zb.propHooks[this.prop];return a&&a.get?a.get(this):Zb.propHooks._default.get(this)},run:function(a){var b,c=Zb.propHooks[this.prop];return this.pos=b=this.options.duration?m.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Zb.propHooks._default.set(this),this}},Zb.prototype.init.prototype=Zb.prototype,Zb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=m.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){m.fx.step[a.prop]?m.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[m.cssProps[a.prop]]||m.cssHooks[a.prop])?m.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Zb.propHooks.scrollTop=Zb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},m.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},m.fx=Zb.prototype.init,m.fx.step={};var $b,_b,ac=/^(?:toggle|show|hide)$/,bc=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),cc=/queueHooks$/,dc=[ic],ec={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bc.exec(b),f=e&&e[3]||(m.cssNumber[a]?"":"px"),g=(m.cssNumber[a]||"px"!==f&&+d)&&bc.exec(m.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do{h=h||".5",g/=h,m.style(c.elem,a,g+f)}while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function fc(){return setTimeout(function(){$b=void 0}),$b=m.now()}function gc(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=T[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function hc(a,b,c){for(var d,e=(ec[b]||[]).concat(ec["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ic(a,b,c){var d,e,f,g,h,i,j,l,n=this,o={},p=a.style,q=a.nodeType&&U(a),r=m._data(a,"fxshow");c.queue||(h=m._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,n.always(function(){n.always(function(){h.unqueued--,m.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=m.css(a,"display"),l="none"===j?m._data(a,"olddisplay")||Fb(a.nodeName):j,"inline"===l&&"none"===m.css(a,"float")&&(k.inlineBlockNeedsLayout&&"inline"!==Fb(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",k.shrinkWrapBlocks()||n.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ac.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||m.style(a,d)}else j=void 0;if(m.isEmptyObject(o))"inline"===("none"===j?Fb(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=m._data(a,"fxshow",{}),f&&(r.hidden=!q),q?m(a).show():n.done(function(){m(a).hide()}),n.done(function(){var b;m._removeData(a,"fxshow");for(b in o)m.style(a,b,o[b])});for(d in o)g=hc(q?r[d]:0,d,n),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function jc(a,b){var c,d,e,f,g;for(c in a)if(d=m.camelCase(c),e=b[d],f=a[c],m.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=m.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kc(a,b,c){var d,e,f=0,g=dc.length,h=m.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$b||fc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:m.extend({},b),opts:m.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$b||fc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=m.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jc(k,j.opts.specialEasing);g>f;f++)if(d=dc[f].call(j,a,k,j.opts))return d;return m.map(k,hc,j),m.isFunction(j.opts.start)&&j.opts.start.call(a,j),m.fx.timer(m.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}m.Animation=m.extend(kc,{tweener:function(a,b){m.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],ec[c]=ec[c]||[],ec[c].unshift(b)},prefilter:function(a,b){b?dc.unshift(a):dc.push(a)}}),m.speed=function(a,b,c){var d=a&&"object"==typeof a?m.extend({},a):{complete:c||!c&&b||m.isFunction(a)&&a,duration:a,easing:c&&b||b&&!m.isFunction(b)&&b};return d.duration=m.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in m.fx.speeds?m.fx.speeds[d.duration]:m.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){m.isFunction(d.old)&&d.old.call(this),d.queue&&m.dequeue(this,d.queue)},d},m.fn.extend({fadeTo:function(a,b,c,d){return this.filter(U).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=m.isEmptyObject(a),f=m.speed(b,c,d),g=function(){var b=kc(this,m.extend({},a),f);(e||m._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=m.timers,g=m._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&cc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&m.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=m._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=m.timers,g=d?d.length:0;for(c.finish=!0,m.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),m.each(["toggle","show","hide"],function(a,b){var c=m.fn[b];m.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gc(b,!0),a,d,e)}}),m.each({slideDown:gc("show"),slideUp:gc("hide"),slideToggle:gc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){m.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),m.timers=[],m.fx.tick=function(){var a,b=m.timers,c=0;for($b=m.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||m.fx.stop(),$b=void 0},m.fx.timer=function(a){m.timers.push(a),a()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){_b||(_b=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(_b),_b=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(a,b){return a=m.fx?m.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e;b=y.createElement("div"),b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=y.createElement("select"),e=c.appendChild(y.createElement("option")),a=b.getElementsByTagName("input")[0],d.style.cssText="top:1px",k.getSetAttribute="t"!==b.className,k.style=/top/.test(d.getAttribute("style")),k.hrefNormalized="/a"===d.getAttribute("href"),k.checkOn=!!a.value,k.optSelected=e.selected,k.enctype=!!y.createElement("form").enctype,c.disabled=!0,k.optDisabled=!e.disabled,a=y.createElement("input"),a.setAttribute("value",""),k.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),k.radioValue="t"===a.value}();var lc=/\r/g;m.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=m.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,m(this).val()):a,null==e?e="":"number"==typeof e?e+="":m.isArray(e)&&(e=m.map(e,function(a){return null==a?"":a+""})),b=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=m.valHooks[e.type]||m.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(lc,""):null==c?"":c)}}}),m.extend({valHooks:{option:{get:function(a){var b=m.find.attr(a,"value");return null!=b?b:m.trim(m.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&m.nodeName(c.parentNode,"optgroup"))){if(b=m(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=m.makeArray(b),g=e.length;while(g--)if(d=e[g],m.inArray(m.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(a,b){return m.isArray(b)?a.checked=m.inArray(m(a).val(),b)>=0:void 0}},k.checkOn||(m.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var mc,nc,oc=m.expr.attrHandle,pc=/^(?:checked|selected)$/i,qc=k.getSetAttribute,rc=k.input;m.fn.extend({attr:function(a,b){return V(this,m.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){m.removeAttr(this,a)})}}),m.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===K?m.prop(a,b,c):(1===f&&m.isXMLDoc(a)||(b=b.toLowerCase(),d=m.attrHooks[b]||(m.expr.match.bool.test(b)?nc:mc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=m.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void m.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=m.propFix[c]||c,m.expr.match.bool.test(c)?rc&&qc||!pc.test(c)?a[d]=!1:a[m.camelCase("default-"+c)]=a[d]=!1:m.attr(a,c,""),a.removeAttribute(qc?c:d)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&m.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),nc={set:function(a,b,c){return b===!1?m.removeAttr(a,c):rc&&qc||!pc.test(c)?a.setAttribute(!qc&&m.propFix[c]||c,c):a[m.camelCase("default-"+c)]=a[c]=!0,c}},m.each(m.expr.match.bool.source.match(/\w+/g),function(a,b){var c=oc[b]||m.find.attr;oc[b]=rc&&qc||!pc.test(b)?function(a,b,d){var e,f;return d||(f=oc[b],oc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,oc[b]=f),e}:function(a,b,c){return c?void 0:a[m.camelCase("default-"+b)]?b.toLowerCase():null}}),rc&&qc||(m.attrHooks.value={set:function(a,b,c){return m.nodeName(a,"input")?void(a.defaultValue=b):mc&&mc.set(a,b,c)}}),qc||(mc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},oc.id=oc.name=oc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},m.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:mc.set},m.attrHooks.contenteditable={set:function(a,b,c){mc.set(a,""===b?!1:b,c)}},m.each(["width","height"],function(a,b){m.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),k.style||(m.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var sc=/^(?:input|select|textarea|button|object)$/i,tc=/^(?:a|area)$/i;m.fn.extend({prop:function(a,b){return V(this,m.prop,a,b,arguments.length>1)},removeProp:function(a){return a=m.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),m.extend({propFix:{for:"htmlFor",class:"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!m.isXMLDoc(a),f&&(b=m.propFix[b]||b,e=m.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=m.find.attr(a,"tabindex");return b?parseInt(b,10):sc.test(a.nodeName)||tc.test(a.nodeName)&&a.href?0:-1}}}}),k.hrefNormalized||m.each(["href","src"],function(a,b){m.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),k.optSelected||(m.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),k.enctype||(m.propFix.enctype="encoding");var uc=/[\t\r\n\f]/g;m.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=m.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?m.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(m.isFunction(a)?function(c){m(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=m(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===K||"boolean"===c)&&(this.className&&m._data(this,"__className__",this.className),this.className=this.className||a===!1?"":m._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(uc," ").indexOf(b)>=0)return!0;return!1}}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){m.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),m.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var vc=m.now(),wc=/\?/,xc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;m.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=m.trim(b+"");return e&&!m.trim(e.replace(xc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():m.error("Invalid JSON: "+b)},m.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+b),c};var yc,zc,Ac=/#.*$/,Bc=/([?&])_=[^&]*/,Cc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Dc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ec=/^(?:GET|HEAD)$/,Fc=/^\/\//,Gc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hc={},Ic={},Jc="*/".concat("*");try{zc=location.href}catch(Kc){zc=y.createElement("a"),zc.href="",zc=zc.href}yc=Gc.exec(zc.toLowerCase())||[];function Lc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(m.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Mc(a,b,c,d){var e={},f=a===Ic;function g(h){var i;return e[h]=!0,m.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Nc(a,b){var c,d,e=m.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&m.extend(!0,a,c),a}function Oc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Pc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zc,type:"GET",isLocal:Dc.test(yc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Jc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Nc(Nc(a,m.ajaxSettings),b):Nc(m.ajaxSettings,a)},ajaxPrefilter:Lc(Hc),ajaxTransport:Lc(Ic),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=m.ajaxSetup({},b),l=k.context||k,n=k.context&&(l.nodeType||l.jquery)?m(l):m.event,o=m.Deferred(),p=m.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Cc.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||zc)+"").replace(Ac,"").replace(Fc,yc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=m.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(c=Gc.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===yc[1]&&c[2]===yc[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(yc[3]||("http:"===yc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=m.param(k.data,k.traditional)),Mc(Hc,k,b,v),2===t)return v;h=m.event&&k.global,h&&0===m.active++&&m.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Ec.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(wc.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Bc.test(e)?e.replace(Bc,"$1_="+vc++):e+(wc.test(e)?"&":"?")+"_="+vc++)),k.ifModified&&(m.lastModified[e]&&v.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&v.setRequestHeader("If-None-Match",m.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Jc+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Mc(Ic,k,b,v)){v.readyState=1,h&&n.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Oc(k,v,c)),u=Pc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(m.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(m.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&n.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(n.trigger("ajaxComplete",[v,k]),--m.active||m.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return m.get(a,b,c,"json")},getScript:function(a,b){return m.get(a,void 0,b,"script")}}),m.each(["get","post"],function(a,b){m[b]=function(a,c,d,e){return m.isFunction(c)&&(e=e||d,d=c,c=void 0),m.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),m._evalUrl=function(a){return m.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},m.fn.extend({wrapAll:function(a){if(m.isFunction(a))return this.each(function(b){m(this).wrapAll(a.call(this,b))});if(this[0]){var b=m(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(m.isFunction(a)?function(b){m(this).wrapInner(a.call(this,b))}:function(){var b=m(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=m.isFunction(a);return this.each(function(c){m(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!k.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||m.css(a,"display"))},m.expr.filters.visible=function(a){return!m.expr.filters.hidden(a)};var Qc=/%20/g,Rc=/\[\]$/,Sc=/\r?\n/g,Tc=/^(?:submit|button|image|reset|file)$/i,Uc=/^(?:input|select|textarea|keygen)/i;function Vc(a,b,c,d){var e;if(m.isArray(b))m.each(b,function(b,e){c||Rc.test(a)?d(a,e):Vc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==m.type(b))d(a,b);else for(e in b)Vc(a+"["+e+"]",b[e],c,d)}m.param=function(a,b){var c,d=[],e=function(a,b){b=m.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(a)||a.jquery&&!m.isPlainObject(a))m.each(a,function(){e(this.name,this.value)});else for(c in a)Vc(c,a[c],b,e);return d.join("&").replace(Qc,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=m.prop(this,"elements");return a?m.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!m(this).is(":disabled")&&Uc.test(this.nodeName)&&!Tc.test(a)&&(this.checked||!W.test(a))}).map(function(a,b){var c=m(this).val();return null==c?null:m.isArray(c)?m.map(c,function(a){return{name:b.name,value:a.replace(Sc,"\r\n")}}):{name:b.name,value:c.replace(Sc,"\r\n")}}).get()}}),m.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zc()||$c()}:Zc;var Wc=0,Xc={},Yc=m.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Xc)Xc[a](void 0,!0)}),k.cors=!!Yc&&"withCredentials"in Yc,Yc=k.ajax=!!Yc,Yc&&m.ajaxTransport(function(a){if(!a.crossDomain||k.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Wc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Xc[g],b=void 0,f.onreadystatechange=m.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Xc[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function Zc(){try{return new a.XMLHttpRequest}catch(b){}}function $c(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return m.globalEval(a),a}}}),m.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),m.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=y.head||m("head")[0]||y.documentElement;return{send:function(d,e){b=y.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var _c=[],ad=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=_c.pop()||m.expando+"_"+vc++;return this[a]=!0,a}}),m.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(ad.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&ad.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(ad,"$1"+e):b.jsonp!==!1&&(b.url+=(wc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||m.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,_c.push(e)),g&&m.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),m.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||y;var d=u.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=m.buildFragment([a],b,e),e&&e.length&&m(e).remove(),m.merge([],d.childNodes))};var bd=m.fn.load;m.fn.load=function(a,b,c){if("string"!=typeof a&&bd)return bd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=m.trim(a.slice(h,a.length)),a=a.slice(0,h)),m.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&m.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?m("<div>").append(m.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){m.fn[b]=function(a){return this.on(b,a)}}),m.expr.filters.animated=function(a){return m.grep(m.timers,function(b){return a===b.elem}).length};var cd=a.document.documentElement;function dd(a){return m.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}m.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=m.css(a,"position"),l=m(a),n={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=m.css(a,"top"),i=m.css(a,"left"),j=("absolute"===k||"fixed"===k)&&m.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),m.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(n.top=b.top-h.top+g),null!=b.left&&(n.left=b.left-h.left+e),"using"in b?b.using.call(a,n):l.css(n)}},m.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){m.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,m.contains(b,e)?(typeof e.getBoundingClientRect!==K&&(d=e.getBoundingClientRect()),c=dd(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===m.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),m.nodeName(a[0],"html")||(c=a.offset()),c.top+=m.css(a[0],"borderTopWidth",!0),c.left+=m.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-m.css(d,"marginTop",!0),left:b.left-c.left-m.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||cd;while(a&&!m.nodeName(a,"html")&&"static"===m.css(a,"position"))a=a.offsetParent;return a||cd})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);m.fn[a]=function(d){return V(this,function(a,d,e){var f=dd(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?m(f).scrollLeft():e,c?e:m(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),m.each(["top","left"],function(a,b){m.cssHooks[b]=Lb(k.pixelPosition,function(a,c){return c?(c=Jb(a,b),Hb.test(c)?m(a).position()[b]+"px":c):void 0})}),m.each({Height:"height",Width:"width"},function(a,b){m.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){m.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return V(this,function(b,c,d){var e;return m.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?m.css(b,c,g):m.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var ed=a.jQuery,fd=a.$;return m.noConflict=function(b){return a.$===m&&(a.$=fd),b&&a.jQuery===m&&(a.jQuery=ed),m},typeof b===K&&(a.jQuery=a.$=m),m});!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.L={})}(this,function(t){"use strict";function i(t){var i,e,n,o;for(e=1,n=arguments.length;e<n;e++){o=arguments[e];for(i in o)t[i]=o[i]}return t}function e(t,i){var e=Array.prototype.slice;if(t.bind)return t.bind.apply(t,e.call(arguments,1));var n=e.call(arguments,2);return function(){return t.apply(i,n.length?n.concat(e.call(arguments)):arguments)}}function n(t){return t._leaflet_id=t._leaflet_id||++ei,t._leaflet_id}function o(t,i,e){var n,o,s,r;return r=function(){n=!1,o&&(s.apply(e,o),o=!1)},s=function(){n?o=arguments:(t.apply(e,arguments),setTimeout(r,i),n=!0)}}function s(t,i,e){var n=i[1],o=i[0],s=n-o;return t===n&&e?t:((t-o)%s+s)%s+o}function r(){return!1}function a(t,i){var e=Math.pow(10,void 0===i?6:i);return Math.round(t*e)/e}function h(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function u(t){return h(t).split(/\s+/)}function l(t,i){t.hasOwnProperty("options")||(t.options=t.options?ii(t.options):{});for(var e in i)t.options[e]=i[e];return t.options}function c(t,i,e){var n=[];for(var o in t)n.push(encodeURIComponent(e?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(i&&-1!==i.indexOf("?")?"&":"?")+n.join("&")}function _(t,i){return t.replace(ni,function(t,e){var n=i[e];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(i)),n})}function d(t,i){for(var e=0;e<t.length;e++)if(t[e]===i)return e;return-1}function p(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}function m(t){var i=+new Date,e=Math.max(0,16-(i-ri));return ri=i+e,window.setTimeout(t,e)}function f(t,i,n){if(!n||ai!==m)return ai.call(window,e(t,i));t.call(i)}function g(t){t&&hi.call(window,t)}function v(){}function y(t){if("undefined"!=typeof L&&L&&L.Mixin){t=oi(t)?t:[t];for(var i=0;i<t.length;i++)t[i]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}function x(t,i,e){this.x=e?Math.round(t):t,this.y=e?Math.round(i):i}function w(t,i,e){return t instanceof x?t:oi(t)?new x(t[0],t[1]):void 0===t||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new x(t.x,t.y):new x(t,i,e)}function P(t,i){if(t)for(var e=i?[t,i]:t,n=0,o=e.length;n<o;n++)this.extend(e[n])}function b(t,i){return!t||t instanceof P?t:new P(t,i)}function T(t,i){if(t)for(var e=i?[t,i]:t,n=0,o=e.length;n<o;n++)this.extend(e[n])}function z(t,i){return t instanceof T?t:new T(t,i)}function M(t,i,e){if(isNaN(t)||isNaN(i))throw new Error("Invalid LatLng object: ("+t+", "+i+")");this.lat=+t,this.lng=+i,void 0!==e&&(this.alt=+e)}function C(t,i,e){return t instanceof M?t:oi(t)&&"object"!=typeof t[0]?3===t.length?new M(t[0],t[1],t[2]):2===t.length?new M(t[0],t[1]):null:void 0===t||null===t?t:"object"==typeof t&&"lat"in t?new M(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===i?null:new M(t,i,e)}function S(t,i,e,n){if(oi(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=i,this._c=e,this._d=n}function Z(t,i,e,n){return new S(t,i,e,n)}function E(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function k(t,i){var e,n,o,s,r,a,h="";for(e=0,o=t.length;e<o;e++){for(n=0,s=(r=t[e]).length;n<s;n++)a=r[n],h+=(n?"L":"M")+a.x+" "+a.y;h+=i?Ji?"z":"x":""}return h||"M0 0"}function B(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}function A(t,i,e,n){return"touchstart"===i?O(t,e,n):"touchmove"===i?W(t,e,n):"touchend"===i&&H(t,e,n),this}function I(t,i,e){var n=t["_leaflet_"+i+e];return"touchstart"===i?t.removeEventListener(te,n,!1):"touchmove"===i?t.removeEventListener(ie,n,!1):"touchend"===i&&(t.removeEventListener(ee,n,!1),t.removeEventListener(ne,n,!1)),this}function O(t,i,n){var o=e(function(t){if("mouse"!==t.pointerType&&t.MSPOINTER_TYPE_MOUSE&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(oe.indexOf(t.target.tagName)<0))return;Pt(t)}j(t,i)});t["_leaflet_touchstart"+n]=o,t.addEventListener(te,o,!1),re||(document.documentElement.addEventListener(te,R,!0),document.documentElement.addEventListener(ie,N,!0),document.documentElement.addEventListener(ee,D,!0),document.documentElement.addEventListener(ne,D,!0),re=!0)}function R(t){se[t.pointerId]=t,ae++}function N(t){se[t.pointerId]&&(se[t.pointerId]=t)}function D(t){delete se[t.pointerId],ae--}function j(t,i){t.touches=[];for(var e in se)t.touches.push(se[e]);t.changedTouches=[t],i(t)}function W(t,i,e){var n=function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&j(t,i)};t["_leaflet_touchmove"+e]=n,t.addEventListener(ie,n,!1)}function H(t,i,e){var n=function(t){j(t,i)};t["_leaflet_touchend"+e]=n,t.addEventListener(ee,n,!1),t.addEventListener(ne,n,!1)}function F(t,i,e){function n(t){var i;if(Vi){if(!bi||"mouse"===t.pointerType)return;i=ae}else i=t.touches.length;if(!(i>1)){var e=Date.now(),n=e-(s||e);r=t.touches?t.touches[0]:t,a=n>0&&n<=h,s=e}}function o(t){if(a&&!r.cancelBubble){if(Vi){if(!bi||"mouse"===t.pointerType)return;var e,n,o={};for(n in r)e=r[n],o[n]=e&&e.bind?e.bind(r):e;r=o}r.type="dblclick",i(r),s=null}}var s,r,a=!1,h=250;return t[le+he+e]=n,t[le+ue+e]=o,t[le+"dblclick"+e]=i,t.addEventListener(he,n,!1),t.addEventListener(ue,o,!1),t.addEventListener("dblclick",i,!1),this}function U(t,i){var e=t[le+he+i],n=t[le+ue+i],o=t[le+"dblclick"+i];return t.removeEventListener(he,e,!1),t.removeEventListener(ue,n,!1),bi||t.removeEventListener("dblclick",o,!1),this}function V(t){return"string"==typeof t?document.getElementById(t):t}function q(t,i){var e=t.style[i]||t.currentStyle&&t.currentStyle[i];if((!e||"auto"===e)&&document.defaultView){var n=document.defaultView.getComputedStyle(t,null);e=n?n[i]:null}return"auto"===e?null:e}function G(t,i,e){var n=document.createElement(t);return n.className=i||"",e&&e.appendChild(n),n}function K(t){var i=t.parentNode;i&&i.removeChild(t)}function Y(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function X(t){var i=t.parentNode;i&&i.lastChild!==t&&i.appendChild(t)}function J(t){var i=t.parentNode;i&&i.firstChild!==t&&i.insertBefore(t,i.firstChild)}function $(t,i){if(void 0!==t.classList)return t.classList.contains(i);var e=et(t);return e.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(e)}function Q(t,i){if(void 0!==t.classList)for(var e=u(i),n=0,o=e.length;n<o;n++)t.classList.add(e[n]);else if(!$(t,i)){var s=et(t);it(t,(s?s+" ":"")+i)}}function tt(t,i){void 0!==t.classList?t.classList.remove(i):it(t,h((" "+et(t)+" ").replace(" "+i+" "," ")))}function it(t,i){void 0===t.className.baseVal?t.className=i:t.className.baseVal=i}function et(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function nt(t,i){"opacity"in t.style?t.style.opacity=i:"filter"in t.style&&ot(t,i)}function ot(t,i){var e=!1,n="DXImageTransform.Microsoft.Alpha";try{e=t.filters.item(n)}catch(t){if(1===i)return}i=Math.round(100*i),e?(e.Enabled=100!==i,e.Opacity=i):t.style.filter+=" progid:"+n+"(opacity="+i+")"}function st(t){for(var i=document.documentElement.style,e=0;e<t.length;e++)if(t[e]in i)return t[e];return!1}function rt(t,i,e){var n=i||new x(0,0);t.style[ce]=(Ri?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(e?" scale("+e+")":"")}function at(t,i){t._leaflet_pos=i,ji?rt(t,i):(t.style.left=i.x+"px",t.style.top=i.y+"px")}function ht(t){return t._leaflet_pos||new x(0,0)}function ut(){mt(window,"dragstart",Pt)}function lt(){ft(window,"dragstart",Pt)}function ct(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(_t(),me=t,fe=t.style.outline,t.style.outline="none",mt(window,"keydown",_t))}function _t(){me&&(me.style.outline=fe,me=void 0,fe=void 0,ft(window,"keydown",_t))}function dt(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function pt(t){var i=t.getBoundingClientRect();return{x:i.width/t.offsetWidth||1,y:i.height/t.offsetHeight||1,boundingClientRect:i}}function mt(t,i,e,n){if("object"==typeof i)for(var o in i)gt(t,o,i[o],e);else for(var s=0,r=(i=u(i)).length;s<r;s++)gt(t,i[s],e,n);return this}function ft(t,i,e,n){if("object"==typeof i)for(var o in i)vt(t,o,i[o],e);else if(i)for(var s=0,r=(i=u(i)).length;s<r;s++)vt(t,i[s],e,n);else{for(var a in t[ye])vt(t,a,t[ye][a]);delete t[ye]}return this}function gt(t,i,e,o){var s=i+n(e)+(o?"_"+n(o):"");if(t[ye]&&t[ye][s])return this;var r=function(i){return e.call(o||t,i||window.event)},a=r;Vi&&0===i.indexOf("touch")?A(t,i,r,s):!qi||"dblclick"!==i||!F||Vi&&Ei?"addEventListener"in t?"mousewheel"===i?t.addEventListener("onwheel"in t?"wheel":"mousewheel",r,!1):"mouseenter"===i||"mouseleave"===i?(r=function(i){i=i||window.event,Ct(t,i)&&a(i)},t.addEventListener("mouseenter"===i?"mouseover":"mouseout",r,!1)):("click"===i&&zi&&(r=function(t){St(t,a)}),t.addEventListener(i,r,!1)):"attachEvent"in t&&t.attachEvent("on"+i,r):F(t,r,s),t[ye]=t[ye]||{},t[ye][s]=r}function vt(t,i,e,o){var s=i+n(e)+(o?"_"+n(o):""),r=t[ye]&&t[ye][s];if(!r)return this;Vi&&0===i.indexOf("touch")?I(t,i,s):!qi||"dblclick"!==i||!U||Vi&&Ei?"removeEventListener"in t?"mousewheel"===i?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",r,!1):t.removeEventListener("mouseenter"===i?"mouseover":"mouseleave"===i?"mouseout":i,r,!1):"detachEvent"in t&&t.detachEvent("on"+i,r):U(t,s),t[ye][s]=null}function yt(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,Mt(t),this}function xt(t){return gt(t,"mousewheel",yt),this}function wt(t){return mt(t,"mousedown touchstart dblclick",yt),gt(t,"click",zt),this}function Pt(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Lt(t){return Pt(t),yt(t),this}function bt(t,i){if(!i)return new x(t.clientX,t.clientY);var e=pt(i),n=e.boundingClientRect;return new x((t.clientX-n.left)/e.x-i.clientLeft,(t.clientY-n.top)/e.y-i.clientTop)}function Tt(t){return bi?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/xe:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function zt(t){we[t.type]=!0}function Mt(t){var i=we[t.type];return we[t.type]=!1,i}function Ct(t,i){var e=i.relatedTarget;if(!e)return!0;try{for(;e&&e!==t;)e=e.parentNode}catch(t){return!1}return e!==t}function St(t,i){var e=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,n=ge&&e-ge;n&&n>100&&n<500||t.target._simulatedClick&&!t._simulated?Lt(t):(ge=e,i(t))}function Zt(t,i){if(!i||!t.length)return t.slice();var e=i*i;return t=At(t,e),t=kt(t,e)}function Et(t,i,e){return Math.sqrt(Dt(t,i,e,!0))}function kt(t,i){var e=t.length,n=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(e);n[0]=n[e-1]=1,Bt(t,n,i,0,e-1);var o,s=[];for(o=0;o<e;o++)n[o]&&s.push(t[o]);return s}function Bt(t,i,e,n,o){var s,r,a,h=0;for(r=n+1;r<=o-1;r++)(a=Dt(t[r],t[n],t[o],!0))>h&&(s=r,h=a);h>e&&(i[s]=1,Bt(t,i,e,n,s),Bt(t,i,e,s,o))}function At(t,i){for(var e=[t[0]],n=1,o=0,s=t.length;n<s;n++)Nt(t[n],t[o])>i&&(e.push(t[n]),o=n);return o<s-1&&e.push(t[s-1]),e}function It(t,i,e,n,o){var s,r,a,h=n?ke:Rt(t,e),u=Rt(i,e);for(ke=u;;){if(!(h|u))return[t,i];if(h&u)return!1;a=Rt(r=Ot(t,i,s=h||u,e,o),e),s===h?(t=r,h=a):(i=r,u=a)}}function Ot(t,i,e,n,o){var s,r,a=i.x-t.x,h=i.y-t.y,u=n.min,l=n.max;return 8&e?(s=t.x+a*(l.y-t.y)/h,r=l.y):4&e?(s=t.x+a*(u.y-t.y)/h,r=u.y):2&e?(s=l.x,r=t.y+h*(l.x-t.x)/a):1&e&&(s=u.x,r=t.y+h*(u.x-t.x)/a),new x(s,r,o)}function Rt(t,i){var e=0;return t.x<i.min.x?e|=1:t.x>i.max.x&&(e|=2),t.y<i.min.y?e|=4:t.y>i.max.y&&(e|=8),e}function Nt(t,i){var e=i.x-t.x,n=i.y-t.y;return e*e+n*n}function Dt(t,i,e,n){var o,s=i.x,r=i.y,a=e.x-s,h=e.y-r,u=a*a+h*h;return u>0&&((o=((t.x-s)*a+(t.y-r)*h)/u)>1?(s=e.x,r=e.y):o>0&&(s+=a*o,r+=h*o)),a=t.x-s,h=t.y-r,n?a*a+h*h:new x(s,r)}function jt(t){return!oi(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function Wt(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),jt(t)}function Ht(t,i,e){var n,o,s,r,a,h,u,l,c,_=[1,4,2,8];for(o=0,u=t.length;o<u;o++)t[o]._code=Rt(t[o],i);for(r=0;r<4;r++){for(l=_[r],n=[],o=0,s=(u=t.length)-1;o<u;s=o++)a=t[o],h=t[s],a._code&l?h._code&l||((c=Ot(h,a,l,i,e))._code=Rt(c,i),n.push(c)):(h._code&l&&((c=Ot(h,a,l,i,e))._code=Rt(c,i),n.push(c)),n.push(a));t=n}return t}function Ft(t,i){var e,n,o,s,r="Feature"===t.type?t.geometry:t,a=r?r.coordinates:null,h=[],u=i&&i.pointToLayer,l=i&&i.coordsToLatLng||Ut;if(!a&&!r)return null;switch(r.type){case"Point":return e=l(a),u?u(t,e):new $e(e);case"MultiPoint":for(o=0,s=a.length;o<s;o++)e=l(a[o]),h.push(u?u(t,e):new $e(e));return new Ke(h);case"LineString":case"MultiLineString":return n=Vt(a,"LineString"===r.type?0:1,l),new nn(n,i);case"Polygon":case"MultiPolygon":return n=Vt(a,"Polygon"===r.type?1:2,l),new on(n,i);case"GeometryCollection":for(o=0,s=r.geometries.length;o<s;o++){var c=Ft({geometry:r.geometries[o],type:"Feature",properties:t.properties},i);c&&h.push(c)}return new Ke(h);default:throw new Error("Invalid GeoJSON object.")}}function Ut(t){return new M(t[1],t[0],t[2])}function Vt(t,i,e){for(var n,o=[],s=0,r=t.length;s<r;s++)n=i?Vt(t[s],i-1,e):(e||Ut)(t[s]),o.push(n);return o}function qt(t,i){return i="number"==typeof i?i:6,void 0!==t.alt?[a(t.lng,i),a(t.lat,i),a(t.alt,i)]:[a(t.lng,i),a(t.lat,i)]}function Gt(t,i,e,n){for(var o=[],s=0,r=t.length;s<r;s++)o.push(i?Gt(t[s],i-1,e,n):qt(t[s],n));return!i&&e&&o.push(o[0]),o}function Kt(t,e){return t.feature?i({},t.feature,{geometry:e}):Yt(e)}function Yt(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}function Xt(t,i){return new sn(t,i)}function Jt(t,i){return new mn(t,i)}function $t(t){return Xi?new vn(t):null}function Qt(t){return Ji||$i?new Pn(t):null}var ti=Object.freeze;Object.freeze=function(t){return t};var ii=Object.create||function(){function t(){}return function(i){return t.prototype=i,new t}}(),ei=0,ni=/\{ *([\w_-]+) *\}/g,oi=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},si="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",ri=0,ai=window.requestAnimationFrame||p("RequestAnimationFrame")||m,hi=window.cancelAnimationFrame||p("CancelAnimationFrame")||p("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)},ui=(Object.freeze||Object)({freeze:ti,extend:i,create:ii,bind:e,lastId:ei,stamp:n,throttle:o,wrapNum:s,falseFn:r,formatNum:a,trim:h,splitWords:u,setOptions:l,getParamString:c,template:_,isArray:oi,indexOf:d,emptyImageUrl:si,requestFn:ai,cancelFn:hi,requestAnimFrame:f,cancelAnimFrame:g});v.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=e.__super__=this.prototype,o=ii(n);o.constructor=e,e.prototype=o;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&"__super__"!==s&&(e[s]=this[s]);return t.statics&&(i(e,t.statics),delete t.statics),t.includes&&(y(t.includes),i.apply(null,[o].concat(t.includes)),delete t.includes),o.options&&(t.options=i(ii(o.options),t.options)),i(o,t),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,i=o._initHooks.length;t<i;t++)o._initHooks[t].call(this)}},e},v.include=function(t){return i(this.prototype,t),this},v.mergeOptions=function(t){return i(this.prototype.options,t),this},v.addInitHook=function(t){var i=Array.prototype.slice.call(arguments,1),e="function"==typeof t?t:function(){this[t].apply(this,i)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(e),this};var li={on:function(t,i,e){if("object"==typeof t)for(var n in t)this._on(n,t[n],i);else for(var o=0,s=(t=u(t)).length;o<s;o++)this._on(t[o],i,e);return this},off:function(t,i,e){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],i);else for(var o=0,s=(t=u(t)).length;o<s;o++)this._off(t[o],i,e);else delete this._events;return this},_on:function(t,i,e){this._events=this._events||{};var n=this._events[t];n||(n=[],this._events[t]=n),e===this&&(e=void 0);for(var o={fn:i,ctx:e},s=n,r=0,a=s.length;r<a;r++)if(s[r].fn===i&&s[r].ctx===e)return;s.push(o)},_off:function(t,i,e){var n,o,s;if(this._events&&(n=this._events[t]))if(i){if(e===this&&(e=void 0),n)for(o=0,s=n.length;o<s;o++){var a=n[o];if(a.ctx===e&&a.fn===i)return a.fn=r,this._firingCount&&(this._events[t]=n=n.slice()),void n.splice(o,1)}}else{for(o=0,s=n.length;o<s;o++)n[o].fn=r;delete this._events[t]}},fire:function(t,e,n){if(!this.listens(t,n))return this;var o=i({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var s=this._events[t];if(s){this._firingCount=this._firingCount+1||1;for(var r=0,a=s.length;r<a;r++){var h=s[r];h.fn.call(h.ctx||this,o)}this._firingCount--}}return n&&this._propagateEvent(o),this},listens:function(t,i){var e=this._events&&this._events[t];if(e&&e.length)return!0;if(i)for(var n in this._eventParents)if(this._eventParents[n].listens(t,i))return!0;return!1},once:function(t,i,n){if("object"==typeof t){for(var o in t)this.once(o,t[o],i);return this}var s=e(function(){this.off(t,i,n).off(t,s,n)},this);return this.on(t,i,n).on(t,s,n)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[n(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[n(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,i({layer:t.target,propagatedFrom:t.target},t),!0)}};li.addEventListener=li.on,li.removeEventListener=li.clearAllEventListeners=li.off,li.addOneTimeEventListener=li.once,li.fireEvent=li.fire,li.hasEventListeners=li.listens;var ci=v.extend(li),_i=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};x.prototype={clone:function(){return new x(this.x,this.y)},add:function(t){return this.clone()._add(w(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(w(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new x(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new x(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=_i(this.x),this.y=_i(this.y),this},distanceTo:function(t){var i=(t=w(t)).x-this.x,e=t.y-this.y;return Math.sqrt(i*i+e*e)},equals:function(t){return(t=w(t)).x===this.x&&t.y===this.y},contains:function(t){return t=w(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+a(this.x)+", "+a(this.y)+")"}},P.prototype={extend:function(t){return t=w(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new x((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new x(this.min.x,this.max.y)},getTopRight:function(){return new x(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var i,e;return(t="number"==typeof t[0]||t instanceof x?w(t):b(t))instanceof P?(i=t.min,e=t.max):i=e=t,i.x>=this.min.x&&e.x<=this.max.x&&i.y>=this.min.y&&e.y<=this.max.y},intersects:function(t){t=b(t);var i=this.min,e=this.max,n=t.min,o=t.max,s=o.x>=i.x&&n.x<=e.x,r=o.y>=i.y&&n.y<=e.y;return s&&r},overlaps:function(t){t=b(t);var i=this.min,e=this.max,n=t.min,o=t.max,s=o.x>i.x&&n.x<e.x,r=o.y>i.y&&n.y<e.y;return s&&r},isValid:function(){return!(!this.min||!this.max)}},T.prototype={extend:function(t){var i,e,n=this._southWest,o=this._northEast;if(t instanceof M)i=t,e=t;else{if(!(t instanceof T))return t?this.extend(C(t)||z(t)):this;if(i=t._southWest,e=t._northEast,!i||!e)return this}return n||o?(n.lat=Math.min(i.lat,n.lat),n.lng=Math.min(i.lng,n.lng),o.lat=Math.max(e.lat,o.lat),o.lng=Math.max(e.lng,o.lng)):(this._southWest=new M(i.lat,i.lng),this._northEast=new M(e.lat,e.lng)),this},pad:function(t){var i=this._southWest,e=this._northEast,n=Math.abs(i.lat-e.lat)*t,o=Math.abs(i.lng-e.lng)*t;return new T(new M(i.lat-n,i.lng-o),new M(e.lat+n,e.lng+o))},getCenter:function(){return new M((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new M(this.getNorth(),this.getWest())},getSouthEast:function(){return new M(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof M||"lat"in t?C(t):z(t);var i,e,n=this._southWest,o=this._northEast;return t instanceof T?(i=t.getSouthWest(),e=t.getNorthEast()):i=e=t,i.lat>=n.lat&&e.lat<=o.lat&&i.lng>=n.lng&&e.lng<=o.lng},intersects:function(t){t=z(t);var i=this._southWest,e=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),s=o.lat>=i.lat&&n.lat<=e.lat,r=o.lng>=i.lng&&n.lng<=e.lng;return s&&r},overlaps:function(t){t=z(t);var i=this._southWest,e=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),s=o.lat>i.lat&&n.lat<e.lat,r=o.lng>i.lng&&n.lng<e.lng;return s&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,i){return!!t&&(t=z(t),this._southWest.equals(t.getSouthWest(),i)&&this._northEast.equals(t.getNorthEast(),i))},isValid:function(){return!(!this._southWest||!this._northEast)}},M.prototype={equals:function(t,i){return!!t&&(t=C(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===i?1e-9:i))},toString:function(t){return"LatLng("+a(this.lat,t)+", "+a(this.lng,t)+")"},distanceTo:function(t){return pi.distance(this,C(t))},wrap:function(){return pi.wrapLatLng(this)},toBounds:function(t){var i=180*t/40075017,e=i/Math.cos(Math.PI/180*this.lat);return z([this.lat-i,this.lng-e],[this.lat+i,this.lng+e])},clone:function(){return new M(this.lat,this.lng,this.alt)}};var di={latLngToPoint:function(t,i){var e=this.projection.project(t),n=this.scale(i);return this.transformation._transform(e,n)},pointToLatLng:function(t,i){var e=this.scale(i),n=this.transformation.untransform(t,e);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var i=this.projection.bounds,e=this.scale(t);return new P(this.transformation.transform(i.min,e),this.transformation.transform(i.max,e))},infinite:!1,wrapLatLng:function(t){var i=this.wrapLng?s(t.lng,this.wrapLng,!0):t.lng;return new M(this.wrapLat?s(t.lat,this.wrapLat,!0):t.lat,i,t.alt)},wrapLatLngBounds:function(t){var i=t.getCenter(),e=this.wrapLatLng(i),n=i.lat-e.lat,o=i.lng-e.lng;if(0===n&&0===o)return t;var s=t.getSouthWest(),r=t.getNorthEast();return new T(new M(s.lat-n,s.lng-o),new M(r.lat-n,r.lng-o))}},pi=i({},di,{wrapLng:[-180,180],R:6371e3,distance:function(t,i){var e=Math.PI/180,n=t.lat*e,o=i.lat*e,s=Math.sin((i.lat-t.lat)*e/2),r=Math.sin((i.lng-t.lng)*e/2),a=s*s+Math.cos(n)*Math.cos(o)*r*r,h=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*h}}),mi={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var i=Math.PI/180,e=this.MAX_LATITUDE,n=Math.max(Math.min(e,t.lat),-e),o=Math.sin(n*i);return new x(this.R*t.lng*i,this.R*Math.log((1+o)/(1-o))/2)},unproject:function(t){var i=180/Math.PI;return new M((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*i,t.x*i/this.R)},bounds:function(){var t=6378137*Math.PI;return new P([-t,-t],[t,t])}()};S.prototype={transform:function(t,i){return this._transform(t.clone(),i)},_transform:function(t,i){return i=i||1,t.x=i*(this._a*t.x+this._b),t.y=i*(this._c*t.y+this._d),t},untransform:function(t,i){return i=i||1,new x((t.x/i-this._b)/this._a,(t.y/i-this._d)/this._c)}};var fi,gi,vi,yi=i({},pi,{code:"EPSG:3857",projection:mi,transformation:function(){var t=.5/(Math.PI*mi.R);return Z(t,.5,-t,.5)}()}),xi=i({},yi,{code:"EPSG:900913"}),wi=document.documentElement.style,Pi="ActiveXObject"in window,Li=Pi&&!document.addEventListener,bi="msLaunchUri"in navigator&&!("documentMode"in document),Ti=B("webkit"),zi=B("android"),Mi=B("android 2")||B("android 3"),Ci=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Si=zi&&B("Google")&&Ci<537&&!("AudioNode"in window),Zi=!!window.opera,Ei=B("chrome"),ki=B("gecko")&&!Ti&&!Zi&&!Pi,Bi=!Ei&&B("safari"),Ai=B("phantom"),Ii="OTransition"in wi,Oi=0===navigator.platform.indexOf("Win"),Ri=Pi&&"transition"in wi,Ni="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Mi,Di="MozPerspective"in wi,ji=!window.L_DISABLE_3D&&(Ri||Ni||Di)&&!Ii&&!Ai,Wi="undefined"!=typeof orientation||B("mobile"),Hi=Wi&&Ti,Fi=Wi&&Ni,Ui=!window.PointerEvent&&window.MSPointerEvent,Vi=!(!window.PointerEvent&&!Ui),qi=!window.L_NO_TOUCH&&(Vi||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),Gi=Wi&&Zi,Ki=Wi&&ki,Yi=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Xi=!!document.createElement("canvas").getContext,Ji=!(!document.createElementNS||!E("svg").createSVGRect),$i=!Ji&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(t){return!1}}(),Qi=(Object.freeze||Object)({ie:Pi,ielt9:Li,edge:bi,webkit:Ti,android:zi,android23:Mi,androidStock:Si,opera:Zi,chrome:Ei,gecko:ki,safari:Bi,phantom:Ai,opera12:Ii,win:Oi,ie3d:Ri,webkit3d:Ni,gecko3d:Di,any3d:ji,mobile:Wi,mobileWebkit:Hi,mobileWebkit3d:Fi,msPointer:Ui,pointer:Vi,touch:qi,mobileOpera:Gi,mobileGecko:Ki,retina:Yi,canvas:Xi,svg:Ji,vml:$i}),te=Ui?"MSPointerDown":"pointerdown",ie=Ui?"MSPointerMove":"pointermove",ee=Ui?"MSPointerUp":"pointerup",ne=Ui?"MSPointerCancel":"pointercancel",oe=["INPUT","SELECT","OPTION"],se={},re=!1,ae=0,he=Ui?"MSPointerDown":Vi?"pointerdown":"touchstart",ue=Ui?"MSPointerUp":Vi?"pointerup":"touchend",le="_leaflet_",ce=st(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),_e=st(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),de="webkitTransition"===_e||"OTransition"===_e?_e+"End":"transitionend";if("onselectstart"in document)fi=function(){mt(window,"selectstart",Pt)},gi=function(){ft(window,"selectstart",Pt)};else{var pe=st(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);fi=function(){if(pe){var t=document.documentElement.style;vi=t[pe],t[pe]="none"}},gi=function(){pe&&(document.documentElement.style[pe]=vi,vi=void 0)}}var me,fe,ge,ve=(Object.freeze||Object)({TRANSFORM:ce,TRANSITION:_e,TRANSITION_END:de,get:V,getStyle:q,create:G,remove:K,empty:Y,toFront:X,toBack:J,hasClass:$,addClass:Q,removeClass:tt,setClass:it,getClass:et,setOpacity:nt,testProp:st,setTransform:rt,setPosition:at,getPosition:ht,disableTextSelection:fi,enableTextSelection:gi,disableImageDrag:ut,enableImageDrag:lt,preventOutline:ct,restoreOutline:_t,getSizedParentNode:dt,getScale:pt}),ye="_leaflet_events",xe=Oi&&Ei?2*window.devicePixelRatio:ki?window.devicePixelRatio:1,we={},Pe=(Object.freeze||Object)({on:mt,off:ft,stopPropagation:yt,disableScrollPropagation:xt,disableClickPropagation:wt,preventDefault:Pt,stop:Lt,getMousePosition:bt,getWheelDelta:Tt,fakeStop:zt,skipped:Mt,isExternalTarget:Ct,addListener:mt,removeListener:ft}),Le=ci.extend({run:function(t,i,e,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=e||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=ht(t),this._offset=i.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=f(this._animate,this),this._step()},_step:function(t){var i=+new Date-this._startTime,e=1e3*this._duration;i<e?this._runFrame(this._easeOut(i/e),t):(this._runFrame(1),this._complete())},_runFrame:function(t,i){var e=this._startPos.add(this._offset.multiplyBy(t));i&&e._round(),at(this._el,e),this.fire("step")},_complete:function(){g(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),be=ci.extend({options:{crs:yi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,i){i=l(this,i),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=e(this._onResize,this),this._initEvents(),i.maxBounds&&this.setMaxBounds(i.maxBounds),void 0!==i.zoom&&(this._zoom=this._limitZoom(i.zoom)),i.center&&void 0!==i.zoom&&this.setView(C(i.center),i.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=_e&&ji&&!Gi&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),mt(this._proxy,de,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,n){return e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(C(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&!0!==n&&(void 0!==n.animate&&(n.zoom=i({animate:n.animate},n.zoom),n.pan=i({animate:n.animate,duration:n.duration},n.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,e),this)},setZoom:function(t,i){return this._loaded?this.setView(this.getCenter(),t,{zoom:i}):(this._zoom=t,this)},zoomIn:function(t,i){return t=t||(ji?this.options.zoomDelta:1),this.setZoom(this._zoom+t,i)},zoomOut:function(t,i){return t=t||(ji?this.options.zoomDelta:1),this.setZoom(this._zoom-t,i)},setZoomAround:function(t,i,e){var n=this.getZoomScale(i),o=this.getSize().divideBy(2),s=(t instanceof x?t:this.latLngToContainerPoint(t)).subtract(o).multiplyBy(1-1/n),r=this.containerPointToLatLng(o.add(s));return this.setView(r,i,{zoom:e})},_getBoundsCenterZoom:function(t,i){i=i||{},t=t.getBounds?t.getBounds():z(t);var e=w(i.paddingTopLeft||i.padding||[0,0]),n=w(i.paddingBottomRight||i.padding||[0,0]),o=this.getBoundsZoom(t,!1,e.add(n));if((o="number"==typeof i.maxZoom?Math.min(i.maxZoom,o):o)===1/0)return{center:t.getCenter(),zoom:o};var s=n.subtract(e).divideBy(2),r=this.project(t.getSouthWest(),o),a=this.project(t.getNorthEast(),o);return{center:this.unproject(r.add(a).divideBy(2).add(s),o),zoom:o}},fitBounds:function(t,i){if(!(t=z(t)).isValid())throw new Error("Bounds are not valid.");var e=this._getBoundsCenterZoom(t,i);return this.setView(e.center,e.zoom,i)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,i){return this.setView(t,this._zoom,{pan:i})},panBy:function(t,i){if(t=w(t).round(),i=i||{},!t.x&&!t.y)return this.fire("moveend");if(!0!==i.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Le,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),i.noMoveStart||this.fire("movestart"),!1!==i.animate){Q(this._mapPane,"leaflet-pan-anim");var e=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,e,i.duration||.25,i.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,i,e){function n(t){var i=(g*g-m*m+(t?-1:1)*x*x*v*v)/(2*(t?g:m)*x*v),e=Math.sqrt(i*i+1)-i;return e<1e-9?-18:Math.log(e)}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}function r(t){return o(t)/s(t)}function a(t){return m*(s(w)/s(w+y*t))}function h(t){return m*(s(w)*r(w+y*t)-o(w))/x}function u(t){return 1-Math.pow(1-t,1.5)}function l(){var e=(Date.now()-P)/b,n=u(e)*L;e<=1?(this._flyToFrame=f(l,this),this._move(this.unproject(c.add(_.subtract(c).multiplyBy(h(n)/v)),p),this.getScaleZoom(m/a(n),p),{flyTo:!0})):this._move(t,i)._moveEnd(!0)}if(!1===(e=e||{}).animate||!ji)return this.setView(t,i,e);this._stop();var c=this.project(this.getCenter()),_=this.project(t),d=this.getSize(),p=this._zoom;t=C(t),i=void 0===i?p:i;var m=Math.max(d.x,d.y),g=m*this.getZoomScale(p,i),v=_.distanceTo(c)||1,y=1.42,x=y*y,w=n(0),P=Date.now(),L=(n(1)-w)/y,b=e.duration?1e3*e.duration:1e3*L*.8;return this._moveStart(!0,e.noMoveStart),l.call(this),this},flyToBounds:function(t,i){var e=this._getBoundsCenterZoom(t,i);return this.flyTo(e.center,e.zoom,i)},setMaxBounds:function(t){return(t=z(t)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var i=this.options.minZoom;return this.options.minZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var i=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&i!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,i){this._enforcingBounds=!0;var e=this.getCenter(),n=this._limitCenter(e,this._zoom,z(t));return e.equals(n)||this.panTo(n,i),this._enforcingBounds=!1,this},panInside:function(t,i){var e=w((i=i||{}).paddingTopLeft||i.padding||[0,0]),n=w(i.paddingBottomRight||i.padding||[0,0]),o=this.getCenter(),s=this.project(o),r=this.project(t),a=this.getPixelBounds(),h=a.getSize().divideBy(2),u=b([a.min.add(e),a.max.subtract(n)]);if(!u.contains(r)){this._enforcingBounds=!0;var l=s.subtract(r),c=w(r.x+l.x,r.y+l.y);(r.x<u.min.x||r.x>u.max.x)&&(c.x=s.x-l.x,l.x>0?c.x+=h.x-e.x:c.x-=h.x-n.x),(r.y<u.min.y||r.y>u.max.y)&&(c.y=s.y-l.y,l.y>0?c.y+=h.y-e.y:c.y-=h.y-n.y),this.panTo(this.unproject(c),i),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=i({animate:!1,pan:!0},!0===t?{animate:!0}:t);var n=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),s=n.divideBy(2).round(),r=o.divideBy(2).round(),a=s.subtract(r);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(e(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:n,newSize:o})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=i({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var n=e(this._handleGeolocationResponse,this),o=e(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(n,o,t):navigator.geolocation.getCurrentPosition(n,o,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var i=t.code,e=t.message||(1===i?"permission denied":2===i?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:i,message:"Geolocation error: "+e+"."})},_handleGeolocationResponse:function(t){var i=new M(t.coords.latitude,t.coords.longitude),e=i.toBounds(2*t.coords.accuracy),n=this._locateOptions;if(n.setView){var o=this.getBoundsZoom(e);this.setView(i,n.maxZoom?Math.min(o,n.maxZoom):o)}var s={latlng:i,bounds:e,timestamp:t.timestamp};for(var r in t.coords)"number"==typeof t.coords[r]&&(s[r]=t.coords[r]);this.fire("locationfound",s)},addHandler:function(t,i){if(!i)return this;var e=this[t]=new i(this);return this._handlers.push(e),this.options[t]&&e.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),K(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(g(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)K(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,i){var e=G("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),i||this._mapPane);return t&&(this._panes[t]=e),e},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new T(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,i,e){t=z(t),e=w(e||[0,0]);var n=this.getZoom()||0,o=this.getMinZoom(),s=this.getMaxZoom(),r=t.getNorthWest(),a=t.getSouthEast(),h=this.getSize().subtract(e),u=b(this.project(a,n),this.project(r,n)).getSize(),l=ji?this.options.zoomSnap:1,c=h.x/u.x,_=h.y/u.y,d=i?Math.max(c,_):Math.min(c,_);return n=this.getScaleZoom(d,n),l&&(n=Math.round(n/(l/100))*(l/100),n=i?Math.ceil(n/l)*l:Math.floor(n/l)*l),Math.max(o,Math.min(s,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new x(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,i){var e=this._getTopLeftPoint(t,i);return new P(e,e.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,i){var e=this.options.crs;return i=void 0===i?this._zoom:i,e.scale(t)/e.scale(i)},getScaleZoom:function(t,i){var e=this.options.crs;i=void 0===i?this._zoom:i;var n=e.zoom(t*e.scale(i));return isNaN(n)?1/0:n},project:function(t,i){return i=void 0===i?this._zoom:i,this.options.crs.latLngToPoint(C(t),i)},unproject:function(t,i){return i=void 0===i?this._zoom:i,this.options.crs.pointToLatLng(w(t),i)},layerPointToLatLng:function(t){var i=w(t).add(this.getPixelOrigin());return this.unproject(i)},latLngToLayerPoint:function(t){return this.project(C(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(C(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(z(t))},distance:function(t,i){return this.options.crs.distance(C(t),C(i))},containerPointToLayerPoint:function(t){return w(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return w(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var i=this.containerPointToLayerPoint(w(t));return this.layerPointToLatLng(i)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(C(t)))},mouseEventToContainerPoint:function(t){return bt(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var i=this._container=V(t);if(!i)throw new Error("Map container not found.");if(i._leaflet_id)throw new Error("Map container is already initialized.");mt(i,"scroll",this._onScroll,this),this._containerId=n(i)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&ji,Q(t,"leaflet-container"+(qi?" leaflet-touch":"")+(Yi?" leaflet-retina":"")+(Li?" leaflet-oldie":"")+(Bi?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var i=q(t,"position");"absolute"!==i&&"relative"!==i&&"fixed"!==i&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),at(this._mapPane,new x(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Q(t.markerPane,"leaflet-zoom-hide"),Q(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,i){at(this._mapPane,new x(0,0));var e=!this._loaded;this._loaded=!0,i=this._limitZoom(i),this.fire("viewprereset");var n=this._zoom!==i;this._moveStart(n,!1)._move(t,i)._moveEnd(n),this.fire("viewreset"),e&&this.fire("load")},_moveStart:function(t,i){return t&&this.fire("zoomstart"),i||this.fire("movestart"),this},_move:function(t,i,e){void 0===i&&(i=this._zoom);var n=this._zoom!==i;return this._zoom=i,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(n||e&&e.pinch)&&this.fire("zoom",e),this.fire("move",e)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return g(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){at(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[n(this._container)]=this;var i=t?ft:mt;i(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&i(window,"resize",this._onResize,this),ji&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){g(this._resizeRequest),this._resizeRequest=f(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,i){for(var e,o=[],s="mouseout"===i||"mouseover"===i,r=t.target||t.srcElement,a=!1;r;){if((e=this._targets[n(r)])&&("click"===i||"preclick"===i)&&!t._simulated&&this._draggableMoved(e)){a=!0;break}if(e&&e.listens(i,!0)){if(s&&!Ct(r,t))break;if(o.push(e),s)break}if(r===this._container)break;r=r.parentNode}return o.length||a||s||!Ct(r,t)||(o=[this]),o},_handleDOMEvent:function(t){if(this._loaded&&!Mt(t)){var i=t.type;"mousedown"!==i&&"keypress"!==i||ct(t.target||t.srcElement),this._fireDOMEvent(t,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,n){if("click"===t.type){var o=i({},t);o.type="preclick",this._fireDOMEvent(o,o.type,n)}if(!t._stopped&&(n=(n||[]).concat(this._findEventTargets(t,e))).length){var s=n[0];"contextmenu"===e&&s.listens(e,!0)&&Pt(t);var r={originalEvent:t};if("keypress"!==t.type){var a=s.getLatLng&&(!s._radius||s._radius<=10);r.containerPoint=a?this.latLngToContainerPoint(s.getLatLng()):this.mouseEventToContainerPoint(t),r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlng=a?s.getLatLng():this.layerPointToLatLng(r.layerPoint)}for(var h=0;h<n.length;h++)if(n[h].fire(e,r,!0),r.originalEvent._stopped||!1===n[h].options.bubblingMouseEvents&&-1!==d(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,i=this._handlers.length;t<i;t++)this._handlers[t].disable()},whenReady:function(t,i){return this._loaded?t.call(i||this,{target:this}):this.on("load",t,i),this},_getMapPanePos:function(){return ht(this._mapPane)||new x(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,i){return(t&&void 0!==i?this._getNewPixelOrigin(t,i):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,i){var e=this.getSize()._divideBy(2);return this.project(t,i)._subtract(e)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,i,e){var n=this._getNewPixelOrigin(e,i);return this.project(t,i)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,i,e){var n=this._getNewPixelOrigin(e,i);return b([this.project(t.getSouthWest(),i)._subtract(n),this.project(t.getNorthWest(),i)._subtract(n),this.project(t.getSouthEast(),i)._subtract(n),this.project(t.getNorthEast(),i)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,i,e){if(!e)return t;var n=this.project(t,i),o=this.getSize().divideBy(2),s=new P(n.subtract(o),n.add(o)),r=this._getBoundsOffset(s,e,i);return r.round().equals([0,0])?t:this.unproject(n.add(r),i)},_limitOffset:function(t,i){if(!i)return t;var e=this.getPixelBounds(),n=new P(e.min.add(t),e.max.add(t));return t.add(this._getBoundsOffset(n,i))},_getBoundsOffset:function(t,i,e){var n=b(this.project(i.getNorthEast(),e),this.project(i.getSouthWest(),e)),o=n.min.subtract(t.min),s=n.max.subtract(t.max);return new x(this._rebound(o.x,-s.x),this._rebound(o.y,-s.y))},_rebound:function(t,i){return t+i>0?Math.round(t-i)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(i))},_limitZoom:function(t){var i=this.getMinZoom(),e=this.getMaxZoom(),n=ji?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(i,Math.min(e,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){tt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,i){var e=this._getCenterOffset(t)._trunc();return!(!0!==(i&&i.animate)&&!this.getSize().contains(e))&&(this.panBy(e,i),!0)},_createAnimProxy:function(){var t=this._proxy=G("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var i=ce,e=this._proxy.style[i];rt(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),e===this._proxy.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var t=this.getCenter(),i=this.getZoom();rt(this._proxy,this.project(t,i),this.getZoomScale(i,1))},this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){K(this._proxy),delete this._proxy},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,i,e){if(this._animatingZoom)return!0;if(e=e||{},!this._zoomAnimated||!1===e.animate||this._nothingToAnimate()||Math.abs(i-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(i),o=this._getCenterOffset(t)._divideBy(1-1/n);return!(!0!==e.animate&&!this.getSize().contains(o))&&(f(function(){this._moveStart(!0,!1)._animateZoom(t,i,!0)},this),!0)},_animateZoom:function(t,i,n,o){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=i,Q(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:i,noUpdate:o}),setTimeout(e(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&tt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),f(function(){this._moveEnd(!0)},this))}}),Te=v.extend({options:{position:"topright"},initialize:function(t){l(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var i=this._map;return i&&i.removeControl(this),this.options.position=t,i&&i.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var i=this._container=this.onAdd(t),e=this.getPosition(),n=t._controlCorners[e];return Q(i,"leaflet-control"),-1!==e.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},remove:function(){return this._map?(K(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),ze=function(t){return new Te(t)};be.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,o){var s=e+t+" "+e+o;i[t+o]=G("div",s,n)}var i=this._controlCorners={},e="leaflet-",n=this._controlContainer=G("div",e+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)K(this._controlCorners[t]);K(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Me=Te.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,i,e,n){return e<n?-1:n<e?1:0}},initialize:function(t,i,e){l(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in i)this._addLayer(i[n],n,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Te.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,i){return this._addLayer(t,i),this._map?this._update():this},addOverlay:function(t,i){return this._addLayer(t,i,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var i=this._getLayer(n(t));return i&&this._layers.splice(this._layers.indexOf(i),1),this._map?this._update():this},expand:function(){Q(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(Q(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):tt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return tt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",i=this._container=G("div",t),e=this.options.collapsed;i.setAttribute("aria-haspopup",!0),wt(i),xt(i);var n=this._section=G("section",t+"-list");e&&(this._map.on("click",this.collapse,this),zi||mt(i,{mouseenter:this.expand,mouseleave:this.collapse},this));var o=this._layersLink=G("a",t+"-toggle",i);o.href="#",o.title="Layers",qi?(mt(o,"click",Lt),mt(o,"click",this.expand,this)):mt(o,"focus",this.expand,this),e||this.expand(),this._baseLayersList=G("div",t+"-base",n),this._separator=G("div",t+"-separator",n),this._overlaysList=G("div",t+"-overlays",n),i.appendChild(n)},_getLayer:function(t){for(var i=0;i<this._layers.length;i++)if(this._layers[i]&&n(this._layers[i].layer)===t)return this._layers[i]},_addLayer:function(t,i,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:i,overlay:n}),this.options.sortLayers&&this._layers.sort(e(function(t,i){return this.options.sortFunction(t.layer,i.layer,t.name,i.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Y(this._baseLayersList),Y(this._overlaysList),this._layerControlInputs=[];var t,i,e,n,o=0;for(e=0;e<this._layers.length;e++)n=this._layers[e],this._addItem(n),i=i||n.overlay,t=t||!n.overlay,o+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&o>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=i&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var i=this._getLayer(n(t.target)),e=i.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;e&&this._map.fire(e,i)},_createRadioElement:function(t,i){var e='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/>",n=document.createElement("div");return n.innerHTML=e,n.firstChild},_addItem:function(t){var i,e=document.createElement("label"),o=this._map.hasLayer(t.layer);t.overlay?((i=document.createElement("input")).type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=o):i=this._createRadioElement("leaflet-base-layers",o),this._layerControlInputs.push(i),i.layerId=n(t.layer),mt(i,"click",this._onInputClick,this);var s=document.createElement("span");s.innerHTML=" "+t.name;var r=document.createElement("div");return e.appendChild(r),r.appendChild(i),r.appendChild(s),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(e),this._checkDisabledLayers(),e},_onInputClick:function(){var t,i,e=this._layerControlInputs,n=[],o=[];this._handlingClick=!0;for(var s=e.length-1;s>=0;s--)t=e[s],i=this._getLayer(t.layerId).layer,t.checked?n.push(i):t.checked||o.push(i);for(s=0;s<o.length;s++)this._map.hasLayer(o[s])&&this._map.removeLayer(o[s]);for(s=0;s<n.length;s++)this._map.hasLayer(n[s])||this._map.addLayer(n[s]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,i,e=this._layerControlInputs,n=this._map.getZoom(),o=e.length-1;o>=0;o--)t=e[o],i=this._getLayer(t.layerId).layer,t.disabled=void 0!==i.options.minZoom&&n<i.options.minZoom||void 0!==i.options.maxZoom&&n>i.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),Ce=Te.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(t){var i="leaflet-control-zoom",e=G("div",i+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,i+"-in",e,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,i+"-out",e,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),e},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,i,e,n,o){var s=G("a",e,n);return s.innerHTML=t,s.href="#",s.title=i,s.setAttribute("role","button"),s.setAttribute("aria-label",i),wt(s),mt(s,"click",Lt),mt(s,"click",o,this),mt(s,"click",this._refocusOnMap,this),s},_updateDisabled:function(){var t=this._map,i="leaflet-disabled";tt(this._zoomInButton,i),tt(this._zoomOutButton,i),(this._disabled||t._zoom===t.getMinZoom())&&Q(this._zoomOutButton,i),(this._disabled||t._zoom===t.getMaxZoom())&&Q(this._zoomInButton,i)}});be.mergeOptions({zoomControl:!0}),be.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ce,this.addControl(this.zoomControl))});var Se=Te.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var i=G("div","leaflet-control-scale"),e=this.options;return this._addScales(e,"leaflet-control-scale-line",i),t.on(e.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,i,e){t.metric&&(this._mScale=G("div",i,e)),t.imperial&&(this._iScale=G("div",i,e))},_update:function(){var t=this._map,i=t.getSize().y/2,e=t.distance(t.containerPointToLatLng([0,i]),t.containerPointToLatLng([this.options.maxWidth,i]));this._updateScales(e)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var i=this._getRoundNum(t),e=i<1e3?i+" m":i/1e3+" km";this._updateScale(this._mScale,e,i/t)},_updateImperial:function(t){var i,e,n,o=3.2808399*t;o>5280?(i=o/5280,e=this._getRoundNum(i),this._updateScale(this._iScale,e+" mi",e/i)):(n=this._getRoundNum(o),this._updateScale(this._iScale,n+" ft",n/o))},_updateScale:function(t,i,e){t.style.width=Math.round(this.options.maxWidth*e)+"px",t.innerHTML=i},_getRoundNum:function(t){var i=Math.pow(10,(Math.floor(t)+"").length-1),e=t/i;return e=e>=10?10:e>=5?5:e>=3?3:e>=2?2:1,i*e}}),Ze=Te.extend({options:{position:"bottomright",prefix:""},initialize:function(t){l(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=G("div","leaflet-control-attribution"),wt(this._container);for(var i in t._layers)t._layers[i].getAttribution&&this.addAttribution(t._layers[i].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var i in this._attributions)this._attributions[i]&&t.push(i);var e=[];this.options.prefix&&e.push(this.options.prefix),t.length&&e.push(t.join(", ")),this._container.innerHTML=e.join(" | ")}}});be.mergeOptions({attributionControl:!0}),be.addInitHook(function(){this.options.attributionControl&&(new Ze).addTo(this)});Te.Layers=Me,Te.Zoom=Ce,Te.Scale=Se,Te.Attribution=Ze,ze.layers=function(t,i,e){return new Me(t,i,e)},ze.zoom=function(t){return new Ce(t)},ze.scale=function(t){return new Se(t)},ze.attribution=function(t){return new Ze(t)};var Ee=v.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ee.addTo=function(t,i){return t.addHandler(i,this),this};var ke,Be={Events:li},Ae=qi?"touchstart mousedown":"mousedown",Ie={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},Oe={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Re=ci.extend({options:{clickTolerance:3},initialize:function(t,i,e,n){l(this,n),this._element=t,this._dragStartTarget=i||t,this._preventOutline=e},enable:function(){this._enabled||(mt(this._dragStartTarget,Ae,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Re._dragging===this&&this.finishDrag(),ft(this._dragStartTarget,Ae,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!$(this._element,"leaflet-zoom-anim")&&!(Re._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(Re._dragging=this,this._preventOutline&&ct(this._element),ut(),fi(),this._moving)))){this.fire("down");var i=t.touches?t.touches[0]:t,e=dt(this._element);this._startPoint=new x(i.clientX,i.clientY),this._parentScale=pt(e),mt(document,Oe[t.type],this._onMove,this),mt(document,Ie[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var i=t.touches&&1===t.touches.length?t.touches[0]:t,e=new x(i.clientX,i.clientY)._subtract(this._startPoint);(e.x||e.y)&&(Math.abs(e.x)+Math.abs(e.y)<this.options.clickTolerance||(e.x/=this._parentScale.x,e.y/=this._parentScale.y,Pt(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=ht(this._element).subtract(e),Q(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Q(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(e),this._moving=!0,g(this._animRequest),this._lastEvent=t,this._animRequest=f(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),at(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){tt(document.body,"leaflet-dragging"),this._lastTarget&&(tt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in Oe)ft(document,Oe[t],this._onMove,this),ft(document,Ie[t],this._onUp,this);lt(),gi(),this._moved&&this._moving&&(g(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,Re._dragging=!1}}),Ne=(Object.freeze||Object)({simplify:Zt,pointToSegmentDistance:Et,closestPointOnSegment:function(t,i,e){return Dt(t,i,e)},clipSegment:It,_getEdgeIntersection:Ot,_getBitCode:Rt,_sqClosestPointOnSegment:Dt,isFlat:jt,_flat:Wt}),De=(Object.freeze||Object)({clipPolygon:Ht}),je={project:function(t){return new x(t.lng,t.lat)},unproject:function(t){return new M(t.y,t.x)},bounds:new P([-180,-90],[180,90])},We={R:6378137,R_MINOR:6356752.314245179,bounds:new P([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var i=Math.PI/180,e=this.R,n=t.lat*i,o=this.R_MINOR/e,s=Math.sqrt(1-o*o),r=s*Math.sin(n),a=Math.tan(Math.PI/4-n/2)/Math.pow((1-r)/(1+r),s/2);return n=-e*Math.log(Math.max(a,1e-10)),new x(t.lng*i*e,n)},unproject:function(t){for(var i,e=180/Math.PI,n=this.R,o=this.R_MINOR/n,s=Math.sqrt(1-o*o),r=Math.exp(-t.y/n),a=Math.PI/2-2*Math.atan(r),h=0,u=.1;h<15&&Math.abs(u)>1e-7;h++)i=s*Math.sin(a),i=Math.pow((1-i)/(1+i),s/2),a+=u=Math.PI/2-2*Math.atan(r*i)-a;return new M(a*e,t.x*e/n)}},He=(Object.freeze||Object)({LonLat:je,Mercator:We,SphericalMercator:mi}),Fe=i({},pi,{code:"EPSG:3395",projection:We,transformation:function(){var t=.5/(Math.PI*We.R);return Z(t,.5,-t,.5)}()}),Ue=i({},pi,{code:"EPSG:4326",projection:je,transformation:Z(1/180,1,-1/180,.5)}),Ve=i({},di,{projection:je,transformation:Z(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,i){var e=i.lng-t.lng,n=i.lat-t.lat;return Math.sqrt(e*e+n*n)},infinite:!0});di.Earth=pi,di.EPSG3395=Fe,di.EPSG3857=yi,di.EPSG900913=xi,di.EPSG4326=Ue,di.Simple=Ve;var qe=ci.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[n(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[n(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var i=t.target;if(i.hasLayer(this)){if(this._map=i,this._zoomAnimated=i._zoomAnimated,this.getEvents){var e=this.getEvents();i.on(e,this),this.once("remove",function(){i.off(e,this)},this)}this.onAdd(i),this.getAttribution&&i.attributionControl&&i.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),i.fire("layeradd",{layer:this})}}});be.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var i=n(t);return this._layers[i]?this:(this._layers[i]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var i=n(t);return this._layers[i]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[i],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&n(t)in this._layers},eachLayer:function(t,i){for(var e in this._layers)t.call(i,this._layers[e]);return this},_addLayers:function(t){for(var i=0,e=(t=t?oi(t)?t:[t]:[]).length;i<e;i++)this.addLayer(t[i])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[n(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var i=n(t);this._zoomBoundLayers[i]&&(delete this._zoomBoundLayers[i],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,i=-1/0,e=this._getZoomSpan();for(var n in this._zoomBoundLayers){var o=this._zoomBoundLayers[n].options;t=void 0===o.minZoom?t:Math.min(t,o.minZoom),i=void 0===o.maxZoom?i:Math.max(i,o.maxZoom)}this._layersMaxZoom=i===-1/0?void 0:i,this._layersMinZoom=t===1/0?void 0:t,e!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ge=qe.extend({initialize:function(t,i){l(this,i),this._layers={};var e,n;if(t)for(e=0,n=t.length;e<n;e++)this.addLayer(t[e])},addLayer:function(t){var i=this.getLayerId(t);return this._layers[i]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var i=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[i]&&this._map.removeLayer(this._layers[i]),delete this._layers[i],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var i,e,n=Array.prototype.slice.call(arguments,1);for(i in this._layers)(e=this._layers[i])[t]&&e[t].apply(e,n);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,i){for(var e in this._layers)t.call(i,this._layers[e]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return n(t)}}),Ke=Ge.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ge.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ge.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new T;for(var i in this._layers){var e=this._layers[i];t.extend(e.getBounds?e.getBounds():e.getLatLng())}return t}}),Ye=v.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){l(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,i){var e=this._getIconUrl(t);if(!e){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(e,i&&"IMG"===i.tagName?i:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,i){var e=this.options,n=e[i+"Size"];"number"==typeof n&&(n=[n,n]);var o=w(n),s=w("shadow"===i&&e.shadowAnchor||e.iconAnchor||o&&o.divideBy(2,!0));t.className="leaflet-marker-"+i+" "+(e.className||""),s&&(t.style.marginLeft=-s.x+"px",t.style.marginTop=-s.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,i){return i=i||document.createElement("img"),i.src=t,i},_getIconUrl:function(t){return Yi&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),Xe=Ye.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return Xe.imagePath||(Xe.imagePath=this._detectIconPath()),(this.options.imagePath||Xe.imagePath)+Ye.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=G("div","leaflet-default-icon-path",document.body),i=q(t,"background-image")||q(t,"backgroundImage");return document.body.removeChild(t),i=null===i||0!==i.indexOf("url")?"":i.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),Je=Ee.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new Re(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Q(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&tt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var i=this._marker,e=i._map,n=this._marker.options.autoPanSpeed,o=this._marker.options.autoPanPadding,s=ht(i._icon),r=e.getPixelBounds(),a=e.getPixelOrigin(),h=b(r.min._subtract(a).add(o),r.max._subtract(a).subtract(o));if(!h.contains(s)){var u=w((Math.max(h.max.x,s.x)-h.max.x)/(r.max.x-h.max.x)-(Math.min(h.min.x,s.x)-h.min.x)/(r.min.x-h.min.x),(Math.max(h.max.y,s.y)-h.max.y)/(r.max.y-h.max.y)-(Math.min(h.min.y,s.y)-h.min.y)/(r.min.y-h.min.y)).multiplyBy(n);e.panBy(u,{animate:!1}),this._draggable._newPos._add(u),this._draggable._startPos._add(u),at(i._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=f(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(g(this._panRequest),this._panRequest=f(this._adjustPan.bind(this,t)))},_onDrag:function(t){var i=this._marker,e=i._shadow,n=ht(i._icon),o=i._map.layerPointToLatLng(n);e&&at(e,n),i._latlng=o,t.latlng=o,t.oldLatLng=this._oldLatLng,i.fire("move",t).fire("drag",t)},_onDragEnd:function(t){g(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),$e=qe.extend({options:{icon:new Xe,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,i){l(this,i),this._latlng=C(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var i=this._latlng;return this._latlng=C(t),this.update(),this.fire("move",{oldLatLng:i,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,i="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),e=t.icon.createIcon(this._icon),n=!1;e!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(e.title=t.title),"IMG"===e.tagName&&(e.alt=t.alt||"")),Q(e,i),t.keyboard&&(e.tabIndex="0"),this._icon=e,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var o=t.icon.createShadow(this._shadow),s=!1;o!==this._shadow&&(this._removeShadow(),s=!0),o&&(Q(o,i),o.alt=""),this._shadow=o,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),o&&s&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),K(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&K(this._shadow),this._shadow=null},_setPos:function(t){at(this._icon,t),this._shadow&&at(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(i)},_initInteraction:function(){if(this.options.interactive&&(Q(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Je)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Je(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;nt(this._icon,t),this._shadow&&nt(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Qe=qe.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return l(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),tn=Qe.extend({options:{fill:!0,radius:10},initialize:function(t,i){l(this,i),this._latlng=C(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=C(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var i=t&&t.radius||this._radius;return Qe.prototype.setStyle.call(this,t),this.setRadius(i),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,i=this._radiusY||t,e=this._clickTolerance(),n=[t+e,i+e];this._pxBounds=new P(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),en=tn.extend({initialize:function(t,e,n){if("number"==typeof e&&(e=i({},n,{radius:e})),l(this,e),this._latlng=C(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new T(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Qe.prototype.setStyle,_project:function(){var t=this._latlng.lng,i=this._latlng.lat,e=this._map,n=e.options.crs;if(n.distance===pi.distance){var o=Math.PI/180,s=this._mRadius/pi.R/o,r=e.project([i+s,t]),a=e.project([i-s,t]),h=r.add(a).divideBy(2),u=e.unproject(h).lat,l=Math.acos((Math.cos(s*o)-Math.sin(i*o)*Math.sin(u*o))/(Math.cos(i*o)*Math.cos(u*o)))/o;(isNaN(l)||0===l)&&(l=s/Math.cos(Math.PI/180*i)),this._point=h.subtract(e.getPixelOrigin()),this._radius=isNaN(l)?0:h.x-e.project([u,t-l]).x,this._radiusY=h.y-r.y}else{var c=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=e.latLngToLayerPoint(this._latlng),this._radius=this._point.x-e.latLngToLayerPoint(c).x}this._updateBounds()}}),nn=Qe.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,i){l(this,i),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var i,e,n=1/0,o=null,s=Dt,r=0,a=this._parts.length;r<a;r++)for(var h=this._parts[r],u=1,l=h.length;u<l;u++){var c=s(t,i=h[u-1],e=h[u],!0);c<n&&(n=c,o=s(t,i,e))}return o&&(o.distance=Math.sqrt(n)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,i,e,n,o,s,r,a=this._rings[0],h=a.length;if(!h)return null;for(t=0,i=0;t<h-1;t++)i+=a[t].distanceTo(a[t+1])/2;if(0===i)return this._map.layerPointToLatLng(a[0]);for(t=0,n=0;t<h-1;t++)if(o=a[t],s=a[t+1],e=o.distanceTo(s),(n+=e)>i)return r=(n-i)/e,this._map.layerPointToLatLng([s.x-r*(s.x-o.x),s.y-r*(s.y-o.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,i){return i=i||this._defaultShape(),t=C(t),i.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new T,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return jt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var i=[],e=jt(t),n=0,o=t.length;n<o;n++)e?(i[n]=C(t[n]),this._bounds.extend(i[n])):i[n]=this._convertLatLngs(t[n]);return i},_project:function(){var t=new P;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var i=this._clickTolerance(),e=new x(i,i);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(e),t.max._add(e),this._pxBounds=t)},_projectLatlngs:function(t,i,e){var n,o,s=t[0]instanceof M,r=t.length;if(s){for(o=[],n=0;n<r;n++)o[n]=this._map.latLngToLayerPoint(t[n]),e.extend(o[n]);i.push(o)}else for(n=0;n<r;n++)this._projectLatlngs(t[n],i,e)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var i,e,n,o,s,r,a,h=this._parts;for(i=0,n=0,o=this._rings.length;i<o;i++)for(e=0,s=(a=this._rings[i]).length;e<s-1;e++)(r=It(a[e],a[e+1],t,e,!0))&&(h[n]=h[n]||[],h[n].push(r[0]),r[1]===a[e+1]&&e!==s-2||(h[n].push(r[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,i=this.options.smoothFactor,e=0,n=t.length;e<n;e++)t[e]=Zt(t[e],i)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,i){var e,n,o,s,r,a,h=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(e=0,s=this._parts.length;e<s;e++)for(n=0,o=(r=(a=this._parts[e]).length)-1;n<r;o=n++)if((i||0!==n)&&Et(t,a[o],a[n])<=h)return!0;return!1}});nn._flat=Wt;var on=nn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,i,e,n,o,s,r,a,h,u=this._rings[0],l=u.length;if(!l)return null;for(s=r=a=0,t=0,i=l-1;t<l;i=t++)e=u[t],n=u[i],o=e.y*n.x-n.y*e.x,r+=(e.x+n.x)*o,a+=(e.y+n.y)*o,s+=3*o;return h=0===s?u[0]:[r/s,a/s],this._map.layerPointToLatLng(h)},_convertLatLngs:function(t){var i=nn.prototype._convertLatLngs.call(this,t),e=i.length;return e>=2&&i[0]instanceof M&&i[0].equals(i[e-1])&&i.pop(),i},_setLatLngs:function(t){nn.prototype._setLatLngs.call(this,t),jt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return jt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,i=this.options.weight,e=new x(i,i);if(t=new P(t.min.subtract(e),t.max.add(e)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var n,o=0,s=this._rings.length;o<s;o++)(n=Ht(this._rings[o],t,!0)).length&&this._parts.push(n)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var i,e,n,o,s,r,a,h,u=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(o=0,a=this._parts.length;o<a;o++)for(s=0,r=(h=(i=this._parts[o]).length)-1;s<h;r=s++)e=i[s],n=i[r],e.y>t.y!=n.y>t.y&&t.x<(n.x-e.x)*(t.y-e.y)/(n.y-e.y)+e.x&&(u=!u);return u||nn.prototype._containsPoint.call(this,t,!0)}}),sn=Ke.extend({initialize:function(t,i){l(this,i),this._layers={},t&&this.addData(t)},addData:function(t){var i,e,n,o=oi(t)?t:t.features;if(o){for(i=0,e=o.length;i<e;i++)((n=o[i]).geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var s=this.options;if(s.filter&&!s.filter(t))return this;var r=Ft(t,s);return r?(r.feature=Yt(t),r.defaultOptions=r.options,this.resetStyle(r),s.onEachFeature&&s.onEachFeature(t,r),this.addLayer(r)):this},resetStyle:function(t){return t.options=i({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(i){this._setLayerStyle(i,t)},this)},_setLayerStyle:function(t,i){"function"==typeof i&&(i=i(t.feature)),t.setStyle&&t.setStyle(i)}}),rn={toGeoJSON:function(t){return Kt(this,{type:"Point",coordinates:qt(this.getLatLng(),t)})}};$e.include(rn),en.include(rn),tn.include(rn),nn.include({toGeoJSON:function(t){var i=!jt(this._latlngs),e=Gt(this._latlngs,i?1:0,!1,t);return Kt(this,{type:(i?"Multi":"")+"LineString",coordinates:e})}}),on.include({toGeoJSON:function(t){var i=!jt(this._latlngs),e=i&&!jt(this._latlngs[0]),n=Gt(this._latlngs,e?2:i?1:0,!0,t);return i||(n=[n]),Kt(this,{type:(e?"Multi":"")+"Polygon",coordinates:n})}}),Ge.include({toMultiPoint:function(t){var i=[];return this.eachLayer(function(e){i.push(e.toGeoJSON(t).geometry.coordinates)}),Kt(this,{type:"MultiPoint",coordinates:i})},toGeoJSON:function(t){var i=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===i)return this.toMultiPoint(t);var e="GeometryCollection"===i,n=[];return this.eachLayer(function(i){if(i.toGeoJSON){var o=i.toGeoJSON(t);if(e)n.push(o.geometry);else{var s=Yt(o);"FeatureCollection"===s.type?n.push.apply(n,s.features):n.push(s)}}}),e?Kt(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}});var an=Xt,hn=qe.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,i,e){this._url=t,this._bounds=z(i),l(this,e)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Q(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){K(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&X(this._image),this},bringToBack:function(){return this._map&&J(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=z(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,i=this._image=t?this._url:G("img");Q(i,"leaflet-image-layer"),this._zoomAnimated&&Q(i,"leaflet-zoom-animated"),this.options.className&&Q(i,this.options.className),i.onselectstart=r,i.onmousemove=r,i.onload=e(this.fire,this,"load"),i.onerror=e(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=i.src:(i.src=this._url,i.alt=this.options.alt)},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),e=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;rt(this._image,e,i)},_reset:function(){var t=this._image,i=new P(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),e=i.getSize();at(t,i.min),t.style.width=e.x+"px",t.style.height=e.y+"px"},_updateOpacity:function(){nt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),un=hn.extend({options:{autoplay:!0,loop:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,i=this._image=t?this._url:G("video");if(Q(i,"leaflet-image-layer"),this._zoomAnimated&&Q(i,"leaflet-zoom-animated"),i.onselectstart=r,i.onmousemove=r,i.onloadeddata=e(this.fire,this,"load"),t){for(var n=i.getElementsByTagName("source"),o=[],s=0;s<n.length;s++)o.push(n[s].src);this._url=n.length>0?o:[i.src]}else{oi(this._url)||(this._url=[this._url]),i.autoplay=!!this.options.autoplay,i.loop=!!this.options.loop;for(var a=0;a<this._url.length;a++){var h=G("source");h.src=this._url[a],i.appendChild(h)}}}}),ln=qe.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,i){l(this,t),this._source=i},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&nt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&nt(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(nt(this._container,0),this._removeTimeout=setTimeout(e(K,void 0,this._container),200)):K(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=C(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&X(this._container),this},bringToBack:function(){return this._map&&J(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,i="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof i)t.innerHTML=i;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(i)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),i=w(this.options.offset),e=this._getAnchor();this._zoomAnimated?at(this._container,t.add(e)):i=i.add(t).add(e);var n=this._containerBottom=-i.y,o=this._containerLeft=-Math.round(this._containerWidth/2)+i.x;this._container.style.bottom=n+"px",this._container.style.left=o+"px"}},_getAnchor:function(){return[0,0]}}),cn=ln.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){ln.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Qe||this._source.on("preclick",yt))},onRemove:function(t){ln.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Qe||this._source.off("preclick",yt))},getEvents:function(){var t=ln.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",i=this._container=G("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),e=this._wrapper=G("div",t+"-content-wrapper",i);if(this._contentNode=G("div",t+"-content",e),wt(e),xt(this._contentNode),mt(e,"contextmenu",yt),this._tipContainer=G("div",t+"-tip-container",i),this._tip=G("div",t+"-tip",this._tipContainer),this.options.closeButton){var n=this._closeButton=G("a",t+"-close-button",i);n.href="#close",n.innerHTML="&#215;",mt(n,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var t=this._contentNode,i=t.style;i.width="",i.whiteSpace="nowrap";var e=t.offsetWidth;e=Math.min(e,this.options.maxWidth),e=Math.max(e,this.options.minWidth),i.width=e+1+"px",i.whiteSpace="",i.height="";var n=t.offsetHeight,o=this.options.maxHeight;o&&n>o?(i.height=o+"px",Q(t,"leaflet-popup-scrolled")):tt(t,"leaflet-popup-scrolled"),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),e=this._getAnchor();at(this._container,i.add(e))},_adjustPan:function(){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var t=this._map,i=parseInt(q(this._container,"marginBottom"),10)||0,e=this._container.offsetHeight+i,n=this._containerWidth,o=new x(this._containerLeft,-e-this._containerBottom);o._add(ht(this._container));var s=t.layerPointToContainerPoint(o),r=w(this.options.autoPanPadding),a=w(this.options.autoPanPaddingTopLeft||r),h=w(this.options.autoPanPaddingBottomRight||r),u=t.getSize(),l=0,c=0;s.x+n+h.x>u.x&&(l=s.x+n-u.x+h.x),s.x-l-a.x<0&&(l=s.x-a.x),s.y+e+h.y>u.y&&(c=s.y+e-u.y+h.y),s.y-c-a.y<0&&(c=s.y-a.y),(l||c)&&t.fire("autopanstart").panBy([l,c])}},_onCloseButtonClick:function(t){this._close(),Lt(t)},_getAnchor:function(){return w(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});be.mergeOptions({closePopupOnClick:!0}),be.include({openPopup:function(t,i,e){return t instanceof cn||(t=new cn(e).setContent(t)),i&&t.setLatLng(i),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),qe.include({bindPopup:function(t,i){return t instanceof cn?(l(t,i),this._popup=t,t._source=this):(this._popup&&!i||(this._popup=new cn(i,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,i){if(t instanceof qe||(i=t,t=this),t instanceof Ke)for(var e in this._layers){t=this._layers[e];break}return i||(i=t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,i)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var i=t.layer||t.target;this._popup&&this._map&&(Lt(t),i instanceof Qe?this.openPopup(t.layer||t.target,t.latlng):this._map.hasLayer(this._popup)&&this._popup._source===i?this.closePopup():this.openPopup(i,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var _n=ln.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){ln.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){ln.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=ln.prototype.getEvents.call(this);return qi&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=G("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var i=this._map,e=this._container,n=i.latLngToContainerPoint(i.getCenter()),o=i.layerPointToContainerPoint(t),s=this.options.direction,r=e.offsetWidth,a=e.offsetHeight,h=w(this.options.offset),u=this._getAnchor();"top"===s?t=t.add(w(-r/2+h.x,-a+h.y+u.y,!0)):"bottom"===s?t=t.subtract(w(r/2-h.x,-h.y,!0)):"center"===s?t=t.subtract(w(r/2+h.x,a/2-u.y+h.y,!0)):"right"===s||"auto"===s&&o.x<n.x?(s="right",t=t.add(w(h.x+u.x,u.y-a/2+h.y,!0))):(s="left",t=t.subtract(w(r+u.x-h.x,a/2-u.y-h.y,!0))),tt(e,"leaflet-tooltip-right"),tt(e,"leaflet-tooltip-left"),tt(e,"leaflet-tooltip-top"),tt(e,"leaflet-tooltip-bottom"),Q(e,"leaflet-tooltip-"+s),at(e,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&nt(this._container,t)},_animateZoom:function(t){var i=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(i)},_getAnchor:function(){return w(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});be.include({openTooltip:function(t,i,e){return t instanceof _n||(t=new _n(e).setContent(t)),i&&t.setLatLng(i),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),qe.include({bindTooltip:function(t,i){return t instanceof _n?(l(t,i),this._tooltip=t,t._source=this):(this._tooltip&&!i||(this._tooltip=new _n(i,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var i=t?"off":"on",e={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?e.add=this._openTooltip:(e.mouseover=this._openTooltip,e.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(e.mousemove=this._moveTooltip),qi&&(e.click=this._openTooltip)),this[i](e),this._tooltipHandlersAdded=!t}},openTooltip:function(t,i){if(t instanceof qe||(i=t,t=this),t instanceof Ke)for(var e in this._layers){t=this._layers[e];break}return i||(i=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,i),this._tooltip.options.interactive&&this._tooltip._container&&(Q(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(tt(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var i=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(i,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var i,e,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(i=this._map.mouseEventToContainerPoint(t.originalEvent),e=this._map.containerPointToLayerPoint(i),n=this._map.layerPointToLatLng(e)),this._tooltip.setLatLng(n)}});var dn=Ye.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:document.createElement("div"),e=this.options;if(i.innerHTML=!1!==e.html?e.html:"",e.bgPos){var n=w(e.bgPos);i.style.backgroundPosition=-n.x+"px "+-n.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}});Ye.Default=Xe;var pn=qe.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Wi,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){l(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),K(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(X(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(J(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=o(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof x?t:new x(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var i,e=this.getPane().children,n=-t(-1/0,1/0),o=0,s=e.length;o<s;o++)i=e[o].style.zIndex,e[o]!==this._container&&i&&(n=t(n,+i));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Li){nt(this._container,this.options.opacity);var t=+new Date,i=!1,e=!1;for(var n in this._tiles){var o=this._tiles[n];if(o.current&&o.loaded){var s=Math.min(1,(t-o.loaded)/200);nt(o.el,s),s<1?i=!0:(o.active?e=!0:this._onOpaqueTile(o),o.active=!0)}}e&&!this._noPrune&&this._pruneTiles(),i&&(g(this._fadeFrame),this._fadeFrame=f(this._updateOpacity,this))}},_onOpaqueTile:r,_initContainer:function(){this._container||(this._container=G("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,i=this.options.maxZoom;if(void 0!==t){for(var e in this._levels)this._levels[e].el.children.length||e===t?(this._levels[e].el.style.zIndex=i-Math.abs(t-e),this._onUpdateLevel(e)):(K(this._levels[e].el),this._removeTilesAtZoom(e),this._onRemoveLevel(e),delete this._levels[e]);var n=this._levels[t],o=this._map;return n||((n=this._levels[t]={}).el=G("div","leaflet-tile-container leaflet-zoom-animated",this._container),n.el.style.zIndex=i,n.origin=o.project(o.unproject(o.getPixelOrigin()),t).round(),n.zoom=t,this._setZoomTransform(n,o.getCenter(),o.getZoom()),n.el.offsetWidth,this._onCreateLevel(n)),this._level=n,n}},_onUpdateLevel:r,_onRemoveLevel:r,_onCreateLevel:r,_pruneTiles:function(){if(this._map){var t,i,e=this._map.getZoom();if(e>this.options.maxZoom||e<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(i=this._tiles[t]).retain=i.current;for(t in this._tiles)if((i=this._tiles[t]).current&&!i.active){var n=i.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var i in this._tiles)this._tiles[i].coords.z===t&&this._removeTile(i)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)K(this._levels[t].el),this._onRemoveLevel(t),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,i,e,n){var o=Math.floor(t/2),s=Math.floor(i/2),r=e-1,a=new x(+o,+s);a.z=+r;var h=this._tileCoordsToKey(a),u=this._tiles[h];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),r>n&&this._retainParent(o,s,r,n))},_retainChildren:function(t,i,e,n){for(var o=2*t;o<2*t+2;o++)for(var s=2*i;s<2*i+2;s++){var r=new x(o,s);r.z=e+1;var a=this._tileCoordsToKey(r),h=this._tiles[a];h&&h.active?h.retain=!0:(h&&h.loaded&&(h.retain=!0),e+1<n&&this._retainChildren(o,s,e+1,n))}},_resetView:function(t){var i=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),i,i)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var i=this.options;return void 0!==i.minNativeZoom&&t<i.minNativeZoom?i.minNativeZoom:void 0!==i.maxNativeZoom&&i.maxNativeZoom<t?i.maxNativeZoom:t},_setView:function(t,i,e,n){var o=this._clampZoom(Math.round(i));(void 0!==this.options.maxZoom&&o>this.options.maxZoom||void 0!==this.options.minZoom&&o<this.options.minZoom)&&(o=void 0);var s=this.options.updateWhenZooming&&o!==this._tileZoom;n&&!s||(this._tileZoom=o,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==o&&this._update(t),e||this._pruneTiles(),this._noPrune=!!e),this._setZoomTransforms(t,i)},_setZoomTransforms:function(t,i){for(var e in this._levels)this._setZoomTransform(this._levels[e],t,i)},_setZoomTransform:function(t,i,e){var n=this._map.getZoomScale(e,t.zoom),o=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(i,e)).round();ji?rt(t.el,o,n):at(t.el,o)},_resetGrid:function(){var t=this._map,i=t.options.crs,e=this._tileSize=this.getTileSize(),n=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&&(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=i.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,i.wrapLng[0]],n).x/e.x),Math.ceil(t.project([0,i.wrapLng[1]],n).x/e.y)],this._wrapY=i.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([i.wrapLat[0],0],n).y/e.x),Math.ceil(t.project([i.wrapLat[1],0],n).y/e.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var i=this._map,e=i._animatingZoom?Math.max(i._animateToZoom,i.getZoom()):i.getZoom(),n=i.getZoomScale(e,this._tileZoom),o=i.project(t,this._tileZoom).floor(),s=i.getSize().divideBy(2*n);return new P(o.subtract(s),o.add(s))},_update:function(t){var i=this._map;if(i){var e=this._clampZoom(i.getZoom());if(void 0===t&&(t=i.getCenter()),void 0!==this._tileZoom){var n=this._getTiledPixelBounds(t),o=this._pxBoundsToTileRange(n),s=o.getCenter(),r=[],a=this.options.keepBuffer,h=new P(o.getBottomLeft().subtract([a,-a]),o.getTopRight().add([a,-a]));if(!(isFinite(o.min.x)&&isFinite(o.min.y)&&isFinite(o.max.x)&&isFinite(o.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var u in this._tiles){var l=this._tiles[u].coords;l.z===this._tileZoom&&h.contains(new x(l.x,l.y))||(this._tiles[u].current=!1)}if(Math.abs(e-this._tileZoom)>1)this._setView(t,e);else{for(var c=o.min.y;c<=o.max.y;c++)for(var _=o.min.x;_<=o.max.x;_++){var d=new x(_,c);if(d.z=this._tileZoom,this._isValidTile(d)){var p=this._tiles[this._tileCoordsToKey(d)];p?p.current=!0:r.push(d)}}if(r.sort(function(t,i){return t.distanceTo(s)-i.distanceTo(s)}),0!==r.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(_=0;_<r.length;_++)this._addTile(r[_],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var i=this._map.options.crs;if(!i.infinite){var e=this._globalTileRange;if(!i.wrapLng&&(t.x<e.min.x||t.x>e.max.x)||!i.wrapLat&&(t.y<e.min.y||t.y>e.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return z(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var i=this._map,e=this.getTileSize(),n=t.scaleBy(e),o=n.add(e);return[i.unproject(n,t.z),i.unproject(o,t.z)]},_tileCoordsToBounds:function(t){var i=this._tileCoordsToNwSe(t),e=new T(i[0],i[1]);return this.options.noWrap||(e=this._map.wrapLatLngBounds(e)),e},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var i=t.split(":"),e=new x(+i[0],+i[1]);return e.z=+i[2],e},_removeTile:function(t){var i=this._tiles[t];i&&(K(i.el),delete this._tiles[t],this.fire("tileunload",{tile:i.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){Q(t,"leaflet-tile");var i=this.getTileSize();t.style.width=i.x+"px",t.style.height=i.y+"px",t.onselectstart=r,t.onmousemove=r,Li&&this.options.opacity<1&&nt(t,this.options.opacity),zi&&!Mi&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,i){var n=this._getTilePos(t),o=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),e(this._tileReady,this,t));this._initTile(s),this.createTile.length<2&&f(e(this._tileReady,this,t,null,s)),at(s,n),this._tiles[o]={el:s,coords:t,current:!0},i.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,i,n){i&&this.fire("tileerror",{error:i,tile:n,coords:t});var o=this._tileCoordsToKey(t);(n=this._tiles[o])&&(n.loaded=+new Date,this._map._fadeAnimated?(nt(n.el,0),g(this._fadeFrame),this._fadeFrame=f(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),i||(Q(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Li||!this._map._fadeAnimated?f(this._pruneTiles,this):setTimeout(e(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var i=new x(this._wrapX?s(t.x,this._wrapX):t.x,this._wrapY?s(t.y,this._wrapY):t.y);return i.z=t.z,i},_pxBoundsToTileRange:function(t){var i=this.getTileSize();return new P(t.min.unscaleBy(i).floor(),t.max.unscaleBy(i).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),mn=pn.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,i){this._url=t,(i=l(this,i)).detectRetina&&Yi&&i.maxZoom>0&&(i.tileSize=Math.floor(i.tileSize/2),i.zoomReverse?(i.zoomOffset--,i.minZoom++):(i.zoomOffset++,i.maxZoom--),i.minZoom=Math.max(0,i.minZoom)),"string"==typeof i.subdomains&&(i.subdomains=i.subdomains.split("")),zi||this.on("tileunload",this._onTileRemove)},setUrl:function(t,i){return this._url===t&&void 0===i&&(i=!0),this._url=t,i||this.redraw(),this},createTile:function(t,i){var n=document.createElement("img");return mt(n,"load",e(this._tileOnLoad,this,i,n)),mt(n,"error",e(this._tileOnError,this,i,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:Yi?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var n=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=n),e["-y"]=n}return _(this._url,i(e,this.options))},_tileOnLoad:function(t,i){Li?setTimeout(e(t,this,null,i),0):t(null,i)},_tileOnError:function(t,i,e){var n=this.options.errorTileUrl;n&&i.getAttribute("src")!==n&&(i.src=n),t(e,i)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,i=this.options.maxZoom,e=this.options.zoomReverse,n=this.options.zoomOffset;return e&&(t=i-t),t+n},_getSubdomain:function(t){var i=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[i]},_abortLoading:function(){var t,i;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&((i=this._tiles[t].el).onload=r,i.onerror=r,i.complete||(i.src=si,K(i),delete this._tiles[t]))},_removeTile:function(t){var i=this._tiles[t];if(i)return Si||i.el.setAttribute("src",si),pn.prototype._removeTile.call(this,t)},_tileReady:function(t,i,e){if(this._map&&(!e||e.getAttribute("src")!==si))return pn.prototype._tileReady.call(this,t,i,e)}}),fn=mn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var n=i({},this.defaultWmsParams);for(var o in e)o in this.options||(n[o]=e[o]);var s=(e=l(this,e)).detectRetina&&Yi?2:1,r=this.getTileSize();n.width=r.x*s,n.height=r.y*s,this.wmsParams=n},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var i=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[i]=this._crs.code,mn.prototype.onAdd.call(this,t)},getTileUrl:function(t){var i=this._tileCoordsToNwSe(t),e=this._crs,n=b(e.project(i[0]),e.project(i[1])),o=n.min,s=n.max,r=(this._wmsVersion>=1.3&&this._crs===Ue?[o.y,o.x,s.y,s.x]:[o.x,o.y,s.x,s.y]).join(","),a=mn.prototype.getTileUrl.call(this,t);return a+c(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+r},setParams:function(t,e){return i(this.wmsParams,t),e||this.redraw(),this}});mn.WMS=fn,Jt.wms=function(t,i){return new fn(t,i)};var gn=qe.extend({options:{padding:.1,tolerance:0},initialize:function(t){l(this,t),n(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&Q(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,i){var e=this._map.getZoomScale(i,this._zoom),n=ht(this._container),o=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,i),r=this._map.project(t,i).subtract(s),a=o.multiplyBy(-e).add(n).add(o).subtract(r);ji?rt(this._container,a,e):at(this._container,a)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,i=this._map.getSize(),e=this._map.containerPointToLayerPoint(i.multiplyBy(-t)).round();this._bounds=new P(e,e.add(i.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),vn=gn.extend({getEvents:function(){var t=gn.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){gn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");mt(t,"mousemove",o(this._onMouseMove,32,this),this),mt(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),mt(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){g(this._redrawRequest),delete this._ctx,K(this._container),ft(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){this._redrawBounds=null;for(var t in this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){gn.prototype._update.call(this);var t=this._bounds,i=this._container,e=t.getSize(),n=Yi?2:1;at(i,t.min),i.width=n*e.x,i.height=n*e.y,i.style.width=e.x+"px",i.style.height=e.y+"px",Yi&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){gn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[n(t)]=t;var i=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=i),this._drawLast=i,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var i=t._order,e=i.next,o=i.prev;e?e.prev=o:this._drawLast=o,o?o.next=e:this._drawFirst=e,delete t._order,delete this._layers[n(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var i,e,n=t.options.dashArray.split(/[, ]+/),o=[];for(e=0;e<n.length;e++){if(i=Number(n[e]),isNaN(i))return;o.push(i)}t.options._dashArray=o}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||f(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var i=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new P,this._redrawBounds.extend(t._pxBounds.min.subtract([i,i])),this._redrawBounds.extend(t._pxBounds.max.add([i,i]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var i=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,i.x,i.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,i=this._redrawBounds;if(this._ctx.save(),i){var e=i.getSize();this._ctx.beginPath(),this._ctx.rect(i.min.x,i.min.y,e.x,e.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!i||t._pxBounds&&t._pxBounds.intersects(i))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,i){if(this._drawing){var e,n,o,s,r=t._parts,a=r.length,h=this._ctx;if(a){for(h.beginPath(),e=0;e<a;e++){for(n=0,o=r[e].length;n<o;n++)s=r[e][n],h[n?"lineTo":"moveTo"](s.x,s.y);i&&h.closePath()}this._fillStroke(h,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var i=t._point,e=this._ctx,n=Math.max(Math.round(t._radius),1),o=(Math.max(Math.round(t._radiusY),1)||n)/n;1!==o&&(e.save(),e.scale(1,o)),e.beginPath(),e.arc(i.x,i.y/o,n,0,2*Math.PI,!1),1!==o&&e.restore(),this._fillStroke(e,t)}},_fillStroke:function(t,i){var e=i.options;e.fill&&(t.globalAlpha=e.fillOpacity,t.fillStyle=e.fillColor||e.color,t.fill(e.fillRule||"evenodd")),e.stroke&&0!==e.weight&&(t.setLineDash&&t.setLineDash(i.options&&i.options._dashArray||[]),t.globalAlpha=e.opacity,t.lineWidth=e.weight,t.strokeStyle=e.color,t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.stroke())},_onClick:function(t){for(var i,e,n=this._map.mouseEventToLayerPoint(t),o=this._drawFirst;o;o=o.next)(i=o.layer).options.interactive&&i._containsPoint(n)&&!this._map._draggableMoved(i)&&(e=i);e&&(zt(t),this._fireEvent([e],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var i=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,i)}},_handleMouseOut:function(t){var i=this._hoveredLayer;i&&(tt(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,i){for(var e,n,o=this._drawFirst;o;o=o.next)(e=o.layer).options.interactive&&e._containsPoint(i)&&(n=e);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(Q(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,i,e){this._map._fireDOMEvent(i,e||i.type,t)},_bringToFront:function(t){var i=t._order;if(i){var e=i.next,n=i.prev;e&&(e.prev=n,n?n.next=e:e&&(this._drawFirst=e),i.prev=this._drawLast,this._drawLast.next=i,i.next=null,this._drawLast=i,this._requestRedraw(t))}},_bringToBack:function(t){var i=t._order;if(i){var e=i.next,n=i.prev;n&&(n.next=e,e?e.prev=n:n&&(this._drawLast=n),i.prev=null,i.next=this._drawFirst,this._drawFirst.prev=i,this._drawFirst=i,this._requestRedraw(t))}}}),yn=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),xn={_initContainer:function(){this._container=G("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(gn.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var i=t._container=yn("shape");Q(i,"leaflet-vml-shape "+(this.options.className||"")),i.coordsize="1 1",t._path=yn("path"),i.appendChild(t._path),this._updateStyle(t),this._layers[n(t)]=t},_addPath:function(t){var i=t._container;this._container.appendChild(i),t.options.interactive&&t.addInteractiveTarget(i)},_removePath:function(t){var i=t._container;K(i),t.removeInteractiveTarget(i),delete this._layers[n(t)]},_updateStyle:function(t){var i=t._stroke,e=t._fill,n=t.options,o=t._container;o.stroked=!!n.stroke,o.filled=!!n.fill,n.stroke?(i||(i=t._stroke=yn("stroke")),o.appendChild(i),i.weight=n.weight+"px",i.color=n.color,i.opacity=n.opacity,n.dashArray?i.dashStyle=oi(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):i.dashStyle="",i.endcap=n.lineCap.replace("butt","flat"),i.joinstyle=n.lineJoin):i&&(o.removeChild(i),t._stroke=null),n.fill?(e||(e=t._fill=yn("fill")),o.appendChild(e),e.color=n.fillColor||n.color,e.opacity=n.fillOpacity):e&&(o.removeChild(e),t._fill=null)},_updateCircle:function(t){var i=t._point.round(),e=Math.round(t._radius),n=Math.round(t._radiusY||e);this._setPath(t,t._empty()?"M0 0":"AL "+i.x+","+i.y+" "+e+","+n+" 0,23592600")},_setPath:function(t,i){t._path.v=i},_bringToFront:function(t){X(t._container)},_bringToBack:function(t){J(t._container)}},wn=$i?yn:E,Pn=gn.extend({getEvents:function(){var t=gn.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=wn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=wn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){K(this._container),ft(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){gn.prototype._update.call(this);var t=this._bounds,i=t.getSize(),e=this._container;this._svgSize&&this._svgSize.equals(i)||(this._svgSize=i,e.setAttribute("width",i.x),e.setAttribute("height",i.y)),at(e,t.min),e.setAttribute("viewBox",[t.min.x,t.min.y,i.x,i.y].join(" ")),this.fire("update")}},_initPath:function(t){var i=t._path=wn("path");t.options.className&&Q(i,t.options.className),t.options.interactive&&Q(i,"leaflet-interactive"),this._updateStyle(t),this._layers[n(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){K(t._path),t.removeInteractiveTarget(t._path),delete this._layers[n(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var i=t._path,e=t.options;i&&(e.stroke?(i.setAttribute("stroke",e.color),i.setAttribute("stroke-opacity",e.opacity),i.setAttribute("stroke-width",e.weight),i.setAttribute("stroke-linecap",e.lineCap),i.setAttribute("stroke-linejoin",e.lineJoin),e.dashArray?i.setAttribute("stroke-dasharray",e.dashArray):i.removeAttribute("stroke-dasharray"),e.dashOffset?i.setAttribute("stroke-dashoffset",e.dashOffset):i.removeAttribute("stroke-dashoffset")):i.setAttribute("stroke","none"),e.fill?(i.setAttribute("fill",e.fillColor||e.color),i.setAttribute("fill-opacity",e.fillOpacity),i.setAttribute("fill-rule",e.fillRule||"evenodd")):i.setAttribute("fill","none"))},_updatePoly:function(t,i){this._setPath(t,k(t._parts,i))},_updateCircle:function(t){var i=t._point,e=Math.max(Math.round(t._radius),1),n="a"+e+","+(Math.max(Math.round(t._radiusY),1)||e)+" 0 1,0 ",o=t._empty()?"M0 0":"M"+(i.x-e)+","+i.y+n+2*e+",0 "+n+2*-e+",0 ";this._setPath(t,o)},_setPath:function(t,i){t._path.setAttribute("d",i)},_bringToFront:function(t){X(t._path)},_bringToBack:function(t){J(t._path)}});$i&&Pn.include(xn),be.include({getRenderer:function(t){var i=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return i||(i=this._renderer=this._createRenderer()),this.hasLayer(i)||this.addLayer(i),i},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var i=this._paneRenderers[t];return void 0===i&&(i=this._createRenderer({pane:t}),this._paneRenderers[t]=i),i},_createRenderer:function(t){return this.options.preferCanvas&&$t(t)||Qt(t)}});var Ln=on.extend({initialize:function(t,i){on.prototype.initialize.call(this,this._boundsToLatLngs(t),i)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=z(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});Pn.create=wn,Pn.pointsToPath=k,sn.geometryToLayer=Ft,sn.coordsToLatLng=Ut,sn.coordsToLatLngs=Vt,sn.latLngToCoords=qt,sn.latLngsToCoords=Gt,sn.getFeature=Kt,sn.asFeature=Yt,be.mergeOptions({boxZoom:!0});var bn=Ee.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){mt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ft(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){K(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),fi(),ut(),this._startPoint=this._map.mouseEventToContainerPoint(t),mt(document,{contextmenu:Lt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=G("div","leaflet-zoom-box",this._container),Q(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var i=new P(this._point,this._startPoint),e=i.getSize();at(this._box,i.min),this._box.style.width=e.x+"px",this._box.style.height=e.y+"px"},_finish:function(){this._moved&&(K(this._box),tt(this._container,"leaflet-crosshair")),gi(),lt(),ft(document,{contextmenu:Lt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(e(this._resetState,this),0);var i=new T(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(i).fire("boxzoomend",{boxZoomBounds:i})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});be.addInitHook("addHandler","boxZoom",bn),be.mergeOptions({doubleClickZoom:!0});var Tn=Ee.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var i=this._map,e=i.getZoom(),n=i.options.zoomDelta,o=t.originalEvent.shiftKey?e-n:e+n;"center"===i.options.doubleClickZoom?i.setZoom(o):i.setZoomAround(t.containerPoint,o)}});be.addInitHook("addHandler","doubleClickZoom",Tn),be.mergeOptions({dragging:!0,inertia:!Mi,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var zn=Ee.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new Re(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}Q(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){tt(this._map._container,"leaflet-grab"),tt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var i=z(this._map.options.maxBounds);this._offsetLimit=b(this._map.latLngToContainerPoint(i.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(i.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var i=this._lastTime=+new Date,e=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(e),this._times.push(i),this._prunePositions(i)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,i){return t-(t-i)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),i=this._offsetLimit;t.x<i.min.x&&(t.x=this._viscousLimit(t.x,i.min.x)),t.y<i.min.y&&(t.y=this._viscousLimit(t.y,i.min.y)),t.x>i.max.x&&(t.x=this._viscousLimit(t.x,i.max.x)),t.y>i.max.y&&(t.y=this._viscousLimit(t.y,i.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,i=Math.round(t/2),e=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-i+e)%t+i-e,s=(n+i+e)%t-i-e,r=Math.abs(o+e)<Math.abs(s+e)?o:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r},_onDragEnd:function(t){var i=this._map,e=i.options,n=!e.inertia||this._times.length<2;if(i.fire("dragend",t),n)i.fire("moveend");else{this._prunePositions(+new Date);var o=this._lastPos.subtract(this._positions[0]),s=(this._lastTime-this._times[0])/1e3,r=e.easeLinearity,a=o.multiplyBy(r/s),h=a.distanceTo([0,0]),u=Math.min(e.inertiaMaxSpeed,h),l=a.multiplyBy(u/h),c=u/(e.inertiaDeceleration*r),_=l.multiplyBy(-c/2).round();_.x||_.y?(_=i._limitOffset(_,i.options.maxBounds),f(function(){i.panBy(_,{duration:c,easeLinearity:r,noMoveStart:!0,animate:!0})})):i.fire("moveend")}}});be.addInitHook("addHandler","dragging",zn),be.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Mn=Ee.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),mt(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ft(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,i=document.documentElement,e=t.scrollTop||i.scrollTop,n=t.scrollLeft||i.scrollLeft;this._map._container.focus(),window.scrollTo(n,e)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var i,e,n=this._panKeys={},o=this.keyCodes;for(i=0,e=o.left.length;i<e;i++)n[o.left[i]]=[-1*t,0];for(i=0,e=o.right.length;i<e;i++)n[o.right[i]]=[t,0];for(i=0,e=o.down.length;i<e;i++)n[o.down[i]]=[0,t];for(i=0,e=o.up.length;i<e;i++)n[o.up[i]]=[0,-1*t]},_setZoomDelta:function(t){var i,e,n=this._zoomKeys={},o=this.keyCodes;for(i=0,e=o.zoomIn.length;i<e;i++)n[o.zoomIn[i]]=t;for(i=0,e=o.zoomOut.length;i<e;i++)n[o.zoomOut[i]]=-t},_addHooks:function(){mt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ft(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var i,e=t.keyCode,n=this._map;if(e in this._panKeys)n._panAnim&&n._panAnim._inProgress||(i=this._panKeys[e],t.shiftKey&&(i=w(i).multiplyBy(3)),n.panBy(i),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds));else if(e in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[e]);else{if(27!==e||!n._popup||!n._popup.options.closeOnEscapeKey)return;n.closePopup()}Lt(t)}}});be.addInitHook("addHandler","keyboard",Mn),be.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Cn=Ee.extend({addHooks:function(){mt(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ft(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var i=Tt(t),n=this._map.options.wheelDebounceTime;this._delta+=i,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var o=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(e(this._performZoom,this),o),Lt(t)},_performZoom:function(){var t=this._map,i=t.getZoom(),e=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),o=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,s=e?Math.ceil(o/e)*e:o,r=t._limitZoom(i+(this._delta>0?s:-s))-i;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(i+r):t.setZoomAround(this._lastMousePos,i+r))}});be.addInitHook("addHandler","scrollWheelZoom",Cn),be.mergeOptions({tap:!0,tapTolerance:15});var Sn=Ee.extend({addHooks:function(){mt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ft(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(Pt(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new x(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&Q(n,"leaflet-active"),this._holdTimeout=setTimeout(e(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),this._simulateEvent("mousedown",i),mt(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),ft(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],e=i.target;e&&e.tagName&&"a"===e.tagName.toLowerCase()&&tt(e,"leaflet-active"),this._simulateEvent("mouseup",i),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var i=t.touches[0];this._newPos=new x(i.clientX,i.clientY),this._simulateEvent("mousemove",i)},_simulateEvent:function(t,i){var e=document.createEvent("MouseEvents");e._simulated=!0,i.target._simulatedClick=!0,e.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(e)}});qi&&!Vi&&be.addInitHook("addHandler","tap",Sn),be.mergeOptions({touchZoom:qi&&!Mi,bounceAtZoomLimits:!0});var Zn=Ee.extend({addHooks:function(){Q(this._map._container,"leaflet-touch-zoom"),mt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){tt(this._map._container,"leaflet-touch-zoom"),ft(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var e=i.mouseEventToContainerPoint(t.touches[0]),n=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),"center"!==i.options.touchZoom&&(this._pinchStartLatLng=i.containerPointToLatLng(e.add(n)._divideBy(2))),this._startDist=e.distanceTo(n),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),mt(document,"touchmove",this._onTouchMove,this),mt(document,"touchend",this._onTouchEnd,this),Pt(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var i=this._map,n=i.mouseEventToContainerPoint(t.touches[0]),o=i.mouseEventToContainerPoint(t.touches[1]),s=n.distanceTo(o)/this._startDist;if(this._zoom=i.getScaleZoom(s,this._startZoom),!i.options.bounceAtZoomLimits&&(this._zoom<i.getMinZoom()&&s<1||this._zoom>i.getMaxZoom()&&s>1)&&(this._zoom=i._limitZoom(this._zoom)),"center"===i.options.touchZoom){if(this._center=this._startLatLng,1===s)return}else{var r=n._add(o)._divideBy(2)._subtract(this._centerPoint);if(1===s&&0===r.x&&0===r.y)return;this._center=i.unproject(i.project(this._pinchStartLatLng,this._zoom).subtract(r),this._zoom)}this._moved||(i._moveStart(!0,!1),this._moved=!0),g(this._animRequest);var a=e(i._move,i,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=f(a,this,!0),Pt(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,g(this._animRequest),ft(document,"touchmove",this._onTouchMove),ft(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});be.addInitHook("addHandler","touchZoom",Zn),be.BoxZoom=bn,be.DoubleClickZoom=Tn,be.Drag=zn,be.Keyboard=Mn,be.ScrollWheelZoom=Cn,be.Tap=Sn,be.TouchZoom=Zn,Object.freeze=ti,t.version="1.4.0",t.Control=Te,t.control=ze,t.Browser=Qi,t.Evented=ci,t.Mixin=Be,t.Util=ui,t.Class=v,t.Handler=Ee,t.extend=i,t.bind=e,t.stamp=n,t.setOptions=l,t.DomEvent=Pe,t.DomUtil=ve,t.PosAnimation=Le,t.Draggable=Re,t.LineUtil=Ne,t.PolyUtil=De,t.Point=x,t.point=w,t.Bounds=P,t.bounds=b,t.Transformation=S,t.transformation=Z,t.Projection=He,t.LatLng=M,t.latLng=C,t.LatLngBounds=T,t.latLngBounds=z,t.CRS=di,t.GeoJSON=sn,t.geoJSON=Xt,t.geoJson=an,t.Layer=qe,t.LayerGroup=Ge,t.layerGroup=function(t,i){return new Ge(t,i)},t.FeatureGroup=Ke,t.featureGroup=function(t){return new Ke(t)},t.ImageOverlay=hn,t.imageOverlay=function(t,i,e){return new hn(t,i,e)},t.VideoOverlay=un,t.videoOverlay=function(t,i,e){return new un(t,i,e)},t.DivOverlay=ln,t.Popup=cn,t.popup=function(t,i){return new cn(t,i)},t.Tooltip=_n,t.tooltip=function(t,i){return new _n(t,i)},t.Icon=Ye,t.icon=function(t){return new Ye(t)},t.DivIcon=dn,t.divIcon=function(t){return new dn(t)},t.Marker=$e,t.marker=function(t,i){return new $e(t,i)},t.TileLayer=mn,t.tileLayer=Jt,t.GridLayer=pn,t.gridLayer=function(t){return new pn(t)},t.SVG=Pn,t.svg=Qt,t.Renderer=gn,t.Canvas=vn,t.canvas=$t,t.Path=Qe,t.CircleMarker=tn,t.circleMarker=function(t,i){return new tn(t,i)},t.Circle=en,t.circle=function(t,i,e){return new en(t,i,e)},t.Polyline=nn,t.polyline=function(t,i){return new nn(t,i)},t.Polygon=on,t.polygon=function(t,i){return new on(t,i)},t.Rectangle=Ln,t.rectangle=function(t,i){return new Ln(t,i)},t.Map=be,t.map=function(t,i){return new be(t,i)};var En=window.L;t.noConflict=function(){return window.L=En,this},window.L=t});this.L=this.L||{},this.L.Control=this.L.Control||{},this.L.Control.Geocoder=function(d){"use strict";d=d&&d.hasOwnProperty("default")?d.default:d;var a=0,n=/[&<>"'`]/g,i=/[&<>"'`]/,t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function r(e){return t[e]}function o(e,t,o,s,n){var i="_l_geocoder_"+a++;t[n||"callback"]=i,window[i]=d.Util.bind(o,s);var r=document.createElement("script");r.type="text/javascript",r.src=e+l(t),r.id=i,document.getElementsByTagName("head")[0].appendChild(r)}function u(e,t,o){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState){var t;if(200!==s.status&&304!==s.status)t="";else if("string"==typeof s.response)try{t=JSON.parse(s.response)}catch(e){t=s.response}else t=s.response;o(t)}},s.open("GET",e+l(t),!0),s.responseType="json",s.setRequestHeader("Accept","application/json"),s.send(null)}function s(e,s){return e.replace(/\{ *([\w_]+) *\}/g,function(e,t){var o=s[t];return void 0===o?o="":"function"==typeof o&&(o=o(s)),function(e){return null==e?"":e?(e=""+e,i.test(e)?e.replace(n,r):e):e+""}(o)})}function l(e,t,o){var s=[];for(var n in e){var i=encodeURIComponent(o?n.toUpperCase():n),r=e[n];if(d.Util.isArray(r))for(var a=0;a<r.length;a++)s.push(i+"="+encodeURIComponent(r[a]));else s.push(i+"="+encodeURIComponent(r))}return(t&&-1!==t.indexOf("?")?"&":"?")+s.join("&")}var c=d.Class.extend({options:{service_url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"},initialize:function(e,t){d.setOptions(this,t),this._accessToken=e},geocode:function(e,r,a){var t={SingleLine:e,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"};this._key&&this._key.length&&(t.token=this._key),u(this.options.service_url+"/findAddressCandidates",d.extend(t,this.options.geocodingQueryParams),function(e){var t,o,s,n=[];if(e.candidates&&e.candidates.length)for(var i=0;i<=e.candidates.length-1;i++)t=e.candidates[i],o=d.latLng(t.location.y,t.location.x),s=d.latLngBounds(d.latLng(t.extent.ymax,t.extent.xmax),d.latLng(t.extent.ymin,t.extent.xmin)),n[i]={name:t.address,bbox:s,center:o};r.call(a,n)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,s,n){var o={location:encodeURIComponent(e.lng)+","+encodeURIComponent(e.lat),distance:100,f:"json"};u(this.options.service_url+"/reverseGeocode",o,function(e){var t,o=[];e&&!e.error&&(t=d.latLng(e.location.y,e.location.x),o.push({name:e.address.Match_addr,center:t,bounds:d.latLngBounds(t,t)})),s.call(n,o)})}});var p=d.Class.extend({initialize:function(e){this.key=e},geocode:function(e,i,r){o("https://dev.virtualearth.net/REST/v1/Locations",{query:e,key:this.key},function(e){var t=[];if(0<e.resourceSets.length)for(var o=e.resourceSets[0].resources.length-1;0<=o;o--){var s=e.resourceSets[0].resources[o],n=s.bbox;t[o]={name:s.name,bbox:d.latLngBounds([n[0],n[1]],[n[2],n[3]]),center:d.latLng(s.point.coordinates)}}i.call(r,t)},this,"jsonp")},reverse:function(e,t,i,r){o("//dev.virtualearth.net/REST/v1/Locations/"+e.lat+","+e.lng,{key:this.key},function(e){for(var t=[],o=e.resourceSets[0].resources.length-1;0<=o;o--){var s=e.resourceSets[0].resources[o],n=s.bbox;t[o]={name:s.name,bbox:d.latLngBounds([n[0],n[1]],[n[2],n[3]]),center:d.latLng(s.point.coordinates)}}i.call(r,t)},this,"jsonp")}});var h=d.Class.extend({options:{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(e,t){this._key=e,d.setOptions(this,t),this.options.serviceUrl=this.options.service_url||this.options.serviceUrl},geocode:function(e,r,a){var t={address:e};this._key&&this._key.length&&(t.key=this._key),t=d.Util.extend(t,this.options.geocodingQueryParams),u(this.options.serviceUrl,t,function(e){var t,o,s,n=[];if(e.results&&e.results.length)for(var i=0;i<=e.results.length-1;i++)t=e.results[i],o=d.latLng(t.geometry.location),s=d.latLngBounds(d.latLng(t.geometry.viewport.northeast),d.latLng(t.geometry.viewport.southwest)),n[i]={name:t.formatted_address,bbox:s,center:o,properties:t.address_components};r.call(a,n)})},reverse:function(e,t,r,a){var o={latlng:encodeURIComponent(e.lat)+","+encodeURIComponent(e.lng)};o=d.Util.extend(o,this.options.reverseQueryParams),this._key&&this._key.length&&(o.key=this._key),u(this.options.serviceUrl,o,function(e){var t,o,s,n=[];if(e.results&&e.results.length)for(var i=0;i<=e.results.length-1;i++)t=e.results[i],o=d.latLng(t.geometry.location),s=d.latLngBounds(d.latLng(t.geometry.viewport.northeast),d.latLng(t.geometry.viewport.southwest)),n[i]={name:t.formatted_address,bbox:s,center:o,properties:t.address_components};r.call(a,n)})}});var g=d.Class.extend({options:{geocodeUrl:"https://geocoder.api.here.com/6.2/geocode.json",reverseGeocodeUrl:"https://reverse.geocoder.api.here.com/6.2/reversegeocode.json",app_id:"<insert your app_id here>",app_code:"<insert your app_code here>",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(e){d.setOptions(this,e)},geocode:function(e,t,o){var s={searchtext:e,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1};s=d.Util.extend(s,this.options.geocodingQueryParams),this.getJSON(this.options.geocodeUrl,s,t,o)},reverse:function(e,t,o,s){var n={prox:encodeURIComponent(e.lat)+","+encodeURIComponent(e.lng),mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1};n=d.Util.extend(n,this.options.reverseQueryParams),this.getJSON(this.options.reverseGeocodeUrl,n,o,s)},getJSON:function(e,t,r,a){u(e,t,function(e){var t,o,s,n=[];if(e.response.view&&e.response.view.length)for(var i=0;i<=e.response.view[0].result.length-1;i++)t=e.response.view[0].result[i].location,o=d.latLng(t.displayPosition.latitude,t.displayPosition.longitude),s=d.latLngBounds(d.latLng(t.mapView.topLeft.latitude,t.mapView.topLeft.longitude),d.latLng(t.mapView.bottomRight.latitude,t.mapView.bottomRight.longitude)),n[i]={name:t.address.label,bbox:s,center:o};r.call(a,n)})}});var m=d.Class.extend({options:{next:void 0,sizeInMeters:1e4},initialize:function(e){d.Util.setOptions(this,e)},geocode:function(e,t,o){var s,n;if((s=e.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?n=d.latLng((/N/i.test(s[1])?1:-1)*parseFloat(s[2]),(/E/i.test(s[3])?1:-1)*parseFloat(s[4])):(s=e.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?n=d.latLng((/N/i.test(s[2])?1:-1)*parseFloat(s[1]),(/E/i.test(s[4])?1:-1)*parseFloat(s[3])):(s=e.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?$/))?n=d.latLng((/N/i.test(s[1])?1:-1)*(parseFloat(s[2])+parseFloat(s[3]/60)),(/E/i.test(s[4])?1:-1)*(parseFloat(s[5])+parseFloat(s[6]/60))):(s=e.match(/^(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([NS])\W*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([EW])$/))?n=d.latLng((/N/i.test(s[3])?1:-1)*(parseFloat(s[1])+parseFloat(s[2]/60)),(/E/i.test(s[6])?1:-1)*(parseFloat(s[4])+parseFloat(s[5]/60))):(s=e.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?$/))?n=d.latLng((/N/i.test(s[1])?1:-1)*(parseFloat(s[2])+parseFloat(s[3]/60+parseFloat(s[4]/3600))),(/E/i.test(s[5])?1:-1)*(parseFloat(s[6])+parseFloat(s[7]/60)+parseFloat(s[8]/3600))):(s=e.match(/^(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]\s*([NS])\W*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\s*([EW])$/))?n=d.latLng((/N/i.test(s[4])?1:-1)*(parseFloat(s[1])+parseFloat(s[2]/60+parseFloat(s[3]/3600))),(/E/i.test(s[8])?1:-1)*(parseFloat(s[5])+parseFloat(s[6]/60)+parseFloat(s[7]/3600))):(s=e.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))&&(n=d.latLng(parseFloat(s[1]),parseFloat(s[2]))),n){var i=[{name:e,center:n,bbox:n.toBounds(this.options.sizeInMeters)}];t.call(o,i)}else this.options.next&&this.options.next.geocode(e,t,o)}});var f=d.Class.extend({options:{serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(e,t){d.setOptions(this,t),this.options.geocodingQueryParams.access_token=e,this.options.reverseQueryParams.access_token=e},geocode:function(e,l,c){var t=this.options.geocodingQueryParams;void 0!==t.proximity&&void 0!==t.proximity.lat&&void 0!==t.proximity.lng&&(t.proximity=t.proximity.lng+","+t.proximity.lat),u(this.options.serviceUrl+encodeURIComponent(e)+".json",t,function(e){var t,o,s,n=[];if(e.features&&e.features.length)for(var i=0;i<=e.features.length-1;i++){t=e.features[i],o=d.latLng(t.center.reverse()),s=t.bbox?d.latLngBounds(d.latLng(t.bbox.slice(0,2).reverse()),d.latLng(t.bbox.slice(2,4).reverse())):d.latLngBounds(o,o);for(var r={text:t.text,address:t.address},a=0;a<(t.context||[]).length;a++){r[t.context[a].id.split(".")[0]]=t.context[a].text}n[i]={name:t.place_name,bbox:s,center:o,properties:r}}l.call(c,n)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,r,a){u(this.options.serviceUrl+encodeURIComponent(e.lng)+","+encodeURIComponent(e.lat)+".json",this.options.reverseQueryParams,function(e){var t,o,s,n=[];if(e.features&&e.features.length)for(var i=0;i<=e.features.length-1;i++)t=e.features[i],o=d.latLng(t.center.reverse()),s=t.bbox?d.latLngBounds(d.latLng(t.bbox.slice(0,2).reverse()),d.latLng(t.bbox.slice(2,4).reverse())):d.latLngBounds(o,o),n[i]={name:t.place_name,bbox:s,center:o};r.call(a,n)})}});var v=d.Class.extend({options:{serviceUrl:"https://www.mapquestapi.com/geocoding/v1"},initialize:function(e,t){this._key=decodeURIComponent(e),d.Util.setOptions(this,t)},_formatName:function(){var e,t=[];for(e=0;e<arguments.length;e++)arguments[e]&&t.push(arguments[e]);return t.join(", ")},geocode:function(e,i,r){u(this.options.serviceUrl+"/address",{key:this._key,location:e,limit:5,outFormat:"json"},d.bind(function(e){var t,o,s=[];if(e.results&&e.results[0].locations)for(var n=e.results[0].locations.length-1;0<=n;n--)t=e.results[0].locations[n],o=d.latLng(t.latLng),s[n]={name:this._formatName(t.street,t.adminArea4,t.adminArea3,t.adminArea1),bbox:d.latLngBounds(o,o),center:o};i.call(r,s)},this))},reverse:function(e,t,i,r){u(this.options.serviceUrl+"/reverse",{key:this._key,location:e.lat+","+e.lng,outputFormat:"json"},d.bind(function(e){var t,o,s=[];if(e.results&&e.results[0].locations)for(var n=e.results[0].locations.length-1;0<=n;n--)t=e.results[0].locations[n],o=d.latLng(t.latLng),s[n]={name:this._formatName(t.street,t.adminArea4,t.adminArea3,t.adminArea1),bbox:d.latLngBounds(o,o),center:o};i.call(r,s)},this))}});var _=d.Class.extend({options:{userId:"<insert your userId here>",apiKey:"<insert your apiKey here>",serviceUrl:"https://neutrinoapi.com/"},initialize:function(e){d.Util.setOptions(this,e)},geocode:function(e,n,i){u(this.options.serviceUrl+"geocode-address",{apiKey:this.options.apiKey,userId:this.options.userId,address:e.split(/\s+/).join(".")},function(e){var t,o,s=[];e.locations&&(e.geometry=e.locations[0],t=d.latLng(e.geometry.latitude,e.geometry.longitude),o=d.latLngBounds(t,t),s[0]={name:e.geometry.address,bbox:o,center:t}),n.call(i,s)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(n,e,i,r){u(this.options.serviceUrl+"geocode-reverse",{apiKey:this.options.apiKey,userId:this.options.userId,latitude:n.lat,longitude:n.lng},function(e){var t,o,s=[];200==e.status.status&&e.found&&(t=d.latLng(n.lat,n.lng),o=d.latLngBounds(t,t),s[0]={name:e.address,bbox:o,center:t}),i.call(r,s)})}});var b=d.Class.extend({options:{serviceUrl:"https://nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(e){var t=e.address,o=[];return(t.road||t.building)&&o.push("{building} {road} {house_number}"),(t.city||t.town||t.village||t.hamlet)&&o.push('<span class="'+(0<o.length?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village} {hamlet}</span>'),(t.state||t.country)&&o.push('<span class="'+(0<o.length?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),s(o.join("<br/>"),t)}},initialize:function(e){d.Util.setOptions(this,e)},geocode:function(e,i,r){u(this.options.serviceUrl+"search",d.extend({q:e,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),d.bind(function(e){for(var t=[],o=e.length-1;0<=o;o--){for(var s=e[o].boundingbox,n=0;n<4;n++)s[n]=parseFloat(s[n]);t[o]={icon:e[o].icon,name:e[o].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e[o]):void 0,bbox:d.latLngBounds([s[0],s[2]],[s[1],s[3]]),center:d.latLng(e[o].lat,e[o].lon),properties:e[o]}}i.call(r,t)},this))},reverse:function(e,t,s,n){u(this.options.serviceUrl+"reverse",d.extend({lat:e.lat,lon:e.lng,zoom:Math.round(Math.log(t/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),d.bind(function(e){var t,o=[];e&&e.lat&&e.lon&&(t=d.latLng(e.lat,e.lon),o.push({name:e.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e):void 0,center:t,bounds:d.latLngBounds(t,t),properties:e})),s.call(n,o)},this))}});var L=d.Class.extend({options:{OpenLocationCode:void 0,codeLength:void 0},initialize:function(e){d.setOptions(this,e)},geocode:function(e,t,o){try{var s=this.options.OpenLocationCode.decode(e),n={name:e,center:d.latLng(s.latitudeCenter,s.longitudeCenter),bbox:d.latLngBounds(d.latLng(s.latitudeLo,s.longitudeLo),d.latLng(s.latitudeHi,s.longitudeHi))};t.call(o,[n])}catch(e){console.warn(e),t.call(o,[])}},reverse:function(e,t,o,s){try{var n={name:this.options.OpenLocationCode.encode(e.lat,e.lng,this.options.codeLength),center:d.latLng(e.lat,e.lng),bbox:d.latLngBounds(d.latLng(e.lat,e.lng),d.latLng(e.lat,e.lng))};o.call(s,[n])}catch(e){console.warn(e),o.call(s,[])}}});var y=d.Class.extend({options:{serviceUrl:"https://api.opencagedata.com/geocode/v1/json"},initialize:function(e){this._accessToken=e},geocode:function(e,r,a){u(this.options.serviceUrl,{key:this._accessToken,q:e},function(e){var t,o,s,n=[];if(e.results&&e.results.length)for(var i=0;i<e.results.length;i++)s=e.results[i],t=d.latLng(s.geometry),o=s.annotations&&s.annotations.bounds?d.latLngBounds(d.latLng(s.annotations.bounds.northeast),d.latLng(s.annotations.bounds.southwest)):d.latLngBounds(t,t),n.push({name:s.formatted,bbox:o,center:t});r.call(a,n)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,r,a){u(this.options.serviceUrl,{key:this._accessToken,q:[e.lat,e.lng].join(",")},function(e){var t,o,s,n=[];if(e.results&&e.results.length)for(var i=0;i<e.results.length;i++)s=e.results[i],t=d.latLng(s.geometry),o=s.annotations&&s.annotations.bounds?d.latLngBounds(d.latLng(s.annotations.bounds.northeast),d.latLng(s.annotations.bounds.southwest)):d.latLngBounds(t,t),n.push({name:s.formatted,bbox:o,center:t});r.call(a,n)})}});var x=d.Class.extend({options:{serviceUrl:"https://api.geocode.earth/v1",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(e,t){d.Util.setOptions(this,t),this._apiKey=e,this._lastSuggest=0},geocode:function(e,t,o){var s=this;u(this.options.serviceUrl+"/search",d.extend({api_key:this._apiKey,text:e},this.options.geocodingQueryParams),function(e){t.call(o,s._parseResults(e,"bbox"))})},suggest:function(e,t,o){var s=this;u(this.options.serviceUrl+"/autocomplete",d.extend({api_key:this._apiKey,text:e},this.options.geocodingQueryParams),d.bind(function(e){e.geocoding.timestamp>this._lastSuggest&&(this._lastSuggest=e.geocoding.timestamp,t.call(o,s._parseResults(e,"bbox")))},this))},reverse:function(e,t,o,s){var n=this;u(this.options.serviceUrl+"/reverse",d.extend({api_key:this._apiKey,"point.lat":e.lat,"point.lon":e.lng},this.options.reverseQueryParams),function(e){o.call(s,n._parseResults(e,"bounds"))})},_parseResults:function(e,i){var r=[];return d.geoJson(e,{pointToLayer:function(e,t){return d.circleMarker(t)},onEachFeature:function(e,t){var o,s,n={};t.getBounds?s=(o=t.getBounds()).getCenter():o=t.feature.bbox?(s=t.getLatLng(),d.latLngBounds(d.GeoJSON.coordsToLatLng(t.feature.bbox.slice(0,2)),d.GeoJSON.coordsToLatLng(t.feature.bbox.slice(2,4)))):(s=t.getLatLng(),d.latLngBounds(s,s)),n.name=t.feature.properties.label,n.center=s,n[i]=o,n.properties=t.feature.properties,r.push(n)}}),r}});function e(e,t){return new x(e,t)}var U=x,C=e,k=x,w=e,D=k.extend({options:{serviceUrl:"https://api.openrouteservice.org/geocode"}});var E=d.Class.extend({options:{serviceUrl:"https://photon.komoot.de/api/",reverseUrl:"https://photon.komoot.de/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]},initialize:function(e){d.setOptions(this,e)},geocode:function(e,t,o){var s=d.extend({q:e},this.options.geocodingQueryParams);u(this.options.serviceUrl,s,d.bind(function(e){t.call(o,this._decodeFeatures(e))},this))},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,o,s){var n=d.extend({lat:e.lat,lon:e.lng},this.options.reverseQueryParams);u(this.options.reverseUrl,n,d.bind(function(e){o.call(s,this._decodeFeatures(e))},this))},_decodeFeatures:function(e){var t,o,s,n,i,r,a=[];if(e&&e.features)for(t=0;t<e.features.length;t++)s=(o=e.features[t]).geometry.coordinates,n=d.latLng(s[1],s[0]),r=(i=o.properties.extent)?d.latLngBounds([i[1],i[0]],[i[3],i[2]]):d.latLngBounds(n,n),a.push({name:this._decodeFeatureName(o),html:this.options.htmlTemplate?this.options.htmlTemplate(o):void 0,center:n,bbox:r,properties:o.properties});return a},_decodeFeatureName:function(t){return(this.options.nameProperties||[]).map(function(e){return t.properties[e]}).filter(function(e){return!!e}).join(", ")}});var T=d.Class.extend({options:{serviceUrl:"https://api.what3words.com/v2/"},initialize:function(e){this._accessToken=e},geocode:function(e,n,i){u(this.options.serviceUrl+"forward",{key:this._accessToken,addr:e.split(/\s+/).join(".")},function(e){var t,o,s=[];e.geometry&&(t=d.latLng(e.geometry.lat,e.geometry.lng),o=d.latLngBounds(t,t),s[0]={name:e.words,bbox:o,center:t}),n.call(i,s)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(e,t,n,i){u(this.options.serviceUrl+"reverse",{key:this._accessToken,coords:[e.lat,e.lng].join(",")},function(e){var t,o,s=[];200==e.status.status&&(t=d.latLng(e.geometry.lat,e.geometry.lng),o=d.latLngBounds(t,t),s[0]={name:e.words,bbox:o,center:t}),n.call(i,s)})}});var B=Object.freeze({ArcGis:c,arcgis:function(e,t){return new c(e,t)},Bing:p,bing:function(e){return new p(e)},Google:h,google:function(e,t){return new h(e,t)},HERE:g,here:function(e){return new g(e)},LatLng:m,latLng:function(e){return new m(e)},Mapbox:f,mapbox:function(e,t){return new f(e,t)},MapQuest:v,mapQuest:function(e,t){return new v(e,t)},Neutrino:_,neutrino:function(e){return new _(e)},Nominatim:b,nominatim:function(e){return new b(e)},OpenLocationCode:L,openLocationCode:function(e){return new L(e)},OpenCage:y,opencage:function(e){return new y(e)},Pelias:x,pelias:e,GeocodeEarth:U,geocodeEarth:C,Mapzen:k,mapzen:w,Openrouteservice:D,openrouteservice:function(e,t){return new D(e,t)},Photon:E,photon:function(e){return new E(e)},What3Words:T,what3words:function(e){return new T(e)}}),R=d.Control.extend({options:{showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Buscar...",errorMessage:"Nothing found.",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},includes:d.Evented.prototype||d.Mixin.Events,initialize:function(e){d.Util.setOptions(this,e),this.options.geocoder||(this.options.geocoder=new b),this._requestCount=0},addThrobberClass:function(){d.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")},removeThrobberClass:function(){d.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")},onAdd:function(e){var t,o="leaflet-control-geocoder",s=d.DomUtil.create("div",o+" leaflet-bar"),n=d.DomUtil.create("button",o+"-icon",s),i=this._form=d.DomUtil.create("div",o+"-form",s);return this._map=e,this._container=s,n.innerHTML="&nbsp;",n.type="button",(t=this._input=d.DomUtil.create("input","",i)).type="text",t.placeholder=this.options.placeholder,d.DomEvent.disableClickPropagation(t),this._errorElement=d.DomUtil.create("div",o+"-form-no-error",s),this._errorElement.innerHTML=this.options.errorMessage,this._alts=d.DomUtil.create("ul",o+"-alternatives leaflet-control-geocoder-alternatives-minimized",s),d.DomEvent.disableClickPropagation(this._alts),d.DomEvent.addListener(t,"keydown",this._keydown,this),this.options.geocoder.suggest&&d.DomEvent.addListener(t,"input",this._change,this),d.DomEvent.addListener(t,"blur",function(){this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1},this),this.options.collapsed?"click"===this.options.expand?d.DomEvent.addListener(s,"click",function(e){0===e.button&&2!==e.detail&&this._toggle()},this):d.Browser.touch&&"touch"===this.options.expand?d.DomEvent.addListener(s,"touchstart mousedown",function(e){this._toggle(),e.preventDefault(),e.stopPropagation()},this):(d.DomEvent.addListener(s,"mouseover",this._expand,this),d.DomEvent.addListener(s,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),d.Browser.touch?d.DomEvent.addListener(s,"touchstart",function(){this._geocode()},this):d.DomEvent.addListener(s,"click",function(){this._geocode()},this)),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),d.DomEvent.disableClickPropagation(s),s},_geocodeResult:function(e,t){if(!t&&this.options.showUniqueResult&&1===e.length)this._geocodeResultSelected(e[0]);else if(0<e.length){this._alts.innerHTML="",this._results=e,d.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),d.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-open");for(var o=0;o<e.length;o++)this._alts.appendChild(this._createAlt(e[o],o))}else d.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-error"),d.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")},markGeocode:function(e){return e=e.geocode||e,this._map.fitBounds(e.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new d.Marker(e.center).bindPopup(e.html||e.name).addTo(this._map).openPopup(),this},_geocode:function(t){var e=this._input.value;if(t||!(e.length<this.options.queryMinLength)){var o=++this._requestCount,s=t?"suggest":"geocode",n={input:e};this._lastGeocode=e,t||this._clearResults(),this.fire("start"+s,n),this.options.geocoder[s](e,function(e){o===this._requestCount&&(n.results=e,this.fire("finish"+s,n),this._geocodeResult(e,t))},this)}},_geocodeResultSelected:function(e){this.fire("markgeocode",{geocode:e})},_toggle:function(){d.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()},_expand:function(){d.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")},_collapse:function(){d.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),d.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),d.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),d.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),d.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")},_clearResults:function(){d.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,d.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),d.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),d.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error")},_createAlt:function(t,e){var o=d.DomUtil.create("li",""),s=d.DomUtil.create("a","",o),n=this.options.showResultIcons&&t.icon?d.DomUtil.create("img","",s):null,i=t.html?void 0:document.createTextNode(t.name);return n&&(n.src=t.icon),o.setAttribute("data-result-index",e),t.html?s.innerHTML=s.innerHTML+t.html:s.appendChild(i),d.DomEvent.addListener(o,"mousedown touchstart",function(e){this._preventBlurCollapse=!0,d.DomEvent.stop(e),this._geocodeResultSelected(t),d.DomEvent.on(o,"click",function(){this.options.collapsed?this._collapse():this._clearResults()},this)},this),o},_keydown:function(e){var t=this,o=function(e){t._selection&&(d.DomUtil.removeClass(t._selection,"leaflet-control-geocoder-selected"),t._selection=t._selection[0<e?"nextSibling":"previousSibling"]),t._selection||(t._selection=t._alts[0<e?"firstChild":"lastChild"]),t._selection&&d.DomUtil.addClass(t._selection,"leaflet-control-geocoder-selected")};switch(e.keyCode){case 27:this.options.collapsed?this._collapse():this._clearResults();break;case 38:o(-1);break;case 40:o(1);break;case 13:if(this._selection){var s=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[s]),this._clearResults()}else this._geocode();break;default:return}d.DomEvent.preventDefault(e)},_change:function(){var e=this._input.value;e!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),e.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(d.bind(function(){this._geocode(!0)},this),this.options.suggestTimeout):this._clearResults())}});return d.Util.extend(R,B),d.Util.extend(d.Control,{Geocoder:R,geocoder:function(e){return new R(e)}}),R}(L);if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.2",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a(f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.2",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")&&(c.prop("checked")&&this.$element.hasClass("active")?a=!1:b.find(".active").removeClass("active")),a&&c.prop("checked",!this.$element.hasClass("active")).trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active"));a&&this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target);d.hasClass("btn")||(d=d.closest(".btn")),b.call(d,"toggle"),c.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.2",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d="prev"==a&&0===c||"next"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e="prev"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));return a>this.$items.length-1||0>a?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide("next")},c.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&"show"==b&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a(this.options.trigger).filter('[href="#'+b.id+'"], [data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.2",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0,trigger:'[data-toggle="collapse"]'},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":a.extend({},e.data(),{trigger:this});c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){b&&3===b.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=c(d),f={relatedTarget:this};e.hasClass("open")&&(e.trigger(b=a.Event("hide.bs.dropdown",f)),b.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger("hidden.bs.dropdown",f)))}))}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.2",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger("shown.bs.dropdown",h)}return!1}},g.prototype.keydown=function(b){if(/(38|40|27|32)/.test(b.which)&&!/input|textarea/i.test(b.target.tagName)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var e=c(d),g=e.hasClass("open");if(!g&&27!=b.which||g&&27==b.which)return 27==b.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.divider):visible a",i=e.find('[role="menu"]'+h+', [role="listbox"]'+h);if(i.length){var j=i.index(b.target);38==b.which&&j>0&&j--,40==b.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',g.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.2",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.options.backdrop&&d.adjustBackdrop(),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in").attr("aria-hidden",!1),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$element.find(".modal-dialog").one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a('<div class="modal-backdrop '+e+'" />').prependTo(this.$element).on("click.dismiss.bs.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.options.backdrop&&this.adjustBackdrop(),this.adjustDialog()},c.prototype.adjustBackdrop=function(){this.$backdrop.css("height",0).css("height",this.$element[0].scrollHeight)},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){this.bodyIsOverflowing=document.body.scrollHeight>document.documentElement.clientHeight,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.3.2",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c&&c.$tip&&c.$tip.is(":visible")?void(c.hoverState="in"):(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.options.container?a(this.options.container):this.$element.parent(),p=this.getPosition(o);h="bottom"==h&&k.bottom+m>p.bottom?"top":"top"==h&&k.top-m<p.top?"bottom":"right"==h&&k.right+l>p.width?"left":"left"==h&&k.left-l<p.left?"right":h,f.removeClass(n).addClass(h)}var q=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(q,h);var r=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",r).emulateTransitionEnd(c.TRANSITION_DURATION):r()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=this.tip(),g=a.Event("hide.bs."+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do{a+=~~(1e6*Math.random())}while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type)})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.2",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},c.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){var e=a.proxy(this.process,this);this.$body=a("body"),this.$scrollElement=a(a(c).is("body")?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.2",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b="offset",c=0;a.isWindow(this.$scrollElement[0])||(b="position",c=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var d=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[b]().top+c,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){d.offsets.push(this[0]),d.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.2",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.2",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return c>e?"top":!1;if("bottom"==this.affixed)return null!=c?e+this.unpin<=f.top?!1:"bottom":a-d>=e+g?!1:"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&c>=e?"top":null!=d&&i+j>=a-d?"bottom":!1},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=a("body").height();"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);(function(){(function(n){var x=this||(0,eval)("this"),u=x.document,M=x.navigator,v=x.jQuery,F=x.JSON;(function(n){"function"===typeof define&&define.amd?define(["exports","require"],n):"object"===typeof exports&&"object"===typeof module?n(module.exports||exports):n(x.ko={})})(function(N,O){function J(a,c){return null===a||typeof a in T?a===c:!1}function U(b,c){var d;return function(){d||(d=a.a.setTimeout(function(){d=n;b()},c))}}function V(b,c){var d;return function(){clearTimeout(d);d=a.a.setTimeout(b,c)}}function W(a,c){c&&c!==I?"beforeChange"===c?this.Kb(a):this.Ha(a,c):this.Lb(a)}function X(a,c){null!==c&&c.k&&c.k()}function Y(a,c){var d=this.Hc,e=d[s];e.R||(this.lb&&this.Ma[c]?(d.Pb(c,a,this.Ma[c]),this.Ma[c]=null,--this.lb):e.r[c]||d.Pb(c,a,e.s?{ia:a}:d.uc(a)))}function K(b,c,d,e){a.d[b]={init:function(b,g,k,l,m){var h,r;a.m(function(){var q=a.a.c(g()),p=!d!==!q,A=!r;if(A||c||p!==h)A&&a.va.Aa()&&(r=a.a.ua(a.f.childNodes(b),!0)),p?(A||a.f.da(b,a.a.ua(r)),a.eb(e?e(m,q):m,b)):a.f.xa(b),h=p},null,{i:b});return{controlsDescendantBindings:!0}}};a.h.ta[b]=!1;a.f.Z[b]=!0}var a="undefined"!==typeof N?N:{};a.b=function(b,c){for(var d=b.split("."),e=a,f=0;f<d.length-1;f++)e=e[d[f]];e[d[d.length-1]]=c};a.G=function(a,c,d){a[c]=d};a.version="3.4.0";a.b("version",a.version);a.options={deferUpdates:!1,useOnlyNativeEvents:!1};a.a=function(){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function c(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(a,b){a.__proto__=b;return a}function e(b,c,d,e){var h=b[c].match(r)||[];a.a.q(d.match(r),function(b){a.a.pa(h,b,e)});b[c]=h.join(" ")}var f={__proto__:[]}instanceof Array,g="function"===typeof Symbol,k={},l={};k[M&&/Firefox\/2/i.test(M.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];k.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");b(k,function(a,b){if(b.length)for(var c=0,d=b.length;c<d;c++)l[b[c]]=a});var m={propertychange:!0},h=u&&function(){for(var a=3,b=u.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",c[0];);return 4<a?a:n}(),r=/\S+/g;return{cc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],q:function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},o:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},Sb:function(a,b,c){for(var d=0,e=a.length;d<e;d++)if(b.call(c,a[d],d))return a[d];return null},La:function(b,c){var d=a.a.o(b,c);0<d?b.splice(d,1):0===d&&b.shift()},Tb:function(b){b=b||[];for(var c=[],d=0,e=b.length;d<e;d++)0>a.a.o(c,b[d])&&c.push(b[d]);return c},fb:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)c.push(b(a[d],d));return c},Ka:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;d<e;d++)b(a[d],d)&&c.push(a[d]);return c},ra:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;c<d;c++)a.push(b[c]);return a},pa:function(b,c,d){var e=a.a.o(a.a.zb(b),c);0>e?d&&b.push(c):d||b.splice(e,1)},ka:f,extend:c,Xa:d,Ya:f?d:c,D:b,Ca:function(a,b){if(!a)return a;var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},ob:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},jc:function(b){b=a.a.V(b);for(var c=(b[0]&&b[0].ownerDocument||u).createElement("div"),d=0,e=b.length;d<e;d++)c.appendChild(a.$(b[d]));return c},ua:function(b,c){for(var d=0,e=b.length,h=[];d<e;d++){var m=b[d].cloneNode(!0);h.push(c?a.$(m):m)}return h},da:function(b,c){a.a.ob(b);if(c)for(var d=0,e=c.length;d<e;d++)b.appendChild(c[d])},qc:function(b,c){var d=b.nodeType?[b]:b;if(0<d.length){for(var e=d[0],h=e.parentNode,m=0,l=c.length;m<l;m++)h.insertBefore(c[m],e);m=0;for(l=d.length;m<l;m++)a.removeNode(d[m])}},za:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);for(;1<a.length&&a[a.length-1].parentNode!==b;)a.length--;if(1<a.length){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)a.push(c),c=c.nextSibling;a.push(d)}}return a},sc:function(a,b){7>h?a.setAttribute("selected",b):a.selected=b},$a:function(a){return null===a||a===n?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},nd:function(a,b){a=a||"";return b.length>a.length?!1:a.substring(0,b.length)===b},Mc:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(b.compareDocumentPosition(a)&16);for(;a&&a!=b;)a=a.parentNode;return!!a},nb:function(b){return a.a.Mc(b,b.ownerDocument.documentElement)},Qb:function(b){return!!a.a.Sb(b,a.a.nb)},A:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},Wb:function(b){return a.onError?function(){try{return b.apply(this,arguments)}catch(c){throw a.onError&&a.onError(c),c}}:b},setTimeout:function(b,c){return setTimeout(a.a.Wb(b),c)},$b:function(b){setTimeout(function(){a.onError&&a.onError(b);throw b},0)},p:function(b,c,d){var e=a.a.Wb(d);d=h&&m[c];if(a.options.useOnlyNativeEvents||d||!v)if(d||"function"!=typeof b.addEventListener)if("undefined"!=typeof b.attachEvent){var l=function(a){e.call(b,a)},f="on"+c;b.attachEvent(f,l);a.a.F.oa(b,function(){b.detachEvent(f,l)})}else throw Error("Browser doesn't support addEventListener or attachEvent");else b.addEventListener(c,e,!1);else v(b).bind(c,e)},Da:function(b,c){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var d;"input"===a.a.A(b)&&b.type&&"click"==c.toLowerCase()?(d=b.type,d="checkbox"==d||"radio"==d):d=!1;if(a.options.useOnlyNativeEvents||!v||d)if("function"==typeof u.createEvent)if("function"==typeof b.dispatchEvent)d=u.createEvent(l[c]||"HTMLEvents"),d.initEvent(c,!0,!0,x,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(d);else throw Error("The supplied element doesn't support dispatchEvent");else if(d&&b.click)b.click();else if("undefined"!=typeof b.fireEvent)b.fireEvent("on"+c);else throw Error("Browser doesn't support triggering events");else v(b).trigger(c)},c:function(b){return a.H(b)?b():b},zb:function(b){return a.H(b)?b.t():b},bb:function(b,c,d){var h;c&&("object"===typeof b.classList?(h=b.classList[d?"add":"remove"],a.a.q(c.match(r),function(a){h.call(b.classList,a)})):"string"===typeof b.className.baseVal?e(b.className,"baseVal",c,d):e(b,"className",c,d))},Za:function(b,c){var d=a.a.c(c);if(null===d||d===n)d="";var e=a.f.firstChild(b);!e||3!=e.nodeType||a.f.nextSibling(e)?a.f.da(b,[b.ownerDocument.createTextNode(d)]):e.data=d;a.a.Rc(b)},rc:function(a,b){a.name=b;if(7>=h)try{a.mergeAttributes(u.createElement("<input name='"+a.name+"'/>"),!1)}catch(c){}},Rc:function(a){9<=h&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},Nc:function(a){if(h){var b=a.style.width;a.style.width=0;a.style.width=b}},hd:function(b,c){b=a.a.c(b);c=a.a.c(c);for(var d=[],e=b;e<=c;e++)d.push(e);return d},V:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b},Yb:function(a){return g?Symbol(a):a},rd:6===h,sd:7===h,C:h,ec:function(b,c){for(var d=a.a.V(b.getElementsByTagName("input")).concat(a.a.V(b.getElementsByTagName("textarea"))),e="string"==typeof c?function(a){return a.name===c}:function(a){return c.test(a.name)},h=[],m=d.length-1;0<=m;m--)e(d[m])&&h.push(d[m]);return h},ed:function(b){return"string"==typeof b&&(b=a.a.$a(b))?F&&F.parse?F.parse(b):new Function("return "+b)():null},Eb:function(b,c,d){if(!F||!F.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return F.stringify(a.a.c(b),c,d)},fd:function(c,d,e){e=e||{};var h=e.params||{},m=e.includeFields||this.cc,l=c;if("object"==typeof c&&"form"===a.a.A(c))for(var l=c.action,f=m.length-1;0<=f;f--)for(var g=a.a.ec(c,m[f]),k=g.length-1;0<=k;k--)h[g[k].name]=g[k].value;d=a.a.c(d);var r=u.createElement("form");r.style.display="none";r.action=l;r.method="post";for(var n in d)c=u.createElement("input"),c.type="hidden",c.name=n,c.value=a.a.Eb(a.a.c(d[n])),r.appendChild(c);b(h,function(a,b){var c=u.createElement("input");c.type="hidden";c.name=a;c.value=b;r.appendChild(c)});u.body.appendChild(r);e.submitter?e.submitter(r):r.submit();setTimeout(function(){r.parentNode.removeChild(r)},0)}}}();a.b("utils",a.a);a.b("utils.arrayForEach",a.a.q);a.b("utils.arrayFirst",a.a.Sb);a.b("utils.arrayFilter",a.a.Ka);a.b("utils.arrayGetDistinctValues",a.a.Tb);a.b("utils.arrayIndexOf",a.a.o);a.b("utils.arrayMap",a.a.fb);a.b("utils.arrayPushAll",a.a.ra);a.b("utils.arrayRemoveItem",a.a.La);a.b("utils.extend",a.a.extend);a.b("utils.fieldsIncludedWithJsonPost",a.a.cc);a.b("utils.getFormFields",a.a.ec);a.b("utils.peekObservable",a.a.zb);a.b("utils.postJson",a.a.fd);a.b("utils.parseJson",a.a.ed);a.b("utils.registerEventHandler",a.a.p);a.b("utils.stringifyJson",a.a.Eb);a.b("utils.range",a.a.hd);a.b("utils.toggleDomNodeCssClass",a.a.bb);a.b("utils.triggerEvent",a.a.Da);a.b("utils.unwrapObservable",a.a.c);a.b("utils.objectForEach",a.a.D);a.b("utils.addOrRemoveItem",a.a.pa);a.b("utils.setTextContent",a.a.Za);a.b("unwrap",a.a.c);Function.prototype.bind||(Function.prototype.bind=function(a){var c=this;if(1===arguments.length)return function(){return c.apply(a,arguments)};var d=Array.prototype.slice.call(arguments,1);return function(){var e=d.slice(0);e.push.apply(e,arguments);return c.apply(a,e)}});a.a.e=new function(){function a(b,g){var k=b[d];if(!k||"null"===k||!e[k]){if(!g)return n;k=b[d]="ko"+c++;e[k]={}}return e[k]}var c=0,d="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=a(c,!1);return e===n?n:e[d]},set:function(c,d,e){if(e!==n||a(c,!1)!==n)a(c,!0)[d]=e},clear:function(a){var b=a[d];return b?(delete e[b],a[d]=null,!0):!1},I:function(){return c+++d}}};a.b("utils.domData",a.a.e);a.b("utils.domData.clear",a.a.e.clear);a.a.F=new function(){function b(b,c){var e=a.a.e.get(b,d);e===n&&c&&(e=[],a.a.e.set(b,d,e));return e}function c(d){var e=b(d,!1);if(e)for(var e=e.slice(0),l=0;l<e.length;l++)e[l](d);a.a.e.clear(d);a.a.F.cleanExternalData(d);if(f[d.nodeType])for(e=d.firstChild;d=e;)e=d.nextSibling,8===d.nodeType&&c(d)}var d=a.a.e.I(),e={1:!0,8:!0,9:!0},f={1:!0,9:!0};return{oa:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b(a,!0).push(c)},pc:function(c,e){var l=b(c,!1);l&&(a.a.La(l,e),0==l.length&&a.a.e.set(c,d,n))},$:function(b){if(e[b.nodeType]&&(c(b),f[b.nodeType])){var d=[];a.a.ra(d,b.getElementsByTagName("*"));for(var l=0,m=d.length;l<m;l++)c(d[l])}return b},removeNode:function(b){a.$(b);b.parentNode&&b.parentNode.removeChild(b)},cleanExternalData:function(a){v&&"function"==typeof v.cleanData&&v.cleanData([a])}}};a.$=a.a.F.$;a.removeNode=a.a.F.removeNode;a.b("cleanNode",a.$);a.b("removeNode",a.removeNode);a.b("utils.domNodeDisposal",a.a.F);a.b("utils.domNodeDisposal.addDisposeCallback",a.a.F.oa);a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.F.pc);(function(){var b=[0,"",""],c=[1,"<table>","</table>"],d=[3,"<table><tbody><tr>","</tr></tbody></table>"],e=[1,"<select multiple='multiple'>","</select>"],f={thead:c,tbody:c,tfoot:c,tr:[2,"<table><tbody>","</tbody></table>"],td:d,th:d,option:e,optgroup:e},g=8>=a.a.C;a.a.ma=function(c,d){var e;if(v)if(v.parseHTML)e=v.parseHTML(c,d)||[];else{if((e=v.clean([c],d))&&e[0]){for(var h=e[0];h.parentNode&&11!==h.parentNode.nodeType;)h=h.parentNode;h.parentNode&&h.parentNode.removeChild(h)}}else{(e=d)||(e=u);var h=e.parentWindow||e.defaultView||x,r=a.a.$a(c).toLowerCase(),q=e.createElement("div"),p;p=(r=r.match(/^<([a-z]+)[ >]/))&&f[r[1]]||b;r=p[0];p="ignored<div>"+p[1]+c+p[2]+"</div>";"function"==typeof h.innerShiv?q.appendChild(h.innerShiv(p)):(g&&e.appendChild(q),q.innerHTML=p,g&&q.parentNode.removeChild(q));for(;r--;)q=q.lastChild;e=a.a.V(q.lastChild.childNodes)}return e};a.a.Cb=function(b,c){a.a.ob(b);c=a.a.c(c);if(null!==c&&c!==n)if("string"!=typeof c&&(c=c.toString()),v)v(b).html(c);else for(var d=a.a.ma(c,b.ownerDocument),e=0;e<d.length;e++)b.appendChild(d[e])}})();a.b("utils.parseHtmlFragment",a.a.ma);a.b("utils.setHtml",a.a.Cb);a.M=function(){function b(c,e){if(c)if(8==c.nodeType){var f=a.M.lc(c.nodeValue);null!=f&&e.push({Lc:c,cd:f})}else if(1==c.nodeType)for(var f=0,g=c.childNodes,k=g.length;f<k;f++)b(g[f],e)}var c={};return{wb:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);c[b]=a;return"\x3c!--[ko_memo:"+b+"]--\x3e"},xc:function(a,b){var f=c[a];if(f===n)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return f.apply(null,b||[]),!0}finally{delete c[a]}},yc:function(c,e){var f=[];b(c,f);for(var g=0,k=f.length;g<k;g++){var l=f[g].Lc,m=[l];e&&a.a.ra(m,e);a.M.xc(f[g].cd,m);l.nodeValue="";l.parentNode&&l.parentNode.removeChild(l)}},lc:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}();a.b("memoization",a.M);a.b("memoization.memoize",a.M.wb);a.b("memoization.unmemoize",a.M.xc);a.b("memoization.parseMemoText",a.M.lc);a.b("memoization.unmemoizeDomNodeAndDescendants",a.M.yc);a.Y=function(){function b(){if(e)for(var b=e,c=0,m;g<e;)if(m=d[g++]){if(g>b){if(5e3<=++c){g=e;a.a.$b(Error("'Too much recursion' after processing "+c+" task groups."));break}b=e}try{m()}catch(h){a.a.$b(h)}}}function c(){b();g=e=d.length=0}var d=[],e=0,f=1,g=0;return{scheduler:x.MutationObserver?function(a){var b=u.createElement("div");new MutationObserver(a).observe(b,{attributes:!0});return function(){b.classList.toggle("foo")}}(c):u&&"onreadystatechange"in u.createElement("script")?function(a){var b=u.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=null;u.documentElement.removeChild(b);b=null;a()};u.documentElement.appendChild(b)}:function(a){setTimeout(a,0)},Wa:function(b){e||a.Y.scheduler(c);d[e++]=b;return f++},cancel:function(a){a-=f-e;a>=g&&a<e&&(d[a]=null)},resetForTesting:function(){var a=e-g;g=e=d.length=0;return a},md:b}}();a.b("tasks",a.Y);a.b("tasks.schedule",a.Y.Wa);a.b("tasks.runEarly",a.Y.md);a.ya={throttle:function(b,c){b.throttleEvaluation=c;var d=null;return a.B({read:b,write:function(e){clearTimeout(d);d=a.a.setTimeout(function(){b(e)},c)}})},rateLimit:function(a,c){var d,e,f;"number"==typeof c?d=c:(d=c.timeout,e=c.method);a.cb=!1;f="notifyWhenChangesStop"==e?V:U;a.Ta(function(a){return f(a,d)})},deferred:function(b,c){if(!0!==c)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");b.cb||(b.cb=!0,b.Ta(function(c){var e;return function(){a.Y.cancel(e);e=a.Y.Wa(c);b.notifySubscribers(n,"dirty")}}))},notify:function(a,c){a.equalityComparer="always"==c?null:J}};var T={undefined:1,boolean:1,number:1,string:1};a.b("extenders",a.ya);a.vc=function(b,c,d){this.ia=b;this.gb=c;this.Kc=d;this.R=!1;a.G(this,"dispose",this.k)};a.vc.prototype.k=function(){this.R=!0;this.Kc()};a.J=function(){a.a.Ya(this,D);D.rb(this)};var I="change",D={rb:function(a){a.K={};a.Nb=1},X:function(b,c,d){var e=this;d=d||I;var f=new a.vc(e,c?b.bind(c):b,function(){a.a.La(e.K[d],f);e.Ia&&e.Ia(d)});e.sa&&e.sa(d);e.K[d]||(e.K[d]=[]);e.K[d].push(f);return f},notifySubscribers:function(b,c){c=c||I;c===I&&this.zc();if(this.Pa(c))try{a.l.Ub();for(var d=this.K[c].slice(0),e=0,f;f=d[e];++e)f.R||f.gb(b)}finally{a.l.end()}},Na:function(){return this.Nb},Uc:function(a){return this.Na()!==a},zc:function(){++this.Nb},Ta:function(b){var c=this,d=a.H(c),e,f,g;c.Ha||(c.Ha=c.notifySubscribers,c.notifySubscribers=W);var k=b(function(){c.Mb=!1;d&&g===c&&(g=c());e=!1;c.tb(f,g)&&c.Ha(f=g)});c.Lb=function(a){c.Mb=e=!0;g=a;k()};c.Kb=function(a){e||(f=a,c.Ha(a,"beforeChange"))}},Pa:function(a){return this.K[a]&&this.K[a].length},Sc:function(b){if(b)return this.K[b]&&this.K[b].length||0;var c=0;a.a.D(this.K,function(a,b){"dirty"!==a&&(c+=b.length)});return c},tb:function(a,c){return!this.equalityComparer||!this.equalityComparer(a,c)},extend:function(b){var c=this;b&&a.a.D(b,function(b,e){var f=a.ya[b];"function"==typeof f&&(c=f(c,e)||c)});return c}};a.G(D,"subscribe",D.X);a.G(D,"extend",D.extend);a.G(D,"getSubscriptionsCount",D.Sc);a.a.ka&&a.a.Xa(D,Function.prototype);a.J.fn=D;a.hc=function(a){return null!=a&&"function"==typeof a.X&&"function"==typeof a.notifySubscribers};a.b("subscribable",a.J);a.b("isSubscribable",a.hc);a.va=a.l=function(){function b(a){d.push(e);e=a}function c(){e=d.pop()}var d=[],e,f=0;return{Ub:b,end:c,oc:function(b){if(e){if(!a.hc(b))throw Error("Only subscribable things can act as dependencies");e.gb.call(e.Gc,b,b.Cc||(b.Cc=++f))}},w:function(a,d,e){try{return b(),a.apply(d,e||[])}finally{c()}},Aa:function(){if(e)return e.m.Aa()},Sa:function(){if(e)return e.Sa}}}();a.b("computedContext",a.va);a.b("computedContext.getDependenciesCount",a.va.Aa);a.b("computedContext.isInitial",a.va.Sa);a.b("ignoreDependencies",a.qd=a.l.w);var E=a.a.Yb("_latestValue");a.N=function(b){function c(){if(0<arguments.length)return c.tb(c[E],arguments[0])&&(c.ga(),c[E]=arguments[0],c.fa()),this;a.l.oc(c);return c[E]}c[E]=b;a.a.ka||a.a.extend(c,a.J.fn);a.J.fn.rb(c);a.a.Ya(c,B);a.options.deferUpdates&&a.ya.deferred(c,!0);return c};var B={equalityComparer:J,t:function(){return this[E]},fa:function(){this.notifySubscribers(this[E])},ga:function(){this.notifySubscribers(this[E],"beforeChange")}};a.a.ka&&a.a.Xa(B,a.J.fn);var H=a.N.gd="__ko_proto__";B[H]=a.N;a.Oa=function(b,c){return null===b||b===n||b[H]===n?!1:b[H]===c?!0:a.Oa(b[H],c)};a.H=function(b){return a.Oa(b,a.N)};a.Ba=function(b){return"function"==typeof b&&b[H]===a.N||"function"==typeof b&&b[H]===a.B&&b.Vc?!0:!1};a.b("observable",a.N);a.b("isObservable",a.H);a.b("isWriteableObservable",a.Ba);a.b("isWritableObservable",a.Ba);a.b("observable.fn",B);a.G(B,"peek",B.t);a.G(B,"valueHasMutated",B.fa);a.G(B,"valueWillMutate",B.ga);a.la=function(b){b=b||[];if("object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");b=a.N(b);a.a.Ya(b,a.la.fn);return b.extend({trackArrayChanges:!0})};a.la.fn={remove:function(b){for(var c=this.t(),d=[],e="function"!=typeof b||a.H(b)?function(a){return a===b}:b,f=0;f<c.length;f++){var g=c[f];e(g)&&(0===d.length&&this.ga(),d.push(g),c.splice(f,1),f--)}d.length&&this.fa();return d},removeAll:function(b){if(b===n){var c=this.t(),d=c.slice(0);this.ga();c.splice(0,c.length);this.fa();return d}return b?this.remove(function(c){return 0<=a.a.o(b,c)}):[]},destroy:function(b){var c=this.t(),d="function"!=typeof b||a.H(b)?function(a){return a===b}:b;this.ga();for(var e=c.length-1;0<=e;e--)d(c[e])&&(c[e]._destroy=!0);this.fa()},destroyAll:function(b){return b===n?this.destroy(function(){return!0}):b?this.destroy(function(c){return 0<=a.a.o(b,c)}):[]},indexOf:function(b){var c=this();return a.a.o(c,b)},replace:function(a,c){var d=this.indexOf(a);0<=d&&(this.ga(),this.t()[d]=c,this.fa())}};a.a.ka&&a.a.Xa(a.la.fn,a.N.fn);a.a.q("pop push reverse shift sort splice unshift".split(" "),function(b){a.la.fn[b]=function(){var a=this.t();this.ga();this.Vb(a,b,arguments);var d=a[b].apply(a,arguments);this.fa();return d===a?this:d}});a.a.q(["slice"],function(b){a.la.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}});a.b("observableArray",a.la);a.ya.trackArrayChanges=function(b,c){function d(){if(!e){e=!0;var c=b.notifySubscribers;b.notifySubscribers=function(a,b){b&&b!==I||++k;return c.apply(this,arguments)};var d=[].concat(b.t()||[]);f=null;g=b.X(function(c){c=[].concat(c||[]);if(b.Pa("arrayChange")){var e;if(!f||1<k)f=a.a.ib(d,c,b.hb);e=f}d=c;f=null;k=0;e&&e.length&&b.notifySubscribers(e,"arrayChange")})}}b.hb={};c&&"object"==typeof c&&a.a.extend(b.hb,c);b.hb.sparse=!0;if(!b.Vb){var e=!1,f=null,g,k=0,l=b.sa,m=b.Ia;b.sa=function(a){l&&l.call(b,a);"arrayChange"===a&&d()};b.Ia=function(a){m&&m.call(b,a);"arrayChange"!==a||b.Pa("arrayChange")||(g.k(),e=!1)};b.Vb=function(b,c,d){function m(a,b,c){return l[l.length]={status:a,value:b,index:c}}if(e&&!k){var l=[],g=b.length,t=d.length,G=0;switch(c){case"push":G=g;case"unshift":for(c=0;c<t;c++)m("added",d[c],G+c);break;case"pop":G=g-1;case"shift":g&&m("deleted",b[G],G);break;case"splice":c=Math.min(Math.max(0,0>d[0]?g+d[0]:d[0]),g);for(var g=1===t?g:Math.min(c+(d[1]||0),g),t=c+t-2,G=Math.max(g,t),P=[],n=[],Q=2;c<G;++c,++Q)c<g&&n.push(m("deleted",b[c],c)),c<t&&P.push(m("added",d[Q],c));a.a.dc(n,P);break;default:return}f=l}}}};var s=a.a.Yb("_state");a.m=a.B=function(b,c,d){function e(){if(0<arguments.length){if("function"===typeof f)f.apply(g.pb,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}a.l.oc(e);(g.S||g.s&&e.Qa())&&e.aa();return g.T}"object"===typeof b?d=b:(d=d||{},b&&(d.read=b));if("function"!=typeof d.read)throw Error("Pass a function that returns the value of the ko.computed");var f=d.write,g={T:n,S:!0,Ra:!1,Fb:!1,R:!1,Va:!1,s:!1,jd:d.read,pb:c||d.owner,i:d.disposeWhenNodeIsRemoved||d.i||null,wa:d.disposeWhen||d.wa,mb:null,r:{},L:0,bc:null};e[s]=g;e.Vc="function"===typeof f;a.a.ka||a.a.extend(e,a.J.fn);a.J.fn.rb(e);a.a.Ya(e,z);d.pure?(g.Va=!0,g.s=!0,a.a.extend(e,$)):d.deferEvaluation&&a.a.extend(e,aa);a.options.deferUpdates&&a.ya.deferred(e,!0);g.i&&(g.Fb=!0,g.i.nodeType||(g.i=null));g.s||d.deferEvaluation||e.aa();g.i&&e.ba()&&a.a.F.oa(g.i,g.mb=function(){e.k()});return e};var z={equalityComparer:J,Aa:function(){return this[s].L},Pb:function(a,c,d){if(this[s].Va&&c===this)throw Error("A 'pure' computed must not be called recursively");this[s].r[a]=d;d.Ga=this[s].L++;d.na=c.Na()},Qa:function(){var a,c,d=this[s].r;for(a in d)if(d.hasOwnProperty(a)&&(c=d[a],c.ia.Uc(c.na)))return!0},bd:function(){this.Fa&&!this[s].Ra&&this.Fa()},ba:function(){return this[s].S||0<this[s].L},ld:function(){this.Mb||this.ac()},uc:function(a){if(a.cb&&!this[s].i){var c=a.X(this.bd,this,"dirty"),d=a.X(this.ld,this);return{ia:a,k:function(){c.k();d.k()}}}return a.X(this.ac,this)},ac:function(){var b=this,c=b.throttleEvaluation;c&&0<=c?(clearTimeout(this[s].bc),this[s].bc=a.a.setTimeout(function(){b.aa(!0)},c)):b.Fa?b.Fa():b.aa(!0)},aa:function(b){var c=this[s],d=c.wa;if(!c.Ra&&!c.R){if(c.i&&!a.a.nb(c.i)||d&&d()){if(!c.Fb){this.k();return}}else c.Fb=!1;c.Ra=!0;try{this.Qc(b)}finally{c.Ra=!1}c.L||this.k()}},Qc:function(b){var c=this[s],d=c.Va?n:!c.L,e={Hc:this,Ma:c.r,lb:c.L};a.l.Ub({Gc:e,gb:Y,m:this,Sa:d});c.r={};c.L=0;e=this.Pc(c,e);this.tb(c.T,e)&&(c.s||this.notifySubscribers(c.T,"beforeChange"),c.T=e,c.s?this.zc():b&&this.notifySubscribers(c.T));d&&this.notifySubscribers(c.T,"awake")},Pc:function(b,c){try{var d=b.jd;return b.pb?d.call(b.pb):d()}finally{a.l.end(),c.lb&&!b.s&&a.a.D(c.Ma,X),b.S=!1}},t:function(){var a=this[s];(a.S&&!a.L||a.s&&this.Qa())&&this.aa();return a.T},Ta:function(b){a.J.fn.Ta.call(this,b);this.Fa=function(){this.Kb(this[s].T);this[s].S=!0;this.Lb(this)}},k:function(){var b=this[s];!b.s&&b.r&&a.a.D(b.r,function(a,b){b.k&&b.k()});b.i&&b.mb&&a.a.F.pc(b.i,b.mb);b.r=null;b.L=0;b.R=!0;b.S=!1;b.s=!1;b.i=null}},$={sa:function(b){var c=this,d=c[s];if(!d.R&&d.s&&"change"==b){d.s=!1;if(d.S||c.Qa())d.r=null,d.L=0,d.S=!0,c.aa();else{var e=[];a.a.D(d.r,function(a,b){e[b.Ga]=a});a.a.q(e,function(a,b){var e=d.r[a],l=c.uc(e.ia);l.Ga=b;l.na=e.na;d.r[a]=l})}d.R||c.notifySubscribers(d.T,"awake")}},Ia:function(b){var c=this[s];c.R||"change"!=b||this.Pa("change")||(a.a.D(c.r,function(a,b){b.k&&(c.r[a]={ia:b.ia,Ga:b.Ga,na:b.na},b.k())}),c.s=!0,this.notifySubscribers(n,"asleep"))},Na:function(){var b=this[s];b.s&&(b.S||this.Qa())&&this.aa();return a.J.fn.Na.call(this)}},aa={sa:function(a){"change"!=a&&"beforeChange"!=a||this.t()}};a.a.ka&&a.a.Xa(z,a.J.fn);var R=a.N.gd;a.m[R]=a.N;z[R]=a.m;a.Xc=function(b){return a.Oa(b,a.m)};a.Yc=function(b){return a.Oa(b,a.m)&&b[s]&&b[s].Va};a.b("computed",a.m);a.b("dependentObservable",a.m);a.b("isComputed",a.Xc);a.b("isPureComputed",a.Yc);a.b("computed.fn",z);a.G(z,"peek",z.t);a.G(z,"dispose",z.k);a.G(z,"isActive",z.ba);a.G(z,"getDependenciesCount",z.Aa);a.nc=function(b,c){if("function"===typeof b)return a.m(b,c,{pure:!0});b=a.a.extend({},b);b.pure=!0;return a.m(b,c)};a.b("pureComputed",a.nc);(function(){function b(a,f,g){g=g||new d;a=f(a);if("object"!=typeof a||null===a||a===n||a instanceof RegExp||a instanceof Date||a instanceof String||a instanceof Number||a instanceof Boolean)return a;var k=a instanceof Array?[]:{};g.save(a,k);c(a,function(c){var d=f(a[c]);switch(typeof d){case"boolean":case"number":case"string":case"function":k[c]=d;break;case"object":case"undefined":var h=g.get(d);k[c]=h!==n?h:b(d,f,g)}});return k}function c(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function d(){this.keys=[];this.Ib=[]}a.wc=function(c){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return b(c,function(b){for(var c=0;a.H(b)&&10>c;c++)b=b();return b})};a.toJSON=function(b,c,d){b=a.wc(b);return a.a.Eb(b,c,d)};d.prototype={save:function(b,c){var d=a.a.o(this.keys,b);0<=d?this.Ib[d]=c:(this.keys.push(b),this.Ib.push(c))},get:function(b){b=a.a.o(this.keys,b);return 0<=b?this.Ib[b]:n}}})();a.b("toJS",a.wc);a.b("toJSON",a.toJSON);(function(){a.j={u:function(b){switch(a.a.A(b)){case"option":return!0===b.__ko__hasDomDataOptionValue__?a.a.e.get(b,a.d.options.xb):7>=a.a.C?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case"select":return 0<=b.selectedIndex?a.j.u(b.options[b.selectedIndex]):n;default:return b.value}},ha:function(b,c,d){switch(a.a.A(b)){case"option":switch(typeof c){case"string":a.a.e.set(b,a.d.options.xb,n);"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__;b.value=c;break;default:a.a.e.set(b,a.d.options.xb,c),b.__ko__hasDomDataOptionValue__=!0,b.value="number"===typeof c?c:""}break;case"select":if(""===c||null===c)c=n;for(var e=-1,f=0,g=b.options.length,k;f<g;++f)if(k=a.j.u(b.options[f]),k==c||""==k&&c===n){e=f;break}if(d||0<=e||c===n&&1<b.size)b.selectedIndex=e;break;default:if(null===c||c===n)c="";b.value=c}}}})();a.b("selectExtensions",a.j);a.b("selectExtensions.readValue",a.j.u);a.b("selectExtensions.writeValue",a.j.ha);a.h=function(){function b(b){b=a.a.$a(b);123===b.charCodeAt(0)&&(b=b.slice(1,-1));var c=[],d=b.match(e),r,k=[],p=0;if(d){d.push(",");for(var A=0,y;y=d[A];++A){var t=y.charCodeAt(0);if(44===t){if(0>=p){c.push(r&&k.length?{key:r,value:k.join("")}:{unknown:r||k.join("")});r=p=0;k=[];continue}}else if(58===t){if(!p&&!r&&1===k.length){r=k.pop();continue}}else 47===t&&A&&1<y.length?(t=d[A-1].match(f))&&!g[t[0]]&&(b=b.substr(b.indexOf(y)+1),d=b.match(e),d.push(","),A=-1,y="/"):40===t||123===t||91===t?++p:41===t||125===t||93===t?--p:r||k.length||34!==t&&39!==t||(y=y.slice(1,-1));k.push(y)}}return c}var c=["true","false","null","undefined"],d=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,e=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),f=/[\])"'A-Za-z0-9_$]+$/,g={in:1,return:1,typeof:1},k={};return{ta:[],ea:k,yb:b,Ua:function(e,m){function h(b,e){var m;if(!A){var l=a.getBindingHandler(b);if(l&&l.preprocess&&!(e=l.preprocess(e,b,h)))return;if(l=k[b])m=e,0<=a.a.o(c,m)?m=!1:(l=m.match(d),m=null===l?!1:l[1]?"Object("+l[1]+")"+l[2]:m),l=m;l&&g.push("'"+b+"':function(_z){"+m+"=_z}")}p&&(e="function(){return "+e+" }");f.push("'"+b+"':"+e)}m=m||{};var f=[],g=[],p=m.valueAccessors,A=m.bindingParams,y="string"===typeof e?b(e):e;a.a.q(y,function(a){h(a.key||a.unknown,a.value)});g.length&&h("_ko_property_writers","{"+g.join(",")+" }");return f.join(",")},ad:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},Ea:function(b,c,d,e,f){if(b&&a.H(b))!a.Ba(b)||f&&b.t()===e||b(e);else if((b=c.get("_ko_property_writers"))&&b[d])b[d](e)}}}();a.b("expressionRewriting",a.h);a.b("expressionRewriting.bindingRewriteValidators",a.h.ta);a.b("expressionRewriting.parseObjectLiteral",a.h.yb);a.b("expressionRewriting.preProcessBindings",a.h.Ua);a.b("expressionRewriting._twoWayBindings",a.h.ea);a.b("jsonExpressionRewriting",a.h);a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.h.Ua);(function(){function b(a){return 8==a.nodeType&&g.test(f?a.text:a.nodeValue)}function c(a){return 8==a.nodeType&&k.test(f?a.text:a.nodeValue)}function d(a,d){for(var e=a,f=1,l=[];e=e.nextSibling;){if(c(e)&&(f--,0===f))return l;l.push(e);b(e)&&f++}if(!d)throw Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function e(a,b){var c=d(a,b);return c?0<c.length?c[c.length-1].nextSibling:a.nextSibling:null}var f=u&&"\x3c!--test--\x3e"===u.createComment("test").text,g=f?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,k=f?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0};a.f={Z:{},childNodes:function(a){return b(a)?d(a):a.childNodes},xa:function(c){if(b(c)){c=a.f.childNodes(c);for(var d=0,e=c.length;d<e;d++)a.removeNode(c[d])}else a.a.ob(c)},da:function(c,d){if(b(c)){a.f.xa(c);for(var e=c.nextSibling,f=0,l=d.length;f<l;f++)e.parentNode.insertBefore(d[f],e)}else a.a.da(c,d)},mc:function(a,c){b(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},gc:function(c,d,e){e?b(c)?c.parentNode.insertBefore(d,e.nextSibling):e.nextSibling?c.insertBefore(d,e.nextSibling):c.appendChild(d):a.f.mc(c,d)},firstChild:function(a){return b(a)?!a.nextSibling||c(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){b(a)&&(a=e(a));return a.nextSibling&&c(a.nextSibling)?null:a.nextSibling},Tc:b,pd:function(a){return(a=(f?a.text:a.nodeValue).match(g))?a[1]:null},kc:function(d){if(l[a.a.A(d)]){var h=d.firstChild;if(h){do{if(1===h.nodeType){var f;f=h.firstChild;var g=null;if(f){do{if(g)g.push(f);else if(b(f)){var k=e(f,!0);k?f=k:g=[f]}else c(f)&&(g=[f])}while(f=f.nextSibling)}if(f=g)for(g=h.nextSibling,k=0;k<f.length;k++)g?d.insertBefore(f[k],g):d.appendChild(f[k])}}while(h=h.nextSibling)}}}}})();a.b("virtualElements",a.f);a.b("virtualElements.allowedBindings",a.f.Z);a.b("virtualElements.emptyNode",a.f.xa);a.b("virtualElements.insertAfter",a.f.gc);a.b("virtualElements.prepend",a.f.mc);a.b("virtualElements.setDomNodeChildren",a.f.da);(function(){a.Q=function(){this.Fc={}};a.a.extend(a.Q.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=b.getAttribute("data-bind")||a.g.getComponentNameForNode(b);case 8:return a.f.Tc(b);default:return!1}},getBindings:function(b,c){var d=this.getBindingsString(b,c),d=d?this.parseBindingsString(d,c,b):null;return a.g.Ob(d,b,c,!1)},getBindingAccessors:function(b,c){var d=this.getBindingsString(b,c),d=d?this.parseBindingsString(d,c,b,{valueAccessors:!0}):null;return a.g.Ob(d,b,c,!0)},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.f.pd(b);default:return null}},parseBindingsString:function(b,c,d,e){try{var f=this.Fc,g=b+(e&&e.valueAccessors||""),k;if(!(k=f[g])){var l,m="with($context){with($data||{}){return{"+a.h.Ua(b,e)+"}}}";l=new Function("$context","$element",m);k=f[g]=l}return k(c,d)}catch(h){throw h.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+h.message,h}}});a.Q.instance=new a.Q})();a.b("bindingProvider",a.Q);(function(){function b(a){return function(){return a}}function c(a){return a()}function d(b){return a.a.Ca(a.l.w(b),function(a,c){return function(){return b()[c]}})}function e(c,e,h){return"function"===typeof c?d(c.bind(null,e,h)):a.a.Ca(c,b)}function f(a,b){return d(this.getBindings.bind(this,a,b))}function g(b,c,d){var e,h=a.f.firstChild(c),f=a.Q.instance,m=f.preprocessNode;if(m){for(;e=h;)h=a.f.nextSibling(e),m.call(f,e);h=a.f.firstChild(c)}for(;e=h;)h=a.f.nextSibling(e),k(b,e,d)}function k(b,c,d){var e=!0,h=1===c.nodeType;h&&a.f.kc(c);if(h&&d||a.Q.instance.nodeHasBindings(c))e=m(c,null,b,d).shouldBindDescendants;e&&!r[a.a.A(c)]&&g(b,c,!h)}function l(b){var c=[],d={},e=[];a.a.D(b,function Z(h){if(!d[h]){var f=a.getBindingHandler(h);f&&(f.after&&(e.push(h),a.a.q(f.after,function(c){if(b[c]){if(-1!==a.a.o(e,c))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+e.join(", "));Z(c)}}),e.length--),c.push({key:h,fc:f}));d[h]=!0}});return c}function m(b,d,e,h){var m=a.a.e.get(b,q);if(!d){if(m)throw Error("You cannot apply bindings multiple times to the same element.");a.a.e.set(b,q,!0)}!m&&h&&a.tc(b,e);var g;if(d&&"function"!==typeof d)g=d;else{var k=a.Q.instance,r=k.getBindingAccessors||f,p=a.B(function(){(g=d?d(e,b):r.call(k,b,e))&&e.P&&e.P();return g},null,{i:b});g&&p.ba()||(p=null)}var u;if(g){var v=p?function(a){return function(){return c(p()[a])}}:function(a){return g[a]},s=function(){return a.a.Ca(p?p():g,c)};s.get=function(a){return g[a]&&c(v(a))};s.has=function(a){return a in g};h=l(g);a.a.q(h,function(c){var d=c.fc.init,h=c.fc.update,f=c.key;if(8===b.nodeType&&!a.f.Z[f])throw Error("The binding '"+f+"' cannot be used with virtual elements");try{"function"==typeof d&&a.l.w(function(){var a=d(b,v(f),s,e.$data,e);if(a&&a.controlsDescendantBindings){if(u!==n)throw Error("Multiple bindings ("+u+" and "+f+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");u=f}}),"function"==typeof h&&a.B(function(){h(b,v(f),s,e.$data,e)},null,{i:b})}catch(m){throw m.message='Unable to process binding "'+f+": "+g[f]+'"\nMessage: '+m.message,m}})}return{shouldBindDescendants:u===n}}function h(b){return b&&b instanceof a.U?b:new a.U(b)}a.d={};var r={script:!0,textarea:!0,template:!0};a.getBindingHandler=function(b){return a.d[b]};a.U=function(b,c,d,e){var h=this,f="function"==typeof b&&!a.H(b),m,g=a.B(function(){var m=f?b():b,l=a.a.c(m);c?(c.P&&c.P(),a.a.extend(h,c),g&&(h.P=g)):(h.$parents=[],h.$root=l,h.ko=a);h.$rawData=m;h.$data=l;d&&(h[d]=l);e&&e(h,c,l);return h.$data},null,{wa:function(){return m&&!a.a.Qb(m)},i:!0});g.ba()&&(h.P=g,g.equalityComparer=null,m=[],g.Ac=function(b){m.push(b);a.a.F.oa(b,function(b){a.a.La(m,b);m.length||(g.k(),h.P=g=n)})})};a.U.prototype.createChildContext=function(b,c,d){return new a.U(b,this,c,function(a,b){a.$parentContext=b;a.$parent=b.$data;a.$parents=(b.$parents||[]).slice(0);a.$parents.unshift(a.$parent);d&&d(a)})};a.U.prototype.extend=function(b){return new a.U(this.P||this.$data,this,null,function(c,d){c.$rawData=d.$rawData;a.a.extend(c,"function"==typeof b?b():b)})};var q=a.a.e.I(),p=a.a.e.I();a.tc=function(b,c){if(2==arguments.length)a.a.e.set(b,p,c),c.P&&c.P.Ac(b);else return a.a.e.get(b,p)};a.Ja=function(b,c,d){1===b.nodeType&&a.f.kc(b);return m(b,c,h(d),!0)};a.Dc=function(b,c,d){d=h(d);return a.Ja(b,e(c,d,b),d)};a.eb=function(a,b){1!==b.nodeType&&8!==b.nodeType||g(h(a),b,!0)};a.Rb=function(a,b){!v&&x.jQuery&&(v=x.jQuery);if(b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||x.document.body;k(h(a),b,!0)};a.kb=function(b){switch(b.nodeType){case 1:case 8:var c=a.tc(b);if(c)return c;if(b.parentNode)return a.kb(b.parentNode)}return n};a.Jc=function(b){return(b=a.kb(b))?b.$data:n};a.b("bindingHandlers",a.d);a.b("applyBindings",a.Rb);a.b("applyBindingsToDescendants",a.eb);a.b("applyBindingAccessorsToNode",a.Ja);a.b("applyBindingsToNode",a.Dc);a.b("contextFor",a.kb);a.b("dataFor",a.Jc)})();(function(b){function c(c,e){var m=f.hasOwnProperty(c)?f[c]:b,h;m?m.X(e):(m=f[c]=new a.J,m.X(e),d(c,function(b,d){var e=!(!d||!d.synchronous);g[c]={definition:b,Zc:e};delete f[c];h||e?m.notifySubscribers(b):a.Y.Wa(function(){m.notifySubscribers(b)})}),h=!0)}function d(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a,c)}):b(null,null)})}function e(c,d,f,h){h||(h=a.g.loaders.slice(0));var g=h.shift();if(g){var q=g[c];if(q){var p=!1;if(q.apply(g,d.concat(function(a){p?f(null):null!==a?f(a):e(c,d,f,h)}))!==b&&(p=!0,!g.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else e(c,d,f,h)}else f(null)}var f={},g={};a.g={get:function(d,e){var f=g.hasOwnProperty(d)?g[d]:b;f?f.Zc?a.l.w(function(){e(f.definition)}):a.Y.Wa(function(){e(f.definition)}):c(d,e)},Xb:function(a){delete g[a]},Jb:e};a.g.loaders=[];a.b("components",a.g);a.b("components.get",a.g.get);a.b("components.clearCachedDefinition",a.g.Xb)})();(function(){function b(b,c,d,e){function g(){0===--y&&e(k)}var k={},y=2,t=d.template;d=d.viewModel;t?f(c,t,function(c){a.g.Jb("loadTemplate",[b,c],function(a){k.template=a;g()})}):g();d?f(c,d,function(c){a.g.Jb("loadViewModel",[b,c],function(a){k[l]=a;g()})}):g()}function c(a,b,d){if("function"===typeof b)d(function(a){return new b(a)});else if("function"===typeof b[l])d(b[l]);else if("instance"in b){var e=b.instance;d(function(){return e})}else"viewModel"in b?c(a,b.viewModel,d):a("Unknown viewModel value: "+b)}function d(b){switch(a.a.A(b)){case"script":return a.a.ma(b.text);case"textarea":return a.a.ma(b.value);case"template":if(e(b.content))return a.a.ua(b.content.childNodes)}return a.a.ua(b.childNodes)}function e(a){return x.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType}function f(a,b,c){"string"===typeof b.require?O||x.require?(O||x.require)([b.require],c):a("Uses require, but no AMD loader is present"):c(b)}function g(a){return function(b){throw Error("Component '"+a+"': "+b)}}var k={};a.g.register=function(b,c){if(!c)throw Error("Invalid configuration for "+b);if(a.g.ub(b))throw Error("Component "+b+" is already registered");k[b]=c};a.g.ub=function(a){return k.hasOwnProperty(a)};a.g.od=function(b){delete k[b];a.g.Xb(b)};a.g.Zb={getConfig:function(a,b){b(k.hasOwnProperty(a)?k[a]:null)},loadComponent:function(a,c,d){var e=g(a);f(e,c,function(c){b(a,e,c,d)})},loadTemplate:function(b,c,f){b=g(b);if("string"===typeof c)f(a.a.ma(c));else if(c instanceof Array)f(c);else if(e(c))f(a.a.V(c.childNodes));else if(c.element)if(c=c.element,x.HTMLElement?c instanceof HTMLElement:c&&c.tagName&&1===c.nodeType)f(d(c));else if("string"===typeof c){var l=u.getElementById(c);l?f(d(l)):b("Cannot find element with ID "+c)}else b("Unknown element type: "+c);else b("Unknown template value: "+c)},loadViewModel:function(a,b,d){c(g(a),b,d)}};var l="createViewModel";a.b("components.register",a.g.register);a.b("components.isRegistered",a.g.ub);a.b("components.unregister",a.g.od);a.b("components.defaultLoader",a.g.Zb);a.g.loaders.push(a.g.Zb);a.g.Bc=k})();(function(){function b(b,e){var f=b.getAttribute("params");if(f){var f=c.parseBindingsString(f,e,b,{valueAccessors:!0,bindingParams:!0}),f=a.a.Ca(f,function(c){return a.m(c,null,{i:b})}),g=a.a.Ca(f,function(c){var e=c.t();return c.ba()?a.m({read:function(){return a.a.c(c())},write:a.Ba(e)&&function(a){c()(a)},i:b}):e});g.hasOwnProperty("$raw")||(g.$raw=f);return g}return{$raw:{}}}a.g.getComponentNameForNode=function(b){var c=a.a.A(b);if(a.g.ub(c)&&(-1!=c.indexOf("-")||"[object HTMLUnknownElement]"==""+b||8>=a.a.C&&b.tagName===c))return c};a.g.Ob=function(c,e,f,g){if(1===e.nodeType){var k=a.g.getComponentNameForNode(e);if(k){c=c||{};if(c.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var l={name:k,params:b(e,f)};c.component=g?function(){return l}:l}}return c};var c=new a.Q;9>a.a.C&&(a.g.register=function(a){return function(b){u.createElement(b);return a.apply(this,arguments)}}(a.g.register),u.createDocumentFragment=function(b){return function(){var c=b(),f=a.g.Bc,g;for(g in f)f.hasOwnProperty(g)&&c.createElement(g);return c}}(u.createDocumentFragment))})();(function(b){function c(b,c,d){c=c.template;if(!c)throw Error("Component '"+b+"' has no template");b=a.a.ua(c);a.f.da(d,b)}function d(a,b,c,d){var e=a.createViewModel;return e?e.call(a,d,{element:b,templateNodes:c}):d}var e=0;a.d.component={init:function(f,g,k,l,m){function h(){var a=r&&r.dispose;"function"===typeof a&&a.call(r);q=r=null}var r,q,p=a.a.V(a.f.childNodes(f));a.a.F.oa(f,h);a.m(function(){var l=a.a.c(g()),k,t;"string"===typeof l?k=l:(k=a.a.c(l.name),t=a.a.c(l.params));if(!k)throw Error("No component name specified");var n=q=++e;a.g.get(k,function(e){if(q===n){h();if(!e)throw Error("Unknown component '"+k+"'");c(k,e,f);var g=d(e,f,p,t);e=m.createChildContext(g,b,function(a){a.$component=g;a.$componentTemplateNodes=p});r=g;a.eb(e,f)}})},null,{i:f});return{controlsDescendantBindings:!0}}};a.f.Z.component=!0})();var S={class:"className",for:"htmlFor"};a.d.attr={update:function(b,c){var d=a.a.c(c())||{};a.a.D(d,function(c,d){d=a.a.c(d);var g=!1===d||null===d||d===n;g&&b.removeAttribute(c);8>=a.a.C&&c in S?(c=S[c],g?b.removeAttribute(c):b[c]=d):g||b.setAttribute(c,d.toString());"name"===c&&a.a.rc(b,g?"":d.toString())})}};(function(){a.d.checked={after:["value","attr"],init:function(b,c,d){function e(){var e=b.checked,f=p?g():e;if(!a.va.Sa()&&(!l||e)){var m=a.l.w(c);if(h){var k=r?m.t():m;q!==f?(e&&(a.a.pa(k,f,!0),a.a.pa(k,q,!1)),q=f):a.a.pa(k,f,e);r&&a.Ba(m)&&m(k)}else a.h.Ea(m,d,"checked",f,!0)}}function f(){var d=a.a.c(c());b.checked=h?0<=a.a.o(d,g()):k?d:g()===d}var g=a.nc(function(){return d.has("checkedValue")?a.a.c(d.get("checkedValue")):d.has("value")?a.a.c(d.get("value")):b.value}),k="checkbox"==b.type,l="radio"==b.type;if(k||l){var m=c(),h=k&&a.a.c(m)instanceof Array,r=!(h&&m.push&&m.splice),q=h?g():n,p=l||h;l&&!b.name&&a.d.uniqueName.init(b,function(){return!0});a.m(e,null,{i:b});a.a.p(b,"click",e);a.m(f,null,{i:b});m=n}}};a.h.ea.checked=!0;a.d.checkedValue={update:function(b,c){b.value=a.a.c(c())}}})();a.d.css={update:function(b,c){var d=a.a.c(c());null!==d&&"object"==typeof d?a.a.D(d,function(c,d){d=a.a.c(d);a.a.bb(b,c,d)}):(d=a.a.$a(String(d||"")),a.a.bb(b,b.__ko__cssValue,!1),b.__ko__cssValue=d,a.a.bb(b,d,!0))}};a.d.enable={update:function(b,c){var d=a.a.c(c());d&&b.disabled?b.removeAttribute("disabled"):d||b.disabled||(b.disabled=!0)}};a.d.disable={update:function(b,c){a.d.enable.update(b,function(){return!a.a.c(c())})}};a.d.event={init:function(b,c,d,e,f){var g=c()||{};a.a.D(g,function(g){"string"==typeof g&&a.a.p(b,g,function(b){var m,h=c()[g];if(h){try{var r=a.a.V(arguments);e=f.$data;r.unshift(e);m=h.apply(e,r)}finally{!0!==m&&(b.preventDefault?b.preventDefault():b.returnValue=!1)}!1===d.get(g+"Bubble")&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}};a.d.foreach={ic:function(b){return function(){var c=b(),d=a.a.zb(c);if(!d||"number"==typeof d.length)return{foreach:c,templateEngine:a.W.sb};a.a.c(c);return{foreach:d.data,as:d.as,includeDestroyed:d.includeDestroyed,afterAdd:d.afterAdd,beforeRemove:d.beforeRemove,afterRender:d.afterRender,beforeMove:d.beforeMove,afterMove:d.afterMove,templateEngine:a.W.sb}}},init:function(b,c){return a.d.template.init(b,a.d.foreach.ic(c))},update:function(b,c,d,e,f){return a.d.template.update(b,a.d.foreach.ic(c),d,e,f)}};a.h.ta.foreach=!1;a.f.Z.foreach=!0;a.d.hasfocus={init:function(b,c,d){function e(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(h){g=f.body}e=g===b}f=c();a.h.Ea(f,d,"hasfocus",e,!0);b.__ko_hasfocusLastValue=e;b.__ko_hasfocusUpdating=!1}var f=e.bind(null,!0),g=e.bind(null,!1);a.a.p(b,"focus",f);a.a.p(b,"focusin",f);a.a.p(b,"blur",g);a.a.p(b,"focusout",g)},update:function(b,c){var d=!!a.a.c(c());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===d||(d?b.focus():b.blur(),!d&&b.__ko_hasfocusLastValue&&b.ownerDocument.body.focus(),a.l.w(a.a.Da,null,[b,d?"focusin":"focusout"]))}};a.h.ea.hasfocus=!0;a.d.hasFocus=a.d.hasfocus;a.h.ea.hasFocus=!0;a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Cb(b,c())}};K("if");K("ifnot",!1,!0);K("with",!0,!1,function(a,c){return a.createChildContext(c)});var L={};a.d.options={init:function(b){if("select"!==a.a.A(b))throw Error("options binding applies only to SELECT elements");for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b,c,d){function e(){return a.a.Ka(b.options,function(a){return a.selected})}function f(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function g(c,e){if(A&&h)a.j.ha(b,a.a.c(d.get("value")),!0);else if(p.length){var f=0<=a.a.o(p,a.j.u(e[0]));a.a.sc(e[0],f);A&&!f&&a.l.w(a.a.Da,null,[b,"change"])}}var k=b.multiple,l=0!=b.length&&k?b.scrollTop:null,m=a.a.c(c()),h=d.get("valueAllowUnset")&&d.has("value"),r=d.get("optionsIncludeDestroyed");c={};var q,p=[];h||(k?p=a.a.fb(e(),a.j.u):0<=b.selectedIndex&&p.push(a.j.u(b.options[b.selectedIndex])));m&&("undefined"==typeof m.length&&(m=[m]),q=a.a.Ka(m,function(b){return r||b===n||null===b||!a.a.c(b._destroy)}),d.has("optionsCaption")&&(m=a.a.c(d.get("optionsCaption")),null!==m&&m!==n&&q.unshift(L)));var A=!1;c.beforeRemove=function(a){b.removeChild(a)};m=g;d.has("optionsAfterRender")&&"function"==typeof d.get("optionsAfterRender")&&(m=function(b,c){g(0,c);a.l.w(d.get("optionsAfterRender"),null,[c[0],b!==L?b:n])});a.a.Bb(b,q,function(c,e,g){g.length&&(p=!h&&g[0].selected?[a.j.u(g[0])]:[],A=!0);e=b.ownerDocument.createElement("option");c===L?(a.a.Za(e,d.get("optionsCaption")),a.j.ha(e,n)):(g=f(c,d.get("optionsValue"),c),a.j.ha(e,a.a.c(g)),c=f(c,d.get("optionsText"),g),a.a.Za(e,c));return[e]},c,m);a.l.w(function(){h?a.j.ha(b,a.a.c(d.get("value")),!0):(k?p.length&&e().length<p.length:p.length&&0<=b.selectedIndex?a.j.u(b.options[b.selectedIndex])!==p[0]:p.length||0<=b.selectedIndex)&&a.a.Da(b,"change")});a.a.Nc(b);l&&20<Math.abs(l-b.scrollTop)&&(b.scrollTop=l)}};a.d.options.xb=a.a.e.I();a.d.selectedOptions={after:["options","foreach"],init:function(b,c,d){a.a.p(b,"change",function(){var e=c(),f=[];a.a.q(b.getElementsByTagName("option"),function(b){b.selected&&f.push(a.j.u(b))});a.h.Ea(e,d,"selectedOptions",f)})},update:function(b,c){if("select"!=a.a.A(b))throw Error("values binding applies only to SELECT elements");var d=a.a.c(c()),e=b.scrollTop;d&&"number"==typeof d.length&&a.a.q(b.getElementsByTagName("option"),function(b){var c=0<=a.a.o(d,a.j.u(b));b.selected!=c&&a.a.sc(b,c)});b.scrollTop=e}};a.h.ea.selectedOptions=!0;a.d.style={update:function(b,c){var d=a.a.c(c()||{});a.a.D(d,function(c,d){d=a.a.c(d);if(null===d||d===n||!1===d)d="";b.style[c]=d})}};a.d.submit={init:function(b,c,d,e,f){if("function"!=typeof c())throw Error("The value for a submit binding must be a function");a.a.p(b,"submit",function(a){var d,e=c();try{d=e.call(f.$data,b)}finally{!0!==d&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}};a.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(b,c){a.a.Za(b,c())}};a.f.Z.text=!0;(function(){if(x&&x.navigator)var b=function(a){if(a)return parseFloat(a[1])},c=x.opera&&x.opera.version&&parseInt(x.opera.version()),d=x.navigator.userAgent,e=b(d.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),f=b(d.match(/Firefox\/([^ ]*)/));if(10>a.a.C)var g=a.a.e.I(),k=a.a.e.I(),l=function(b){var c=this.activeElement;(c=c&&a.a.e.get(c,k))&&c(b)},m=function(b,c){var d=b.ownerDocument;a.a.e.get(d,g)||(a.a.e.set(d,g,!0),a.a.p(d,"selectionchange",l));a.a.e.set(b,k,c)};a.d.textInput={init:function(b,d,g){function l(c,d){a.a.p(b,c,d)}function k(){var c=a.a.c(d());if(null===c||c===n)c="";v!==n&&c===v?a.a.setTimeout(k,4):b.value!==c&&(u=c,b.value=c)}function y(){s||(v=b.value,s=a.a.setTimeout(t,4))}function t(){clearTimeout(s);v=s=n;var c=b.value;u!==c&&(u=c,a.h.Ea(d(),g,"textInput",c))}var u=b.value,s,v,x=9==a.a.C?y:t;10>a.a.C?(l("propertychange",function(a){"value"===a.propertyName&&x(a)}),8==a.a.C&&(l("keyup",t),l("keydown",t)),8<=a.a.C&&(m(b,x),l("dragend",y))):(l("input",t),5>e&&"textarea"===a.a.A(b)?(l("keydown",y),l("paste",y),l("cut",y)):11>c?l("keydown",y):4>f&&(l("DOMAutoComplete",t),l("dragdrop",t),l("drop",t)));l("change",t);a.m(k,null,{i:b})}};a.h.ea.textInput=!0;a.d.textinput={preprocess:function(a,b,c){c("textInput",a)}}})();a.d.uniqueName={init:function(b,c){if(c()){var d="ko_unique_"+ ++a.d.uniqueName.Ic;a.a.rc(b,d)}}};a.d.uniqueName.Ic=0;a.d.value={after:["options","foreach"],init:function(b,c,d){if("input"!=b.tagName.toLowerCase()||"checkbox"!=b.type&&"radio"!=b.type){var e=["change"],f=d.get("valueUpdate"),g=!1,k=null;f&&("string"==typeof f&&(f=[f]),a.a.ra(e,f),e=a.a.Tb(e));var l=function(){k=null;g=!1;var e=c(),f=a.j.u(b);a.h.Ea(e,d,"value",f)};!a.a.C||"input"!=b.tagName.toLowerCase()||"text"!=b.type||"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete||-1!=a.a.o(e,"propertychange")||(a.a.p(b,"propertychange",function(){g=!0}),a.a.p(b,"focus",function(){g=!1}),a.a.p(b,"blur",function(){g&&l()}));a.a.q(e,function(c){var d=l;a.a.nd(c,"after")&&(d=function(){k=a.j.u(b);a.a.setTimeout(l,0)},c=c.substring(5));a.a.p(b,c,d)});var m=function(){var e=a.a.c(c()),f=a.j.u(b);if(null!==k&&e===k)a.a.setTimeout(m,0);else if(e!==f)if("select"===a.a.A(b)){var g=d.get("valueAllowUnset"),f=function(){a.j.ha(b,e,g)};f();g||e===a.j.u(b)?a.a.setTimeout(f,0):a.l.w(a.a.Da,null,[b,"change"])}else a.j.ha(b,e)};a.m(m,null,{i:b})}else a.Ja(b,{checkedValue:c})},update:function(){}};a.h.ea.value=!0;a.d.visible={update:function(b,c){var d=a.a.c(c()),e="none"!=b.style.display;d&&!e?b.style.display="":!d&&e&&(b.style.display="none")}};(function(b){a.d[b]={init:function(c,d,e,f,g){return a.d.event.init.call(this,c,function(){var a={};a[b]=d();return a},e,f,g)}}})("click");a.O=function(){};a.O.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")};a.O.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")};a.O.prototype.makeTemplateSource=function(b,c){if("string"==typeof b){c=c||u;var d=c.getElementById(b);if(!d)throw Error("Cannot find template with ID "+b);return new a.v.n(d)}if(1==b.nodeType||8==b.nodeType)return new a.v.qa(b);throw Error("Unknown template type: "+b)};a.O.prototype.renderTemplate=function(a,c,d,e){a=this.makeTemplateSource(a,e);return this.renderTemplateSource(a,c,d,e)};a.O.prototype.isTemplateRewritten=function(a,c){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,c).data("isRewritten")};a.O.prototype.rewriteTemplate=function(a,c,d){a=this.makeTemplateSource(a,d);c=c(a.text());a.text(c);a.data("isRewritten",!0)};a.b("templateEngine",a.O);a.Gb=function(){function b(b,c,d,k){b=a.h.yb(b);for(var l=a.h.ta,m=0;m<b.length;m++){var h=b[m].key;if(l.hasOwnProperty(h)){var r=l[h];if("function"===typeof r){if(h=r(b[m].value))throw Error(h)}else if(!r)throw Error("This template engine does not support the '"+h+"' binding within its templates")}}d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.h.Ua(b,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')";return k.createJavaScriptEvaluatorBlock(d)+c}var c=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,d=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Oc:function(b,c,d){c.isTemplateRewritten(b,d)||c.rewriteTemplate(b,function(b){return a.Gb.dd(b,c)},d)},dd:function(a,f){return a.replace(c,function(a,c,d,e,h){return b(h,c,d,f)}).replace(d,function(a,c){return b(c,"\x3c!-- ko --\x3e","#comment",f)})},Ec:function(b,c){return a.M.wb(function(d,k){var l=d.nextSibling;l&&l.nodeName.toLowerCase()===c&&a.Ja(l,b,k)})}}}();a.b("__tr_ambtns",a.Gb.Ec);(function(){a.v={};a.v.n=function(b){if(this.n=b){var c=a.a.A(b);this.ab="script"===c?1:"textarea"===c?2:"template"==c&&b.content&&11===b.content.nodeType?3:4}};a.v.n.prototype.text=function(){var b=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.n[b];var c=arguments[0];"innerHTML"===b?a.a.Cb(this.n,c):this.n[b]=c};var b=a.a.e.I()+"_";a.v.n.prototype.data=function(c){if(1===arguments.length)return a.a.e.get(this.n,b+c);a.a.e.set(this.n,b+c,arguments[1])};var c=a.a.e.I();a.v.n.prototype.nodes=function(){var b=this.n;if(0==arguments.length)return(a.a.e.get(b,c)||{}).jb||(3===this.ab?b.content:4===this.ab?b:n);a.a.e.set(b,c,{jb:arguments[0]})};a.v.qa=function(a){this.n=a};a.v.qa.prototype=new a.v.n;a.v.qa.prototype.text=function(){if(0==arguments.length){var b=a.a.e.get(this.n,c)||{};b.Hb===n&&b.jb&&(b.Hb=b.jb.innerHTML);return b.Hb}a.a.e.set(this.n,c,{Hb:arguments[0]})};a.b("templateSources",a.v);a.b("templateSources.domElement",a.v.n);a.b("templateSources.anonymousTemplate",a.v.qa)})();(function(){function b(b,c,d){var e;for(c=a.f.nextSibling(c);b&&(e=b)!==c;)b=a.f.nextSibling(e),d(e,b)}function c(c,d){if(c.length){var e=c[0],f=c[c.length-1],g=e.parentNode,k=a.Q.instance,n=k.preprocessNode;if(n){b(e,f,function(a,b){var c=a.previousSibling,d=n.call(k,a);d&&(a===e&&(e=d[0]||b),a===f&&(f=d[d.length-1]||c))});c.length=0;if(!e)return;e===f?c.push(e):(c.push(e,f),a.a.za(c,g))}b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.Rb(d,b)});b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.M.yc(b,[d])});a.a.za(c,g)}}function d(a){return a.nodeType?a:0<a.length?a[0]:null}function e(b,e,f,k,q){q=q||{};var p=(b&&d(b)||f||{}).ownerDocument,n=q.templateEngine||g;a.Gb.Oc(f,n,p);f=n.renderTemplate(f,k,q,p);if("number"!=typeof f.length||0<f.length&&"number"!=typeof f[0].nodeType)throw Error("Template engine must return an array of DOM nodes");p=!1;switch(e){case"replaceChildren":a.f.da(b,f);p=!0;break;case"replaceNode":a.a.qc(b,f);p=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+e)}p&&(c(f,k),q.afterRender&&a.l.w(q.afterRender,null,[f,k.$data]));return f}function f(b,c,d){return a.H(b)?b():"function"===typeof b?b(c,d):b}var g;a.Db=function(b){if(b!=n&&!(b instanceof a.O))throw Error("templateEngine must inherit from ko.templateEngine");g=b};a.Ab=function(b,c,h,k,q){h=h||{};if((h.templateEngine||g)==n)throw Error("Set a template engine before calling renderTemplate");q=q||"replaceChildren";if(k){var p=d(k);return a.B(function(){var g=c&&c instanceof a.U?c:new a.U(a.a.c(c)),n=f(b,g.$data,g),g=e(k,q,n,g,h);"replaceNode"==q&&(k=g,p=d(k))},null,{wa:function(){return!p||!a.a.nb(p)},i:p&&"replaceNode"==q?p.parentNode:p})}return a.M.wb(function(d){a.Ab(b,c,h,d,"replaceNode")})};a.kd=function(b,d,g,k,q){function p(a,b){c(b,s);g.afterRender&&g.afterRender(b,a);s=null}function u(a,c){s=q.createChildContext(a,g.as,function(a){a.$index=c});var d=f(b,a,s);return e(null,"ignoreTargetNode",d,s,g)}var s;return a.B(function(){var b=a.a.c(d)||[];"undefined"==typeof b.length&&(b=[b]);b=a.a.Ka(b,function(b){return g.includeDestroyed||b===n||null===b||!a.a.c(b._destroy)});a.l.w(a.a.Bb,null,[k,b,u,g,p])},null,{i:k})};var k=a.a.e.I();a.d.template={init:function(b,c){var d=a.a.c(c());if("string"==typeof d||d.name)a.f.xa(b);else{if("nodes"in d){if(d=d.nodes||[],a.H(d))throw Error('The "nodes" option must be a plain, non-observable array.')}else d=a.f.childNodes(b);d=a.a.jc(d);new a.v.qa(b).nodes(d)}return{controlsDescendantBindings:!0}},update:function(b,c,d,e,f){var g=c(),s;c=a.a.c(g);d=!0;e=null;"string"==typeof c?c={}:(g=c.name,"if"in c&&(d=a.a.c(c["if"])),d&&"ifnot"in c&&(d=!a.a.c(c.ifnot)),s=a.a.c(c.data));"foreach"in c?e=a.kd(g||b,d&&c.foreach||[],c,b,f):d?(f="data"in c?f.createChildContext(s,c.as):f,e=a.Ab(g||b,f,c,b)):a.f.xa(b);f=e;(s=a.a.e.get(b,k))&&"function"==typeof s.k&&s.k();a.a.e.set(b,k,f&&f.ba()?f:n)}};a.h.ta.template=function(b){b=a.h.yb(b);return 1==b.length&&b[0].unknown||a.h.ad(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"};a.f.Z.template=!0})();a.b("setTemplateEngine",a.Db);a.b("renderTemplate",a.Ab);a.a.dc=function(a,c,d){if(a.length&&c.length){var e,f,g,k,l;for(e=f=0;(!d||e<d)&&(k=a[f]);++f){for(g=0;l=c[g];++g)if(k.value===l.value){k.moved=l.index;l.moved=k.index;c.splice(g,1);e=g=0;break}e+=g}}};a.a.ib=function(){function b(b,d,e,f,g){var k=Math.min,l=Math.max,m=[],h,n=b.length,q,p=d.length,s=p-n||1,u=n+p+1,t,v,x;for(h=0;h<=n;h++)for(v=t,m.push(t=[]),x=k(p,h+s),q=l(0,h-1);q<=x;q++)t[q]=q?h?b[h-1]===d[q-1]?v[q-1]:k(v[q]||u,t[q-1]||u)+1:q+1:h+1;k=[];l=[];s=[];h=n;for(q=p;h||q;)p=m[h][q]-1,q&&p===m[h][q-1]?l.push(k[k.length]={status:e,value:d[--q],index:q}):h&&p===m[h-1][q]?s.push(k[k.length]={status:f,value:b[--h],index:h}):(--q,--h,g.sparse||k.push({status:"retained",value:d[q]}));a.a.dc(s,l,!g.dontLimitMoves&&10*n);return k.reverse()}return function(a,d,e){e="boolean"===typeof e?{dontLimitMoves:e}:e||{};a=a||[];d=d||[];return a.length<d.length?b(a,d,"added","deleted",e):b(d,a,"deleted","added",e)}}();a.b("utils.compareArrays",a.a.ib);(function(){function b(b,c,d,k,l){var m=[],h=a.B(function(){var h=c(d,l,a.a.za(m,b))||[];0<m.length&&(a.a.qc(m,h),k&&a.l.w(k,null,[d,h,l]));m.length=0;a.a.ra(m,h)},null,{i:b,wa:function(){return!a.a.Qb(m)}});return{ca:m,B:h.ba()?h:n}}var c=a.a.e.I(),d=a.a.e.I();a.a.Bb=function(e,f,g,k,l){function m(b,c){w=q[c];v!==c&&(D[b]=w);w.qb(v++);a.a.za(w.ca,e);u.push(w);z.push(w)}function h(b,c){if(b)for(var d=0,e=c.length;d<e;d++)c[d]&&a.a.q(c[d].ca,function(a){b(a,d,c[d].ja)})}f=f||[];k=k||{};var r=a.a.e.get(e,c)===n,q=a.a.e.get(e,c)||[],p=a.a.fb(q,function(a){return a.ja}),s=a.a.ib(p,f,k.dontLimitMoves),u=[],t=0,v=0,x=[],z=[];f=[];for(var D=[],p=[],w,C=0,B,E;B=s[C];C++)switch(E=B.moved,B.status){case"deleted":E===n&&(w=q[t],w.B&&(w.B.k(),w.B=n),a.a.za(w.ca,e).length&&(k.beforeRemove&&(u.push(w),z.push(w),w.ja===d?w=null:f[C]=w),w&&x.push.apply(x,w.ca)));t++;break;case"retained":m(C,t++);break;case"added":E!==n?m(C,E):(w={ja:B.value,qb:a.N(v++)},u.push(w),z.push(w),r||(p[C]=w))}a.a.e.set(e,c,u);h(k.beforeMove,D);a.a.q(x,k.beforeRemove?a.$:a.removeNode);for(var C=0,r=a.f.firstChild(e),F;w=z[C];C++){w.ca||a.a.extend(w,b(e,g,w.ja,l,w.qb));for(t=0;s=w.ca[t];r=s.nextSibling,F=s,t++)s!==r&&a.f.gc(e,s,F);!w.Wc&&l&&(l(w.ja,w.ca,w.qb),w.Wc=!0)}h(k.beforeRemove,f);for(C=0;C<f.length;++C)f[C]&&(f[C].ja=d);h(k.afterMove,D);h(k.afterAdd,p)}})();a.b("utils.setDomNodeChildrenFromArrayMapping",a.a.Bb);a.W=function(){this.allowTemplateRewriting=!1};a.W.prototype=new a.O;a.W.prototype.renderTemplateSource=function(b,c,d,e){if(c=(9>a.a.C?0:b.nodes)?b.nodes():null)return a.a.V(c.cloneNode(!0).childNodes);b=b.text();return a.a.ma(b,e)};a.W.sb=new a.W;a.Db(a.W.sb);a.b("nativeTemplateEngine",a.W);(function(){a.vb=function(){var a=this.$c=function(){if(!v||!v.tmpl)return 0;try{if(0<=v.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=function(b,e,f,g){g=g||u;f=f||{};if(2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var k=b.data("precompiled");k||(k=b.text()||"",k=v.template(null,"{{ko_with $item.koBindingContext}}"+k+"{{/ko_with}}"),b.data("precompiled",k));b=[e.$data];e=v.extend({koBindingContext:e},f.templateOptions);e=v.tmpl(k,b,e);e.appendTo(g.createElement("div"));v.fragments={};return e};this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"};this.addTemplate=function(a,b){u.write("<script type='text/html' id='"+a+"'>"+b+"<\/script>")};0<a&&(v.tmpl.tag.ko_code={open:"__.push($1 || '');"},v.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};a.vb.prototype=new a.O;var b=new a.vb;0<b.$c&&a.Db(b);a.b("jqueryTmplTemplateEngine",a.vb)})()})})()})();!function(){function n(n){return n&&(n.ownerDocument||n.document||n).documentElement}function t(n){return n&&(n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView)}function e(n,t){return t>n?-1:n>t?1:n>=t?0:0/0}function r(n){return null===n?0/0:+n}function u(n){return!isNaN(n)}function i(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)<0?r=i+1:u=i}return r},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)>0?u=i:r=i+1}return r}}}function o(n){return n.length}function a(n){for(var t=1;n*t%1;)t*=10;return t}function c(n,t){for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}function l(){this._=Object.create(null)}function s(n){return(n+="")===pa||n[0]===va?va+n:n}function f(n){return(n+="")[0]===va?n.slice(1):n}function h(n){return s(n)in this._}function g(n){return(n=s(n))in this._&&delete this._[n]}function p(){var n=[];for(var t in this._)n.push(f(t));return n}function v(){var n=0;for(var t in this._)++n;return n}function d(){for(var n in this._)return!1;return!0}function m(){this._=Object.create(null)}function y(n){return n}function M(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function x(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=da.length;r>e;++e){var u=da[e]+t;if(u in n)return u}}function b(){}function _(){}function w(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;)(t=r[u].on)&&t.apply(this,arguments);return n}var e=[],r=new l;return t.on=function(t,u){var i,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,i=e.indexOf(o)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n)},t}function S(){ta.event.preventDefault()}function k(){for(var n,t=ta.event;n=t.sourceEvent;)t=n;return t}function E(n){for(var t=new _,e=0,r=arguments.length;++e<r;)t[arguments[e]]=w(t);return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=ta.event;u.target=n,ta.event=u,t[u.type].apply(e,r)}finally{ta.event=i}}},t}function A(n){return ya(n,_a),n}function N(n){return"function"==typeof n?n:function(){return Ma(n,this)}}function C(n){return"function"==typeof n?n:function(){return xa(n,this)}}function z(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=ta.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?i:u}function q(n){return n.trim().replace(/\s+/g," ")}function L(n){return new RegExp("(?:^|\\s+)"+ta.requote(n)+"(?:\\s+|$)","g")}function T(n){return(n+"").trim().split(/^|\s+/)}function R(n,t){function e(){for(var e=-1;++e<u;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<u;)n[e](this,r)}n=T(n).map(D);var u=n.length;return"function"==typeof t?r:e}function D(n){var t=L(n);return function(e,r){if(u=e.classList)return r?u.add(n):u.remove(n);var u=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",q(u+" "+n))):e.setAttribute("class",q(u.replace(t," ")))}}function P(n,t,e){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,e)}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?i:u}function U(n,t){function e(){delete this[n]}function r(){this[n]=t}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?u:r}function j(n){function t(){var t=this.ownerDocument,e=this.namespaceURI;return e?t.createElementNS(e,n):t.createElement(n)}function e(){return this.ownerDocument.createElementNS(n.space,n.local)}return"function"==typeof n?n:(n=ta.ns.qualify(n)).local?e:t}function F(){var n=this.parentNode;n&&n.removeChild(this)}function H(n){return{__data__:n}}function O(n){return function(){return ba(this,n)}}function I(n){return arguments.length||(n=e),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function Y(n,t){for(var e=0,r=n.length;r>e;e++)for(var u,i=n[e],o=0,a=i.length;a>o;o++)(u=i[o])&&t(u,o,e);return n}function Z(n){return ya(n,Sa),n}function V(n){var t,e;return function(r,u,i){var o,a=n[i].update,c=a.length;for(i!=e&&(e=i,t=0),u>=t&&(t=u+1);!(o=a[t])&&++t<c;);return o}}function X(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function u(){var u=c(t,ra(arguments));r.call(this),this.addEventListener(n,this[o]=u,u.$=e),u._=t}function i(){var t,e=new RegExp("^__on([^.]+)"+ta.requote(n)+"$");for(var r in this)if(t=r.match(e)){var u=this[r];this.removeEventListener(t[1],u,u.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),c=$;a>0&&(n=n.slice(0,a));var l=ka.get(n);return l&&(n=l,c=B),a?t?u:r:t?b:i}function $(n,t){return function(e){var r=ta.event;ta.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{ta.event=r}}}function B(n,t){var e=$(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function W(e){var r=".dragsuppress-"+ ++Aa,u="click"+r,i=ta.select(t(e)).on("touchmove"+r,S).on("dragstart"+r,S).on("selectstart"+r,S);if(null==Ea&&(Ea="onselectstart"in e?!1:x(e.style,"userSelect")),Ea){var o=n(e).style,a=o[Ea];o[Ea]="none"}return function(n){if(i.on(r,null),Ea&&(o[Ea]=a),n){var t=function(){i.on(u,null)};i.on(u,function(){S(),t()},!0),setTimeout(t,0)}}}function J(n,e){e.changedTouches&&(e=e.changedTouches[0]);var r=n.ownerSVGElement||n;if(r.createSVGPoint){var u=r.createSVGPoint();if(0>Na){var i=t(n);if(i.scrollX||i.scrollY){r=ta.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=r[0][0].getScreenCTM();Na=!(o.f||o.e),r.remove()}}return Na?(u.x=e.pageX,u.y=e.pageY):(u.x=e.clientX,u.y=e.clientY),u=u.matrixTransform(n.getScreenCTM().inverse()),[u.x,u.y]}var a=n.getBoundingClientRect();return[e.clientX-a.left-n.clientLeft,e.clientY-a.top-n.clientTop]}function G(){return ta.event.changedTouches[0].identifier}function K(n){return n>0?1:0>n?-1:0}function Q(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function nt(n){return n>1?0:-1>n?qa:Math.acos(n)}function tt(n){return n>1?Ra:-1>n?-Ra:Math.asin(n)}function et(n){return((n=Math.exp(n))-1/n)/2}function rt(n){return((n=Math.exp(n))+1/n)/2}function ut(n){return((n=Math.exp(2*n))-1)/(n+1)}function it(n){return(n=Math.sin(n/2))*n}function ot(){}function at(n,t,e){return this instanceof at?(this.h=+n,this.s=+t,void(this.l=+e)):arguments.length<2?n instanceof at?new at(n.h,n.s,n.l):bt(""+n,_t,at):new at(n,t,e)}function ct(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(o-i)*n/60:180>n?o:240>n?i+(o-i)*(240-n)/60:i}function u(n){return Math.round(255*r(n))}var i,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,o=.5>=e?e*(1+t):e+t-e*t,i=2*e-o,new mt(u(n+120),u(n),u(n-120))}function lt(n,t,e){return this instanceof lt?(this.h=+n,this.c=+t,void(this.l=+e)):arguments.length<2?n instanceof lt?new lt(n.h,n.c,n.l):n instanceof ft?gt(n.l,n.a,n.b):gt((n=wt((n=ta.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new lt(n,t,e)}function st(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new ft(e,Math.cos(n*=Da)*t,Math.sin(n)*t)}function ft(n,t,e){return this instanceof ft?(this.l=+n,this.a=+t,void(this.b=+e)):arguments.length<2?n instanceof ft?new ft(n.l,n.a,n.b):n instanceof lt?st(n.h,n.c,n.l):wt((n=mt(n)).r,n.g,n.b):new ft(n,t,e)}function ht(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=pt(u)*Xa,r=pt(r)*$a,i=pt(i)*Ba,new mt(dt(3.2404542*u-1.5371385*r-.4985314*i),dt(-.969266*u+1.8760108*r+.041556*i),dt(.0556434*u-.2040259*r+1.0572252*i))}function gt(n,t,e){return n>0?new lt(Math.atan2(e,t)*Pa,Math.sqrt(t*t+e*e),n):new lt(0/0,0/0,n)}function pt(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function vt(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function dt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function mt(n,t,e){return this instanceof mt?(this.r=~~n,this.g=~~t,void(this.b=~~e)):arguments.length<2?n instanceof mt?new mt(n.r,n.g,n.b):bt(""+n,mt,ct):new mt(n,t,e)}function yt(n){return new mt(n>>16,n>>8&255,255&n)}function Mt(n){return yt(n)+""}function xt(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function bt(n,t,e){var r,u,i,o=0,a=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(kt(u[0]),kt(u[1]),kt(u[2]))}return(i=Ga.get(n.toLowerCase()))?t(i.r,i.g,i.b):(null==n||"#"!==n.charAt(0)||isNaN(i=parseInt(n.slice(1),16))||(4===n.length?(o=(3840&i)>>4,o=o>>4|o,a=240&i,a=a>>4|a,c=15&i,c=c<<4|c):7===n.length&&(o=(16711680&i)>>16,a=(65280&i)>>8,c=255&i)),t(o,a,c))}function _t(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-i,c=(o+i)/2;return a?(u=.5>c?a/(o+i):a/(2-o-i),r=n==o?(t-e)/a+(e>t?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=0/0,u=c>0&&1>c?0:r),new at(r,u,c)}function wt(n,t,e){n=St(n),t=St(t),e=St(e);var r=vt((.4124564*n+.3575761*t+.1804375*e)/Xa),u=vt((.2126729*n+.7151522*t+.072175*e)/$a),i=vt((.0193339*n+.119192*t+.9503041*e)/Ba);return ft(116*u-16,500*(r-u),200*(u-i))}function St(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function kt(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function Et(n){return"function"==typeof n?n:function(){return n}}function At(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Nt(t,e,n,r)}}function Nt(n,t,e,r){function u(){var n,t=c.status;if(!t&&zt(c)||t>=200&&300>t||304===t){try{n=e.call(i,c)}catch(r){return void o.error.call(i,r)}o.load.call(i,n)}else o.error.call(i,c)}var i={},o=ta.dispatch("beforesend","progress","load","error"),a={},c=new XMLHttpRequest,l=null;return!this.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=u:c.onreadystatechange=function(){c.readyState>3&&u()},c.onprogress=function(n){var t=ta.event;ta.event=n;try{o.progress.call(i,c)}finally{ta.event=t}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",i)},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t},i.responseType=function(n){return arguments.length?(l=n,i):l},i.response=function(n){return e=n,i},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat(ra(arguments)))}}),i.send=function(e,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),c.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var s in a)c.setRequestHeader(s,a[s]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=l&&(c.responseType=l),null!=u&&i.on("error",u).on("load",function(n){u(null,n)}),o.beforesend.call(i,c),c.send(null==r?null:r),i},i.abort=function(){return c.abort(),i},ta.rebind(i,o,"on"),null==r?i:i.get(Ct(r))}function Ct(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function zt(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function qt(){var n=Lt(),t=Tt()-n;t>24?(isFinite(t)&&(clearTimeout(tc),tc=setTimeout(qt,t)),nc=0):(nc=1,rc(qt))}function Lt(){var n=Date.now();for(ec=Ka;ec;)n>=ec.t&&(ec.f=ec.c(n-ec.t)),ec=ec.n;return n}function Tt(){for(var n,t=Ka,e=1/0;t;)t.f?t=n?n.n=t.n:Ka=t.n:(t.t<e&&(e=t.t),t=(n=t).n);return Qa=n,e}function Rt(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Dt(n,t){var e=Math.pow(10,3*ga(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function Pt(n){var t=n.decimal,e=n.thousands,r=n.grouping,u=n.currency,i=r&&e?function(n,t){for(var u=n.length,i=[],o=0,a=r[0],c=0;u>0&&a>0&&(c+a+1>t&&(a=Math.max(1,t-c)),i.push(n.substring(u-=a,u+a)),!((c+=a+1)>t));)a=r[o=(o+1)%r.length];return i.reverse().join(e)}:y;return function(n){var e=ic.exec(n),r=e[1]||" ",o=e[2]||">",a=e[3]||"-",c=e[4]||"",l=e[5],s=+e[6],f=e[7],h=e[8],g=e[9],p=1,v="",d="",m=!1,y=!0;switch(h&&(h=+h.substring(1)),(l||"0"===r&&"="===o)&&(l=r="0",o="="),g){case"n":f=!0,g="g";break;case"%":p=100,d="%",g="f";break;case"p":p=100,d="%",g="r";break;case"b":case"o":case"x":case"X":"#"===c&&(v="0"+g.toLowerCase());case"c":y=!1;case"d":m=!0,h=0;break;case"s":p=-1,g="r"}"$"===c&&(v=u[0],d=u[1]),"r"!=g||h||(g="g"),null!=h&&("g"==g?h=Math.max(1,Math.min(21,h)):("e"==g||"f"==g)&&(h=Math.max(0,Math.min(20,h)))),g=oc.get(g)||Ut;var M=l&&f;return function(n){var e=d;if(m&&n%1)return"";var u=0>n||0===n&&0>1/n?(n=-n,"-"):"-"===a?"":a;if(0>p){var c=ta.formatPrefix(n,h);n=c.scale(n),e=c.symbol+d}else n*=p;n=g(n,h);var x,b,_=n.lastIndexOf(".");if(0>_){var w=y?n.lastIndexOf("e"):-1;0>w?(x=n,b=""):(x=n.substring(0,w),b=n.substring(w))}else x=n.substring(0,_),b=t+n.substring(_+1);!l&&f&&(x=i(x,1/0));var S=v.length+x.length+b.length+(M?0:u.length),k=s>S?new Array(S=s-S+1).join(r):"";return M&&(x=i(k+x,k.length?s-b.length:1/0)),u+=v,n=x+b,("<"===o?u+n+k:">"===o?k+u+n:"^"===o?k.substring(0,S>>=1)+u+n+k.substring(S):u+(M?n:k+n))+e}}}function Ut(n){return n+""}function jt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ft(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r}function u(e){return t(e=n(new cc(e-1)),1),e}function i(n,e){return t(n=new cc(+n),e),n}function o(n,r,i){var o=u(n),a=[];if(i>1)for(;r>o;)e(o)%i||a.push(new Date(+o)),t(o,1);else for(;r>o;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{cc=jt;var r=new jt;return r._=n,o(r,t,e)}finally{cc=Date}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=o;var c=n.utc=Ht(n);return c.floor=c,c.round=Ht(r),c.ceil=Ht(u),c.offset=Ht(i),c.range=a,n}function Ht(n){return function(t,e){try{cc=jt;var r=new jt;return r._=t,n(r,e)._}finally{cc=Date}}}function Ot(n){function t(n){function t(t){for(var e,u,i,o=[],a=-1,c=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.slice(c,a)),null!=(u=sc[e=n.charAt(++a)])&&(e=n.charAt(++a)),(i=N[e])&&(e=i(t,null==u?"e"===e?" ":"0":u)),o.push(e),c=a+1);return o.push(n.slice(c,a)),o.join("")}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},u=e(r,n,t,0);if(u!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var i=null!=r.Z&&cc!==jt,o=new(i?jt:cc);return"j"in r?o.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),i?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var u,i,o,a=0,c=t.length,l=e.length;c>a;){if(r>=l)return-1;if(u=t.charCodeAt(a++),37===u){if(o=t.charAt(a++),i=C[o in sc?t.charAt(a++):o],!i||(r=i(n,e,r))<0)return-1}else if(u!=e.charCodeAt(r++))return-1}return r}function r(n,t,e){_.lastIndex=0;var r=_.exec(t.slice(e));return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1}function u(n,t,e){x.lastIndex=0;var r=x.exec(t.slice(e));return r?(n.w=b.get(r[0].toLowerCase()),e+r[0].length):-1}function i(n,t,e){E.lastIndex=0;var r=E.exec(t.slice(e));return r?(n.m=A.get(r[0].toLowerCase()),e+r[0].length):-1}function o(n,t,e){S.lastIndex=0;var r=S.exec(t.slice(e));return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1}function a(n,t,r){return e(n,N.c.toString(),t,r)}function c(n,t,r){return e(n,N.x.toString(),t,r)}function l(n,t,r){return e(n,N.X.toString(),t,r)}function s(n,t,e){var r=M.get(t.slice(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}var f=n.dateTime,h=n.date,g=n.time,p=n.periods,v=n.days,d=n.shortDays,m=n.months,y=n.shortMonths;t.utc=function(n){function e(n){try{cc=jt;var t=new cc;return t._=n,r(t)}finally{cc=Date}}var r=t(n);return e.parse=function(n){try{cc=jt;var t=r.parse(n);return t&&t._}finally{cc=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ae;var M=ta.map(),x=Yt(v),b=Zt(v),_=Yt(d),w=Zt(d),S=Yt(m),k=Zt(m),E=Yt(y),A=Zt(y);p.forEach(function(n,t){M.set(n.toLowerCase(),t)});var N={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return y[n.getMonth()]},B:function(n){return m[n.getMonth()]},c:t(f),d:function(n,t){return It(n.getDate(),t,2)},e:function(n,t){return It(n.getDate(),t,2)},H:function(n,t){return It(n.getHours(),t,2)},I:function(n,t){return It(n.getHours()%12||12,t,2)},j:function(n,t){return It(1+ac.dayOfYear(n),t,3)},L:function(n,t){return It(n.getMilliseconds(),t,3)},m:function(n,t){return It(n.getMonth()+1,t,2)},M:function(n,t){return It(n.getMinutes(),t,2)},p:function(n){return p[+(n.getHours()>=12)]},S:function(n,t){return It(n.getSeconds(),t,2)},U:function(n,t){return It(ac.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return It(ac.mondayOfYear(n),t,2)},x:t(h),X:t(g),y:function(n,t){return It(n.getFullYear()%100,t,2)},Y:function(n,t){return It(n.getFullYear()%1e4,t,4)},Z:ie,"%":function(){return"%"}},C={a:r,A:u,b:i,B:o,c:a,d:Qt,e:Qt,H:te,I:te,j:ne,L:ue,m:Kt,M:ee,p:s,S:re,U:Xt,w:Vt,W:$t,x:c,X:l,y:Wt,Y:Bt,Z:Jt,"%":oe};return t}function It(n,t,e){var r=0>n?"-":"",u=(r?-n:n)+"",i=u.length;return r+(e>i?new Array(e-i+1).join(t)+u:u)}function Yt(n){return new RegExp("^(?:"+n.map(ta.requote).join("|")+")","i")}function Zt(n){for(var t=new l,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function Vt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Xt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e));return r?(n.U=+r[0],e+r[0].length):-1}function $t(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e));return r?(n.W=+r[0],e+r[0].length):-1}function Bt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Wt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.y=Gt(+r[0]),e+r[0].length):-1}function Jt(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1}function Gt(n){return n+(n>68?1900:2e3)}function Kt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function Qt(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function ne(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function te(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function ee(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function re(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ue(n,t,e){fc.lastIndex=0;var r=fc.exec(t.slice(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function ie(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=ga(t)/60|0,u=ga(t)%60;return e+It(r,"0",2)+It(u,"0",2)}function oe(n,t,e){hc.lastIndex=0;var r=hc.exec(t.slice(e,e+1));return r?e+r[0].length:-1}function ae(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ce(){}function le(n,t,e){var r=e.s=n+t,u=r-n,i=r-u;e.t=n-i+(t-u)}function se(n,t){n&&dc.hasOwnProperty(n.type)&&dc[n.type](n,t)}function fe(n,t,e){var r,u=-1,i=n.length-e;for(t.lineStart();++u<i;)r=n[u],t.point(r[0],r[1],r[2]);t.lineEnd()}function he(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)fe(n[e],t,1);t.polygonEnd()}function ge(){function n(n,t){n*=Da,t=t*Da/2+qa/4;var e=n-r,o=e>=0?1:-1,a=o*e,c=Math.cos(t),l=Math.sin(t),s=i*l,f=u*c+s*Math.cos(a),h=s*o*Math.sin(a);yc.add(Math.atan2(h,f)),r=n,u=c,i=l}var t,e,r,u,i;Mc.point=function(o,a){Mc.point=n,r=(t=o)*Da,u=Math.cos(a=(e=a)*Da/2+qa/4),i=Math.sin(a)},Mc.lineEnd=function(){n(t,e)}}function pe(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function ve(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function de(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function me(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function ye(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Me(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function xe(n){return[Math.atan2(n[1],n[0]),tt(n[2])]}function be(n,t){return ga(n[0]-t[0])<Ca&&ga(n[1]-t[1])<Ca}function _e(n,t){n*=Da;var e=Math.cos(t*=Da);we(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function we(n,t,e){++xc,_c+=(n-_c)/xc,wc+=(t-wc)/xc,Sc+=(e-Sc)/xc}function Se(){function n(n,u){n*=Da;var i=Math.cos(u*=Da),o=i*Math.cos(n),a=i*Math.sin(n),c=Math.sin(u),l=Math.atan2(Math.sqrt((l=e*c-r*a)*l+(l=r*o-t*c)*l+(l=t*a-e*o)*l),t*o+e*a+r*c);bc+=l,kc+=l*(t+(t=o)),Ec+=l*(e+(e=a)),Ac+=l*(r+(r=c)),we(t,e,r)}var t,e,r;qc.point=function(u,i){u*=Da;var o=Math.cos(i*=Da);t=o*Math.cos(u),e=o*Math.sin(u),r=Math.sin(i),qc.point=n,we(t,e,r)}}function ke(){qc.point=_e}function Ee(){function n(n,t){n*=Da;var e=Math.cos(t*=Da),o=e*Math.cos(n),a=e*Math.sin(n),c=Math.sin(t),l=u*c-i*a,s=i*o-r*c,f=r*a-u*o,h=Math.sqrt(l*l+s*s+f*f),g=r*o+u*a+i*c,p=h&&-nt(g)/h,v=Math.atan2(h,g);Nc+=p*l,Cc+=p*s,zc+=p*f,bc+=v,kc+=v*(r+(r=o)),Ec+=v*(u+(u=a)),Ac+=v*(i+(i=c)),we(r,u,i)}var t,e,r,u,i;qc.point=function(o,a){t=o,e=a,qc.point=n,o*=Da;var c=Math.cos(a*=Da);r=c*Math.cos(o),u=c*Math.sin(o),i=Math.sin(a),we(r,u,i)},qc.lineEnd=function(){n(t,e),qc.lineEnd=ke,qc.point=_e}}function Ae(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function Ne(){return!0}function Ce(n,t,e,r,u){var i=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(be(e,r)){u.lineStart();for(var a=0;t>a;++a)u.point((e=n[a])[0],e[1]);return void u.lineEnd()}var c=new qe(e,n,null,!0),l=new qe(e,null,c,!1);c.o=l,i.push(c),o.push(l),c=new qe(r,n,null,!1),l=new qe(r,null,c,!0),c.o=l,i.push(c),o.push(l)}}),o.sort(t),ze(i),ze(o),i.length){for(var a=0,c=e,l=o.length;l>a;++a)o[a].e=c=!c;for(var s,f,h=i[0];;){for(var g=h,p=!0;g.v;)if((g=g.n)===h)return;s=g.z,u.lineStart();do{if(g.v=g.o.v=!0,g.e){if(p)for(var a=0,l=s.length;l>a;++a)u.point((f=s[a])[0],f[1]);else r(g.x,g.n.x,1,u);g=g.n}else{if(p){s=g.p.z;for(var a=s.length-1;a>=0;--a)u.point((f=s[a])[0],f[1])}else r(g.x,g.p.x,-1,u);g=g.p}g=g.o,s=g.z,p=!p}while(!g.v);u.lineEnd()}}}function ze(n){if(t=n.length){for(var t,e,r=0,u=n[0];++r<t;)u.n=e=n[r],e.p=u,u=e;u.n=e=n[0],e.p=u}}function qe(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Le(n,t,e,r){return function(u,i){function o(t,e){var r=u(t,e);n(t=r[0],e=r[1])&&i.point(t,e)}function a(n,t){var e=u(n,t);d.point(e[0],e[1])}function c(){y.point=a,d.lineStart()}function l(){y.point=o,d.lineEnd()}function s(n,t){v.push([n,t]);var e=u(n,t);x.point(e[0],e[1])}function f(){x.lineStart(),v=[]}function h(){s(v[0][0],v[0][1]),x.lineEnd();var n,t=x.clean(),e=M.buffer(),r=e.length;if(v.pop(),p.push(v),v=null,r)if(1&t){n=e[0];var u,r=n.length-1,o=-1;if(r>0){for(b||(i.polygonStart(),b=!0),i.lineStart();++o<r;)i.point((u=n[o])[0],u[1]);i.lineEnd()}}else r>1&&2&t&&e.push(e.pop().concat(e.shift())),g.push(e.filter(Te))}var g,p,v,d=t(i),m=u.invert(r[0],r[1]),y={point:o,lineStart:c,lineEnd:l,polygonStart:function(){y.point=s,y.lineStart=f,y.lineEnd=h,g=[],p=[]},polygonEnd:function(){y.point=o,y.lineStart=c,y.lineEnd=l,g=ta.merge(g);var n=Fe(m,p);g.length?(b||(i.polygonStart(),b=!0),Ce(g,De,n,e,i)):n&&(b||(i.polygonStart(),b=!0),i.lineStart(),e(null,null,1,i),i.lineEnd()),b&&(i.polygonEnd(),b=!1),g=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},M=Re(),x=t(M),b=!1;return y}}function Te(n){return n.length>1}function Re(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:b,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function De(n,t){return((n=n.x)[0]<0?n[1]-Ra-Ca:Ra-n[1])-((t=t.x)[0]<0?t[1]-Ra-Ca:Ra-t[1])}function Pe(n){var t,e=0/0,r=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,o){var a=i>0?qa:-qa,c=ga(i-e);ga(c-qa)<Ca?(n.point(e,r=(r+o)/2>0?Ra:-Ra),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):u!==a&&c>=qa&&(ga(e-u)<Ca&&(e-=u*Ca),ga(i-a)<Ca&&(i-=a*Ca),r=Ue(e,r,i,o),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=o),u=a},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function Ue(n,t,e,r){var u,i,o=Math.sin(n-e);return ga(o)>Ca?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*o)):(t+r)/2}function je(n,t,e,r){var u;if(null==n)u=e*Ra,r.point(-qa,u),r.point(0,u),r.point(qa,u),r.point(qa,0),r.point(qa,-u),r.point(0,-u),r.point(-qa,-u),r.point(-qa,0),r.point(-qa,u);else if(ga(n[0]-t[0])>Ca){var i=n[0]<t[0]?qa:-qa;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u)}else r.point(t[0],t[1])}function Fe(n,t){var e=n[0],r=n[1],u=[Math.sin(e),-Math.cos(e),0],i=0,o=0;yc.reset();for(var a=0,c=t.length;c>a;++a){var l=t[a],s=l.length;if(s)for(var f=l[0],h=f[0],g=f[1]/2+qa/4,p=Math.sin(g),v=Math.cos(g),d=1;;){d===s&&(d=0),n=l[d];var m=n[0],y=n[1]/2+qa/4,M=Math.sin(y),x=Math.cos(y),b=m-h,_=b>=0?1:-1,w=_*b,S=w>qa,k=p*M;if(yc.add(Math.atan2(k*_*Math.sin(w),v*x+k*Math.cos(w))),i+=S?b+_*La:b,S^h>=e^m>=e){var E=de(pe(f),pe(n));Me(E);var A=de(u,E);Me(A);var N=(S^b>=0?-1:1)*tt(A[2]);(r>N||r===N&&(E[0]||E[1]))&&(o+=S^b>=0?1:-1)}if(!d++)break;h=m,p=M,v=x,f=n}}return(-Ca>i||Ca>i&&0>yc)^1&o}function He(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function e(n){var e,i,c,l,s;return{lineStart:function(){l=c=!1,s=1},point:function(f,h){var g,p=[f,h],v=t(f,h),d=o?v?0:u(f,h):v?u(f+(0>f?qa:-qa),h):0;if(!e&&(l=c=v)&&n.lineStart(),v!==c&&(g=r(e,p),(be(e,g)||be(p,g))&&(p[0]+=Ca,p[1]+=Ca,v=t(p[0],p[1]))),v!==c)s=0,v?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(a&&e&&o^v){var m;d&i||!(m=r(p,e,!0))||(s=0,o?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])))}!v||e&&be(e,p)||n.point(p[0],p[1]),e=p,c=v,i=d},lineEnd:function(){c&&n.lineEnd(),e=null},clean:function(){return s|(l&&c)<<1}}}function r(n,t,e){var r=pe(n),u=pe(t),o=[1,0,0],a=de(r,u),c=ve(a,a),l=a[0],s=c-l*l;if(!s)return!e&&n;var f=i*c/s,h=-i*l/s,g=de(o,a),p=ye(o,f),v=ye(a,h);me(p,v);var d=g,m=ve(p,d),y=ve(d,d),M=m*m-y*(ve(p,p)-1);if(!(0>M)){var x=Math.sqrt(M),b=ye(d,(-m-x)/y);if(me(b,p),b=xe(b),!e)return b;var _,w=n[0],S=t[0],k=n[1],E=t[1];w>S&&(_=w,w=S,S=_);var A=S-w,N=ga(A-qa)<Ca,C=N||Ca>A;if(!N&&k>E&&(_=k,k=E,E=_),C?N?k+E>0^b[1]<(ga(b[0]-w)<Ca?k:E):k<=b[1]&&b[1]<=E:A>qa^(w<=b[0]&&b[0]<=S)){var z=ye(d,(-m+x)/y);return me(z,p),[b,xe(z)]}}}function u(t,e){var r=o?n:qa-n,u=0;return-r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u}var i=Math.cos(n),o=i>0,a=ga(i)>Ca,c=gr(n,6*Da);return Le(t,e,c,o?[0,-n]:[-qa,n-qa])}function Oe(n,t,e,r){return function(u){var i,o=u.a,a=u.b,c=o.x,l=o.y,s=a.x,f=a.y,h=0,g=1,p=s-c,v=f-l;if(i=n-c,p||!(i>0)){if(i/=p,0>p){if(h>i)return;g>i&&(g=i)}else if(p>0){if(i>g)return;i>h&&(h=i)}if(i=e-c,p||!(0>i)){if(i/=p,0>p){if(i>g)return;i>h&&(h=i)}else if(p>0){if(h>i)return;g>i&&(g=i)}if(i=t-l,v||!(i>0)){if(i/=v,0>v){if(h>i)return;g>i&&(g=i)}else if(v>0){if(i>g)return;i>h&&(h=i)}if(i=r-l,v||!(0>i)){if(i/=v,0>v){if(i>g)return;i>h&&(h=i)}else if(v>0){if(h>i)return;g>i&&(g=i)}return h>0&&(u.a={x:c+h*p,y:l+h*v}),1>g&&(u.b={x:c+g*p,y:l+g*v}),u}}}}}}function Ie(n,t,e,r){function u(r,u){return ga(r[0]-n)<Ca?u>0?0:3:ga(r[0]-e)<Ca?u>0?2:1:ga(r[1]-t)<Ca?u>0?1:0:u>0?3:2}function i(n,t){return o(n.x,t.x)}function o(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function c(n){for(var t=0,e=d.length,r=n[1],u=0;e>u;++u)for(var i,o=1,a=d[u],c=a.length,l=a[0];c>o;++o)i=a[o],l[1]<=r?i[1]>r&&Q(l,i,n)>0&&++t:i[1]<=r&&Q(l,i,n)<0&&--t,l=i;return 0!==t}function l(i,a,c,l){var s=0,f=0;if(null==i||(s=u(i,c))!==(f=u(a,c))||o(i,a)<0^c>0){do{l.point(0===s||3===s?n:e,s>1?r:t)}while((s=(s+c+4)%4)!==f)}else l.point(a[0],a[1])}function s(u,i){return u>=n&&e>=u&&i>=t&&r>=i}function f(n,t){s(n,t)&&a.point(n,t)}function h(){C.point=p,d&&d.push(m=[]),S=!0,w=!1,b=_=0/0}function g(){v&&(p(y,M),x&&w&&A.rejoin(),v.push(A.buffer())),C.point=f,w&&a.lineEnd()}function p(n,t){n=Math.max(-Tc,Math.min(Tc,n)),t=Math.max(-Tc,Math.min(Tc,t));var e=s(n,t);if(d&&m.push([n,t]),S)y=n,M=t,x=e,S=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&w)a.point(n,t);else{var r={a:{x:b,y:_},b:{x:n,y:t}};N(r)?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1)}b=n,_=t,w=e}var v,d,m,y,M,x,b,_,w,S,k,E=a,A=Re(),N=Oe(n,t,e,r),C={point:f,lineStart:h,lineEnd:g,polygonStart:function(){a=A,v=[],d=[],k=!0},polygonEnd:function(){a=E,v=ta.merge(v);var t=c([n,r]),e=k&&t,u=v.length;(e||u)&&(a.polygonStart(),e&&(a.lineStart(),l(null,null,1,a),a.lineEnd()),u&&Ce(v,i,t,l,a),a.polygonEnd()),v=d=m=null}};return C}}function Ye(n){var t=0,e=qa/3,r=ir(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*qa/180,e=n[1]*qa/180):[t/qa*180,e/qa*180]},u}function Ze(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),o-e*Math.cos(n)]}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),o=Math.sqrt(i)/u;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/u,tt((i-(n*n+e*e)*u*u)/(2*u))]},e}function Ve(){function n(n,t){Dc+=u*n-r*t,r=n,u=t}var t,e,r,u;Hc.point=function(i,o){Hc.point=n,t=r=i,e=u=o},Hc.lineEnd=function(){n(t,e)}}function Xe(n,t){Pc>n&&(Pc=n),n>jc&&(jc=n),Uc>t&&(Uc=t),t>Fc&&(Fc=t)}function $e(){function n(n,t){o.push("M",n,",",t,i)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function u(){o.push("Z")}var i=Be(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return i=Be(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Be(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function We(n,t){_c+=n,wc+=t,++Sc}function Je(){function n(n,r){var u=n-t,i=r-e,o=Math.sqrt(u*u+i*i);kc+=o*(t+n)/2,Ec+=o*(e+r)/2,Ac+=o,We(t=n,e=r)}var t,e;Ic.point=function(r,u){Ic.point=n,We(t=r,e=u)}}function Ge(){Ic.point=We}function Ke(){function n(n,t){var e=n-r,i=t-u,o=Math.sqrt(e*e+i*i);kc+=o*(r+n)/2,Ec+=o*(u+t)/2,Ac+=o,o=u*n-r*t,Nc+=o*(r+n),Cc+=o*(u+t),zc+=3*o,We(r=n,u=t)}var t,e,r,u;Ic.point=function(i,o){Ic.point=n,We(t=r=i,e=u=o)},Ic.lineEnd=function(){n(t,e)}}function Qe(n){function t(t,e){n.moveTo(t+o,e),n.arc(t,e,o,0,La)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function u(){a.point=t}function i(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:u,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=u,a.point=t},pointRadius:function(n){return o=n,a},result:b};return a}function nr(n){function t(n){return(a?r:e)(n)}function e(t){return rr(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){M=0/0,S.point=i,t.lineStart()}function i(e,r){var i=pe([e,r]),o=n(e,r);u(M,x,y,b,_,w,M=o[0],x=o[1],y=e,b=i[0],_=i[1],w=i[2],a,t),t.point(M,x)}function o(){S.point=e,t.lineEnd()}function c(){r(),S.point=l,S.lineEnd=s}function l(n,t){i(f=n,h=t),g=M,p=x,v=b,d=_,m=w,S.point=i}function s(){u(M,x,y,b,_,w,g,p,f,v,d,m,a,t),S.lineEnd=o,o()}var f,h,g,p,v,d,m,y,M,x,b,_,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=c},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function u(t,e,r,a,c,l,s,f,h,g,p,v,d,m){var y=s-t,M=f-e,x=y*y+M*M;if(x>4*i&&d--){var b=a+g,_=c+p,w=l+v,S=Math.sqrt(b*b+_*_+w*w),k=Math.asin(w/=S),E=ga(ga(w)-1)<Ca||ga(r-h)<Ca?(r+h)/2:Math.atan2(_,b),A=n(E,k),N=A[0],C=A[1],z=N-t,q=C-e,L=M*z-y*q;(L*L/x>i||ga((y*z+M*q)/x-.5)>.3||o>a*g+c*p+l*v)&&(u(t,e,r,a,c,l,N,C,E,b/=S,_/=S,w,d,m),m.point(N,C),u(N,C,E,b,_,w,s,f,h,g,p,v,d,m))}}var i=.5,o=Math.cos(30*Da),a=16;return t.precision=function(n){return arguments.length?(a=(i=n*n)>0&&16,t):Math.sqrt(i)},t}function tr(n){var t=nr(function(t,e){return n([t*Pa,e*Pa])});return function(n){return or(t(n))}}function er(n){this.stream=n}function rr(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function ur(n){return ir(function(){return n})()}function ir(n){function t(n){return n=a(n[0]*Da,n[1]*Da),[n[0]*h+c,l-n[1]*h]}function e(n){return n=a.invert((n[0]-c)/h,(l-n[1])/h),n&&[n[0]*Pa,n[1]*Pa]}function r(){a=Ae(o=lr(m,M,x),i);var n=i(v,d);return c=g-n[0]*h,l=p+n[1]*h,u()}function u(){return s&&(s.valid=!1,s=null),t}var i,o,a,c,l,s,f=nr(function(n,t){return n=i(n,t),[n[0]*h+c,l-n[1]*h]}),h=150,g=480,p=250,v=0,d=0,m=0,M=0,x=0,b=Lc,_=y,w=null,S=null;return t.stream=function(n){return s&&(s.valid=!1),s=or(b(o,f(_(n)))),s.valid=!0,s},t.clipAngle=function(n){return arguments.length?(b=null==n?(w=n,Lc):He((w=+n)*Da),u()):w},t.clipExtent=function(n){return arguments.length?(S=n,_=n?Ie(n[0][0],n[0][1],n[1][0],n[1][1]):y,u()):S},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p]},t.center=function(n){return arguments.length?(v=n[0]%360*Da,d=n[1]%360*Da,r()):[v*Pa,d*Pa]},t.rotate=function(n){return arguments.length?(m=n[0]%360*Da,M=n[1]%360*Da,x=n.length>2?n[2]%360*Da:0,r()):[m*Pa,M*Pa,x*Pa]},ta.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&e,r()}}function or(n){return rr(n,function(t,e){n.point(t*Da,e*Da)})}function ar(n,t){return[n,t]}function cr(n,t){return[n>qa?n-La:-qa>n?n+La:n,t]}function lr(n,t,e){return n?t||e?Ae(fr(n),hr(t,e)):fr(n):t||e?hr(t,e):cr}function sr(n){return function(t,e){return t+=n,[t>qa?t-La:-qa>t?t+La:t,e]}}function fr(n){var t=sr(n);return t.invert=sr(-n),t}function hr(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*r+a*u;return[Math.atan2(c*i-s*o,a*r-l*u),tt(s*i+c*o)]}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*i-c*o;return[Math.atan2(c*i+l*o,a*r+s*u),tt(s*r-a*u)]},e}function gr(n,t){var e=Math.cos(n),r=Math.sin(n);return function(u,i,o,a){var c=o*t;null!=u?(u=pr(e,u),i=pr(e,i),(o>0?i>u:u>i)&&(u+=o*La)):(u=n+o*La,i=n-.5*c);for(var l,s=u;o>0?s>i:i>s;s-=c)a.point((l=xe([e,-r*Math.cos(s),-r*Math.sin(s)]))[0],l[1])}}function pr(n,t){var e=pe(t);e[0]-=n,Me(e);var r=nt(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Ca)%(2*Math.PI)}function vr(n,t,e){var r=ta.range(n,t-Ca,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function dr(n,t,e){var r=ta.range(n,t-Ca,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function mr(n){return n.source}function yr(n){return n.target}function Mr(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),o=Math.cos(r),a=Math.sin(r),c=u*Math.cos(n),l=u*Math.sin(n),s=o*Math.cos(e),f=o*Math.sin(e),h=2*Math.asin(Math.sqrt(it(r-t)+u*o*it(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*s,u=e*l+t*f,o=e*i+t*a;return[Math.atan2(u,r)*Pa,Math.atan2(o,Math.sqrt(r*r+u*u))*Pa]}:function(){return[n*Pa,t*Pa]};return p.distance=h,p}function xr(){function n(n,u){var i=Math.sin(u*=Da),o=Math.cos(u),a=ga((n*=Da)-t),c=Math.cos(a);Yc+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*i-e*o*c)*a),e*i+r*o*c),t=n,e=i,r=o}var t,e,r;Zc.point=function(u,i){t=u*Da,e=Math.sin(i*=Da),r=Math.cos(i),Zc.point=n},Zc.lineEnd=function(){Zc.point=Zc.lineEnd=b}}function br(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),o=Math.cos(u);return[Math.atan2(n*i,r*o),Math.asin(r&&e*i/r)]},e}function _r(n,t){function e(n,t){o>0?-Ra+Ca>t&&(t=-Ra+Ca):t>Ra-Ca&&(t=Ra-Ca);var e=o/Math.pow(u(t),i);return[e*Math.sin(i*n),o-e*Math.cos(i*n)]}var r=Math.cos(n),u=function(n){return Math.tan(qa/4+n/2)},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),o=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=o-t,r=K(i)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(o/r,1/i))-Ra]},e):Sr}function wr(n,t){function e(n,t){var e=i-t;return[e*Math.sin(u*n),i-e*Math.cos(u*n)]}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;return ga(u)<Ca?ar:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-K(u)*Math.sqrt(n*n+e*e)]},e)}function Sr(n,t){return[n,Math.log(Math.tan(qa/4+t/2))]}function kr(n){var t,e=ur(n),r=e.scale,u=e.translate,i=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=u.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=i.apply(e,arguments);if(o===e){if(t=null==n){var a=qa*r(),c=u();i([[c[0]-a,c[1]-a],[c[0]+a,c[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function Er(n,t){return[Math.log(Math.tan(qa/4+t/2)),-n]}function Ar(n){return n[0]}function Nr(n){return n[1]}function Cr(n){for(var t=n.length,e=[0,1],r=2,u=2;t>u;u++){for(;r>1&&Q(n[e[r-2]],n[e[r-1]],n[u])<=0;)--r;e[r++]=u}return e.slice(0,r)}function zr(n,t){return n[0]-t[0]||n[1]-t[1]}function qr(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function Lr(n,t,e,r){var u=n[0],i=e[0],o=t[0]-u,a=r[0]-i,c=n[1],l=e[1],s=t[1]-c,f=r[1]-l,h=(a*(c-l)-f*(u-i))/(f*o-a*s);return[u+h*o,c+h*s]}function Tr(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Rr(){tu(this),this.edge=this.site=this.circle=null}function Dr(n){var t=el.pop()||new Rr;return t.site=n,t}function Pr(n){Xr(n),Qc.remove(n),el.push(n),tu(n)}function Ur(n){var t=n.circle,e=t.x,r=t.cy,u={x:e,y:r},i=n.P,o=n.N,a=[n];Pr(n);for(var c=i;c.circle&&ga(e-c.circle.x)<Ca&&ga(r-c.circle.cy)<Ca;)i=c.P,a.unshift(c),Pr(c),c=i;a.unshift(c),Xr(c);for(var l=o;l.circle&&ga(e-l.circle.x)<Ca&&ga(r-l.circle.cy)<Ca;)o=l.N,a.push(l),Pr(l),l=o;a.push(l),Xr(l);var s,f=a.length;for(s=1;f>s;++s)l=a[s],c=a[s-1],Kr(l.edge,c.site,l.site,u);c=a[0],l=a[f-1],l.edge=Jr(c.site,l.site,null,u),Vr(c),Vr(l)}function jr(n){for(var t,e,r,u,i=n.x,o=n.y,a=Qc._;a;)if(r=Fr(a,o)-i,r>Ca)a=a.L;else{if(u=i-Hr(a,o),!(u>Ca)){r>-Ca?(t=a.P,e=a):u>-Ca?(t=a,e=a.N):t=e=a;break}if(!a.R){t=a;break}a=a.R}var c=Dr(n);if(Qc.insert(t,c),t||e){if(t===e)return Xr(t),e=Dr(t.site),Qc.insert(c,e),c.edge=e.edge=Jr(t.site,c.site),Vr(t),void Vr(e);if(!e)return void(c.edge=Jr(t.site,c.site));Xr(t),Xr(e);var l=t.site,s=l.x,f=l.y,h=n.x-s,g=n.y-f,p=e.site,v=p.x-s,d=p.y-f,m=2*(h*d-g*v),y=h*h+g*g,M=v*v+d*d,x={x:(d*y-g*M)/m+s,y:(h*M-v*y)/m+f};Kr(e.edge,l,p,x),c.edge=Jr(l,n,null,x),e.edge=Jr(n,p,null,x),Vr(t),Vr(e)}}function Fr(n,t){var e=n.site,r=e.x,u=e.y,i=u-t;if(!i)return r;var o=n.P;if(!o)return-1/0;e=o.site;var a=e.x,c=e.y,l=c-t;if(!l)return a;var s=a-r,f=1/i-1/l,h=s/l;return f?(-h+Math.sqrt(h*h-2*f*(s*s/(-2*l)-c+l/2+u-i/2)))/f+r:(r+a)/2}function Hr(n,t){var e=n.N;if(e)return Fr(e,t);var r=n.site;return r.y===t?r.x:1/0}function Or(n){this.site=n,this.edges=[]}function Ir(n){for(var t,e,r,u,i,o,a,c,l,s,f=n[0][0],h=n[1][0],g=n[0][1],p=n[1][1],v=Kc,d=v.length;d--;)if(i=v[d],i&&i.prepare())for(a=i.edges,c=a.length,o=0;c>o;)s=a[o].end(),r=s.x,u=s.y,l=a[++o%c].start(),t=l.x,e=l.y,(ga(r-t)>Ca||ga(u-e)>Ca)&&(a.splice(o,0,new Qr(Gr(i.site,s,ga(r-f)<Ca&&p-u>Ca?{x:f,y:ga(t-f)<Ca?e:p}:ga(u-p)<Ca&&h-r>Ca?{x:ga(e-p)<Ca?t:h,y:p}:ga(r-h)<Ca&&u-g>Ca?{x:h,y:ga(t-h)<Ca?e:g}:ga(u-g)<Ca&&r-f>Ca?{x:ga(e-g)<Ca?t:f,y:g}:null),i.site,null)),++c)}function Yr(n,t){return t.angle-n.angle}function Zr(){tu(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vr(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,u=n.site,i=e.site;if(r!==i){var o=u.x,a=u.y,c=r.x-o,l=r.y-a,s=i.x-o,f=i.y-a,h=2*(c*f-l*s);if(!(h>=-za)){var g=c*c+l*l,p=s*s+f*f,v=(f*g-l*p)/h,d=(c*p-s*g)/h,f=d+a,m=rl.pop()||new Zr;m.arc=n,m.site=u,m.x=v+o,m.y=f+Math.sqrt(v*v+d*d),m.cy=f,n.circle=m;for(var y=null,M=tl._;M;)if(m.y<M.y||m.y===M.y&&m.x<=M.x){if(!M.L){y=M.P;break}M=M.L}else{if(!M.R){y=M;break}M=M.R}tl.insert(y,m),y||(nl=m)}}}}function Xr(n){var t=n.circle;t&&(t.P||(nl=t.N),tl.remove(t),rl.push(t),tu(t),n.circle=null)}function $r(n){for(var t,e=Gc,r=Oe(n[0][0],n[0][1],n[1][0],n[1][1]),u=e.length;u--;)t=e[u],(!Br(t,n)||!r(t)||ga(t.a.x-t.b.x)<Ca&&ga(t.a.y-t.b.y)<Ca)&&(t.a=t.b=null,e.splice(u,1))}function Br(n,t){var e=n.b;if(e)return!0;var r,u,i=n.a,o=t[0][0],a=t[1][0],c=t[0][1],l=t[1][1],s=n.l,f=n.r,h=s.x,g=s.y,p=f.x,v=f.y,d=(h+p)/2,m=(g+v)/2;if(v===g){if(o>d||d>=a)return;if(h>p){if(i){if(i.y>=l)return}else i={x:d,y:c};e={x:d,y:l}}else{if(i){if(i.y<c)return}else i={x:d,y:l};e={x:d,y:c}}}else if(r=(h-p)/(v-g),u=m-r*d,-1>r||r>1)if(h>p){if(i){if(i.y>=l)return}else i={x:(c-u)/r,y:c};e={x:(l-u)/r,y:l}}else{if(i){if(i.y<c)return}else i={x:(l-u)/r,y:l};e={x:(c-u)/r,y:c}}else if(v>g){if(i){if(i.x>=a)return}else i={x:o,y:r*o+u};e={x:a,y:r*a+u}}else{if(i){if(i.x<o)return}else i={x:a,y:r*a+u};e={x:o,y:r*o+u}}return n.a=i,n.b=e,!0}function Wr(n,t){this.l=n,this.r=t,this.a=this.b=null}function Jr(n,t,e,r){var u=new Wr(n,t);return Gc.push(u),e&&Kr(u,n,t,e),r&&Kr(u,t,n,r),Kc[n.i].edges.push(new Qr(u,n,t)),Kc[t.i].edges.push(new Qr(u,t,n)),u}function Gr(n,t,e){var r=new Wr(n,null);return r.a=t,r.b=e,Gc.push(r),r}function Kr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function Qr(n,t,e){var r=n.a,u=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(u.x-r.x,r.y-u.y):Math.atan2(r.x-u.x,u.y-r.y)}function nu(){this._=null}function tu(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function eu(n,t){var e=t,r=t.R,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function ru(n,t){var e=t,r=t.L,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function uu(n){for(;n.L;)n=n.L;return n}function iu(n,t){var e,r,u,i=n.sort(ou).pop();for(Gc=[],Kc=new Array(n.length),Qc=new nu,tl=new nu;;)if(u=nl,i&&(!u||i.y<u.y||i.y===u.y&&i.x<u.x))(i.x!==e||i.y!==r)&&(Kc[i.i]=new Or(i),jr(i),e=i.x,r=i.y),i=n.pop();else{if(!u)break;Ur(u.arc)}t&&($r(t),Ir(t));var o={cells:Kc,edges:Gc};return Qc=tl=Gc=Kc=null,o}function ou(n,t){return t.y-n.y||t.x-n.x}function au(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}function cu(n){return n.x}function lu(n){return n.y}function su(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function fu(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var o=.5*(e+u),a=.5*(r+i),c=t.nodes;c[0]&&fu(n,c[0],e,r,o,a),c[1]&&fu(n,c[1],o,r,u,a),c[2]&&fu(n,c[2],e,a,o,i),c[3]&&fu(n,c[3],o,a,u,i)}}function hu(n,t,e,r,u,i,o){var a,c=1/0;return function l(n,s,f,h,g){if(!(s>i||f>o||r>h||u>g)){if(p=n.point){var p,v=t-n.x,d=e-n.y,m=v*v+d*d;if(c>m){var y=Math.sqrt(c=m);r=t-y,u=e-y,i=t+y,o=e+y,a=p}}for(var M=n.nodes,x=.5*(s+h),b=.5*(f+g),_=t>=x,w=e>=b,S=w<<1|_,k=S+4;k>S;++S)if(n=M[3&S])switch(3&S){case 0:l(n,s,f,x,b);break;case 1:l(n,x,f,h,b);break;case 2:l(n,s,b,x,g);break;case 3:l(n,x,b,h,g)}}}(n,r,u,i,o),a}function gu(n,t){n=ta.rgb(n),t=ta.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,o=t.g-r,a=t.b-u;return function(n){return"#"+xt(Math.round(e+i*n))+xt(Math.round(r+o*n))+xt(Math.round(u+a*n))}}function pu(n,t){var e,r={},u={};for(e in n)e in t?r[e]=mu(n[e],t[e]):u[e]=n[e];for(e in t)e in n||(u[e]=t[e]);return function(n){for(e in r)u[e]=r[e](n);return u}}function vu(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function du(n,t){var e,r,u,i=il.lastIndex=ol.lastIndex=0,o=-1,a=[],c=[];for(n+="",t+="";(e=il.exec(n))&&(r=ol.exec(t));)(u=r.index)>i&&(u=t.slice(i,u),a[o]?a[o]+=u:a[++o]=u),(e=e[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,c.push({i:o,x:vu(e,r)})),i=ol.lastIndex;return i<t.length&&(u=t.slice(i),a[o]?a[o]+=u:a[++o]=u),a.length<2?c[0]?(t=c[0].x,function(n){return t(n)+""}):function(){return t}:(t=c.length,function(n){for(var e,r=0;t>r;++r)a[(e=c[r]).i]=e.x(n);return a.join("")})}function mu(n,t){for(var e,r=ta.interpolators.length;--r>=0&&!(e=ta.interpolators[r](n,t)););return e}function yu(n,t){var e,r=[],u=[],i=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;a>e;++e)r.push(mu(n[e],t[e]));for(;i>e;++e)u[e]=n[e];for(;o>e;++e)u[e]=t[e];return function(n){for(e=0;a>e;++e)u[e]=r[e](n);return u}}function Mu(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function xu(n){return function(t){return 1-n(1-t)}}function bu(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function _u(n){return n*n}function wu(n){return n*n*n}function Su(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function ku(n){return function(t){return Math.pow(t,n)}}function Eu(n){return 1-Math.cos(n*Ra)}function Au(n){return Math.pow(2,10*(n-1))}function Nu(n){return 1-Math.sqrt(1-n*n)}function Cu(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/La*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*La/t)}}function zu(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function qu(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Lu(n,t){n=ta.hcl(n),t=ta.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,o=t.c-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return st(e+i*n,r+o*n,u+a*n)+""}}function Tu(n,t){n=ta.hsl(n),t=ta.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,o=t.s-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return ct(e+i*n,r+o*n,u+a*n)+""}}function Ru(n,t){n=ta.lab(n),t=ta.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,o=t.a-r,a=t.b-u;return function(n){return ht(e+i*n,r+o*n,u+a*n)+""}}function Du(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Pu(n){var t=[n.a,n.b],e=[n.c,n.d],r=ju(t),u=Uu(t,e),i=ju(Fu(e,t,-u))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Pa,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*Pa:0}function Uu(n,t){return n[0]*t[0]+n[1]*t[1]}function ju(n){var t=Math.sqrt(Uu(n,n));return t&&(n[0]/=t,n[1]/=t),t}function Fu(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function Hu(n,t){var e,r=[],u=[],i=ta.transform(n),o=ta.transform(t),a=i.translate,c=o.translate,l=i.rotate,s=o.rotate,f=i.skew,h=o.skew,g=i.scale,p=o.scale;return a[0]!=c[0]||a[1]!=c[1]?(r.push("translate(",null,",",null,")"),u.push({i:1,x:vu(a[0],c[0])},{i:3,x:vu(a[1],c[1])})):r.push(c[0]||c[1]?"translate("+c+")":""),l!=s?(l-s>180?s+=360:s-l>180&&(l+=360),u.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:vu(l,s)})):s&&r.push(r.pop()+"rotate("+s+")"),f!=h?u.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:vu(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),u.push({i:e-4,x:vu(g[0],p[0])},{i:e-2,x:vu(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=u.length,function(n){for(var t,i=-1;++i<e;)r[(t=u[i]).i]=t.x(n);return r.join("")}}function Ou(n,t){return t=(t-=n=+n)||1/t,function(e){return(e-n)/t}}function Iu(n,t){return t=(t-=n=+n)||1/t,function(e){return Math.max(0,Math.min(1,(e-n)/t))}}function Yu(n){for(var t=n.source,e=n.target,r=Vu(t,e),u=[t];t!==r;)t=t.parent,u.push(t);for(var i=u.length;e!==r;)u.splice(i,0,e),e=e.parent;return u}function Zu(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Vu(n,t){if(n===t)return n;for(var e=Zu(n),r=Zu(t),u=e.pop(),i=r.pop(),o=null;u===i;)o=u,u=e.pop(),i=r.pop();return o}function Xu(n){n.fixed|=2}function $u(n){n.fixed&=-7}function Bu(n){n.fixed|=4,n.px=n.x,n.py=n.y}function Wu(n){n.fixed&=-5}function Ju(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf)for(var i,o=n.nodes,a=o.length,c=-1;++c<a;)i=o[c],null!=i&&(Ju(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var l=t*e[n.point.index];n.charge+=n.pointCharge=l,r+=l*n.point.x,u+=l*n.point.y}n.cx=r/n.charge,n.cy=u/n.charge}function Gu(n,t){return ta.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=ri,n}function Ku(n,t){for(var e=[n];null!=(n=e.pop());)if(t(n),(u=n.children)&&(r=u.length))for(var r,u;--r>=0;)e.push(u[r])}function Qu(n,t){for(var e=[n],r=[];null!=(n=e.pop());)if(r.push(n),(i=n.children)&&(u=i.length))for(var u,i,o=-1;++o<u;)e.push(i[o]);for(;null!=(n=r.pop());)t(n)}function ni(n){return n.children}function ti(n){return n.value}function ei(n,t){return t.value-n.value}function ri(n){return ta.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function ui(n){return n.x}function ii(n){return n.y}function oi(n,t,e){n.y0=t,n.y=e}function ai(n){return ta.range(n.length)}function ci(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function li(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;i>e;++e)(t=n[e][1])>u&&(r=e,u=t);return r}function si(n){return n.reduce(fi,0)}function fi(n,t){return n+t[1]}function hi(n,t){return gi(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function gi(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];++e<=t;)i[e]=u*e+r;return i}function pi(n){return[ta.min(n),ta.max(n)]}function vi(n,t){return n.value-t.value}function di(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function mi(n,t){n._pack_next=t,t._pack_prev=n}function yi(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return.999*u*u>e*e+r*r}function Mi(n){function t(n){s=Math.min(n.x-n.r,s),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(l=e.length)){var e,r,u,i,o,a,c,l,s=1/0,f=-1/0,h=1/0,g=-1/0;if(e.forEach(xi),r=e[0],r.x=-r.r,r.y=0,t(r),l>1&&(u=e[1],u.x=u.r,u.y=0,t(u),l>2))for(i=e[2],wi(r,u,i),t(i),di(r,i),r._pack_prev=i,di(i,u),u=r._pack_next,o=3;l>o;o++){wi(r,u,i=e[o]);var p=0,v=1,d=1;for(a=u._pack_next;a!==u;a=a._pack_next,v++)if(yi(a,i)){p=1;break}if(1==p)for(c=r._pack_prev;c!==a._pack_prev&&!yi(c,i);c=c._pack_prev,d++);p?(d>v||v==d&&u.r<r.r?mi(r,u=a):mi(r=c,u),o--):(di(r,i),u=i,t(i))}var m=(s+f)/2,y=(h+g)/2,M=0;for(o=0;l>o;o++)i=e[o],i.x-=m,i.y-=y,M=Math.max(M,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=M,e.forEach(bi)}}function xi(n){n._pack_next=n._pack_prev=n}function bi(n){delete n._pack_next,delete n._pack_prev}function _i(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u)for(var i=-1,o=u.length;++i<o;)_i(u[i],t,e,r)}function wi(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var o=t.r+e.r,a=u*u+i*i;o*=o,r*=r;var c=.5+(r-o)/(2*a),l=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+c*u+l*i,e.y=n.y+c*i-l*u}else e.x=n.x+r,e.y=n.y}function Si(n,t){return n.parent==t.parent?1:2}function ki(n){var t=n.children;return t.length?t[0]:n.t}function Ei(n){var t,e=n.children;return(t=e.length)?e[t-1]:n.t}function Ai(n,t,e){var r=e/(t.i-n.i);t.c-=r,t.s+=e,n.c+=r,t.z+=e,t.m+=e}function Ni(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;)t=u[i],t.z+=e,t.m+=e,e+=t.s+(r+=t.c)}function Ci(n,t,e){return n.a.parent===t.parent?n.a:e}function zi(n){return 1+ta.max(n,function(n){return n.y})}function qi(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Li(n){var t=n.children;return t&&t.length?Li(t[0]):n}function Ti(n){var t,e=n.children;return e&&(t=e.length)?Ti(e[t-1]):n}function Ri(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Di(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i}}function Pi(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Ui(n){return n.rangeExtent?n.rangeExtent():Pi(n.range())}function ji(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);return function(n){return i(u(n))}}function Fi(n,t){var e,r=0,u=n.length-1,i=n[r],o=n[u];return i>o&&(e=r,r=u,u=e,e=i,i=o,o=e),n[r]=t.floor(i),n[u]=t.ceil(o),n}function Hi(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:ml}function Oi(n,t,e,r){var u=[],i=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)u.push(e(n[o-1],n[o])),i.push(r(t[o-1],t[o]));return function(t){var e=ta.bisect(n,t,1,a)-1;return i[e](u[e](t))}}function Ii(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?Oi:ji,c=r?Iu:Ou;return o=u(n,t,c,e),a=u(t,n,c,mu),i}function i(n){return o(n)}var o,a;return i.invert=function(n){return a(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Du)},i.clamp=function(n){return arguments.length?(r=n,u()):r},i.interpolate=function(n){return arguments.length?(e=n,u()):e},i.ticks=function(t){return Xi(n,t)},i.tickFormat=function(t,e){return $i(n,t,e)},i.nice=function(t){return Zi(n,t),u()},i.copy=function(){return Ii(n,t,e,r)},u()}function Yi(n,t){return ta.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Zi(n,t){return Fi(n,Hi(Vi(n,t)[2]))}function Vi(n,t){null==t&&(t=10);var e=Pi(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+.5*u,e[2]=u,e}function Xi(n,t){return ta.range.apply(ta,Vi(n,t))}function $i(n,t,e){var r=Vi(n,t);if(e){var u=ic.exec(e);if(u.shift(),"s"===u[8]){var i=ta.formatPrefix(Math.max(ga(r[0]),ga(r[1])));return u[7]||(u[7]="."+Bi(i.scale(r[2]))),u[8]="f",e=ta.format(u.join("")),function(n){return e(i.scale(n))+i.symbol}}u[7]||(u[7]="."+Wi(u[8],r)),e=u.join("")}else e=",."+Bi(r[2])+"f";return ta.format(e)}function Bi(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function Wi(n,t){var e=Bi(t[2]);return n in yl?Math.abs(e-Bi(Math.max(ga(t[0]),ga(t[1]))))+ +("e"!==n):e-2*("%"===n)}function Ji(n,t,e,r){function u(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function i(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(u(t))}return o.invert=function(t){return i(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(u)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(u)),o):t},o.nice=function(){var t=Fi(r.map(u),e?Math:xl);return n.domain(t),r=t.map(i),o},o.ticks=function(){var n=Pi(r),o=[],a=n[0],c=n[1],l=Math.floor(u(a)),s=Math.ceil(u(c)),f=t%1?2:t;if(isFinite(s-l)){if(e){for(;s>l;l++)for(var h=1;f>h;h++)o.push(i(l)*h);o.push(i(l))}else for(o.push(i(l));l++<s;)for(var h=f-1;h>0;h--)o.push(i(l)*h);for(l=0;o[l]<a;l++);for(s=o.length;o[s-1]>c;s--);o=o.slice(l,s)}return o},o.tickFormat=function(n,t){if(!arguments.length)return Ml;arguments.length<2?t=Ml:"function"!=typeof t&&(t=ta.format(t));var r,a=Math.max(.1,n/o.ticks().length),c=e?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(n){return n/i(c(u(n)+r))<=a?t(n):""}},o.copy=function(){return Ji(n.copy(),t,e,r)},Yi(o,n)}function Gi(n,t,e){function r(t){return n(u(t))}var u=Ki(t),i=Ki(1/t);return r.invert=function(t){return i(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(u)),r):e},r.ticks=function(n){return Xi(e,n)},r.tickFormat=function(n,t){return $i(e,n,t)},r.nice=function(n){return r.domain(Zi(e,n))},r.exponent=function(o){return arguments.length?(u=Ki(t=o),i=Ki(1/t),n.domain(e.map(u)),r):t},r.copy=function(){return Gi(n.copy(),t,e)},Yi(r,n)}function Ki(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function Qi(n,t){function e(e){return i[((u.get(e)||("range"===t.t?u.set(e,n.push(e)):0/0))-1)%i.length]}function r(t,e){return ta.range(n.length).map(function(n){return t+e*n})}var u,i,o;return e.domain=function(r){if(!arguments.length)return n;n=[],u=new l;for(var i,o=-1,a=r.length;++o<a;)u.has(i=r[o])||u.set(i,n.push(i));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(i=n,o=0,t={t:"range",a:arguments},e):i},e.rangePoints=function(u,a){arguments.length<2&&(a=0);var c=u[0],l=u[1],s=n.length<2?(c=(c+l)/2,0):(l-c)/(n.length-1+a);return i=r(c+s*a/2,s),o=0,t={t:"rangePoints",a:arguments},e},e.rangeRoundPoints=function(u,a){arguments.length<2&&(a=0);var c=u[0],l=u[1],s=n.length<2?(c=l=Math.round((c+l)/2),0):(l-c)/(n.length-1+a)|0;return i=r(c+Math.round(s*a/2+(l-c-(n.length-1+a)*s)/2),s),o=0,t={t:"rangeRoundPoints",a:arguments},e},e.rangeBands=function(u,a,c){arguments.length<2&&(a=0),arguments.length<3&&(c=a);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=(f-s)/(n.length-a+2*c);return i=r(s+h*c,h),l&&i.reverse(),o=h*(1-a),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(u,a,c){arguments.length<2&&(a=0),arguments.length<3&&(c=a);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=Math.floor((f-s)/(n.length-a+2*c));return i=r(s+Math.round((f-s-(n.length-a)*h)/2),h),l&&i.reverse(),o=Math.round(h*(1-a)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return o},e.rangeExtent=function(){return Pi(t.a[0])},e.copy=function(){return Qi(n,t)},e.domain(n)}function no(n,t){function i(){var e=0,r=t.length;for(a=[];++e<r;)a[e-1]=ta.quantile(n,e/r);return o}function o(n){return isNaN(n=+n)?void 0:t[ta.bisect(a,n)]}var a;return o.domain=function(t){return arguments.length?(n=t.map(r).filter(u).sort(e),i()):n},o.range=function(n){return arguments.length?(t=n,i()):t},o.quantiles=function(){return a},o.invertExtent=function(e){return e=t.indexOf(e),0>e?[0/0,0/0]:[e>0?a[e-1]:n[0],e<a.length?a[e]:n[n.length-1]]},o.copy=function(){return no(n,t)},i()}function to(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(i*(t-n))))]}function u(){return i=e.length/(t-n),o=e.length-1,r}var i,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t]},r.range=function(n){return arguments.length?(e=n,u()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?0/0:t/i+n,[t,t+1/i]},r.copy=function(){return to(n,t,e)},u()}function eo(n,t){function e(e){return e>=e?t[ta.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return eo(n,t)},e}function ro(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Xi(n,t)},t.tickFormat=function(t,e){return $i(n,t,e)},t.copy=function(){return ro(n)},t}function uo(){return 0}function io(n){return n.innerRadius}function oo(n){return n.outerRadius}function ao(n){return n.startAngle}function co(n){return n.endAngle}function lo(n){return n&&n.padAngle}function so(n,t,e,r){return(n-e)*t-(t-r)*n>0?0:1}function fo(n,t,e,r,u){var i=n[0]-t[0],o=n[1]-t[1],a=(u?r:-r)/Math.sqrt(i*i+o*o),c=a*o,l=-a*i,s=n[0]+c,f=n[1]+l,h=t[0]+c,g=t[1]+l,p=(s+h)/2,v=(f+g)/2,d=h-s,m=g-f,y=d*d+m*m,M=e-r,x=s*g-h*f,b=(0>m?-1:1)*Math.sqrt(M*M*y-x*x),_=(x*m-d*b)/y,w=(-x*d-m*b)/y,S=(x*m+d*b)/y,k=(-x*d+m*b)/y,E=_-p,A=w-v,N=S-p,C=k-v;return E*E+A*A>N*N+C*C&&(_=S,w=k),[[_-c,w-l],[_*e/M,w*e/M]]}function ho(n){function t(t){function o(){l.push("M",i(n(s),a))}for(var c,l=[],s=[],f=-1,h=t.length,g=Et(e),p=Et(r);++f<h;)u.call(this,c=t[f],f)?s.push([+g.call(this,c,f),+p.call(this,c,f)]):s.length&&(o(),s=[]);return s.length&&o(),l.length?l.join(""):null}var e=Ar,r=Nr,u=Ne,i=go,o=i.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?i=n:(i=El.get(n)||go).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function go(n){return n.join("L")}function po(n){return go(n)+"Z"}function vo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&u.push("H",r[0]),u.join("")}function mo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("V",(r=n[t])[1],"H",r[0]);return u.join("")}function yo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r=n[t])[0],"V",r[1]);return u.join("")}function Mo(n,t){return n.length<4?go(n):n[1]+_o(n.slice(1,-1),wo(n,t))}function xo(n,t){return n.length<3?go(n):n[0]+_o((n.push(n[0]),n),wo([n[n.length-2]].concat(n,[n[1]]),t))}function bo(n,t){return n.length<3?go(n):n[0]+_o(n,wo(n,t))}function _o(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return go(n);var e=n.length!=t.length,r="",u=n[0],i=n[1],o=t[0],a=o,c=1;if(e&&(r+="Q"+(i[0]-2*o[0]/3)+","+(i[1]-2*o[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){a=t[1],i=n[c],c++,r+="C"+(u[0]+o[0])+","+(u[1]+o[1])+","+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1];for(var l=2;l<t.length;l++,c++)i=n[c],a=t[l],r+="S"+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1]}if(e){var s=n[c];r+="Q"+(i[0]+2*a[0]/3)+","+(i[1]+2*a[1]/3)+","+s[0]+","+s[1]}return r}function wo(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],o=n[1],a=1,c=n.length;++a<c;)e=i,i=o,o=n[a],r.push([u*(o[0]-e[0]),u*(o[1]-e[1])]);return r}function So(n){if(n.length<3)return go(n);var t=1,e=n.length,r=n[0],u=r[0],i=r[1],o=[u,u,u,(r=n[1])[0]],a=[i,i,i,r[1]],c=[u,",",i,"L",No(Cl,o),",",No(Cl,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),Co(c,o,a);return n.pop(),c.push("L",r),c.join("")}function ko(n){if(n.length<4)return go(n);for(var t,e=[],r=-1,u=n.length,i=[0],o=[0];++r<3;)t=n[r],i.push(t[0]),o.push(t[1]);for(e.push(No(Cl,i)+","+No(Cl,o)),--r;++r<u;)t=n[r],i.shift(),i.push(t[0]),o.shift(),o.push(t[1]),Co(e,i,o);return e.join("")}function Eo(n){for(var t,e,r=-1,u=n.length,i=u+4,o=[],a=[];++r<4;)e=n[r%u],o.push(e[0]),a.push(e[1]);for(t=[No(Cl,o),",",No(Cl,a)],--r;++r<i;)e=n[r%u],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Co(t,o,a);return t.join("")}function Ao(n,t){var e=n.length-1;if(e)for(var r,u,i=n[0][0],o=n[0][1],a=n[e][0]-i,c=n[e][1]-o,l=-1;++l<=e;)r=n[l],u=l/e,r[0]=t*r[0]+(1-t)*(i+u*a),r[1]=t*r[1]+(1-t)*(o+u*c);return So(n)}function No(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Co(n,t,e){n.push("C",No(Al,t),",",No(Al,e),",",No(Nl,t),",",No(Nl,e),",",No(Cl,t),",",No(Cl,e))}function zo(n,t){return(t[1]-n[1])/(t[0]-n[0])}function qo(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],o=r[0]=zo(u,i);++t<e;)r[t]=(o+(o=zo(u=i,i=n[t+1])))/2;return r[t]=o,r}function Lo(n){for(var t,e,r,u,i=[],o=qo(n),a=-1,c=n.length-1;++a<c;)t=zo(n[a],n[a+1]),ga(t)<Ca?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),o[a]=u*e,o[a+1]=u*r));for(a=-1;++a<=c;)u=(n[Math.min(c,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),i.push([u||0,o[a]*u||0]);return i}function To(n){return n.length<3?go(n):n[0]+_o(n,Lo(n))}function Ro(n){for(var t,e,r,u=-1,i=n.length;++u<i;)t=n[u],e=t[0],r=t[1]-Ra,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function Do(n){function t(t){function c(){v.push("M",a(n(m),f),s,l(n(d.reverse()),f),"Z")}for(var h,g,p,v=[],d=[],m=[],y=-1,M=t.length,x=Et(e),b=Et(u),_=e===r?function(){return g}:Et(r),w=u===i?function(){return p}:Et(i);++y<M;)o.call(this,h=t[y],y)?(d.push([g=+x.call(this,h,y),p=+b.call(this,h,y)]),m.push([+_.call(this,h,y),+w.call(this,h,y)])):d.length&&(c(),d=[],m=[]);return d.length&&c(),v.length?v.join(""):null}var e=Ar,r=Ar,u=0,i=Nr,o=Ne,a=go,c=a.key,l=a,s="L",f=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?a=n:(a=El.get(n)||go).key,l=a.reverse||a,s=a.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Po(n){return n.radius}function Uo(n){return[n.x,n.y]}function jo(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]-Ra;return[e*Math.cos(r),e*Math.sin(r)]}}function Fo(){return 64}function Ho(){return"circle"}function Oo(n){var t=Math.sqrt(n/qa);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Io(n){return function(){var t,e;(t=this[n])&&(e=t[t.active])&&(--t.count?delete t[t.active]:delete this[n],t.active+=.5,e.event&&e.event.interrupt.call(this,this.__data__,e.index))}}function Yo(n,t,e){return ya(n,Pl),n.namespace=t,n.id=e,n}function Zo(n,t,e,r){var u=n.id,i=n.namespace;return Y(n,"function"==typeof e?function(n,o,a){n[i][u].tween.set(t,r(e.call(n,n.__data__,o,a)))}:(e=r(e),function(n){n[i][u].tween.set(t,e)}))}function Vo(n){return null==n&&(n=""),function(){this.textContent=n}}function Xo(n){return null==n?"__transition__":"__transition_"+n+"__"}function $o(n,t,e,r,u){var i=n[e]||(n[e]={active:0,count:0}),o=i[r];if(!o){var a=u.time;o=i[r]={tween:new l,time:a,delay:u.delay,duration:u.duration,ease:u.ease,index:t},u=null,++i.count,ta.timer(function(u){function c(e){if(i.active>r)return s();var u=i[i.active];u&&(--i.count,delete i[i.active],u.event&&u.event.interrupt.call(n,n.__data__,u.index)),i.active=r,o.event&&o.event.start.call(n,n.__data__,t),o.tween.forEach(function(e,r){(r=r.call(n,n.__data__,t))&&v.push(r)}),h=o.ease,f=o.duration,ta.timer(function(){return p.c=l(e||1)?Ne:l,1},0,a)}function l(e){if(i.active!==r)return 1;for(var u=e/f,a=h(u),c=v.length;c>0;)v[--c].call(n,a);return u>=1?(o.event&&o.event.end.call(n,n.__data__,t),s()):void 0}function s(){return--i.count?delete i[r]:delete n[e],1}var f,h,g=o.delay,p=ec,v=[];return p.t=g+a,u>=g?c(u-g):void(p.c=c)},0,a)}}function Bo(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"})}function Wo(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"})}function Jo(n){return n.toISOString()}function Go(n,t,e){function r(t){return n(t)}function u(n,e){var r=n[1]-n[0],u=r/e,i=ta.bisect(Vl,u);return i==Vl.length?[t.year,Vi(n.map(function(n){return n/31536e6}),e)[2]]:i?t[u/Vl[i-1]<Vl[i]/u?i-1:i]:[Bl,Vi(n,e)[2]]}return r.invert=function(t){return Ko(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(Ko)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,Ko(+e+1),t).length}var i=r.domain(),o=Pi(i),a=null==n?u(o,10):"number"==typeof n&&u(o,n);return a&&(n=a[0],t=a[1]),r.domain(Fi(i,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=Ko(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=Ko(+t+1);return t}}:n))},r.ticks=function(n,t){var e=Pi(r.domain()),i=null==n?u(e,10):"number"==typeof n?u(e,n):!n.range&&[{range:n},t];return i&&(n=i[0],t=i[1]),n.range(e[0],Ko(+e[1]+1),1>t?1:t)},r.tickFormat=function(){return e},r.copy=function(){return Go(n.copy(),t,e)},Yi(r,n)}function Ko(n){return new Date(n)}function Qo(n){return JSON.parse(n.responseText)}function na(n){var t=ua.createRange();return t.selectNode(ua.body),t.createContextualFragment(n.responseText)}var ta={version:"3.5.5"},ea=[].slice,ra=function(n){return ea.call(n)},ua=this.document;if(ua)try{ra(ua.documentElement.childNodes)[0].nodeType}catch(ia){ra=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}if(Date.now||(Date.now=function(){return+new Date}),ua)try{ua.createElement("DIV").style.setProperty("opacity",0,"")}catch(oa){var aa=this.Element.prototype,ca=aa.setAttribute,la=aa.setAttributeNS,sa=this.CSSStyleDeclaration.prototype,fa=sa.setProperty;aa.setAttribute=function(n,t){ca.call(this,n,t+"")},aa.setAttributeNS=function(n,t,e){la.call(this,n,t,e+"")},sa.setProperty=function(n,t,e){fa.call(this,n,t+"",e)}}ta.ascending=e,ta.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},ta.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i;)if(null!=(r=n[u])&&r>=r){e=r;break}for(;++u<i;)null!=(r=n[u])&&e>r&&(e=r)}else{for(;++u<i;)if(null!=(r=t.call(n,n[u],u))&&r>=r){e=r;break}for(;++u<i;)null!=(r=t.call(n,n[u],u))&&e>r&&(e=r)}return e},ta.max=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i;)if(null!=(r=n[u])&&r>=r){e=r;break}for(;++u<i;)null!=(r=n[u])&&r>e&&(e=r)}else{for(;++u<i;)if(null!=(r=t.call(n,n[u],u))&&r>=r){e=r;break}for(;++u<i;)null!=(r=t.call(n,n[u],u))&&r>e&&(e=r)}return e},ta.extent=function(n,t){var e,r,u,i=-1,o=n.length;if(1===arguments.length){for(;++i<o;)if(null!=(r=n[i])&&r>=r){e=u=r;break}for(;++i<o;)null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r))}else{for(;++i<o;)if(null!=(r=t.call(n,n[i],i))&&r>=r){e=u=r;break}for(;++i<o;)null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r))}return[e,u]},ta.sum=function(n,t){var e,r=0,i=n.length,o=-1;if(1===arguments.length)for(;++o<i;)u(e=+n[o])&&(r+=e);else for(;++o<i;)u(e=+t.call(n,n[o],o))&&(r+=e);return r},ta.mean=function(n,t){var e,i=0,o=n.length,a=-1,c=o;if(1===arguments.length)for(;++a<o;)u(e=r(n[a]))?i+=e:--c;else for(;++a<o;)u(e=r(t.call(n,n[a],a)))?i+=e:--c;return c?i/c:void 0},ta.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;return i?u+i*(n[r]-u):u},ta.median=function(n,t){var i,o=[],a=n.length,c=-1;if(1===arguments.length)for(;++c<a;)u(i=r(n[c]))&&o.push(i);else for(;++c<a;)u(i=r(t.call(n,n[c],c)))&&o.push(i);return o.length?ta.quantile(o.sort(e),.5):void 0},ta.variance=function(n,t){var e,i,o=n.length,a=0,c=0,l=-1,s=0;if(1===arguments.length)for(;++l<o;)u(e=r(n[l]))&&(i=e-a,a+=i/++s,c+=i*(e-a));else for(;++l<o;)u(e=r(t.call(n,n[l],l)))&&(i=e-a,a+=i/++s,c+=i*(e-a));return s>1?c/(s-1):void 0},ta.deviation=function(){var n=ta.variance.apply(this,arguments);return n?Math.sqrt(n):n};var ha=i(e);ta.bisectLeft=ha.left,ta.bisect=ta.bisectRight=ha.right,ta.bisector=function(n){return i(1===n.length?function(t,r){return e(n(t),r)}:n)},ta.shuffle=function(n,t,e){(i=arguments.length)<3&&(e=n.length,2>i&&(t=0));for(var r,u,i=e-t;i;)u=Math.random()*i--|0,r=n[i+t],n[i+t]=n[u+t],n[u+t]=r;return n},ta.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},ta.pairs=function(n){for(var t,e=0,r=n.length-1,u=n[0],i=new Array(0>r?0:r);r>e;)i[e]=[t=u,u=n[++e]];return i},ta.zip=function(){if(!(r=arguments.length))return[];for(var n=-1,t=ta.min(arguments,o),e=new Array(t);++n<t;)for(var r,u=-1,i=e[n]=new Array(r);++u<r;)i[u]=arguments[u][n];return e},ta.transpose=function(n){return ta.zip.apply(ta,n)},ta.keys=function(n){var t=[];for(var e in n)t.push(e);return t},ta.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},ta.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},ta.merge=function(n){for(var t,e,r,u=n.length,i=-1,o=0;++i<u;)o+=n[i].length;for(e=new Array(o);--u>=0;)for(r=n[u],t=r.length;--t>=0;)e[--o]=r[t];return e};var ga=Math.abs;ta.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),(t-n)/e===1/0)throw new Error("infinite range");var r,u=[],i=a(ga(e)),o=-1;if(n*=i,t*=i,e*=i,0>e)for(;(r=n+e*++o)>t;)u.push(r/i);else for(;(r=n+e*++o)<t;)u.push(r/i);return u},ta.map=function(n,t){var e=new l;if(n instanceof l)n.forEach(function(n,t){e.set(n,t)});else if(Array.isArray(n)){var r,u=-1,i=n.length;if(1===arguments.length)for(;++u<i;)e.set(u,n[u]);else for(;++u<i;)e.set(t.call(n,r=n[u],u),r)}else for(var o in n)e.set(o,n[o]);return e};var pa="__proto__",va="\0";c(l,{has:h,get:function(n){return this._[s(n)]},set:function(n,t){return this._[s(n)]=t},remove:g,keys:p,values:function(){var n=[];for(var t in this._)n.push(this._[t]);return n},entries:function(){var n=[];for(var t in this._)n.push({key:f(t),value:this._[t]});return n},size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,f(t),this._[t])}}),ta.nest=function(){function n(t,o,a){if(a>=i.length)return r?r.call(u,o):e?o.sort(e):o;for(var c,s,f,h,g=-1,p=o.length,v=i[a++],d=new l;++g<p;)(h=d.get(c=v(s=o[g])))?h.push(s):d.set(c,[s]);return t?(s=t(),f=function(e,r){s.set(e,n(t,r,a))}):(s={},f=function(e,r){s[e]=n(t,r,a)}),d.forEach(f),s}function t(n,e){if(e>=i.length)return n;var r=[],u=o[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var e,r,u={},i=[],o=[];return u.map=function(t,e){return n(e,t,0)},u.entries=function(e){return t(n(ta.map,e,0),0)},u.key=function(n){return i.push(n),u},u.sortKeys=function(n){return o[i.length-1]=n,u},u.sortValues=function(n){return e=n,u},u.rollup=function(n){return r=n,u},u},ta.set=function(n){var t=new m;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},c(m,{has:h,add:function(n){return this._[s(n+="")]=!0,n},remove:g,values:p,size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,f(t))}}),ta.behavior={},ta.rebind=function(n,t){for(var e,r=1,u=arguments.length;++r<u;)n[e=arguments[r]]=M(n,t,t[e]);return n};var da=["webkit","ms","moz","Moz","o","O"];ta.dispatch=function(){for(var n=new _,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=w(n);return n},_.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.slice(e+1),n=n.slice(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},ta.event=null,ta.requote=function(n){return n.replace(ma,"\\$&")};var ma=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ya={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},Ma=function(n,t){return t.querySelector(n)},xa=function(n,t){return t.querySelectorAll(n)},ba=function(n,t){var e=n.matches||n[x(n,"matchesSelector")];return(ba=function(n,t){return e.call(n,t)})(n,t)};"function"==typeof Sizzle&&(Ma=function(n,t){return Sizzle(n,t)[0]||null},xa=Sizzle,ba=Sizzle.matchesSelector),ta.selection=function(){return ta.select(ua.documentElement)};var _a=ta.selection.prototype=[];_a.select=function(n){var t,e,r,u,i=[];n=N(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var c=-1,l=r.length;++c<l;)(u=r[c])?(t.push(e=n.call(u,u.__data__,c,o)),e&&"__data__"in u&&(e.__data__=u.__data__)):t.push(null)}return A(i)},_a.selectAll=function(n){var t,e,r=[];n=C(n);for(var u=-1,i=this.length;++u<i;)for(var o=this[u],a=-1,c=o.length;++a<c;)(e=o[a])&&(r.push(t=ra(n.call(e,e.__data__,a,u))),t.parentNode=e);return A(r)};var wa={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ta.ns={prefix:wa,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.slice(0,t),n=n.slice(t+1)),wa.hasOwnProperty(e)?{space:wa[e],local:n}:n}},_a.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=ta.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(z(t,n[t]));return this}return this.each(z(n,t))},_a.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=T(n)).length,u=-1;if(t=e.classList){for(;++u<r;)if(!t.contains(n[u]))return!1}else for(t=e.getAttribute("class");++u<r;)if(!L(n[u]).test(t))return!1;return!0}for(t in n)this.each(R(t,n[t]));return this}return this.each(R(n,t))},_a.style=function(n,e,r){var u=arguments.length;if(3>u){if("string"!=typeof n){2>u&&(e="");for(r in n)this.each(P(r,n[r],e));return this}if(2>u){var i=this.node();return t(i).getComputedStyle(i,null).getPropertyValue(n)}r=""}return this.each(P(n,e,r))},_a.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(U(t,n[t]));return this}return this.each(U(n,t))},_a.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},_a.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},_a.append=function(n){return n=j(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},_a.insert=function(n,t){return n=j(n),t=N(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},_a.remove=function(){return this.each(F)},_a.data=function(n,t){function e(n,e){var r,u,i,o=n.length,f=e.length,h=Math.min(o,f),g=new Array(f),p=new Array(f),v=new Array(o);if(t){var d,m=new l,y=new Array(o);for(r=-1;++r<o;)m.has(d=t.call(u=n[r],u.__data__,r))?v[r]=u:m.set(d,u),y[r]=d;for(r=-1;++r<f;)(u=m.get(d=t.call(e,i=e[r],r)))?u!==!0&&(g[r]=u,u.__data__=i):p[r]=H(i),m.set(d,!0);for(r=-1;++r<o;)m.get(y[r])!==!0&&(v[r]=n[r])}else{for(r=-1;++r<h;)u=n[r],i=e[r],u?(u.__data__=i,g[r]=u):p[r]=H(i);for(;f>r;++r)p[r]=H(e[r]);for(;o>r;++r)v[r]=n[r]}p.update=g,p.parentNode=g.parentNode=v.parentNode=n.parentNode,a.push(p),c.push(g),s.push(v)}var r,u,i=-1,o=this.length;if(!arguments.length){for(n=new Array(o=(r=this[0]).length);++i<o;)(u=r[i])&&(n[i]=u.__data__);return n}var a=Z([]),c=A([]),s=A([]);if("function"==typeof n)for(;++i<o;)e(r=this[i],n.call(r,r.parentNode.__data__,i));else for(;++i<o;)e(r=this[i],n);return c.enter=function(){return a},c.exit=function(){return s},c},_a.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},_a.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=O(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;for(var a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return A(u)},_a.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;)(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},_a.sort=function(n){n=I.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},_a.each=function(n){return Y(this,function(t,e,r){n.call(t,t.__data__,e,r)})},_a.call=function(n){var t=ra(arguments);return n.apply(t[0]=this,t),this},_a.empty=function(){return!this.node()},_a.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];if(i)return i}return null},_a.size=function(){var n=0;return Y(this,function(){++n}),n};var Sa=[];ta.selection.enter=Z,ta.selection.enter.prototype=Sa,Sa.append=_a.append,Sa.empty=_a.empty,Sa.node=_a.node,Sa.call=_a.call,Sa.size=_a.size,Sa.select=function(n){for(var t,e,r,u,i,o=[],a=-1,c=this.length;++a<c;){r=(u=this[a]).update,o.push(t=[]),t.parentNode=u.parentNode;for(var l=-1,s=u.length;++l<s;)(i=u[l])?(t.push(r[l]=e=n.call(u.parentNode,i.__data__,l,a)),e.__data__=i.__data__):t.push(null)}return A(o)},Sa.insert=function(n,t){return arguments.length<2&&(t=V(this)),_a.insert.call(this,n,t)},ta.select=function(t){var e;return"string"==typeof t?(e=[Ma(t,ua)],e.parentNode=ua.documentElement):(e=[t],e.parentNode=n(t)),A([e])},ta.selectAll=function(n){var t;return"string"==typeof n?(t=ra(xa(n,ua)),t.parentNode=ua.documentElement):(t=n,t.parentNode=null),A([t])},_a.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(X(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(X(n,t,e))};var ka=ta.map({mouseenter:"mouseover",mouseleave:"mouseout"});ua&&ka.forEach(function(n){"on"+n in ua&&ka.remove(n)});var Ea,Aa=0;ta.mouse=function(n){return J(n,k())};var Na=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ta.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=k().changedTouches),t)for(var r,u=0,i=t.length;i>u;++u)if((r=t[u]).identifier===e)return J(n,r)},ta.behavior.drag=function(){function n(){this.on("mousedown.drag",i).on("touchstart.drag",o)}function e(n,t,e,i,o){return function(){function a(){var n,e,r=t(h,v);r&&(n=r[0]-M[0],e=r[1]-M[1],p|=n|e,M=r,g({type:"drag",x:r[0]+l[0],y:r[1]+l[1],dx:n,dy:e}))}function c(){t(h,v)&&(m.on(i+d,null).on(o+d,null),y(p&&ta.event.target===f),g({type:"dragend"}))}var l,s=this,f=ta.event.target,h=s.parentNode,g=r.of(s,arguments),p=0,v=n(),d=".drag"+(null==v?"":"-"+v),m=ta.select(e(f)).on(i+d,a).on(o+d,c),y=W(f),M=t(h,v);u?(l=u.apply(s,arguments),l=[l.x-M[0],l.y-M[1]]):l=[0,0],g({type:"dragstart"})}}var r=E(n,"drag","dragstart","dragend"),u=null,i=e(b,ta.mouse,t,"mousemove","mouseup"),o=e(G,ta.touch,y,"touchmove","touchend");return n.origin=function(t){return arguments.length?(u=t,n):u},ta.rebind(n,r,"on")},ta.touches=function(n,t){return arguments.length<2&&(t=k().touches),t?ra(t).map(function(t){var e=J(n,t);return e.identifier=t.identifier,e}):[]};var Ca=1e-6,za=Ca*Ca,qa=Math.PI,La=2*qa,Ta=La-Ca,Ra=qa/2,Da=qa/180,Pa=180/qa,Ua=Math.SQRT2,ja=2,Fa=4;ta.interpolateZoom=function(n,t){function e(n){var t=n*y;if(m){var e=rt(v),o=i/(ja*h)*(e*ut(Ua*t+v)-et(v));return[r+o*l,u+o*s,i*e/rt(Ua*t+v)]}return[r+n*l,u+n*s,i*Math.exp(Ua*t)]}var r=n[0],u=n[1],i=n[2],o=t[0],a=t[1],c=t[2],l=o-r,s=a-u,f=l*l+s*s,h=Math.sqrt(f),g=(c*c-i*i+Fa*f)/(2*i*ja*h),p=(c*c-i*i-Fa*f)/(2*c*ja*h),v=Math.log(Math.sqrt(g*g+1)-g),d=Math.log(Math.sqrt(p*p+1)-p),m=d-v,y=(m||Math.log(c/i))/Ua;return e.duration=1e3*y,e},ta.behavior.zoom=function(){function n(n){n.on(q,f).on(Oa+".zoom",g).on("dblclick.zoom",p).on(R,h)}function e(n){return[(n[0]-k.x)/k.k,(n[1]-k.y)/k.k]}function r(n){return[n[0]*k.k+k.x,n[1]*k.k+k.y]}function u(n){k.k=Math.max(N[0],Math.min(N[1],n))}function i(n,t){t=r(t),k.x+=n[0]-t[0],k.y+=n[1]-t[1]}function o(t,e,r,o){t.__chart__={x:k.x,y:k.y,k:k.k},u(Math.pow(2,o)),i(d=e,r),t=ta.select(t),C>0&&(t=t.transition().duration(C)),t.call(n.event)}function a(){b&&b.domain(x.range().map(function(n){return(n-k.x)/k.k}).map(x.invert)),w&&w.domain(_.range().map(function(n){return(n-k.y)/k.k}).map(_.invert))}function c(n){z++||n({type:"zoomstart"})}function l(n){a(),n({type:"zoom",scale:k.k,translate:[k.x,k.y]})}function s(n){--z||n({type:"zoomend"}),d=null}function f(){function n(){f=1,i(ta.mouse(u),g),l(a)}function r(){h.on(L,null).on(T,null),p(f&&ta.event.target===o),s(a)}var u=this,o=ta.event.target,a=D.of(u,arguments),f=0,h=ta.select(t(u)).on(L,n).on(T,r),g=e(ta.mouse(u)),p=W(u);Dl.call(u),c(a)}function h(){function n(){var n=ta.touches(p);return g=k.k,n.forEach(function(n){n.identifier in d&&(d[n.identifier]=e(n))}),n}function t(){var t=ta.event.target;ta.select(t).on(x,r).on(b,a),_.push(t);for(var e=ta.event.changedTouches,u=0,i=e.length;i>u;++u)d[e[u].identifier]=null;var c=n(),l=Date.now();if(1===c.length){if(500>l-M){var s=c[0];o(p,s,d[s.identifier],Math.floor(Math.log(k.k)/Math.LN2)+1),S()}M=l}else if(c.length>1){var s=c[0],f=c[1],h=s[0]-f[0],g=s[1]-f[1];m=h*h+g*g}}function r(){var n,t,e,r,o=ta.touches(p);Dl.call(p);for(var a=0,c=o.length;c>a;++a,r=null)if(e=o[a],r=d[e.identifier]){if(t)break;n=e,t=r}if(r){var s=(s=e[0]-n[0])*s+(s=e[1]-n[1])*s,f=m&&Math.sqrt(s/m);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+r[0])/2,(t[1]+r[1])/2],u(f*g)}M=null,i(n,t),l(v)}function a(){if(ta.event.touches.length){for(var t=ta.event.changedTouches,e=0,r=t.length;r>e;++e)delete d[t[e].identifier];for(var u in d)return void n()}ta.selectAll(_).on(y,null),w.on(q,f).on(R,h),E(),s(v)}var g,p=this,v=D.of(p,arguments),d={},m=0,y=".zoom-"+ta.event.changedTouches[0].identifier,x="touchmove"+y,b="touchend"+y,_=[],w=ta.select(p),E=W(p);t(),c(v),w.on(q,null).on(R,t)}function g(){var n=D.of(this,arguments);y?clearTimeout(y):(v=e(d=m||ta.mouse(this)),Dl.call(this),c(n)),y=setTimeout(function(){y=null,s(n)},50),S(),u(Math.pow(2,.002*Ha())*k.k),i(d,v),l(n)}function p(){var n=ta.mouse(this),t=Math.log(k.k)/Math.LN2;o(this,n,e(n),ta.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1)}var v,d,m,y,M,x,b,_,w,k={x:0,y:0,k:1},A=[960,500],N=Ia,C=250,z=0,q="mousedown.zoom",L="mousemove.zoom",T="mouseup.zoom",R="touchstart.zoom",D=E(n,"zoomstart","zoom","zoomend");return Oa||(Oa="onwheel"in ua?(Ha=function(){return-ta.event.deltaY*(ta.event.deltaMode?120:1)},"wheel"):"onmousewheel"in ua?(Ha=function(){return ta.event.wheelDelta},"mousewheel"):(Ha=function(){return-ta.event.detail},"MozMousePixelScroll")),n.event=function(n){n.each(function(){var n=D.of(this,arguments),t=k;Tl?ta.select(this).transition().each("start.zoom",function(){k=this.__chart__||{x:0,y:0,k:1},c(n)}).tween("zoom:zoom",function(){var e=A[0],r=A[1],u=d?d[0]:e/2,i=d?d[1]:r/2,o=ta.interpolateZoom([(u-k.x)/k.k,(i-k.y)/k.k,e/k.k],[(u-t.x)/t.k,(i-t.y)/t.k,e/t.k]);return function(t){var r=o(t),a=e/r[2];this.__chart__=k={x:u-r[0]*a,y:i-r[1]*a,k:a},l(n)}}).each("interrupt.zoom",function(){s(n)}).each("end.zoom",function(){s(n)}):(this.__chart__=k,c(n),l(n),s(n))})},n.translate=function(t){return arguments.length?(k={x:+t[0],y:+t[1],k:k.k},a(),n):[k.x,k.y]},n.scale=function(t){return arguments.length?(k={x:k.x,y:k.y,k:+t},a(),n):k.k},n.scaleExtent=function(t){return arguments.length?(N=null==t?Ia:[+t[0],+t[1]],n):N},n.center=function(t){return arguments.length?(m=t&&[+t[0],+t[1]],n):m},n.size=function(t){return arguments.length?(A=t&&[+t[0],+t[1]],n):A},n.duration=function(t){return arguments.length?(C=+t,n):C},n.x=function(t){return arguments.length?(b=t,x=t.copy(),k={x:0,y:0,k:1},n):b},n.y=function(t){return arguments.length?(w=t,_=t.copy(),k={x:0,y:0,k:1},n):w},ta.rebind(n,D,"on")};var Ha,Oa,Ia=[0,1/0];ta.color=ot,ot.prototype.toString=function(){return this.rgb()+""},ta.hsl=at;var Ya=at.prototype=new ot;Ya.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),new at(this.h,this.s,this.l/n)},Ya.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new at(this.h,this.s,n*this.l)},Ya.rgb=function(){return ct(this.h,this.s,this.l)},ta.hcl=lt;var Za=lt.prototype=new ot;Za.brighter=function(n){return new lt(this.h,this.c,Math.min(100,this.l+Va*(arguments.length?n:1)))},Za.darker=function(n){return new lt(this.h,this.c,Math.max(0,this.l-Va*(arguments.length?n:1)))},Za.rgb=function(){return st(this.h,this.c,this.l).rgb()},ta.lab=ft;var Va=18,Xa=.95047,$a=1,Ba=1.08883,Wa=ft.prototype=new ot;Wa.brighter=function(n){return new ft(Math.min(100,this.l+Va*(arguments.length?n:1)),this.a,this.b)},Wa.darker=function(n){return new ft(Math.max(0,this.l-Va*(arguments.length?n:1)),this.a,this.b)},Wa.rgb=function(){return ht(this.l,this.a,this.b)},ta.rgb=mt;var Ja=mt.prototype=new ot;Ja.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),new mt(Math.min(255,t/n),Math.min(255,e/n),Math.min(255,r/n))):new mt(u,u,u)},Ja.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new mt(n*this.r,n*this.g,n*this.b)},Ja.hsl=function(){return _t(this.r,this.g,this.b)},Ja.toString=function(){return"#"+xt(this.r)+xt(this.g)+xt(this.b)};var Ga=ta.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Ga.forEach(function(n,t){Ga.set(n,yt(t))}),ta.functor=Et,ta.xhr=At(y),ta.dsv=function(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);var o=Nt(n,t,null==e?r:u(e),i);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:u(n)):e},o}function r(n){return e.parse(n.responseText)}function u(n){return function(t){return e.parse(t.responseText,n)}}function i(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),c=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(u(n),e)}:u})},e.parseRows=function(n,t){function e(){if(s>=l)return o;if(u)return u=!1,i;var t=s;if(34===n.charCodeAt(t)){for(var e=t;e++<l;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}s=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++s):10===r&&(u=!0),n.slice(t+1,e).replace(/""/g,'"')}for(;l>s;){var r=n.charCodeAt(s++),a=1;if(10===r)u=!0;else if(13===r)u=!0,10===n.charCodeAt(s)&&(++s,++a);else if(r!==c)continue;return n.slice(t,s-a)}return n.slice(t)}for(var r,u,i={},o={},a=[],l=n.length,s=0,f=0;(r=e())!==o;){for(var h=[];r!==i&&r!==o;)h.push(r),r=e();t&&null==(h=t(h,f++))||a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new m,u=[];return t.forEach(function(n){for(var t in n)r.has(t)||u.push(r.add(t))}),[u.map(o).join(n)].concat(t.map(function(t){return u.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(i).join("\n")},e},ta.csv=ta.dsv(",","text/csv"),ta.tsv=ta.dsv("\t","text/tab-separated-values");var Ka,Qa,nc,tc,ec,rc=this[x(this,"requestAnimationFrame")]||function(n){setTimeout(n,17)};ta.timer=function(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var u=e+t,i={c:n,t:u,f:!1,n:null};Qa?Qa.n=i:Ka=i,Qa=i,nc||(tc=clearTimeout(tc),nc=1,rc(qt))},ta.timer.flush=function(){Lt(),Tt()},ta.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var uc=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Dt);ta.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=ta.round(n,Rt(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),uc[8+e/3]};var ic=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,oc=ta.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=ta.round(n,Rt(n,t))).toFixed(Math.max(0,Math.min(20,Rt(n*(1+1e-15),t))))}}),ac=ta.time={},cc=Date;jt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){lc.setUTCDate.apply(this._,arguments)},setDay:function(){lc.setUTCDay.apply(this._,arguments)},setFullYear:function(){lc.setUTCFullYear.apply(this._,arguments)},setHours:function(){lc.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){lc.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){lc.setUTCMinutes.apply(this._,arguments)},setMonth:function(){lc.setUTCMonth.apply(this._,arguments)},setSeconds:function(){lc.setUTCSeconds.apply(this._,arguments)},setTime:function(){lc.setTime.apply(this._,arguments)}};var lc=Date.prototype;ac.year=Ft(function(n){return n=ac.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),ac.years=ac.year.range,ac.years.utc=ac.year.utc.range,ac.day=Ft(function(n){var t=new cc(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),ac.days=ac.day.range,ac.days.utc=ac.day.utc.range,ac.dayOfYear=function(n){var t=ac.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var e=ac[n]=Ft(function(n){return(n=ac.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=ac.year(n).getDay();return Math.floor((ac.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});ac[n+"s"]=e.range,ac[n+"s"].utc=e.utc.range,ac[n+"OfYear"]=function(n){var e=ac.year(n).getDay();return Math.floor((ac.dayOfYear(n)+(e+t)%7)/7)}}),ac.week=ac.sunday,ac.weeks=ac.sunday.range,ac.weeks.utc=ac.sunday.utc.range,ac.weekOfYear=ac.sundayOfYear;var sc={"-":"",_:" ",0:"0"},fc=/^\s*\d+/,hc=/^%/;ta.locale=function(n){return{numberFormat:Pt(n),timeFormat:Ot(n)}};var gc=ta.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],shortMonths:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]});ta.format=gc.numberFormat,ta.geo={},ce.prototype={s:0,t:0,add:function(n){le(n,this.t,pc),le(pc.s,this.s,this),this.s?this.t+=pc.t:this.s=pc.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var pc=new ce;ta.geo.stream=function(n,t){n&&vc.hasOwnProperty(n.type)?vc[n.type](n,t):se(n,t)};var vc={Feature:function(n,t){se(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;++r<u;)se(e[r].geometry,t)}},dc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){fe(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)fe(e[r],t,0)},Polygon:function(n,t){he(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)he(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;)se(e[r],t)}};ta.geo.area=function(n){return mc=0,ta.geo.stream(n,Mc),mc};var mc,yc=new ce,Mc={sphere:function(){mc+=4*qa},point:b,lineStart:b,lineEnd:b,polygonStart:function(){yc.reset(),Mc.lineStart=ge},polygonEnd:function(){var n=2*yc;mc+=0>n?4*qa+n:n,Mc.lineStart=Mc.lineEnd=Mc.point=b}};ta.geo.bounds=function(){function n(n,t){M.push(x=[s=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,e){var r=pe([t*Da,e*Da]);if(m){var u=de(m,r),i=[u[1],-u[0],0],o=de(i,u);Me(o),o=xe(o);var c=t-p,l=c>0?1:-1,v=o[0]*Pa*l,d=ga(c)>180;if(d^(v>l*p&&l*t>v)){var y=o[1]*Pa;y>g&&(g=y)}else if(v=(v+360)%360-180,d^(v>l*p&&l*t>v)){var y=-o[1]*Pa;f>y&&(f=y)}else f>e&&(f=e),e>g&&(g=e);d?p>t?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t):h>=s?(s>t&&(s=t),t>h&&(h=t)):t>p?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t)}else n(t,e);m=r,p=t}function e(){b.point=t}function r(){x[0]=s,x[1]=h,b.point=n,m=null}function u(n,e){if(m){var r=n-p;y+=ga(r)>180?r+(r>0?360:-360):r}else v=n,d=e;Mc.point(n,e),t(n,e)}function i(){Mc.lineStart()}function o(){u(v,d),Mc.lineEnd(),ga(y)>Ca&&(s=-(h=180)),x[0]=s,x[1]=h,m=null}function a(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function l(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var s,f,h,g,p,v,d,m,y,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=u,b.lineStart=i,b.lineEnd=o,y=0,Mc.polygonStart()},polygonEnd:function(){Mc.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,0>yc?(s=-(h=180),f=-(g=90)):y>Ca?g=90:-Ca>y&&(f=-90),x[0]=s,x[1]=h}};return function(n){g=h=-(s=f=1/0),M=[],ta.geo.stream(n,b);var t=M.length;if(t){M.sort(c);for(var e,r=1,u=M[0],i=[u];t>r;++r)e=M[r],l(e[0],u)||l(e[1],u)?(a(u[0],e[1])>a(u[0],u[1])&&(u[1]=e[1]),a(e[0],u[1])>a(u[0],u[1])&&(u[0]=e[0])):i.push(u=e);for(var o,e,p=-1/0,t=i.length-1,r=0,u=i[t];t>=r;u=e,++r)e=i[r],(o=a(u[1],e[0]))>p&&(p=o,s=e[0],h=u[1])}return M=x=null,1/0===s||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[s,f],[h,g]]}}(),ta.geo.centroid=function(n){xc=bc=_c=wc=Sc=kc=Ec=Ac=Nc=Cc=zc=0,ta.geo.stream(n,qc);var t=Nc,e=Cc,r=zc,u=t*t+e*e+r*r;return za>u&&(t=kc,e=Ec,r=Ac,Ca>bc&&(t=_c,e=wc,r=Sc),u=t*t+e*e+r*r,za>u)?[0/0,0/0]:[Math.atan2(e,t)*Pa,tt(r/Math.sqrt(u))*Pa]};var xc,bc,_c,wc,Sc,kc,Ec,Ac,Nc,Cc,zc,qc={sphere:b,point:_e,lineStart:Se,lineEnd:ke,polygonStart:function(){qc.lineStart=Ee},polygonEnd:function(){qc.lineStart=Se}},Lc=Le(Ne,Pe,je,[-qa,-qa/2]),Tc=1e9;ta.geo.clipExtent=function(){var n,t,e,r,u,i,o={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u},extent:function(a){return arguments.length?(i=Ie(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),u&&(u.valid=!1,u=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(ta.geo.conicEqualArea=function(){return Ye(Ze)}).raw=Ze,ta.geo.albers=function(){return ta.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ta.geo.albersUsa=function(){function n(n){var i=n[0],o=n[1];return t=null,e(i,o),t||(r(i,o),t)||u(i,o),t}var t,e,r,u,i=ta.geo.albers(),o=ta.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=ta.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=i.scale(),e=i.translate(),r=(n[0]-e[0])/t,u=(n[1]-e[1])/t;return(u>=.12&&.234>u&&r>=-.425&&-.214>r?o:u>=.166&&.234>u&&r>=-.214&&-.115>r?a:i).invert(n)},n.stream=function(n){var t=i.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,u){t.point(n,u),e.point(n,u),r.point(n,u)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),a.precision(t),n):i.precision()},n.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),a.scale(t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var l=i.scale(),s=+t[0],f=+t[1];return e=i.translate(t).clipExtent([[s-.455*l,f-.238*l],[s+.455*l,f+.238*l]]).stream(c).point,r=o.translate([s-.307*l,f+.201*l]).clipExtent([[s-.425*l+Ca,f+.12*l+Ca],[s-.214*l-Ca,f+.234*l-Ca]]).stream(c).point,u=a.translate([s-.205*l,f+.212*l]).clipExtent([[s-.214*l+Ca,f+.166*l+Ca],[s-.115*l-Ca,f+.234*l-Ca]]).stream(c).point,n},n.scale(1070)};var Rc,Dc,Pc,Uc,jc,Fc,Hc={point:b,lineStart:b,lineEnd:b,polygonStart:function(){Dc=0,Hc.lineStart=Ve},polygonEnd:function(){Hc.lineStart=Hc.lineEnd=Hc.point=b,Rc+=ga(Dc/2)}},Oc={point:Xe,lineStart:b,lineEnd:b,polygonStart:b,polygonEnd:b},Ic={point:We,lineStart:Je,lineEnd:Ge,polygonStart:function(){Ic.lineStart=Ke},polygonEnd:function(){Ic.point=We,Ic.lineStart=Je,Ic.lineEnd=Ge}};ta.geo.path=function(){function n(n){return n&&("function"==typeof a&&i.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=u(i)),ta.geo.stream(n,o)),i.result()}function t(){return o=null,n}var e,r,u,i,o,a=4.5;return n.area=function(n){return Rc=0,ta.geo.stream(n,u(Hc)),Rc},n.centroid=function(n){return _c=wc=Sc=kc=Ec=Ac=Nc=Cc=zc=0,ta.geo.stream(n,u(Ic)),zc?[Nc/zc,Cc/zc]:Ac?[kc/Ac,Ec/Ac]:Sc?[_c/Sc,wc/Sc]:[0/0,0/0]},n.bounds=function(n){return jc=Fc=-(Pc=Uc=1/0),ta.geo.stream(n,u(Oc)),[[Pc,Uc],[jc,Fc]]},n.projection=function(n){return arguments.length?(u=(e=n)?n.stream||tr(n):y,t()):e},n.context=function(n){return arguments.length?(i=null==(r=n)?new $e:new Qe(n),"function"!=typeof a&&i.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(i.pointRadius(+t),+t),n):a},n.projection(ta.geo.albersUsa()).context(null)},ta.geo.transform=function(n){return{stream:function(t){var e=new er(t);for(var r in n)e[r]=n[r];return e}}},er.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ta.geo.projection=ur,ta.geo.projectionMutator=ir,(ta.geo.equirectangular=function(){return ur(ar)}).raw=ar.invert=ar,ta.geo.rotation=function(n){function t(t){return t=n(t[0]*Da,t[1]*Da),t[0]*=Pa,t[1]*=Pa,t}return n=lr(n[0]%360*Da,n[1]*Da,n.length>2?n[2]*Da:0),t.invert=function(t){return t=n.invert(t[0]*Da,t[1]*Da),t[0]*=Pa,t[1]*=Pa,t},t},cr.invert=ar,ta.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=lr(-n[0]*Da,-n[1]*Da,0).invert,u=[];return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=Pa,n[1]*=Pa}}),{type:"Polygon",coordinates:[u]}}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=gr((t=+r)*Da,u*Da),n):t},n.precision=function(r){return arguments.length?(e=gr(t*Da,(u=+r)*Da),n):u},n.angle(90)},ta.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Da,u=n[1]*Da,i=t[1]*Da,o=Math.sin(r),a=Math.cos(r),c=Math.sin(u),l=Math.cos(u),s=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((e=f*o)*e+(e=l*s-c*f*a)*e),c*s+l*f*a)},ta.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return ta.range(Math.ceil(i/d)*d,u,d).map(h).concat(ta.range(Math.ceil(l/m)*m,c,m).map(g)).concat(ta.range(Math.ceil(r/p)*p,e,p).filter(function(n){return ga(n%d)>Ca}).map(s)).concat(ta.range(Math.ceil(a/v)*v,o,v).filter(function(n){return ga(n%m)>Ca}).map(f))}var e,r,u,i,o,a,c,l,s,f,h,g,p=10,v=p,d=90,m=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(l).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],l=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),l>c&&(t=l,l=c,c=t),n.precision(y)):[[i,l],[u,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(y)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],m=+t[1],n):[d,m]},n.minorStep=function(t){return arguments.length?(p=+t[0],v=+t[1],n):[p,v]},n.precision=function(t){return arguments.length?(y=+t,s=vr(a,o,90),f=dr(r,e,y),h=vr(l,c,90),g=dr(i,u,y),n):y},n.majorExtent([[-180,-90+Ca],[180,90-Ca]]).minorExtent([[-180,-80-Ca],[180,80+Ca]])},ta.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]}}var t,e,r=mr,u=yr;return n.distance=function(){return ta.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},ta.geo.interpolate=function(n,t){return Mr(n[0]*Da,n[1]*Da,t[0]*Da,t[1]*Da)},ta.geo.length=function(n){return Yc=0,ta.geo.stream(n,Zc),Yc};var Yc,Zc={sphere:b,point:b,lineStart:xr,lineEnd:b,polygonStart:b,polygonEnd:b},Vc=br(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(ta.geo.azimuthalEqualArea=function(){return ur(Vc)}).raw=Vc;var Xc=br(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},y);(ta.geo.azimuthalEquidistant=function(){return ur(Xc)}).raw=Xc,(ta.geo.conicConformal=function(){return Ye(_r)}).raw=_r,(ta.geo.conicEquidistant=function(){return Ye(wr)}).raw=wr;var $c=br(function(n){return 1/n},Math.atan);(ta.geo.gnomonic=function(){return ur($c)}).raw=$c,Sr.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Ra]},(ta.geo.mercator=function(){return kr(Sr)}).raw=Sr;var Bc=br(function(){return 1},Math.asin);(ta.geo.orthographic=function(){return ur(Bc)}).raw=Bc;var Wc=br(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(ta.geo.stereographic=function(){return ur(Wc)}).raw=Wc,Er.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-Ra]},(ta.geo.transverseMercator=function(){var n=kr(Er),t=n.center,e=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},n.rotate=function(n){return n?e([n[0],n[1],n.length>2?n[2]+90:90]):(n=e(),[n[0],n[1],n[2]-90])},e([0,0,90])}).raw=Er,ta.geom={},ta.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u=Et(e),i=Et(r),o=n.length,a=[],c=[];for(t=0;o>t;t++)a.push([+u.call(this,n[t],t),+i.call(this,n[t],t),t]);for(a.sort(zr),t=0;o>t;t++)c.push([a[t][0],-a[t][1]]);var l=Cr(a),s=Cr(c),f=s[0]===l[0],h=s[s.length-1]===l[l.length-1],g=[];for(t=l.length-1;t>=0;--t)g.push(n[a[l[t]][2]]);for(t=+f;t<s.length-h;++t)g.push(n[a[s[t]][2]]);return g}var e=Ar,r=Nr;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},ta.geom.polygon=function(n){return ya(n,Jc),n};var Jc=ta.geom.polygon.prototype=[];Jc.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],u=0;++t<e;)n=r,r=this[t],u+=n[1]*r[0]-n[0]*r[1];return.5*u},Jc.centroid=function(n){var t,e,r=-1,u=this.length,i=0,o=0,a=this[u-1];for(arguments.length||(n=-1/(6*this.area()));++r<u;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],i+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[i*n,o*n]},Jc.clip=function(n){for(var t,e,r,u,i,o,a=Tr(n),c=-1,l=this.length-Tr(this),s=this[l-1];++c<l;){for(t=n.slice(),n.length=0,u=this[c],i=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],qr(o,s,u)?(qr(i,s,u)||n.push(Lr(i,o,s,u)),n.push(o)):qr(i,s,u)&&n.push(Lr(i,o,s,u)),i=o;a&&n.push(n[0]),s=u}return n};var Gc,Kc,Qc,nl,tl,el=[],rl=[];Or.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)n=t[e].edge,n.b&&n.a||t.splice(e,1);return t.sort(Yr),t.length},Qr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},nu.prototype={insert:function(n,t){var e,r,u;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else this._?(n=uu(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)r=e.U,e===r.L?(u=r.R,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.R&&(eu(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ru(this,r))):(u=r.L,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.L&&(ru(this,e),n=e,e=n.U),e.C=!1,r.C=!0,eu(this,r))),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,u=n.U,i=n.L,o=n.R;if(e=i?o?uu(o):i:o,u?u.L===n?u.L=e:u.R=e:this._=e,i&&o?(r=e.C,e.C=n.C,e.L=i,i.U=e,e!==o?(u=e.U,e.U=n.U,n=e.R,u.L=n,e.R=o,o.U=e):(e.U=u,u=e,n=e.R)):(r=n.C,n=e),n&&(n.U=u),!r){if(n&&n.C)return void(n.C=!1);do{if(n===this._)break;if(n===u.L){if(t=u.R,t.C&&(t.C=!1,u.C=!0,eu(this,u),t=u.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ru(this,t),t=u.R),t.C=u.C,u.C=t.R.C=!1,eu(this,u),n=this._;break}}else if(t=u.L,t.C&&(t.C=!1,u.C=!0,ru(this,u),t=u.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,eu(this,t),t=u.L),t.C=u.C,u.C=t.L.C=!1,ru(this,u),n=this._;break}t.C=!0,n=u,u=u.U}while(!n.C);n&&(n.C=!1)}}},ta.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],u=a[0][1],i=a[1][0],o=a[1][1];return iu(e(n),a).cells.forEach(function(e,a){var c=e.edges,l=e.site,s=t[a]=c.length?c.map(function(n){var t=n.start();return[t.x,t.y]}):l.x>=r&&l.x<=i&&l.y>=u&&l.y<=o?[[r,o],[i,o],[i,u],[r,u]]:[];s.point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(i(n,t)/Ca)*Ca,y:Math.round(o(n,t)/Ca)*Ca,i:t}})}var r=Ar,u=Nr,i=r,o=u,a=ul;return n?t(n):(t.links=function(n){return iu(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return iu(e(n)).cells.forEach(function(e,r){for(var u,i,o=e.site,a=e.edges.sort(Yr),c=-1,l=a.length,s=a[l-1].edge,f=s.l===o?s.r:s.l;++c<l;)u=s,i=f,s=a[c].edge,f=s.l===o?s.r:s.l,r<i.i&&r<f.i&&au(o,i,f)<0&&t.push([n[r],n[i.i],n[f.i]])}),t},t.x=function(n){return arguments.length?(i=Et(r=n),t):r},t.y=function(n){return arguments.length?(o=Et(u=n),t):u},t.clipExtent=function(n){return arguments.length?(a=null==n?ul:n,t):a===ul?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===ul?null:a&&a[1]},t)};var ul=[[-1e6,-1e6],[1e6,1e6]];ta.geom.delaunay=function(n){return ta.geom.voronoi().triangles(n)},ta.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,s=n.y;if(null!=c)if(ga(c-e)+ga(s-r)<.01)l(n,t,e,r,u,i,o,a);else{var f=n.point;n.x=n.y=n.point=null,l(n,f,c,s,u,i,o,a),l(n,t,e,r,u,i,o,a)}else n.x=e,n.y=r,n.point=t}else l(n,t,e,r,u,i,o,a)}function l(n,t,e,r,u,o,a,c){var l=.5*(u+a),s=.5*(o+c),f=e>=l,h=r>=s,g=h<<1|f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=su()),f?u=l:a=l,h?o=s:c=s,i(n,t,e,r,u,o,a,c)}var s,f,h,g,p,v,d,m,y,M=Et(a),x=Et(c);if(null!=t)v=t,d=e,m=r,y=u;else if(m=y=-(v=d=1/0),f=[],h=[],p=n.length,o)for(g=0;p>g;++g)s=n[g],s.x<v&&(v=s.x),s.y<d&&(d=s.y),s.x>m&&(m=s.x),s.y>y&&(y=s.y),f.push(s.x),h.push(s.y);else for(g=0;p>g;++g){var b=+M(s=n[g],g),_=+x(s,g);v>b&&(v=b),d>_&&(d=_),b>m&&(m=b),_>y&&(y=_),f.push(b),h.push(_)}var w=m-v,S=y-d;w>S?y=d+w:m=v+S;var k=su();if(k.add=function(n){i(k,n,+M(n,++g),+x(n,g),v,d,m,y)},k.visit=function(n){fu(n,k,v,d,m,y)},k.find=function(n){return hu(k,n[0],n[1],v,d,m,y)},g=-1,null==t){for(;++g<p;)i(k,n[g],f[g],h[g],v,d,m,y);--g}else n.forEach(k.add);return f=h=n=s=null,k}var o,a=Ar,c=Nr;return(o=arguments.length)?(a=cu,c=lu,3===o&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(a=n,i):a},i.y=function(n){return arguments.length?(c=n,i):c},i.extent=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,e],[r,u]]},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r-t,u-e]},i)},ta.interpolateRgb=gu,ta.interpolateObject=pu,ta.interpolateNumber=vu,ta.interpolateString=du;var il=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ol=new RegExp(il.source,"g");ta.interpolate=mu,ta.interpolators=[function(n,t){var e=typeof t;return("string"===e?Ga.has(t)||/^(#|rgb\(|hsl\()/.test(t)?gu:du:t instanceof ot?gu:Array.isArray(t)?yu:"object"===e&&isNaN(t)?pu:vu)(n,t)}],ta.interpolateArray=yu;var al=function(){return y},cl=ta.map({linear:al,poly:ku,quad:function(){return _u},cubic:function(){return wu},sin:function(){return Eu},exp:function(){return Au},circle:function(){return Nu},elastic:Cu,back:zu,bounce:function(){return qu}}),ll=ta.map({in:y,out:xu,"in-out":bu,"out-in":function(n){return bu(xu(n))}});ta.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.slice(0,t):n,r=t>=0?n.slice(t+1):"in";return e=cl.get(e)||al,r=ll.get(r)||y,Mu(r(e.apply(null,ea.call(arguments,1))))},ta.interpolateHcl=Lu,ta.interpolateHsl=Tu,ta.interpolateLab=Ru,ta.interpolateRound=Du,ta.transform=function(n){var t=ua.createElementNS(ta.ns.prefix.svg,"g");return(ta.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new Pu(e?e.matrix:sl)})(n)},Pu.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var sl={a:1,b:0,c:0,d:1,e:0,f:0};ta.interpolateTransform=Hu,ta.layout={},ta.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Yu(n[e]));return t}},ta.layout.chord=function(){function n(){var n,l,f,h,g,p={},v=[],d=ta.range(i),m=[];for(e=[],r=[],n=0,h=-1;++h<i;){for(l=0,g=-1;++g<i;)l+=u[h][g];v.push(l),m.push(ta.range(i)),n+=l}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&m.forEach(function(n,t){n.sort(function(n,e){return a(u[t][n],u[t][e])})}),n=(La-s*i)/n,l=0,h=-1;++h<i;){for(f=l,g=-1;++g<i;){var y=d[h],M=m[y][g],x=u[y][M],b=l,_=l+=x*n;p[y+"-"+M]={index:y,subindex:M,startAngle:b,endAngle:_,value:x}}r[y]={index:y,startAngle:f,endAngle:l,value:(l-f)/n},l+=s}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,u,i,o,a,c,l={},s=0;return l.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,l):u},l.padding=function(n){return arguments.length?(s=n,e=r=null,l):s},l.sortGroups=function(n){return arguments.length?(o=n,e=r=null,l):o},l.sortSubgroups=function(n){return arguments.length?(a=n,e=null,l):a},l.sortChords=function(n){return arguments.length?(c=n,e&&t(),l):c},l.chords=function(){return e||n(),e},l.groups=function(){return r||n(),r},l},ta.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,o=t.cy-n.y,a=u-e,c=i*i+o*o;if(c>a*a/d){if(p>c){var l=t.charge/c;n.px-=i*l,n.py-=o*l}return!0}if(t.point&&c&&p>c){var l=t.pointCharge/c;n.px-=i*l,n.py-=o*l}}return!t.charge}}function t(n){n.px=ta.event.x,n.py=ta.event.y,a.resume()}var e,r,u,i,o,a={},c=ta.dispatch("start","tick","end"),l=[1,1],s=.9,f=fl,h=hl,g=-30,p=gl,v=.1,d=.64,m=[],M=[];return a.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,a,f,h,p,d,y,x,b=m.length,_=M.length;for(e=0;_>e;++e)a=M[e],f=a.source,h=a.target,y=h.x-f.x,x=h.y-f.y,(p=y*y+x*x)&&(p=r*i[e]*((p=Math.sqrt(p))-u[e])/p,y*=p,x*=p,h.x-=y*(d=f.weight/(h.weight+f.weight)),h.y-=x*d,f.x+=y*(d=1-d),f.y+=x*d);if((d=r*v)&&(y=l[0]/2,x=l[1]/2,e=-1,d))for(;++e<b;)a=m[e],a.x+=(y-a.x)*d,a.y+=(x-a.y)*d;if(g)for(Ju(t=ta.geom.quadtree(m),r,o),e=-1;++e<b;)(a=m[e]).fixed||t.visit(n(a));for(e=-1;++e<b;)a=m[e],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*s,a.y-=(a.py-(a.py=a.y))*s);c.tick({type:"tick",alpha:r})},a.nodes=function(n){return arguments.length?(m=n,a):m},a.links=function(n){return arguments.length?(M=n,a):M},a.size=function(n){return arguments.length?(l=n,a):l},a.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,a):f},a.distance=a.linkDistance,a.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,a):h},a.friction=function(n){return arguments.length?(s=+n,a):s},a.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,a):g},a.chargeDistance=function(n){return arguments.length?(p=n*n,a):Math.sqrt(p)},a.gravity=function(n){return arguments.length?(v=+n,a):v},a.theta=function(n){return arguments.length?(d=n*n,a):Math.sqrt(d)},a.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),ta.timer(a.tick)),a):r},a.start=function(){function n(n,r){if(!e){for(e=new Array(c),a=0;c>a;++a)e[a]=[];for(a=0;s>a;++a){var u=M[a];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var i,o=e[t],a=-1,l=o.length;++a<l;)if(!isNaN(i=o[a][n]))return i;return Math.random()*r}var t,e,r,c=m.length,s=M.length,p=l[0],v=l[1];for(t=0;c>t;++t)(r=m[t]).index=t,r.weight=0;for(t=0;s>t;++t)r=M[t],"number"==typeof r.source&&(r.source=m[r.source]),"number"==typeof r.target&&(r.target=m[r.target]),++r.source.weight,++r.target.weight;for(t=0;c>t;++t)r=m[t],isNaN(r.x)&&(r.x=n("x",p)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof f)for(t=0;s>t;++t)u[t]=+f.call(this,M[t],t);else for(t=0;s>t;++t)u[t]=f;if(i=[],"function"==typeof h)for(t=0;s>t;++t)i[t]=+h.call(this,M[t],t);else for(t=0;s>t;++t)i[t]=h;if(o=[],"function"==typeof g)for(t=0;c>t;++t)o[t]=+g.call(this,m[t],t);else for(t=0;c>t;++t)o[t]=g;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){return e||(e=ta.behavior.drag().origin(y).on("dragstart.force",Xu).on("drag.force",t).on("dragend.force",$u)),arguments.length?void this.on("mouseover.force",Bu).on("mouseout.force",Wu).call(e):e},ta.rebind(a,c,"on")};var fl=20,hl=1,gl=1/0;ta.layout.hierarchy=function(){function n(u){var i,o=[u],a=[];for(u.depth=0;null!=(i=o.pop());)if(a.push(i),(l=e.call(n,i,i.depth))&&(c=l.length)){for(var c,l,s;--c>=0;)o.push(s=l[c]),s.parent=i,s.depth=i.depth+1;r&&(i.value=0),i.children=l}else r&&(i.value=+r.call(n,i,i.depth)||0),delete i.children;return Qu(u,function(n){var e,u;t&&(e=n.children)&&e.sort(t),r&&(u=n.parent)&&(u.value+=n.value)}),a}var t=ei,e=ni,r=ti;return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(r=t,n):r},n.revalue=function(t){return r&&(Ku(t,function(n){n.children&&(n.value=0)}),Qu(t,function(t){var e;t.children||(t.value=+r.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},n},ta.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(o=i.length)){var o,a,c,l=-1;for(r=t.value?r/t.value:0;++l<o;)n(a=i[l],e,c=a.value*r,u),e+=c}}function t(n){var e=n.children,r=0;if(e&&(u=e.length))for(var u,i=-1;++i<u;)r=Math.max(r,t(e[i]));return 1+r}function e(e,i){var o=r.call(this,e,i);return n(o[0],0,u[0],u[1]/t(o[0])),o}var r=ta.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u},Gu(e,r)},ta.layout.pie=function(){function n(o){var a,c=o.length,l=o.map(function(e,r){return+t.call(n,e,r)}),s=+("function"==typeof r?r.apply(this,arguments):r),f=("function"==typeof u?u.apply(this,arguments):u)-s,h=Math.min(Math.abs(f)/c,+("function"==typeof i?i.apply(this,arguments):i)),g=h*(0>f?-1:1),p=(f-c*g)/ta.sum(l),v=ta.range(c),d=[];return null!=e&&v.sort(e===pl?function(n,t){return l[t]-l[n]}:function(n,t){return e(o[n],o[t])}),v.forEach(function(n){d[n]={data:o[n],value:a=l[n],startAngle:s,endAngle:s+=a*p+g,padAngle:h}}),d}var t=Number,e=pl,r=0,u=La,i=0;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(u=t,n):u},n.padAngle=function(t){return arguments.length?(i=t,n):i},n};var pl={};ta.layout.stack=function(){function n(a,c){if(!(h=a.length))return a;var l=a.map(function(e,r){return t.call(n,e,r)}),s=l.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),o.call(n,t,e)]})}),f=e.call(n,s,c);l=ta.permute(l,f),s=ta.permute(s,f);var h,g,p,v,d=r.call(n,s,c),m=l[0].length;for(p=0;m>p;++p)for(u.call(n,l[0][p],v=d[p],s[0][p][1]),g=1;h>g;++g)u.call(n,l[g][p],v+=s[g-1][p][1],s[g][p][1]);return a}var t=y,e=ai,r=ci,u=oi,i=ui,o=ii;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:vl.get(t)||ai,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:dl.get(t)||ci,n):r},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(u=t,n):u},n};var vl=ta.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(li),i=n.map(si),o=ta.range(r).sort(function(n,t){return u[n]-u[t]}),a=0,c=0,l=[],s=[];for(t=0;r>t;++t)e=o[t],c>a?(a+=i[e],l.push(e)):(c+=i[e],s.push(e));return s.reverse().concat(l)},reverse:function(n){return ta.range(n.length).reverse()},default:ai}),dl=ta.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,o=[],a=0,c=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;i>e;++e)c[e]=(a-o[e])/2;return c},wiggle:function(n){var t,e,r,u,i,o,a,c,l,s=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=l=0,e=1;h>e;++e){for(t=0,u=0;s>t;++t)u+=n[t][e][1];for(t=0,i=0,a=f[e][0]-f[e-1][0];s>t;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);t>r;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;i+=o*n[t][e][1]}g[e]=c-=u?i/u*a:0,l>c&&(l=c)}for(e=0;h>e;++e)g[e]-=l;return g},expand:function(n){var t,e,r,u=n.length,i=n[0].length,o=1/u,a=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];if(r)for(t=0;u>t;t++)n[t][e][1]/=r;else for(t=0;u>t;t++)n[t][e][1]=o}for(e=0;i>e;++e)a[e]=0;return a},zero:ci});ta.layout.histogram=function(){function n(n,i){for(var o,a,c=[],l=n.map(e,this),s=r.call(this,l,i),f=u.call(this,s,l,i),i=-1,h=l.length,g=f.length-1,p=t?1:1/h;++i<g;)o=c[i]=[],o.dx=f[i+1]-(o.x=f[i]),o.y=0;if(g>0)for(i=-1;++i<h;)a=l[i],a>=s[0]&&a<=s[1]&&(o=c[ta.bisect(f,a,1,g)-1],o.y+=p,o.push(n[i]));return c}var t=!0,e=Number,r=pi,u=hi;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=Et(t),n):r},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return gi(n,t)}:Et(t),n):u},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},ta.layout.pack=function(){function n(n,i){var o=e.call(this,n,i),a=o[0],c=u[0],l=u[1],s=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,Qu(a,function(n){n.r=+s(n.value)}),Qu(a,Mi),r){var f=r*(t?1:Math.max(2*a.r/c,2*a.r/l))/2;Qu(a,function(n){n.r+=f}),Qu(a,Mi),Qu(a,function(n){n.r-=f})}return _i(a,c/2,l/2,t?1:1/Math.max(2*a.r/c,2*a.r/l)),o}var t,e=ta.layout.hierarchy().sort(vi),r=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},Gu(n,e)},ta.layout.tree=function(){function n(n,u){var s=o.call(this,n,u),f=s[0],h=t(f);if(Qu(h,e),h.parent.m=-h.z,Ku(h,r),l)Ku(f,i);else{var g=f,p=f,v=f;Ku(f,function(n){n.x<g.x&&(g=n),n.x>p.x&&(p=n),n.depth>v.depth&&(v=n)});var d=a(g,p)/2-g.x,m=c[0]/(p.x+a(p,g)/2+d),y=c[1]/(v.depth||1);Ku(f,function(n){n.x=(n.x+d)*m,n.y=n.depth*y})}return s}function t(n){for(var t,e={A:null,children:[n]},r=[e];null!=(t=r.pop());)for(var u,i=t.children,o=0,a=i.length;a>o;++o)r.push((i[o]=u={_:i[o],parent:t,children:(u=i[o].children)&&u.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=u);return e.children[0]}function e(n){var t=n.children,e=n.parent.children,r=n.i?e[n.i-1]:null;if(t.length){Ni(n);var i=(t[0].z+t[t.length-1].z)/2;r?(n.z=r.z+a(n._,r._),n.m=n.z-i):n.z=i}else r&&(n.z=r.z+a(n._,r._));n.parent.A=u(n,r,n.parent.A||e[0])}function r(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function u(n,t,e){if(t){for(var r,u=n,i=n,o=t,c=u.parent.children[0],l=u.m,s=i.m,f=o.m,h=c.m;o=Ei(o),u=ki(u),o&&u;)c=ki(c),i=Ei(i),i.a=n,r=o.z+f-u.z-l+a(o._,u._),r>0&&(Ai(Ci(o,n,e),n,r),l+=r,s+=r),f+=o.m,l+=u.m,h+=c.m,s+=i.m;o&&!Ei(i)&&(i.t=o,i.m+=f-s),u&&!ki(c)&&(c.t=u,c.m+=l-h,e=n)}return e}function i(n){n.x*=c[0],n.y=n.depth*c[1]}var o=ta.layout.hierarchy().sort(null).value(null),a=Si,c=[1,1],l=null;return n.separation=function(t){return arguments.length?(a=t,n):a},n.size=function(t){return arguments.length?(l=null==(c=t)?i:null,n):l?null:c},n.nodeSize=function(t){return arguments.length?(l=null==(c=t)?null:i,n):l?c:null},Gu(n,o)},ta.layout.cluster=function(){function n(n,i){var o,a=t.call(this,n,i),c=a[0],l=0;Qu(c,function(n){var t=n.children;t&&t.length?(n.x=qi(t),n.y=zi(t)):(n.x=o?l+=e(n,o):0,n.y=0,o=n)});var s=Li(c),f=Ti(c),h=s.x-e(s,f)/2,g=f.x+e(f,s)/2;return Qu(c,u?function(n){n.x=(n.x-c.x)*r[0],n.y=(c.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(c.y?n.y/c.y:1))*r[1]}),a}var t=ta.layout.hierarchy().sort(null).value(null),e=Si,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},Gu(n,t)},ta.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;)r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var i=e.children;if(i&&i.length){var o,a,c,l=f(e),s=[],h=i.slice(),p=1/0,v="slice"===g?l.dx:"dice"===g?l.dy:"slice-dice"===g?1&e.depth?l.dy:l.dx:Math.min(l.dx,l.dy);for(n(h,l.dx*l.dy/e.value),s.area=0;(c=h.length)>0;)s.push(o=h[c-1]),s.area+=o.area,"squarify"!==g||(a=r(s,v))<=p?(h.pop(),p=a):(s.area-=s.pop().area,u(s,v,l,!1),v=Math.min(l.dx,l.dy),s.length=s.area=0,p=1/0);s.length&&(u(s,v,l,!0),s.length=s.area=0),i.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var i,o=f(t),a=r.slice(),c=[];for(n(a,o.dx*o.dy/t.value),c.area=0;i=a.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?o.dx:o.dy,o,!a.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(i>e&&(i=e),e>u&&(u=e));return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0}function u(n,t,e,r){var u,i=-1,o=n.length,a=e.x,l=e.y,s=t?c(n.area/t):0;if(t==e.dx){for((r||s>e.dy)&&(s=e.dy);++i<o;)u=n[i],u.x=a,u.y=l,u.dy=s,a+=u.dx=Math.min(e.x+e.dx-a,s?c(u.area/s):0);u.z=!0,u.dx+=e.x+e.dx-a,e.y+=s,e.dy-=s}else{for((r||s>e.dx)&&(s=e.dx);++i<o;)u=n[i],u.x=a,u.y=l,u.dx=s,l+=u.dy=Math.min(e.y+e.dy-l,s?c(u.area/s):0);u.z=!1,u.dy+=e.y+e.dy-l,e.x+=s,e.dx-=s}}function i(r){var u=o||a(r),i=u[0];return i.x=0,i.y=0,i.dx=l[0],i.dy=l[1],o&&a.revalue(i),n([i],i.dx*i.dy/i.value),(o?e:t)(i),h&&(o=u),u}var o,a=ta.layout.hierarchy(),c=Math.round,l=[1,1],s=null,f=Ri,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return i.size=function(n){return arguments.length?(l=n,i):l},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);return null==e?Ri(t):Di(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Di(t,n)}if(!arguments.length)return s;var r;return f=null==(s=n)?Ri:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,o=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},Gu(i,a)},ta.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do{e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r}while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=ta.random.normal.apply(ta,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=ta.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t}}},ta.scale={};var ml={floor:y,ceil:y};ta.scale.linear=function(){return Ii([0,1],[0,1],mu,!1)};var yl={s:1,g:1,p:1,r:1,e:1};ta.scale.log=function(){return Ji(ta.scale.linear().domain([0,1]),10,!0,[1,10])};var Ml=ta.format(".0e"),xl={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};ta.scale.pow=function(){return Gi(ta.scale.linear(),1,[0,1])},ta.scale.sqrt=function(){return ta.scale.pow().exponent(.5)},ta.scale.ordinal=function(){return Qi([],{t:"range",a:[[]]})},ta.scale.category10=function(){return ta.scale.ordinal().range(bl)},ta.scale.category20=function(){return ta.scale.ordinal().range(_l)},ta.scale.category20b=function(){return ta.scale.ordinal().range(wl)},ta.scale.category20c=function(){return ta.scale.ordinal().range(Sl)};var bl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Mt),_l=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Mt),wl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Mt),Sl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Mt);ta.scale.quantile=function(){return no([],[])},ta.scale.quantize=function(){return to(0,1,[0,1])},ta.scale.threshold=function(){return eo([.5],[0,1])},ta.scale.identity=function(){return ro([0,1])},ta.svg={},ta.svg.arc=function(){function n(){var n=Math.max(0,+e.apply(this,arguments)),l=Math.max(0,+r.apply(this,arguments)),s=o.apply(this,arguments)-Ra,f=a.apply(this,arguments)-Ra,h=Math.abs(f-s),g=s>f?0:1;if(n>l&&(p=l,l=n,n=p),h>=Ta)return t(l,g)+(n?t(n,1-g):"")+"Z";var p,v,d,m,y,M,x,b,_,w,S,k,E=0,A=0,N=[];if((m=(+c.apply(this,arguments)||0)/2)&&(d=i===kl?Math.sqrt(n*n+l*l):+i.apply(this,arguments),g||(A*=-1),l&&(A=tt(d/l*Math.sin(m))),n&&(E=tt(d/n*Math.sin(m)))),l){y=l*Math.cos(s+A),M=l*Math.sin(s+A),x=l*Math.cos(f-A),b=l*Math.sin(f-A);var C=Math.abs(f-s-2*A)<=qa?0:1;if(A&&so(y,M,x,b)===g^C){var z=(s+f)/2;y=l*Math.cos(z),M=l*Math.sin(z),x=b=null}}else y=M=0;if(n){_=n*Math.cos(f-E),w=n*Math.sin(f-E),S=n*Math.cos(s+E),k=n*Math.sin(s+E);var q=Math.abs(s-f+2*E)<=qa?0:1;if(E&&so(_,w,S,k)===1-g^q){var L=(s+f)/2;_=n*Math.cos(L),w=n*Math.sin(L),S=k=null}}else _=w=0;if((p=Math.min(Math.abs(l-n)/2,+u.apply(this,arguments)))>.001){v=l>n^g?0:1;var T=null==S?[_,w]:null==x?[y,M]:Lr([y,M],[S,k],[x,b],[_,w]),R=y-T[0],D=M-T[1],P=x-T[0],U=b-T[1],j=1/Math.sin(Math.acos((R*P+D*U)/(Math.sqrt(R*R+D*D)*Math.sqrt(P*P+U*U)))/2),F=Math.sqrt(T[0]*T[0]+T[1]*T[1]);if(null!=x){var H=Math.min(p,(l-F)/(j+1)),O=fo(null==S?[_,w]:[S,k],[y,M],l,H,g),I=fo([x,b],[_,w],l,H,g);p===H?N.push("M",O[0],"A",H,",",H," 0 0,",v," ",O[1],"A",l,",",l," 0 ",1-g^so(O[1][0],O[1][1],I[1][0],I[1][1]),",",g," ",I[1],"A",H,",",H," 0 0,",v," ",I[0]):N.push("M",O[0],"A",H,",",H," 0 1,",v," ",I[0])}else N.push("M",y,",",M);if(null!=S){var Y=Math.min(p,(n-F)/(j-1)),Z=fo([y,M],[S,k],n,-Y,g),V=fo([_,w],null==x?[y,M]:[x,b],n,-Y,g);p===Y?N.push("L",V[0],"A",Y,",",Y," 0 0,",v," ",V[1],"A",n,",",n," 0 ",g^so(V[1][0],V[1][1],Z[1][0],Z[1][1]),",",1-g," ",Z[1],"A",Y,",",Y," 0 0,",v," ",Z[0]):N.push("L",V[0],"A",Y,",",Y," 0 0,",v," ",Z[0])}else N.push("L",_,",",w)}else N.push("M",y,",",M),null!=x&&N.push("A",l,",",l," 0 ",C,",",g," ",x,",",b),N.push("L",_,",",w),null!=S&&N.push("A",n,",",n," 0 ",q,",",1-g," ",S,",",k);return N.push("Z"),N.join("")}function t(n,t){return"M0,"+n+"A"+n+","+n+" 0 1,"+t+" 0,"+-n+"A"+n+","+n+" 0 1,"+t+" 0,"+n}var e=io,r=oo,u=uo,i=kl,o=ao,a=co,c=lo;return n.innerRadius=function(t){return arguments.length?(e=Et(t),n):e},n.outerRadius=function(t){return arguments.length?(r=Et(t),n):r},n.cornerRadius=function(t){return arguments.length?(u=Et(t),n):u},n.padRadius=function(t){return arguments.length?(i=t==kl?kl:Et(t),n):i},n.startAngle=function(t){return arguments.length?(o=Et(t),n):o},n.endAngle=function(t){return arguments.length?(a=Et(t),n):a},n.padAngle=function(t){return arguments.length?(c=Et(t),n):c},n.centroid=function(){var n=(+e.apply(this,arguments)+ +r.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Ra;return[Math.cos(t)*n,Math.sin(t)*n]},n};var kl="auto";ta.svg.line=function(){return ho(y)};var El=ta.map({linear:go,"linear-closed":po,step:vo,"step-before":mo,"step-after":yo,basis:So,"basis-open":ko,"basis-closed":Eo,bundle:Ao,cardinal:bo,"cardinal-open":Mo,"cardinal-closed":xo,monotone:To});El.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var Al=[0,2/3,1/3,0],Nl=[0,1/3,2/3,0],Cl=[0,1/6,2/3,1/6];ta.svg.line.radial=function(){var n=ho(Ro);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},mo.reverse=yo,yo.reverse=mo,ta.svg.area=function(){return Do(y)},ta.svg.area.radial=function(){var n=Do(Ro);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},ta.svg.chord=function(){function n(n,a){var c=t(this,i,n,a),l=t(this,o,n,a);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,l)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,l.r,l.p0)+r(l.r,l.p1,l.a1-l.a0)+u(l.r,l.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var u=t.call(n,e,r),i=a.call(n,u,r),o=c.call(n,u,r)-Ra,s=l.call(n,u,r)-Ra;return{r:i,a0:o,a1:s,p0:[i*Math.cos(o),i*Math.sin(o)],p1:[i*Math.cos(s),i*Math.sin(s)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>qa)+",1 "+t}function u(n,t,e,r){return"Q 0,0 "+r}var i=mr,o=yr,a=Po,c=ao,l=co;return n.radius=function(t){return arguments.length?(a=Et(t),n):a},n.source=function(t){return arguments.length?(i=Et(t),n):i},n.target=function(t){return arguments.length?(o=Et(t),n):o},n.startAngle=function(t){return arguments.length?(c=Et(t),n):c},n.endAngle=function(t){return arguments.length?(l=Et(t),n):l},n},ta.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),o=e.call(this,n,u),a=(i.y+o.y)/2,c=[i,{x:i.x,y:a},{x:o.x,y:a},o];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=mr,e=yr,r=Uo;return n.source=function(e){return arguments.length?(t=Et(e),n):t},n.target=function(t){return arguments.length?(e=Et(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},ta.svg.diagonal.radial=function(){var n=ta.svg.diagonal(),t=Uo,e=n.projection;return n.projection=function(n){return arguments.length?e(jo(t=n)):t},n},ta.svg.symbol=function(){function n(n,r){return(zl.get(t.call(this,n,r))||Oo)(e.call(this,n,r))}var t=Ho,e=Fo;return n.type=function(e){return arguments.length?(t=Et(e),n):t},n.size=function(t){return arguments.length?(e=Et(t),n):e},n};var zl=ta.map({circle:Oo,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*Ll)),e=t*Ll;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/ql),e=t*ql/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/ql),e=t*ql/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});ta.svg.symbolTypes=zl.keys();var ql=Math.sqrt(3),Ll=Math.tan(30*Da);_a.transition=function(n){for(var t,e,r=Tl||++Ul,u=Xo(n),i=[],o=Rl||{time:Date.now(),ease:Su,delay:0,duration:250},a=-1,c=this.length;++a<c;){i.push(t=[]);for(var l=this[a],s=-1,f=l.length;++s<f;)(e=l[s])&&$o(e,s,u,r,o),t.push(e)}return Yo(i,u,r)},_a.interrupt=function(n){return this.each(null==n?Dl:Io(Xo(n)))};var Tl,Rl,Dl=Io(Xo()),Pl=[],Ul=0;Pl.call=_a.call,Pl.empty=_a.empty,Pl.node=_a.node,Pl.size=_a.size,ta.transition=function(n,t){return n&&n.transition?Tl?n.transition(t):n:ta.selection().transition(n)},ta.transition.prototype=Pl,Pl.select=function(n){var t,e,r,u=this.id,i=this.namespace,o=[];n=N(n);for(var a=-1,c=this.length;++a<c;){o.push(t=[]);for(var l=this[a],s=-1,f=l.length;++s<f;)(r=l[s])&&(e=n.call(r,r.__data__,s,a))?("__data__"in r&&(e.__data__=r.__data__),$o(e,s,i,u,r[i][u]),t.push(e)):t.push(null)}return Yo(o,i,u)},Pl.selectAll=function(n){var t,e,r,u,i,o=this.id,a=this.namespace,c=[];n=C(n);for(var l=-1,s=this.length;++l<s;)for(var f=this[l],h=-1,g=f.length;++h<g;)if(r=f[h]){i=r[a][o],e=n.call(r,r.__data__,h,l),c.push(t=[]);for(var p=-1,v=e.length;++p<v;)(u=e[p])&&$o(u,p,a,o,i),t.push(u)}return Yo(c,a,o)},Pl.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=O(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]);for(var e=this[i],a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return Yo(u,this.namespace,this.id)},Pl.tween=function(n,t){var e=this.id,r=this.namespace;return arguments.length<2?this.node()[r][e].tween.get(n):Y(this,null==t?function(t){t[r][e].tween.remove(n)}:function(u){u[r][e].tween.set(n,t)})},Pl.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}function u(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})}function i(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?Hu:mu,a=ta.ns.qualify(n);return Zo(this,"attr."+n,t,a.local?i:u)},Pl.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));return r&&function(n){this.setAttribute(u,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));return r&&function(n){this.setAttributeNS(u.space,u.local,r(n))}}var u=ta.ns.qualify(n);return this.tween("attr."+n,u.local?r:e)},Pl.style=function(n,e,r){function u(){this.style.removeProperty(n)}function i(e){return null==e?u:(e+="",function(){var u,i=t(this).getComputedStyle(this,null).getPropertyValue(n);return i!==e&&(u=mu(i,e),function(t){this.style.setProperty(n,u(t),r)})})}var o=arguments.length;if(3>o){if("string"!=typeof n){2>o&&(e="");for(r in n)this.style(r,n[r],e);return this}r=""}return Zo(this,"style."+n,e,i)},Pl.styleTween=function(n,e,r){function u(u,i){var o=e.call(this,u,i,t(this).getComputedStyle(this,null).getPropertyValue(n));return o&&function(t){this.style.setProperty(n,o(t),r)}}return arguments.length<3&&(r=""),this.tween("style."+n,u)},Pl.text=function(n){return Zo(this,"text",n,Vo)},Pl.remove=function(){var n=this.namespace;return this.each("end.transition",function(){var t;this[n].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Pl.ease=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].ease:("function"!=typeof n&&(n=ta.ease.apply(ta,arguments)),Y(this,function(r){r[e][t].ease=n}))},Pl.delay=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].delay:Y(this,"function"==typeof n?function(r,u,i){r[e][t].delay=+n.call(r,r.__data__,u,i)}:(n=+n,function(r){r[e][t].delay=n}))},Pl.duration=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].duration:Y(this,"function"==typeof n?function(r,u,i){r[e][t].duration=Math.max(1,n.call(r,r.__data__,u,i))}:(n=Math.max(1,n),function(r){r[e][t].duration=n}))},Pl.each=function(n,t){var e=this.id,r=this.namespace;if(arguments.length<2){var u=Rl,i=Tl;try{Tl=e,Y(this,function(t,u,i){Rl=t[r][e],n.call(t,t.__data__,u,i)})}finally{Rl=u,Tl=i}}else Y(this,function(u){var i=u[r][e];(i.event||(i.event=ta.dispatch("start","end","interrupt"))).on(n,t)});return this},Pl.transition=function(){for(var n,t,e,r,u=this.id,i=++Ul,o=this.namespace,a=[],c=0,l=this.length;l>c;c++){a.push(n=[]);for(var t=this[c],s=0,f=t.length;f>s;s++)(e=t[s])&&(r=e[o][u],$o(e,s,o,i,{time:r.time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration})),n.push(e)}return Yo(a,o,i)},ta.svg.axis=function(){function n(n){n.each(function(){var n,l=ta.select(this),s=this.__chart__||e,f=this.__chart__=e.copy(),h=null==c?f.ticks?f.ticks.apply(f,a):f.domain():c,g=null==t?f.tickFormat?f.tickFormat.apply(f,a):y:t,p=l.selectAll(".tick").data(h,f),v=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Ca),d=ta.transition(p.exit()).style("opacity",Ca).remove(),m=ta.transition(p.order()).style("opacity",1),M=Math.max(u,0)+o,x=Ui(f),b=l.selectAll(".domain").data([0]),_=(b.enter().append("path").attr("class","domain"),ta.transition(b));v.append("line"),v.append("text");var w,S,k,E,A=v.select("line"),N=m.select("line"),C=p.select("text").text(g),z=v.select("text"),q=m.select("text"),L="top"===r||"left"===r?-1:1;if("bottom"===r||"top"===r?(n=Bo,w="x",k="y",S="x2",E="y2",C.attr("dy",0>L?"0em":".71em").style("text-anchor","middle"),_.attr("d","M"+x[0]+","+L*i+"V0H"+x[1]+"V"+L*i)):(n=Wo,w="y",k="x",S="y2",E="x2",C.attr("dy",".32em").style("text-anchor",0>L?"end":"start"),_.attr("d","M"+L*i+","+x[0]+"H0V"+x[1]+"H"+L*i)),A.attr(E,L*u),z.attr(k,L*M),N.attr(S,0).attr(E,L*u),q.attr(w,0).attr(k,L*M),f.rangeBand){var T=f,R=T.rangeBand()/2;s=f=function(n){return T(n)+R}}else s.rangeBand?s=f:d.call(n,f,s);v.call(n,s,f),m.call(n,f,f)})}var t,e=ta.scale.linear(),r=jl,u=6,i=6,o=3,a=[10],c=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Fl?t+"":jl,n):r},n.ticks=function(){return arguments.length?(a=arguments,n):a},n.tickValues=function(t){return arguments.length?(c=t,n):c},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(u=+t,i=+arguments[e-1],n):u},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var jl="bottom",Fl={top:1,right:1,bottom:1,left:1};ta.svg.brush=function(){function n(t){t.each(function(){var t=ta.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),o=t.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=t.selectAll(".resize").data(v,y);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return Hl[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var c,f=ta.transition(t),h=ta.transition(o);l&&(c=Ui(l),h.attr("x",c[0]).attr("width",c[1]-c[0]),r(f)),s&&(c=Ui(s),h.attr("y",c[0]).attr("height",c[1]-c[0]),u(f)),e(f)})}function e(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+f[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")"})}function r(n){n.select(".extent").attr("x",f[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",f[1]-f[0])}function u(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function i(){function i(){32==ta.event.keyCode&&(C||(M=null,q[0]-=f[1],q[1]-=h[1],C=2),S())}function v(){32==ta.event.keyCode&&2==C&&(q[0]+=f[1],q[1]+=h[1],C=0,S())}function d(){var n=ta.mouse(b),t=!1;x&&(n[0]+=x[0],n[1]+=x[1]),C||(ta.event.altKey?(M||(M=[(f[0]+f[1])/2,(h[0]+h[1])/2]),q[0]=f[+(n[0]<M[0])],q[1]=h[+(n[1]<M[1])]):M=null),A&&m(n,l,0)&&(r(k),t=!0),N&&m(n,s,1)&&(u(k),t=!0),t&&(e(k),w({type:"brush",mode:C?"move":"resize"}))}function m(n,t,e){var r,u,i=Ui(t),c=i[0],l=i[1],s=q[e],v=e?h:f,d=v[1]-v[0];return C&&(c-=s,l-=d+s),r=(e?p:g)?Math.max(c,Math.min(l,n[e])):n[e],C?u=(r+=s)+d:(M&&(s=Math.max(c,Math.min(l,2*M[e]-r))),r>s?(u=r,r=s):u=s),v[0]!=r||v[1]!=u?(e?a=null:o=null,v[0]=r,v[1]=u,!0):void 0}function y(){d(),k.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),ta.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),z(),w({type:"brushend"})}var M,x,b=this,_=ta.select(ta.event.target),w=c.of(b,arguments),k=ta.select(b),E=_.datum(),A=!/^(n|s)$/.test(E)&&l,N=!/^(e|w)$/.test(E)&&s,C=_.classed("extent"),z=W(b),q=ta.mouse(b),L=ta.select(t(b)).on("keydown.brush",i).on("keyup.brush",v);if(ta.event.changedTouches?L.on("touchmove.brush",d).on("touchend.brush",y):L.on("mousemove.brush",d).on("mouseup.brush",y),k.interrupt().selectAll("*").interrupt(),C)q[0]=f[0]-q[0],q[1]=h[0]-q[1];else if(E){var T=+/w$/.test(E),R=+/^n/.test(E);x=[f[1-T]-q[0],h[1-R]-q[1]],q[0]=f[T],q[1]=h[R]}else ta.event.altKey&&(M=q.slice());k.style("pointer-events","none").selectAll(".resize").style("display",null),ta.select("body").style("cursor",_.style("cursor")),w({type:"brushstart"}),d()}var o,a,c=E(n,"brushstart","brush","brushend"),l=null,s=null,f=[0,0],h=[0,0],g=!0,p=!0,v=Ol[0];return n.event=function(n){n.each(function(){var n=c.of(this,arguments),t={x:f,y:h,i:o,j:a},e=this.__chart__||t;this.__chart__=t,Tl?ta.select(this).transition().each("start.brush",function(){o=e.i,a=e.j,f=e.x,h=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=yu(f,t.x),r=yu(h,t.y);return o=a=null,function(u){f=t.x=e(u),h=t.y=r(u),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=t.i,a=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(l=t,v=Ol[!l<<1|!s],n):l},n.y=function(t){return arguments.length?(s=t,v=Ol[!l<<1|!s],n):s},n.clamp=function(t){return arguments.length?(l&&s?(g=!!t[0],p=!!t[1]):l?g=!!t:s&&(p=!!t),n):l&&s?[g,p]:l?g:s?p:null},n.extent=function(t){var e,r,u,i,c;return arguments.length?(l&&(e=t[0],r=t[1],s&&(e=e[0],r=r[0]),o=[e,r],l.invert&&(e=l(e),r=l(r)),e>r&&(c=e,e=r,r=c),(e!=f[0]||r!=f[1])&&(f=[e,r])),s&&(u=t[0],i=t[1],l&&(u=u[1],i=i[1]),a=[u,i],s.invert&&(u=s(u),i=s(i)),u>i&&(c=u,u=i,i=c),(u!=h[0]||i!=h[1])&&(h=[u,i])),n):(l&&(o?(e=o[0],r=o[1]):(e=f[0],r=f[1],l.invert&&(e=l.invert(e),r=l.invert(r)),e>r&&(c=e,e=r,r=c))),s&&(a?(u=a[0],i=a[1]):(u=h[0],i=h[1],s.invert&&(u=s.invert(u),i=s.invert(i)),u>i&&(c=u,u=i,i=c))),l&&s?[[e,u],[r,i]]:l?[e,r]:s&&[u,i])},n.clear=function(){return n.empty()||(f=[0,0],h=[0,0],o=a=null),n},n.empty=function(){return!!l&&f[0]==f[1]||!!s&&h[0]==h[1]},ta.rebind(n,c,"on")};var Hl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Ol=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Il=ac.format=gc.timeFormat,Yl=Il.utc,Zl=Yl("%Y-%m-%dT%H:%M:%S.%LZ");Il.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Jo:Zl,Jo.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},Jo.toString=Zl.toString,ac.second=Ft(function(n){return new cc(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),ac.seconds=ac.second.range,ac.seconds.utc=ac.second.utc.range,ac.minute=Ft(function(n){return new cc(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),ac.minutes=ac.minute.range,ac.minutes.utc=ac.minute.utc.range,ac.hour=Ft(function(n){var t=n.getTimezoneOffset()/60;return new cc(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),ac.hours=ac.hour.range,ac.hours.utc=ac.hour.utc.range,ac.month=Ft(function(n){return n=ac.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),ac.months=ac.month.range,ac.months.utc=ac.month.utc.range;var Vl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Xl=[[ac.second,1],[ac.second,5],[ac.second,15],[ac.second,30],[ac.minute,1],[ac.minute,5],[ac.minute,15],[ac.minute,30],[ac.hour,1],[ac.hour,3],[ac.hour,6],[ac.hour,12],[ac.day,1],[ac.day,2],[ac.week,1],[ac.month,1],[ac.month,3],[ac.year,1]],$l=Il.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",Ne]]),Bl={range:function(n,t,e){return ta.range(Math.ceil(n/e)*e,+t,e).map(Ko)},floor:y,ceil:y};Xl.year=ac.year,ac.scale=function(){return Go(ta.scale.linear(),Xl,$l)};var Wl=Xl.map(function(n){return[n[0].utc,n[1]]}),Jl=Yl.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",Ne]]);Wl.year=ac.year.utc,ac.scale.utc=function(){return Go(ta.scale.linear(),Wl,Jl)},ta.text=At(function(n){return n.responseText}),ta.json=function(n,t){return Nt(n,"application/json",Qo,t)},ta.html=function(n,t){return Nt(n,"text/html",na,t)},ta.xml=At(function(n){return n.responseXML}),"function"==typeof define&&define.amd?define(ta):"object"==typeof module&&module.exports&&(module.exports=ta),this.d3=ta}();!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){function a(t){return void 0!==t&&null!==t}t(document).ready(function(){t("body").append("<div id=snackbar-container/>")});var n={events:{},on:function(t,a){this.events[t]=this.events[t]||[],this.events[t].push(a)},off:function(t){this.events[t]&&delete this.events[t]},emit:function(t,a){this.events[t]&&this.events[t].forEach(function(t){t(a)})}};t(document).on("click","[data-toggle=snackbar]",function(){t(this).snackbar("toggle")}).on("click","#snackbar-container .snackbar",function(){t(this).snackbar("hide")}),t.snackbar=function(e){if(a(e)&&e===Object(e)){var s,i=!1;a((e=Object.assign({},t.snackbar.defaults,e)).id)?t("#"+e.id).length?s=t("#"+e.id):(s=t("<div/>").attr("id",""+e.id).attr("class","snackbar"),i=!0):(e.id="snackbar"+Date.now(),s=t("<div/>").attr("id",e.id).attr("class","snackbar"),i=!0);var o=s.hasClass("snackbar-opened");a(e.style)?(o?s.attr("class","snackbar snackbar-opened "+e.style):s.attr("class","snackbar "+e.style),s.attr("data-style",e.style)):o?s.attr("class","snackbar snackbar-opened"):s.attr("class","snackbar"),e.htmlAllowed=!!a(e.htmlAllowed)&&e.htmlAllowed,e.timeout=a(e.timeout)?e.timeout:3e3,s.attr("data-timeout",e.timeout),e.content=e.htmlAllowed?e.content:t("<p>"+e.content+"</p>").text(),a(e.onClose)&&n.on(e.id,e.onClose),a(e.htmlAllowed)&&s.attr("data-html-allowed",e.htmlAllowed),a(e.content)&&(s.find(".snackbar-content").length?s.find(".snackbar-content").html(e.content):s.prepend("<span class=snackbar-content>"+e.content+"</span>"),s.attr("data-content",e.content)),i?s.appendTo("#snackbar-container"):s.insertAfter("#snackbar-container .snackbar:last-child"),a(e.action)&&"toggle"==e.action&&(e.action=o?"hide":"show");var c=Date.now();s.data("animationId1",c),setTimeout(function(){s.data("animationId1")===c&&(a(e.action)&&"show"!=e.action?a(e.action)&&"hide"==e.action&&(s.removeClass("snackbar-opened"),n.emit(e.id),n.off(e.id)):s.addClass("snackbar-opened"))},50);var r=Date.now();return s.data("animationId2",r),0!==e.timeout&&setTimeout(function(){s.data("animationId2")===r&&(s.removeClass("snackbar-opened"),n.emit(e.id),n.off(e.id))},e.timeout),s}return!1},t.snackbar.defaults={},t.fn.snackbar=function(n){if(void 0!==n){var e={};if(this.hasClass("snackbar"))return e={id:this.attr("id"),content:t(this).attr("data-content"),style:t(this).attr("data-style"),timeout:parseInt(t(this).attr("data-timeout")),htmlAllowed:t(this).attr("data-html-allowed")},"show"!==n&&"hide"!==n&&"toggle"!=n||(e.action=n),t.snackbar(e);a(n)&&"show"!==n&&"hide"!==n&&"toggle"!=n||(e={content:t(this).attr("data-content"),style:t(this).attr("data-style"),timeout:t(this).attr("data-timeout"),htmlAllowed:t(this).attr("data-html-allowed")}),a(n)&&(e.id=this.attr("data-snackbar-id"),"show"!==n&&"hide"!==n&&"toggle"!=n||(e.action=n));var s=t.snackbar(e);return this.attr("data-snackbar-id",s.attr("id")),s}}});!function(e,t){"use strict";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?t(require("knockout"),require("jquery")):"function"==typeof define&&define.amd?define("knockstrap",["knockout","jquery"],t):t(ko,$)}(0,function(e,t){"use strict";var a,n;e.utils.uniqueId=(a={"ks-unique-":0},function(e){return a[e=e||"ks-unique-"]||(a[e]=0),e+a[e]++}),e.utils.unwrapProperties=function(t){if(null===t||"object"!=typeof t)return t;var a={};return e.utils.objectForEach(t,function(t,n){a[t]=e.unwrap(n)}),a},n={alert:'<div class="alert fade in" data-bind="css: type, template: innerTemplate"> </div>',alertInner:'<button class="close" data-dismiss="alert" aria-hidden="true">&times;</button> <p data-bind="text: message"></p>',carousel:'\x3c!-- ko template: indicatorsTemplate --\x3e \x3c!-- /ko --\x3e <div class="carousel-inner"> \x3c!-- ko foreach: items --\x3e <div class="item" data-bind="with: $parent.converter($data), css: { active: $index() == 0 }"> <img data-bind="attr: { src: src, alt: alt }"> <div class="container"> <div class="carousel-caption"> \x3c!-- ko template: { name: $parents[1].itemTemplateName, data: $data, templateEngine: $parents[1].templateEngine, afterRender: $parents[1].afterRender, afterAdd: $parents[1].afterAdd, beforeRemove: $parents[1].beforeRemove } --\x3e \x3c!-- /ko --\x3e </div> </div> </div> \x3c!-- /ko --\x3e </div> \x3c!-- ko template: controlsTemplate --\x3e \x3c!-- /ko --\x3e ',carouselContent:'<div data-bind="text: content"></div>',carouselControls:'<a class="left carousel-control" data-bind="attr: { href: id }" data-slide="prev"> <span class="icon-prev"></span> </a> <a class="right carousel-control" data-bind="attr: { href: id }" data-slide="next"> <span class="icon-next"></span> </a>',carouselIndicators:'<ol class="carousel-indicators" data-bind="foreach: items"> <li data-bind="attr: { \'data-target\': $parent.id, \'data-slide-to\': $index }"></li> </ol> ',modal:'<div class="modal-dialog" data-bind="css: dialogCss"> <div class="modal-content"> <div class="modal-header" data-bind="template: headerTemplate"> </div> <div class="modal-body" data-bind="template: bodyTemplate"> </div> \x3c!-- ko if: footerTemplate --\x3e <div class="modal-footer" data-bind="template: footerTemplate"> </div> \x3c!-- /ko --\x3e </div> </div>',popoverX:'<div class="popover" data-bind="css: dialogCss"><div class="arrow"></div> <div class="popover-title" data-bind="template: headerTemplate"></div> <div class="popover-content" data-bind="template: bodyTemplate"></div> \x3c!-- ko if: footerTemplate --\x3e<div class="popover-footer" data-bind="template: footerTemplate"></div>\x3c!-- /ko --\x3e </div>',modalBody:'<div data-bind="html: content"> </div>',modalFooter:'\x3c!-- ko if: $data.action --\x3e <a href="#" class="btn btn-primary" data-bind="click: action, html: primaryLabel"></a> \x3c!-- /ko --\x3e <a href="#" class="btn btn-default" data-bind="html: closeLabel" data-dismiss="modal"></a>',modalHeader:'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3 data-bind="text: label"></h3> ',progress:'<div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" data-bind="style: { width: barWidth }, attr: { \'aria-valuenow\': value }, css: innerCss"> <span data-bind="css: { \'sr-only\': textHidden }"> <span data-bind="text: value"></span>% <span data-bind="text: text"></span> </span> </div> '},e.templateSources.stringTemplate=function(e){this.templateName=e,this.data=function(e,t){if(n.data=n.data||{},n.data[this.templateName]=n.data[this.templateName]||{},1===arguments.length)return n.data[this.templateName][e];n.data[this.templateName][e]=t},this.text=function(e){if(0===arguments.length)return n[this.templateName];n[this.templateName]=e}},e.stringTemplateEngine=function(){this.allowTemplateRewriting=!1},e.stringTemplateEngine.prototype=new e.nativeTemplateEngine,e.stringTemplateEngine.prototype.constructor=e.stringTemplateEngine,e.stringTemplateEngine.prototype.makeTemplateSource=function(t){return new e.templateSources.stringTemplate(t)},e.stringTemplateEngine.prototype.getTemplate=function(e){return n[e]},e.stringTemplateEngine.prototype.addTemplate=function(e,t){if(arguments.length<2)throw new Error("template is not provided");n[e]=t},e.stringTemplateEngine.prototype.removeTemplate=function(e){if(!e)throw new Error("template name is not provided");delete n[e]},e.stringTemplateEngine.prototype.isTemplateExist=function(e){return!!n[e]},e.stringTemplateEngine.instance=new e.stringTemplateEngine,e.bindingHandlers.alert={init:function(){return{controlsDescendantBindings:!0}},update:function(a,n,i,r,o){var s,d,l=t(a),p=n(),c=p.template?null:e.stringTemplateEngine.instance,u=e.unwrap(p.template)||"alertInner";if(a.nodeType===(Node.ELEMENT_NODE||1))s=u,d=p.data||{message:p.message},l.addClass("alert fade in").addClass("alert-"+(e.unwrap(p.type)||"info"));else{if(a.nodeType!==(Node.COMMENT_NODE||8))throw new Error("alert binding should be used with dom elements or ko virtual elements");s="alert",d={innerTemplate:{name:u,data:p.data||{message:p.message},templateEngine:c},type:"alert-"+(e.unwrap(p.type)||"info")}}e.renderTemplate(s,o.createChildContext(d),e.utils.extend({templateEngine:c},p.templateOptions),a)}},e.virtualElements.allowedBindings.alert=!0,e.bindingHandlers.carousel={defaults:{css:"carousel slide",controlsTemplate:{name:"carouselControls",templateEngine:e.stringTemplateEngine.instance,dataConverter:function(t){return{id:e.computed(function(){return"#"+e.unwrap(t.id)})}}},indicatorsTemplate:{name:"carouselIndicators",templateEngine:e.stringTemplateEngine.instance,dataConverter:function(t){return{id:e.computed(function(){return"#"+e.unwrap(t.id)}),items:t.content.data}}},itemTemplate:{name:"carouselContent",templateEngine:e.stringTemplateEngine.instance,converter:function(e){return e}}},init:function(a,n,i,r,o){var s=t(a),d=n(),l=e.bindingHandlers.carousel.defaults,p=function(e,a){var n={name:e.name,data:d[a]&&(d[a].data||d[a].dataConverter&&d[a].dataConverter(d))||e.dataConverter(d)};return n=t.extend(!0,{},n,d[a]),d[a]&&d[a].name||(n.templateEngine=e.templateEngine),n};if(!d.content)throw new Error("content option is required for carousel binding");a.id?d.id=a.id:d.id?a.id=e.unwrap(d.id):a.id=d.id=e.utils.uniqueId("ks-carousel-");var c={id:d.id,controlsTemplate:p(l.controlsTemplate,"controls"),indicatorsTemplate:p(l.indicatorsTemplate,"indicators"),items:d.content.data,converter:d.content.converter||l.itemTemplate.converter,itemTemplateName:d.content.name||l.itemTemplate.name,templateEngine:d.content.name?null:l.itemTemplate.templateEngine,afterRender:d.content.afterRender,afterAdd:d.content.afterAdd,beforeRemove:d.content.beforeRemove};return e.renderTemplate("carousel",o.createChildContext(c),{templateEngine:e.stringTemplateEngine.instance},a),s.addClass(l.css),{controlsDescendantBindings:!0}},update:function(a,n){var i=n(),r=e.unwrap(i.options);t(a).carousel(r)}},e.bindingHandlers.checkbox={init:function(a,n){var i=t(a),r=function(a){setTimeout(function(){var i=t(a.target),r=n(),o=i.val(),s=i.parent().hasClass("active");if(e.unwrap(r)instanceof Array){var d=e.unwrap(r).indexOf(o);s&&-1===d?r.push(o):s||-1===d||r.splice(d,1)}else r(s)},0)};if("buttons"===i.attr("data-toggle")&&i.find("input:checkbox").length){if(!(e.unwrap(n())instanceof Array))throw new Error("checkbox binding should be used only with array or observableArray values in this case");i.on("change","input:checkbox",r)}else{if("checkbox"!==i.attr("type"))throw new Error("checkbox binding should be used only with bootstrap checkboxes");if(!e.isObservable(n()))throw new Error("checkbox binding should be used only with observable values in this case");i.on("change",r)}},update:function(a,n){var i,r=t(a),o=e.unwrap(n());o instanceof Array?"buttons"===r.attr("data-toggle")?r.find("input:checkbox").each(function(e,a){i=-1!==o.indexOf(a.value),t(a).parent().toggleClass("active",i),a.checked=i}):(i=-1!==o.indexOf(r.val()),r.toggleClass("active",i),r.find("input").prop("checked",i)):(i=!!o,r.prop("checked",i),r.parent().toggleClass("active",i))}},e.bindingHandlers.modal={defaults:{css:"modal fade",dialogCss:"",attributes:{role:"dialog"},headerTemplate:{name:"modalHeader",templateEngine:e.stringTemplateEngine.instance},bodyTemplate:{name:"modalBody",templateEngine:e.stringTemplateEngine.instance},footerTemplate:{name:"modalFooter",templateEngine:e.stringTemplateEngine.instance,data:{closeLabel:"Close",primaryLabel:"Ok"}}},init:function(a,n,i,r,o){var s=t(a),d=n(),l=e.bindingHandlers.modal.defaults,p=e.utils.extend({show:s.data().show||!1},e.utils.unwrapProperties(d.options)),c=function(e,a){var n={name:e.name,data:e.data};return n=t.extend(!0,{},n,a),a&&a.name||(n.templateEngine=e.templateEngine),n};if(!d.header||!d.body)throw new Error("header and body options are required for modal binding.");(p.keyboard||void 0===p.keyboard)&&s.attr("tabindex",-1);var u={dialogCss:d.dialogCss||l.dialogCss,headerTemplate:c(l.headerTemplate,e.unwrap(d.header)),bodyTemplate:c(l.bodyTemplate,e.unwrap(d.body)),footerTemplate:d.footer?c(l.footerTemplate,e.unwrap(d.footer)):null};return e.renderTemplate("modal",o.createChildContext(u),{templateEngine:e.stringTemplateEngine.instance},a),s.addClass(l.css).attr(l.attributes),s.modal(p),s.on("shown.bs.modal",function(){void 0!==d.visible&&d.visible(!0),t(this).find("[autofocus]:first").focus()}),void 0!==d.visible&&(s.on("hidden.bs.modal",function(){d.visible(!1)}),p.show&&d.visible(!0)),{controlsDescendantBindings:!0}},update:function(a,n){var i=n();void 0!==i.visible&&t(a).modal(e.unwrap(i.visible)?"show":"hide")}};var i="__popoverTemplateKey__";e.bindingHandlers.popover={init:function(a){var n=t(a);e.utils.domNodeDisposal.addDisposeCallback(a,function(){n.data("bs.popover")&&n.popover("destroy")})},update:function(a,n,r,o,s){var d=t(a),l=e.unwrap(n()),p=(l.options||l.template?e.utils.unwrapProperties(l.options):e.utils.unwrapProperties(l))||{};if(l.template){e.unwrap(l.template);var c=e.utils.domData.get(a,i),u=e.unwrap(l.data),m=function(){e.renderTemplate(e.unwrap(l.template),s.createChildContext(u),l.templateOptions,document.getElementById(c));var a=t("#"+c).parents(".popover"),n=d.data("bs.popover"),i=n.getCalculatedOffset(p.placement||"right",n.getPosition(),a.outerWidth(),a.outerHeight());n.applyPlacement(i,p.placement||"right")};c||(c=e.utils.uniqueId("ks-popover-"),e.utils.domData.set(a,i,c),d.on("shown.bs.popover",m)),p.content='<div id="'+c+'" ></div>',p.html=!0,t("#"+c).is(":visible")&&m()}var v=d.data("bs.popover");v?e.utils.extend(v.options,p):(d.popover(p),d.on("shown.bs.popover",function(){(p.container?t(p.container):d.parent()).one("click",'[data-dismiss="popover"]',function(){d.popover("hide")})}))}},e.bindingHandlers.progress={defaults:{css:"progress",text:"",textHidden:!0,striped:!1,type:"",animated:!1},init:function(a,n){var i=t(a),r=n(),o=e.unwrap(r),s=e.bindingHandlers.progress.defaults,d=t.extend({},s,o);if("number"==typeof o)d.value=r,d.barWidth=e.computed(function(){return e.unwrap(r)+"%"});else{if("number"!=typeof e.unwrap(o.value))throw new Error('progress binding can accept only numbers or objects with "value" number propertie');d.barWidth=e.computed(function(){return e.unwrap(o.value)+"%"})}return d.innerCss=e.computed(function(){var t=e.utils.unwrapProperties(o),a="";return t.animated&&(a+="active "),t.striped&&(a+="progress-bar-striped "),t.type&&(a+="progress-bar-"+t.type),a}),e.renderTemplate("progress",d,{templateEngine:e.stringTemplateEngine.instance},a),i.addClass(s.css),{controlsDescendantBindings:!0}}},e.bindingHandlers.radio={init:function(a,n){if(!e.isObservable(n()))throw new Error("radio binding should be used only with observable values");t(a).on("change","input:radio",function(e){setTimeout(function(){var a=t(e.target);n()(a.val())},0)})},update:function(a,n){var i,r=t(a).find('input[value="'+e.unwrap(n())+'"]');r.length?((i=r.parent()).siblings().removeClass("active"),i.addClass("active"),r.prop("checked",!0)):((i=t(a).find(".active")).removeClass("active"),i.find("input").prop("checked",!1))}},e.bindingHandlers.toggle={init:function(a,n){var i=n();if(!e.isObservable(i))throw new Error("toggle binding should be used only with observable values");t(a).on("click",function(){var t=e.unwrap(i);i(!t)})},update:function(t,a){e.utils.toggleDomNodeCssClass(t,"active",e.unwrap(a()))}},e.bindingHandlers.tooltip={init:function(a){var n=t(a);e.utils.domNodeDisposal.addDisposeCallback(a,function(){n.data("bs.tooltip")&&n.tooltip("destroy")})},update:function(a,n){var i=t(a),r=e.unwrap(n()),o=e.utils.unwrapProperties(r),s=i.data("bs.tooltip");s?e.utils.extend(s.options,o):i.tooltip(o)}}});!function(t){var e=function(e,o){var r=this;r.options=o,r.$element=t(e).on("click.dismiss.popoverX",'[data-dismiss="popover-x"]',t.proxy(r.hide,r)),r.init()};e.prototype=t.extend({},t.fn.modal.Constructor.prototype,{constructor:e,init:function(){var e=this;e.$body=t(document.body),e.$target=e.options.$target,e.useOffsetForPos=void 0==e.options.useOffsetForPos||e.options.useOffsetForPos,e.$element.find(".popover-footer").length&&e.$element.removeClass("has-footer").addClass("has-footer"),e.options.remote&&e.$element.find(".popover-content").load(e.options.remote,function(){e.$element.trigger("load.complete.popoverX")})},getPosition:function(){var e=this.$target,o=this.useOffsetForPos?e.offset():e.position();return t.extend({},o,{width:e[0].offsetWidth,height:e[0].offsetHeight})},refreshPosition:function(){var t,e=this,o=e.$element,r=e.options.placement,a=o[0].offsetWidth,i=o[0].offsetHeight,p=e.getPosition();switch(r){case"bottom":t={top:p.top+p.height,left:p.left+p.width/2-a/2};break;case"bottom bottom-left":t={top:p.top+p.height,left:p.left};break;case"bottom bottom-right":t={top:p.top+p.height,left:p.left+p.width-a};break;case"top":t={top:p.top-i,left:p.left+p.width/2-a/2};break;case"top top-left":t={top:p.top-i,left:p.left};break;case"top top-right":t={top:p.top-i,left:p.left+p.width-a};break;case"left":t={top:p.top+p.height/2-i/2,left:p.left-a};break;case"left left-top":t={top:p.top,left:p.left-a};break;case"left left-bottom":t={top:p.top+p.height-i,left:p.left-a};break;case"right":t={top:p.top+p.height/2-i/2,left:p.left+p.width};break;case"right right-top":t={top:p.top,left:p.left+p.width};break;case"right right-bottom":t={top:p.top+p.height-i,left:p.left+p.width}}o.css(t).addClass(r).addClass("in")},show:function(){var e=this,o=e.$element;o.css({top:0,left:0,display:"block","z-index":1050}),e.refreshPosition(),t.fn.modal.Constructor.prototype.show.call(e,arguments),o.css({padding:0})}}),t.fn.popoverX=function(o){return this.each(function(){var r=t(this),a=r.data("popover-x"),i=t.extend({},t.fn.popoverX.defaults,r.data(),"object"==typeof o&&o);if(i.$target||(a&&a.$target?i.$target=a.$target:i.$target=o.$target||t(o.target)),a){if("object"==typeof o&&o)for(var p in"placement"in o&&r.removeClass(a.options.placement),o)o.hasOwnProperty(p)&&(a.options[p]=o[p])}else r.data("popover-x",a=new e(this,i));"string"==typeof o&&a[o]()})},t.fn.popoverX.defaults=t.extend({},t.fn.modal.defaults,{placement:"right",keyboard:!0}),t(document).on("ready",function(){t("[data-toggle='popover-x']").on("click",function(e){var o=t(this),r=o.attr("href"),a=t(o.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),i=a.data("popover-x")?"toggle":t.extend({remote:!/#/.test(r)&&r},a.data(),o.data());e.preventDefault(),a.trigger("click.target.popoverX"),"toggle"!==i?(i.$target=o,a.popoverX(i).popoverX("show").on("hide",function(){o.focus()})):a.popoverX(i).on("hide",function(){o.focus()})}),t('[data-toggle="popover-x"]').on("keyup",function(e){var o=t(this),r=t(o.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,""));r&&27==e.which&&r.trigger("keyup.target.popoverX")&&r.popoverX("hide")})})}(window.jQuery);!function(t){t.fn.splitPane=function(){var e=this;e.each(i),e.append('<div class="split-pane-resize-shim">'),e.children(".split-pane-divider").bind("mousedown touchstart",n),setTimeout(function(){e.each(function(){t(this).bind("_splitpaneparentresize",function(t){var e=t[0],i=t.children(".split-pane-component:first")[0],n=t.children(".split-pane-divider")[0],s=t.children(".split-pane-component:last")[0];{if(t.is(".fixed-top")){var f=r(s);return function(r){var o=e.offsetHeight-f-n.offsetHeight;i.offsetHeight>o&&a(i,n,s,o+"px"),t.resize()}}if(t.is(".fixed-bottom")){var c=r(i);return function(f){var r=e.offsetHeight-c-n.offsetHeight;s.offsetHeight>r&&h(i,n,s,r+"px"),t.resize()}}if(t.is(".horizontal-percent")){var f=r(s),c=r(i);return function(r){var o=e.offsetHeight-c-n.offsetHeight;s.offsetHeight>o?h(i,n,s,o/e.offsetHeight*100+"%"):e.offsetHeight-i.offsetHeight-n.offsetHeight<f&&h(i,n,s,f/e.offsetHeight*100+"%"),t.resize()}}if(t.is(".fixed-left")){var u=o(s);return function(f){var r=e.offsetWidth-u-n.offsetWidth;i.offsetWidth>r&&p(i,n,s,r+"px"),t.resize()}}if(t.is(".fixed-right")){var l=o(i);return function(f){var r=e.offsetWidth-l-n.offsetWidth;s.offsetWidth>r&&d(i,n,s,r+"px"),t.resize()}}if(t.is(".vertical-percent")){var u=o(s),l=o(i);return function(f){var r=e.offsetWidth-l-n.offsetWidth;s.offsetWidth>r?d(i,n,s,r/e.offsetWidth*100+"%"):e.offsetWidth-i.offsetWidth-n.offsetWidth<u&&d(i,n,s,u/e.offsetWidth*100+"%"),t.resize()}}}}(t(this)))}),t(window).trigger("resize")},100)};var e="_splitpaneparentresizeHandler";function i(){var e=t(this),i=e.children(".split-pane-component:first"),n=e.children(".split-pane-divider"),s=e.children(".split-pane-component:last");e.is(".fixed-top, .fixed-bottom, .horizontal-percent")?e.css("min-height",r(i)+r(s)+n.height()+"px"):e.css("min-width",o(i)+o(s)+n.width()+"px")}function n(e){e.preventDefault();var i=e.type.match(/^touch/),n=i?"touchmove":"mousemove",c=i?"touchend":"mouseup",u=t(this),l=u.parent(),v=u.siblings(".split-pane-resize-shim");v.show(),u.addClass("dragged"),i&&u.addClass("touch"),t(document).on(n,function(t,e,i){var n=t[0],c=t.children(".split-pane-component:first")[0],u=t.children(".split-pane-divider")[0],l=t.children(".split-pane-component:last")[0];{if(t.is(".fixed-top")){var v=r(c),g=n.offsetHeight-r(l)-u.offsetHeight,m=u.offsetTop-i;return function(e){e.preventDefault();var i=Math.min(Math.max(v,m+f(e)),g);a(c,u,l,i+"px"),t.resize()}}if(t.is(".fixed-bottom")){var x=r(l),z=n.offsetHeight-r(c)-u.offsetHeight,H=l.offsetHeight+i;return function(e){e.preventDefault();var i=Math.min(Math.max(x,H-f(e)),z);h(c,u,l,i+"px"),t.resize()}}if(t.is(".horizontal-percent")){var W=n.offsetHeight,x=r(l),z=W-r(c)-u.offsetHeight,H=l.offsetHeight+i;return function(e){e.preventDefault();var i=Math.min(Math.max(x,H-f(e)),z);h(c,u,l,i/W*100+"%"),t.resize()}}if(t.is(".fixed-left")){var y=o(c),w=n.offsetWidth-o(l)-u.offsetWidth,M=u.offsetLeft-e;return function(e){e.preventDefault();var i=Math.min(Math.max(y,M+s(e)),w);p(c,u,l,i+"px"),t.resize()}}if(t.is(".fixed-right")){var b=o(l),D=n.offsetWidth-o(c)-u.offsetWidth,T=l.offsetWidth+e;return function(e){e.preventDefault();var i=Math.min(Math.max(b,T-s(e)),D);d(c,u,l,i+"px"),t.resize()}}if(t.is(".vertical-percent")){var E=n.offsetWidth,b=o(l),D=E-o(c)-u.offsetWidth,T=l.offsetWidth+e;return function(e){e.preventDefault();var i=Math.min(Math.max(b,T-s(e)),D);d(c,u,l,i/E*100+"%"),t.resize()}}}}(l,s(e),f(e))),t(document).one(c,function(e){t(document).unbind(n),u.removeClass("dragged touch"),v.hide()})}function s(t){var e=t.pageX||t.originalEvent.pageX;if(!e){var i=t.targetTouches||t.originalEvent.targetTouches;if(i&&i.length>0)e=i[0].pageX}return e}function f(t){var e=t.pageY||t.originalEvent.pageY;if(!e){var i=t.targetTouches||t.originalEvent.targetTouches;if(i&&i.length>0)e=i[0].pageY}return e}function r(e){return parseInt(t(e).css("min-height"))||0}function o(e){return parseInt(t(e).css("min-width"))||0}function a(t,e,i,n){t.style.height=n,e.style.top=n,i.style.top=n}function h(t,e,i,n){t.style.bottom=n,e.style.bottom=n,i.style.height=n}function p(t,e,i,n){t.style.width=n,e.style.left=n,i.style.left=n}function d(t,e,i,n){t.style.right=n,e.style.right=n,i.style.width=n}jQuery.event.special._splitpaneparentresize={setup:function(i,n){var s=this,f=t(this).parent().closest(".split-pane")[0]||window;t(this).data(e,function(t){(t.target===document?window:t.target)===f?(t.type="_splitpaneparentresize",jQuery.event.dispatch.apply(s,arguments)):t.stopPropagation()}),t(f).bind("resize",t(this).data(e))},teardown:function(i){var n=t(this).parent().closest(".split-pane")[0]||window;t(n).unbind("resize",t(this).data(e)),t(this).removeData(e)}}}(jQuery);function loadInitialModel(){const xhr=new XMLHttpRequest;xhr.responseType="arraybuffer";xhr.onreadystatechange=()=>{if(xhr.readyState===XMLHttpRequest.DONE){if(xhr.status===200){const data=xhr.response;const blob=new Blob([data],{type:"application/x-tgif"});const file=new File([blob],"model.obj",{type:"application/x-tgif"});window.App.Manager.importFile([file])}else{console.error("Ocurrió un error al cargar el modelo inicial")}}};xhr.open("GET","model/simple_house.obj",true);xhr.send()}var pd=pd||{};!function(){pd.version="0.1.2",pd.isBrowser="undefined"!=typeof window,pd.Const={EPSILON:1e-6,HALF_PI:.5*Math.PI,TWO_PI:2*Math.PI,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI},pd.Align={NONE:0,LEFT:1,CENTER:2,RIGHT:4,BOTTOM:8,MIDDLE:16,TOP:32,BASELINE:64,BOT_LEFT:9,BOT_CENTER:10,BOT_RIGHT:12,MID_LEFT:17,MID_CENTER:18,MID_RIGHT:20,TOP_LEFT:33,TOP_CENTER:34,TOP_RIGHT:36,OUTSIDE:1,INSIDE:2},pd.Align.isLeft=function(t){return t&pd.Align.LEFT},pd.Align.isCenter=function(t){return t&pd.Align.CENTER},pd.Align.isRight=function(t){return t&pd.Align.RIGHT},pd.Align.isTop=function(t){return t&pd.Align.TOP},pd.Align.isMiddle=function(t){return t&pd.Align.MIDDLE},pd.Align.isBottom=function(t){return t&pd.Align.BOTTOM},pd.sign=function(t){return t<0?-1:1},pd.isNumeric=function(t){return null!=t&&isFinite(parseFloat(t))},pd.isNumber=function(t){return null!=t&&isFinite(t)},pd.toNumber=function(t,e){return t=parseFloat(t),isFinite(t)?t:e},pd.toNumberInRange=function(t,e,r,n){return pd.constrainTo(pd.toNumber(t,e),r,n)},pd.isInteger=function(t){return null!=t&&isFinite(t)&&Math.round(t)===t},pd.toInteger=function(t,e){return t=parseFloat(t),isFinite(t)?Math.round(t):Math.round(+e)},pd.toBoolean=function(t,e){return null!=t?!!t:!!e},pd.isBetween=function(t,e,r,n){return n=+n||0,!!isFinite(t)&&(e-n<t&&t<r+n||r-n<t&&t<e+n)},pd.isBetweenInclusive=function(t,e,r){var n=pd.Const.EPSILON;return!(!isFinite(t)||t>Math.max(e,r)+n)&&!(t<Math.min(e,r)-n)},pd.isPowerOfTwo=function(t){return 0==(t&t-1)},pd.nextPowerOfTwo=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},pd.closeTo=function(t,e,r){return r=r||pd.Const.EPSILON,!(!isFinite(t)||e+r<t||t<e-r)},pd.constrainTo=function(t,e,r){if(!isFinite(t))return e;if(r<e){if(e<t)return e;if(t<r)return r}else{if(t<e)return e;if(r<t)return r}return t},pd.wrapAt=function(t,e,r,n){var i=Math.min(r,e),e=Math.max(r,e);if(n&&t>e-pd.Const.EPSILON&&t<e+pd.Const.EPSILON)return i;if(t<i||e<t){n=e-i;return 0<n?t=t<i?e-(i-t)%n:i+(t-i)%n:i}return t},pd._fastWrap=function(t,e,r){if(t<e||r<t){var n=r-e;return 0<n?t<e?r-(e-t)%n:e+(t-e)%n:e}return t},pd.snapTo=function(t,e){return(e=e||1)*Math.round(t/e)},pd.incrementBy=function(t,e){var r=(e=e||1)*Math.floor(t/e)+e,n=Math.abs(.1*e);return r-n<t&&t<r+n?r+e:r},pd.mapAndConstrainTo=function(t,e,r,n,i){r-=e;return Math.abs(r)<pd.Const.EPSILON?.5*(n+i):pd.constrainTo(n+(t-e)/r*(i-n),n,i)},pd.mapTo=function(t,e,r,n,i){r-=e;return Math.abs(r)<pd.Const.EPSILON?.5*(n+i):n+(t-e)/r*(i-n)},pd.interpolate=function(t,e,r){return t+r*(e-t)},pd.getTickIncrement=function(t,e){var r=Math.pow(10,Math.floor(Math.log10(t)));r<pd.Const.EPSILON&&(r=1);var n=t/r;return n<=.1*(e=e||20)?.1*r:n<=.2*e?.2*r:n<=.5*e?.5*r:n<=e?r:pd.snapTo(t/e,.1*r)},pd.randomRange=function(t,e){return Math.random()*(e-t)+t},pd.safeDivide=function(t,e){return Math.abs(e)<1e-9?0:t/e},pd.degreesToRadians=function(t){return t*pd.Const.DEG2RAD},pd.radiansToDegrees=function(t){return t*pd.Const.RAD2DEG},pd.sinDegrees=function(t){return Math.sin(t*pd.Const.DEG2RAD)},pd.cosDegrees=function(t){return Math.cos(t*pd.Const.DEG2RAD)},pd.tanDegrees=function(t){return Math.tan(t*pd.Const.DEG2RAD)};var e=987655555,r=123455555,n=4294967295;pd.randomNumber=function(t){return t&&(e=987654321+t,r=123456789-t),(((r=36969*(65535&r)+(r>>16)&n)<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n)/4294967296+.5},pd.randomNumberInRange=function(t,e){return pd.randomNumber()*(e-t)+t},pd.RandomNumberCache=function(t,e,r){this.array=[],this.count=0,this.index=0,this.rebuild(t,e,r)},pd.RandomNumberCache.prototype.rebuild=function(t,e,r){if(t=pd.constrainTo(pd.toInteger(t,64),2,2048),arguments.length<2||isNaN(e)||isNaN(r))for(var n=e-r,i=this.array.length,a=0;a<t;++a)o=pd.randomNumber(),a<i?this.array[a]=o:this.array.push(o);else for(var o,n=e-r,i=this.array.length,a=0;a<t;++a)o=e+pd.randomNumber()*n,a<i?this.array[a]=o:this.array.push(o);return this.count=t,this.array.length=t,this.index=0,this},pd.RandomNumberCache.prototype.next=function(){return++this.index>=this.count&&(this.index=0),this.array[this.index]},pd.RandomNumberCache.prototype.reset=function(t,e,r){return this.index=0,this},pd.toHexColorString=function(t){var e,r="#";return pd.isArray(t)?((e=Math.round(255*t[0]))<16&&(r+="0"),r+=e.toString(16).toUpperCase(),(e=Math.round(255*t[1]))<16&&(r+="0"),r+=e.toString(16).toUpperCase(),(e=Math.round(255*t[2]))<16&&(r+="0"),r+=e.toString(16).toUpperCase()):"none"},pd.visibleTextColor=function(t,e){return t?pd.isArray(t)||(t=pd.parseHexColorString(t.toString())):t=[0,0,0],.65<.265*t[0]+.67*t[1]+.065*t[2]?e?"#888":"#000":e?"#CCC":"#FFF"},pd.parseHexColorString=function(t,e){if(e=e||[1,1,1,1],t&&1<t.length)if(0<=t.indexOf("[")&&0<=t.indexOf("]")){if((r=JSON.parse(t))&&pd.isArray(r))return e[0]=pd.constrainTo(pd.toNumber(r[0],0),0,1),e[1]=pd.constrainTo(pd.toNumber(r[1],0),0,1),e[2]=pd.constrainTo(pd.toNumber(r[2],0),0,1),e[3]=pd.constrainTo(pd.toNumber(r[3],1),0,1),e}else{var r;t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,r,n){return e+e+r+r+n+n}),(r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))&&(e[0]=parseInt(r[1],16)/255,e[1]=parseInt(r[2],16)/255,e[2]=parseInt(r[3],16)/255,e[3]=1)}return e},pd.randomColorArray=function(t,e){var r,n=[];return t=pd.constrainTo(pd.toNumber(t,0),-.9,.9),e&&pd.randomNumber(e),1e-4<t?(r=1-t,n[0]=t+pd.randomNumber()*r,n[1]=t+pd.randomNumber()*r,n[2]=t+pd.randomNumber()*r):t<-1e-4?(r=1+t,n[0]=pd.randomNumber()*r,n[1]=pd.randomNumber()*r,n[2]=pd.randomNumber()*r):(n[0]=pd.randomNumber(),n[1]=pd.randomNumber(),n[2]=pd.randomNumber()),n[3]=1,n},pd.modifiyColorArray=function(t,e,r){return(t=t||[])[0]=pd.constrainTo(+e[0]*r,0,1),t[1]=pd.constrainTo(+e[1]*r,0,1),t[2]=pd.constrainTo(+e[2]*r,0,1),t[3]=pd.toNumber(e[3],1),t},pd.setColorArray=function(t,e,r,n,i){var a;return t=t||[],2==arguments.length&&pd.isArray(e)?(a=e,t[0]=+a[0]||0,t[1]=+a[1]||0,t[2]=+a[2]||0,t[3]=pd.toNumber(a[3],1)):(t[0]=+e||0,t[1]=+r||0,t[2]=+n||0,t[3]=pd.toNumber(i,1)),t},pd.setVectorArray=function(t,e,r,n){var i;return t=t||[],2==arguments.length&&pd.isArray(e)?(i=e,t[0]=+i[0]||0,t[1]=+i[1]||0,t[2]=+i[2]||0):(t[0]=+e||0,t[1]=+r||0,t[2]=+n||0),t},pd.notZeroLength=function(t){return 1e-9<t[0]||t[0]<-1e-9||1e-9<t[1]||t[1]<-1e-9||1e-9<t[2]||t[2]<-1e-9},pd.cloneSimpleObject=function(t){return JSON.parse(JSON.stringify(t))},pd.hashMapFactory=function(){return Object.create(null)},pd.hashMapHasEntry=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},pd.hashMapValues=function(t){var e,r=[];for(e in t)null!=e&&r.push(t[e]);return r},pd.hashMapIsEmpty=function(t){for(var e in t)if(null!=e)return!1;return!0},pd.hashMapClear=function(t){for(var e in t)delete t[e]},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),r=e.length>>>0,n=arguments[1]>>0,i=n<0?Math.max(r+n,0):Math.min(n,r),n=arguments[2],n=void 0===n?r:n>>0,a=n<0?Math.max(r+n,0):Math.min(n,r);i<a;)e[i]=t,i++;return e}});var i=1.6*Math.PI,a=Math.PI/1.5;pd.colorScaleRainbow=function(t,e){e=e||[];t=pd.constrainTo(t,0,1)*i;return e[0]=.5-.5*Math.sin(t),e[1]=.5-.5*Math.sin(t+=a),e[2]=.5-.5*Math.sin(t+=a),e[3]=1,e},pd.colorScaleRed=function(t,e){e=e||[];var r=.75*(t=pd.constrainTo(t,0,1));return e[0]=.25+r,e[1]=e[2]=t*r,e[3]=1,e},pd.colorScaleGreen=function(t,e){return e=e||[],t=pd.constrainTo(t,0,1),e[0]=.5<t?1.6*(t-.5):0,e[1]=.4+.6*t,e[2]=0,e[3]=1,e},pd.colorScaleBlue=function(t,e){e=e||[];var r=.75*(t=pd.constrainTo(t,0,1));return e[0]=e[1]=t*r,e[2]=.25+r,e[3]=1,e},pd.colorScaleRedWhiteBlue=function(t,e){e=e||[];t=pd.constrainTo(t,0,1);return t<=.5?(e[0]=e[1]=2*t,e[2]=1):(e[0]=1,e[1]=e[2]=pd.mapAndConstrainTo(t,.5,.95,1,0)),e[3]=1,e},pd.colorScaleSepia=function(t,e){e=e||[];t=.1+.9*pd.constrainTo(t,0,1);return e[0]=t,e[1]=t,e[2]=.25*t,e[3]=1,e},pd.colorScaleEcotect=function(t,e){e=e||[];var r=2.1*pd.constrainTo(t,0,1),n=0,t=0;return 1<r&&(n=r-1,r=1),1<n&&(n=1),n<0&&(n=0),r<0&&(r=0),t=1-r,e[0]=r,e[1]=n,e[2]=t,e[3]=1,e},pd.startsWith=function(t,e){return 0===t.indexOf(e)},pd.endsWith=function(t,e){var r=t.length-e.length,e=t.indexOf(e,r);return-1!==e&&e===r},pd.indexOfLowerCase=function(t,e){return pd.isString(e)&&pd.isString(t)?t.toLowerCase().indexOf(e.toLowerCase()):-1},pd.countOccurrences=function(t,e,r){if(!pd.isString(e)||!pd.isString(t)||e.length<=0)return 0;for(var n=0,i=0,a=r?1:e.length;0<=(n=t.indexOf(e,n));)n+=a,++i;return i},pd.toStringWithLeadingZeros=function(t,e){var r=String(t);for(e=pd.toInteger(e,2);r.length<e;)r="0"+r;return r},pd.toStringWithPrecision=function(t,e){return(t=parseFloat(t)).toFixed(pd.toInteger(e,3))},pd.toStringWithPrecisionRange=function(t,e,r){if(e<0||r<0)throw new Error("ERROR: Minimum and maximum decimal places must be zero or positive.");if(t=parseFloat(t),r<=e)return t.toFixed(e);var n=t.toFixed(r).split(".");if(n.length<2)return t.toFixed(e);var i=n[1].length;if(i<=e)return t.toFixed(e);for(var a=i-1;e<=a&&"0"==n[1].charAt(a);a--)i--;return 0<i?n[0]+"."+n[1].slice(0,i):n[0]},pd.toCamelCase=function(t){return t.replace(/([-_][a-z])/g,function(t){return t.toUpperCase().replace(/[-_]/,"")})},pd.fromCamelCase=function(t,e){return e=e||"-",t.replace(/([A-Z])/g,function(t){return e+t.toLowerCase()})},pd.UnitType={NONE:0,FRACTION:1,PERCENTAGE:2,LENGTH:3,AREA:4,VOLUME:5,TIME_HRS:6,TIME_MINS:7,DATE:8},pd.DimensionType={DEFAULT:0,METRIC_MM:1,METRIC_SI:2,IMPERIAL:3},pd.Dimension={},pd.Dimension.type=pd.DimensionType.METRIC_MM,pd.Dimension.formatFeetAndInches=function(t){var e="",r=pd.sign(t),n=Math.abs(t)/25.4/12+.001,i=12*(n-Math.floor(n))+.001,t=16*(i-Math.floor(i))+.001;return t=Math.floor(t),i=Math.floor(i),(0<(n=Math.floor(n))||i<.001&&t<.999)&&(e+=n.toString()+"'"),(0<i||1<=t)&&(0<n&&(e+=" "),e+=i.toString()+'"'),1<=t&&(0<e.length&&(e+=" "),e+=t%8==0?Math.round(t/8).toString()+"/2":t%4==0?Math.round(t/4).toString()+"/4":t%2==0?Math.round(t/2).toString()+"/8":t.toString()+"/16"),r<0?"-"+e:e},pd.Dimension.formatDimension=function(t,e,r,n){switch(e=e||pd.Dimension.type){default:case pd.DimensionType.METRIC_MM:return(!pd.isNumeric(r)||r<0)&&(r=0),n?t.toFixed(r)+" mm":t.toFixed(r);case pd.DimensionType.METRIC_SI:return(!pd.isNumeric(r)||r<0)&&(r=3),n?(t/1e3).toFixed(r)+" m":(t/1e3).toFixed(r);case pd.DimensionType.IMPERIAL:return pd.Dimension.formatFeetAndInches(t)}},pd.Dimension.formatDistance=function(t,e,r,n){switch(e=e||pd.Dimension.type){default:case pd.DimensionType.METRIC_MM:case pd.DimensionType.METRIC_SI:return(!pd.isNumeric(r)||r<0)&&(r=3),n?(t/1e3).toFixed(r)+" m":(t/1e3).toFixed(r);case pd.DimensionType.IMPERIAL:return pd.Dimension.formatFeetAndInches(t)}},pd.Dimension.formatArea=function(t,e,r,n){var i="";return e=e||pd.Dimension.type,(!pd.isNumeric(r)||r<0)&&(r=3),e!==pd.DimensionType.IMPERIAL?(i=t.toFixed(r),n&&(i+=" m2")):(i=(10.7639104*t).toFixed(r),n&&(i+=" ft3")),i},pd.Dimension.formatVolume=function(t,e,r,n){var i="";return e=e||pd.Dimension.type,(!pd.isNumeric(r)||r<0)&&(r=3),e!==pd.DimensionType.IMPERIAL?(i=(1e-9*t).toFixed(r),n&&(i+=" m3")):(i=(35.314666721*t).toFixed(r),n&&(i+=" ft3")),i},pd.Dimension.getDefaultStep=function(t){switch(t=t||pd.Dimension.type){default:case pd.DimensionType.METRIC_MM:case pd.DimensionType.METRIC_SI:return 25;case pd.DimensionType.IMPERIAL:return 25.4}},pd.Dimension.getSmallStep=function(t){switch(t=t||pd.Dimension.type){default:case pd.DimensionType.METRIC_MM:case pd.DimensionType.METRIC_SI:return 5;case pd.DimensionType.IMPERIAL:return 6.35}},pd.Dimension.getIncrement=function(t,e,r){var n,i;return e=pd.toNumber(e,0),r=pd.toNumber(r,pd.Dimension.getDefaultStep()),e=e&&(pd.Dimension.type==pd.DimensionType.IMPERIAL?(i=1.5875,900<r?(n=4572,r=25.4):300<r?(n=914.4,r=25.4):15<r?(n=304.8,r=25.4):.99<r?(n=304.8,r=1):(r=1.5875,n=25.4),r<i&&(r=i),t&&t.shiftKey?Math.abs(e)<10?n*pd.sign(e):5*n*pd.sign(e):t&&(t.ctrlKey||t.metaKey)?Math.abs(e)<10?i*pd.sign(e):4*i*pd.sign(e):Math.abs(e)<10?r*pd.sign(e):n*pd.sign(e)):(n=5*r,r<(i=1)&&(r=i),t&&t.shiftKey?Math.abs(e)<5?n*pd.sign(e):Math.abs(e)<10?5*n*pd.sign(e):10*n*pd.sign(e):t&&(t.ctrlKey||t.metaKey)?Math.abs(e)<10?i*pd.sign(e):5*i*pd.sign(e):Math.abs(e)<10?r*pd.sign(e):n*pd.sign(e)))},pd.Dimension.incrementDimension=function(t,e,r,n){return pd.incrementBy(pd.toNumber(r,0),pd.Dimension.getIncrement(t,e,n))},pd.Dimension.formatArea=function(t,e,r){switch(e=e||pd.Dimension.type){default:case pd.DimensionType.METRIC_MM:case pd.DimensionType.METRIC_SI:return(!pd.isNumeric(r)||r<0)&&(r=2),t.toFixed(r)+" m2";case pd.DimensionType.IMPERIAL:return(!pd.isNumeric(r)||r<0)&&(r=1),(10.76391041671*t).toFixed(r)+" ft2"}},pd.Dimension.parseDimension=function(t,e){var r=0===(t=t.toString().trim()).indexOf("=");switch(e=e||pd.Dimension.type,/\'|\"/.test(t)?(e=pd.DimensionType.IMPERIAL,r=!1):0<=t.indexOf("ft")||0<t.indexOf("in")?(t=(t=t.replace("ft","'")).replace("in",'"'),e=pd.DimensionType.IMPERIAL,r=!1):0<t.indexOf("mm")?e=pd.DimensionType.METRIC_MM:0<t.indexOf("m")&&(e=pd.DimensionType.METRIC_SI),e){default:case pd.DimensionType.METRIC_MM:return pd.parseEqn(t);case pd.DimensionType.METRIC_SI:return 1e3*pd.parseEqn(t);case pd.DimensionType.IMPERIAL:var n=0,i=0,a=0;if(0<=t.indexOf("'")||0<=t.indexOf('"'))for(var o=t.split(/([\s\'\"]+)/),s=0;s<o.length;s+=2){0<=o[s].indexOf("/")?1<(d=o[s].split("/")).length&&(h=parseFloat(d[0]),.1<(l=parseFloat(d[1]))&&(a=h/l)):s<o.length-1&&0<o[s+1].length?0<=o[s+1].indexOf('"')||0<=o[s+1].indexOf("''")||0<=o[s+1].indexOf(" ")&&0<s?i=parseFloat(o[s]):(0<=o[s+1].indexOf("'")||0<=o[s+1].indexOf(" ")&&0==s)&&(n=parseFloat(o[s])):0<o[s].length&&(0<s||0<n?i=parseFloat(o[s]):n=parseFloat(o[s]))}else{if(r)return 304.8*pd.parseEqn(t);for(var d,h,l,o=t.split(" "),s=0;s<o.length;++s){0<o[s].length&&(0<=o[s].indexOf("/")?1<(d=o[s].split("/")).length&&(h=parseFloat(d[0]),.1<(l=parseFloat(d[1]))&&(a=h/l)):0<s?i=parseFloat(o[s]):n=parseFloat(o[s]))}}return 304.8*n+25.4*i+25.4*a}},pd.Indexer=function(t,e){this.unique=pd.isArray(t)?t:[],this.map=pd.hashMapFactory(),this.decimals=pd.toInteger(e,3),this.indexId=0},pd.Indexer.prototype.addObject=function(t){var e,r=JSON.stringify(t);return r in this.map?e=this.map[r]:(e=this.map[r]=this.unique.length,this.unique.push(t)),e},pd.Indexer.prototype.addById=function(t){var e,r;return t._indexId||(t._indexId=++this.indexId),(r=t._indexId)in this.map?e=this.map[r]:(e=this.map[r]=this.unique.length,this.unique.push(t)),e},pd.Indexer.prototype.addVectorArray=function(t){var e,r=this.decimals,r="["+t[0].toFixed(r)+","+t[1].toFixed(r)+","+t[2].toFixed(r)+"]";return r in this.map?e=this.map[r]:(e=this.map[r]=this.unique.length,this.unique.push(t)),e},pd.IndexCounter=function(t){this.unique=pd.isArray(t)?t:[],this.counter=[],this.map=pd.hashMapFactory()},pd.IndexCounter.prototype.count=function(t){var e=JSON.stringify(t);e in this.map||(this.map[e]=this.unique.length,this.unique.push(t),this.counter.push(0));t=this.map[e];return this.counter[t]++,this.map[e]},pd.copyArray=function(t,e,r){r=r||Math.round(Math.min(t.length,e.length));for(var n=0;n<r;++n)e[n]=t[n]},pd.isArray=Array.isArray||function(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)},pd.isTypedArray=function(t){return!!t&&(t.BYTES_PER_ELEMENT&&void 0!==t.byteLength)},pd.isObject=function(t){return null!==t&&("object"==typeof t||"function"==typeof t)},pd.isString=function(t){return"string"==typeof t||t instanceof String},pd.isFunction=function(t){return"function"==typeof t},pd.isAlpha=function(t){return/^[A-Za-z]$/.test(t)},pd.sleepFor=function(t){for(var e=(new Date).getTime();(new Date).getTime()<e+t;);return pd},pd.parseEqn=parseFloat,pd.parseCSV=function(t){for(var e,r=[""],n=!1,i=0,a=0;a<t.length;++a)if('"'==(e=t[a])&&n&&'"'==t[a+1])r[i]+=e,++a;else if('"'!=e)if(","!=e||n){if("\n"==e&&!n)break;r[i]+=e}else r[++i]="";else n=!n;return r},pd.GUID=function(){for(var t={},i=[],e=0;e<256;++e)i[e]=(e<16?"0":"")+e.toString(16);return t.generate=function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255]+"-"+i[255&e]+i[e>>8&255]+"-"+i[e>>16&15|64]+i[e>>24&255]+"-"+i[63&r|128]+i[r>>8&255]+"-"+i[r>>16&255]+i[r>>24&255]+i[255&n]+i[n>>8&255]+i[n>>16&255]+i[n>>24&255]},t}(),pd.addSimpleEventHandling=function(a){a._pd_events=a._pd_events||{},a.on=function(t,e){return"string"==typeof t&&(t=t.trim(),a._pd_events[t]&&pd.isArray(a._pd_events[t])||(a._pd_events[t]=[]),e&&a._pd_events[t].indexOf(e)<0&&a._pd_events[t].push(e)),a},a.off=function(t,e){return"string"==typeof t&&(t=t.trim(),a._pd_events[t]&&pd.isArray(a._pd_events[t])&&(-1<(e=a._pd_events[t].indexOf(e))&&a._pd_events[t].splice(e,1))),a},a.emit=function(t){if(a._pd_events[t]&&pd.isArray(a._pd_events[t]))for(var e=[].slice.call(arguments,1),r=a._pd_events[t],n=0,i=r.length;n<i;++n)r[n].apply(a,e);return a},a.once=function(e,r){return a.on(e,function t(){a.removeListener(e,t),r.apply(a,arguments)}),a}},pd.Easing={linear:function(t){return t},inSine:function(t){return 1-Math.sin(pd.Const.HALF_PI+t*pd.Const.HALF_PI)},outSine:function(t){return Math.sin(t*pd.Const.HALF_PI)},inOutSine:function(t){return.5*(1+Math.sin(-pd.Const.HALF_PI+t*Math.PI))},inOutSinePow:function(t,e){return e=+e||2,Math.pow(.5*(1+Math.cos(-Math.PI+t*Math.PI)),e)},inQuad:function(t){return t*t},outQuad:function(t){return t*(2-t)},inOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},inQuart:function(t){return t*t*t*t},outQuart:function(t){return 1- --t*t*t*t},inOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return 1+--t*t*t*t*t},inOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t},inExpo:function(t){return(Math.pow(2,8*t)-1)/255},outExpo:function(t){return 1-Math.pow(2,-8*t)},inOutExpo:function(t){return t<.5?(Math.pow(2,16*t)-1)/510:1-.5*Math.pow(2,-16*(t-.5))},inCirc:function(t){return 1-Math.sqrt(1-t)},outCirc:function(t){return Math.sqrt(t)},inOutCirc:function(t){return t<.5?.5*(1-Math.sqrt(1-2*t)):.5*(1+Math.sqrt(2*t-1))},inBack:function(t){return t*t*(2.70158*t-1.70158)},outBack:function(t){return 1+--t*t*(2.70158*t+1.70158)},inOutBack:function(t){return t<.5?t*t*(7*t-2.5)*2:1+--t*t*2*(7*t+2.5)},inBounce:function(t){var e=t*t;return e*e*Math.sin(t*Math.PI*4.5)},outBounce:function(t){var e=(t-1)*(t-1);return 1-e*e*Math.cos(t*Math.PI*4.5)},inOutBounce:function(t){var e;return t<.45?8*(e=t*t)*e*Math.sin(t*Math.PI*9):t<.55?.5+.75*Math.sin(t*Math.PI*4):1-8*(e=(t-1)*(t-1))*e*Math.sin(t*Math.PI*9)},inWobble:function(t){return(.04+.02/t)*Math.sin(25*t)},outWobble:function(t){return(.04-.04/t)*Math.sin(25*t)+1},inOutWobble:function(t){return(t-=.5)<0?(.02+.01/t)*Math.sin(50*t):(.02-.01/t)*Math.sin(50*t)+1},outElastic:function(t,e){return e=e||.35,Math.pow(2,-10*t)*Math.sin((t-e/4)*(2*Math.PI)/e)+1}}}(),function(){var d="num",h="var";function l(t){return pd.isString(t)&&null!==t.match(/^[A-Za-z]+$/)}var c=/\s*([A-Za-z]+|(\d*\.?\d+\.?)+|\S)\s*/g;function a(t){var e=0,r=function(t){for(var e,r=[];null!==(e=c.exec(t));)r.push(e[1]);return r}(t);function n(){return r[e]}function i(){e++}function a(){var t,e=n();if(t=e,pd.isString(t)&&null!==t.match(/^\d*\.?\d+\.?/))return i(),{type:d,value:e};if(l(e))return i(),{type:h,name:e};if("("===e){i();var r=s();if(")"!==n())throw new SyntaxError("Unmatched closing bracket found.");return i(),r}if("-"!==e)throw new SyntaxError("Expected a number, variable or bracket, but found: "+e);return i(),(r=a()).value="-"+r.value,r}function o(){for(var t=a(),e=n();"*"===e||"/"===e||"^"===e;){i();t={type:e,left:t,right:a()},e=n()}return t}function s(){for(var t=o(),e=n();"+"===e||"-"===e;){i();t={type:e,left:t,right:o()},e=n()}return t}return s()}var o={},e={PI:Math.PI,E:Math.E};function s(t){switch(t.type){case d:return parseFloat(t.value);case h:return e[t.name]||o[t.name]||0;case"^":return Math.pow(s(t.left),s(t.right));case"+":return s(t.left)+s(t.right);case"-":return s(t.left)-s(t.right);case"*":return s(t.left)*s(t.right);case"/":return s(t.left)/s(t.right)}throw new SyntaxError("Unrecognised symbol: "+t.toString())}var u=null;pd.parseEqn=u=function(t,e){var r,n,i;pd.parseEqn.error&&(pd.parseEqn.error="");try{if(pd.isString(t)&&0<=t.indexOf("=")?1<(n=t.split("=",2)).length?(r=s(a(n[1])),l(i=n[0].trim())&&(o[i]=r,u.emit("assign",i,r))):r=s(a(n[0])):r=parseFloat(t),NaN==r)throw new SyntaxError("Invalid numeric input: "+t.toString())}catch(t){pd.parseEqn.error=t.message,u.emit("error",pd.parseEqn.error),r=NaN}return r},pd.addSimpleEventHandling(u),pd.parseEqn.error=""}();var pd3D=pd3D||{};!function(){function n(t,e,r){return e==r?Math.abs(t-e)<1e-9:!(e-1e-9<t&&r-1e-9<t)&&!(t<e+1e-9&&t<r+1e-9)}pd3D.AXIS={NONE:0,X_POS:1,X_NEG:-1,Y_POS:2,Y_NEG:-2,Z_POS:3,Z_NEG:-3},pd3D.VectorArray={},pd3D.VectorArray.origin=[0,0,0],pd3D.VectorArray.unitX=[1,0,0],pd3D.VectorArray.unitY=[0,1,0],pd3D.VectorArray.unitZ=[0,0,1],pd3D.VectorArray.create=function(t,e,r){return 1==arguments.length?pd.isArray(t)?[+t[0]||0,+t[1]||0,+t[2]||0]:[t=pd.toNumber(t,0),t,t]:[+t||0,+e||0,+r||0]},pd3D.VectorArray.createFromComponents=function(t,e,r){return[+t||0,+e||0,+r||0]},pd3D.VectorArray.createFromArray=function(t){return[+t[0]||0,+t[1]||0,+t[2]||0]},pd3D.VectorArray.clone=pd3D.VectorArray.createFromArray,pd3D.VectorArray.min=function(t,e,r){return Math.min(e[t],r[t])},pd3D.VectorArray.max=function(t,e,r){return Math.max(e[t],r[t])},pd3D.VectorArray.getMajorAxis=function(t){var e=Math.abs(t[0]),r=Math.abs(t[1]),n=Math.abs(t[2]);return r<e&&n<e?t[0]<0?-1:1:n<r?t[1]<0?-2:2:t[2]<0?-3:3},pd3D.VectorArray.length=function(t){return t[2]=+t[2]||0,Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},pd3D.VectorArray.magnitudeInMajorAxis=function(t,e){var r,n;switch(e){default:r=t[0],n=t[1];break;case 1:case-1:r=t[1],n=+t[2]||0;break;case 2:case-2:r=t[0],n=+t[2]||0}return Math.sqrt(r*r+n*n)},pd3D.VectorArray.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},pd3D.VectorArray.closeTo=function(t,e,r){return r=r||pd.Const.EPSILON,Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r},pd3D.VectorArray.closeToInMajorAxis=function(t,e,r,n){switch(n=n||pd.Const.EPSILON,r){default:return Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n;case 1:case-1:return Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n;case 2:case-2:return Math.abs(e[0]-t[0])<=n&&Math.abs(e[2]-t[2])<=n}},pd3D.VectorArray.isOpposite=function(t,e,r){return r=r||pd.Const.EPSILON,Math.abs(e[0]+t[0])<=r&&Math.abs(e[1]+t[1])<=r&&Math.abs(e[2]+t[2])<=r},pd3D.VectorArray.isParallel=function(t,e,r){e=pd3D.VectorArray.cross([],t,e);return r=r||pd.Const.EPSILON,Math.abs(e)<=r&&Math.abs(e)<=r&&Math.abs(e)<=r},pd3D.VectorArray.isColinear=function(t,e,r,n){var i=r[0]-t[0],a=r[1]-t[1],o=r[2]-t[2],s=e[0]-t[0],r=e[1]-t[1],e=e[2]-t[2],t=a*e-o*r,e=o*s-i*e,s=i*r-a*s;return n=n||pd.Const.EPSILON,Math.abs(t)<=n&&Math.abs(e)<=n&&Math.abs(s)<=n},pd3D.VectorArray.isBetween=function(t,e,r){return n(t[0],e[0],r[0])&&n(t[1],e[1],r[1])&&n(t[2],e[2],r[2])},pd3D.VectorArray.toPolarArray=function(t){var e=pd3D.VectorArray.length(t);return e<1e-9?[0,0]:[Math.atan2(t[1],t[0]),Math.asin(t[2]/e)]},pd3D.VectorArray.azimuthOfVector=function(t){return Math.atan2(t[1],t[0])},pd3D.VectorArray.azimuthOfLine=function(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])},pd3D.VectorArray.azimuthBetweenVectors=function(t,e){return Math.atan2(e[1],e[0])-Math.atan2(t[1],t[0])},pd3D.VectorArray.azimuthBetweenPoints=function(t,e,r){return Math.atan2(r[1]-t[1],r[0]-t[0])-Math.atan2(e[1]-t[1],e[0]-t[0])},pd3D.VectorArray.altitudeOfVector=function(t){return t[2]=+t[2]||0,Math.asin(pd.safeDivide(t[2],pd3D.VectorArray.length(t)))},pd3D.VectorArray.altitudeOfLine=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],t=e[2]-t[2],n=Math.sqrt(r*r+n*n+t*t);return Math.asin(pd.safeDivide(t,n))},pd3D.VectorArray.altitudeBetweenVectors=function(t,e){return Math.asin(pd.safeDivide(e[2],pd3D.VectorArray.length(e)))-Math.asin(pd.safeDivide(t[2],pd3D.VectorArray.length(t)))},pd3D.VectorArray.altitudeBetweenPoints=function(t,e,r){return pd3D.VectorArray.altitudeOfLine(t,r)-pd3D.VectorArray.altitudeOfLine(t,e)},pd3D.VectorArray.angleBetweenVectors=function(t,e){var r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],e=pd3D.VectorArray.length(t)*pd3D.VectorArray.length(e),e=pd.safeDivide(r,e);return 1<=e?0:e<=-1?Math.PI:Math.acos(e)},pd3D.VectorArray.angleBetweenPoints=function(t,e,r){var n=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2],o=r[0]-e[0],s=r[1]-e[1],t=r[2]-e[2],r=Math.sqrt(n*n+i*i+a*a),e=Math.sqrt(o*o+s*s+t*t),t=n*o+i*s+a*t,e=pd.safeDivide(t,r*e);return 1<=e?0:e<=-1?Math.PI:Math.acos(e)},pd3D.VectorArray.signedAngleBetweenPoints=function(t,e,r,n){t=pd3D.VectorArray.normalize(pd3D.VectorArray.vectorBetweenPoints([],t,e)),e=pd3D.VectorArray.normalize(pd3D.VectorArray.vectorBetweenPoints([],e,r)),r=pd3D.VectorArray.cross([],t,e),e=pd3D.VectorArray.dot(t,e),e=1<=e?0:e<=-1?Math.PI:Math.acos(e);return pd3D.VectorArray.dot(n,r)<0?-e:e},pd3D.VectorArray.distancePointToPointSquared=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],t=e[2]-t[2];return r*r+n*n+t*t},pd3D.VectorArray.distancePointToPoint=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],t=e[2]-t[2];return Math.sqrt(r*r+n*n+t*t)},pd3D.VectorArray.distanceInMajorAxis=function(t,e,r){var n,i;switch(r){default:n=e[0]-t[0],i=e[1]-t[1];break;case 1:case-1:n=e[1]-t[1],i=e[2]-t[2];break;case 2:case-2:n=e[0]-t[0],i=e[2]-t[2]}return Math.sqrt(n*n+i*i)},pd3D.VectorArray.distanceInVectorDirection=function(t,e,r){var n=pd3D.VectorArray.distancePointToPoint(t,r),r=pd3D.VectorArray.normalize([r[0]-t[0],r[1]-t[1],r[2]-t[2]]),t=e[0]*r[0]+e[1]*r[1]+e[2]*r[2],r=pd3D.VectorArray.length(e)*pd3D.VectorArray.length(r);return pd.constrainTo(pd.safeDivide(t,r),-1,1)*n},pd3D.VectorArray.signedDistanceInVectorDirection=function(t,e,r){t=[r[0]-t[0],r[1]-t[1],r[2]-t[2]],e=pd3D.VectorArray.dot(e,t),t=pd3D.VectorArray.length(t);return pd.sign(e)*t},pd3D.VectorArray.signedMagnitudeInVectorDirection=function(t,e){return pd.sign(pd3D.VectorArray.dot(e,t))*pd3D.VectorArray.length(t)},pd3D.VectorArray.distancePointToLineSegment=function(t,e,r,n){var i=pd3D.VectorArray.distancePointToPoint(e,t),a=pd3D.VectorArray.distancePointToPoint(r,t),o=pd3D.VectorArray.distancePointToPoint(e,r),s=(t[0]-e[0])*(r[0]-e[0])+(t[1]-e[1])*(r[1]-e[1])+(t[2]-e[2])*(r[2]-e[2]),t=pd.constrainTo(pd.safeDivide(s,i*o),-1,1),s=Math.acos(t);if(s>pd.Const.HALF_PI)return n&&pd3D.VectorArray.set(n,e),i;t*=i;return o<t?(n&&pd3D.VectorArray.set(n,r),a):(n&&pd3D.VectorArray.lerpBetween(n,e,r,pd.safeDivide(t,o)),i*Math.sin(s))},pd3D.VectorArray.distanceRayToLineSegment=function(t,e,r,n,i){i=i||[];var a=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],o=[n[0]-r[0],n[1]-r[1],n[2]-r[2]],a=pd3D.VectorArray.cross([],a,o),o=pd3D.VectorArray.add([],r,a),o=pd3D.PlaneArray.createFromTriangle(r,n,o);return!o||pd3D.PlaneArray.intersect(i,t,e,o)||(pd3D.PlaneArray.calcFromNormalAndPoint(o,a,r),pd3D.PlaneArray.intersect(i,t,e,o))?pd3D.VectorArray.distancePointToLineSegment(i,r,n):1/0},pd3D.VectorArray.closestPointOnVector=function(t,e,r,n){n=n||[];t=pd3D.PlaneArray.createFromNormalAndPoint(r,t),r=pd3D.VectorArray.translateInVectorDirection([],e,r,1e3);return pd3D.PlaneArray.intersect(n,e,r,t)||pd3D.VectorArray.set(n,e),n},pd3D.VectorArray.closestPointOnLineSegment=function(t,e,r,n){return pd3D.VectorArray.distancePointToLineSegment(t,e,r,n)},pd3D.VectorArray.triangleArea=function(t,e,r){var n=pd3D.VectorArray.distancePointToPoint(t,e),e=pd3D.VectorArray.distancePointToPoint(e,r),r=pd3D.VectorArray.distancePointToPoint(r,t),t=(n+e+r)/2;return Math.sqrt(t*(t-n)*(t-e)*(t-r))},pd3D.VectorArray.set=function(t,e,r,n){return 2==arguments.length?pd.isArray(e)?(t[0]=+e[0]||0,t[1]=+e[1]||0,t[2]=+e[2]||0):t[0]=t[1]=t[2]=+e||0:(t[0]=+e||0,t[1]=+r||0,t[2]=+n||0),t},pd3D.VectorArray.copyTo=function(t,e){return t[0]=+e[0]||0,t[1]=+e[1]||0,t[2]=+e[2]||0,t},pd3D.VectorArray.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},pd3D.VectorArray.addComponents=function(t,e,r,n,i){return t[0]=e[0]+r,t[1]=e[1]+n,t[2]=e[2]+i,t},pd3D.VectorArray.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},pd3D.VectorArray.subtractComponents=function(t,e,r,n,i){return t[0]=e[0]-r,t[1]=e[1]-n,t[2]=e[2]-i,t},pd3D.VectorArray.negate=function(t,e){return e=e||t,t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},pd3D.VectorArray.normalize=function(t,e){var r=(e=e||t)[0],n=e[1],i=+e[2]||0,e=r*r+n*n+i*i;return 0<e&&(e=1/Math.sqrt(e),t[0]=r*e,t[1]=n*e,t[2]=i*e),t},pd3D.VectorArray.normalizedDirectionVector=function(t,e,r){var n=r[0]-e[0],i=r[1]-e[1],r=+r[2]-+e[2],e=n*n+i*i+r*r;return 0<e&&(e=1/Math.sqrt(e),t[0]=n*e,t[1]=i*e,t[2]=r*e),t},pd3D.VectorArray.cross=function(t,e,r){return t[0]=e[1]*r[2]-e[2]*r[1],t[1]=e[2]*r[0]-e[0]*r[2],t[2]=e[0]*r[1]-e[1]*r[0],t},pd3D.VectorArray.translate=function(t,e,r,n,i){return 3==arguments.length?pd.isArray(r)?(t[0]=e[0]+(+r[0]||0),t[1]=e[1]+(+r[1]||0),t[2]=e[2]+(+r[2]||0)):(r=+r||0,t[0]=e[0]+r,t[1]=e[1]+r,t[2]=e[2]+r):(t[0]=e[0]+(+r||0),t[1]=e[1]+(+n||0),t[2]=e[2]+(+i||0)),t},pd3D.VectorArray.translateInVectorDirection=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},pd3D.VectorArray.scale=function(t,e,r){return pd.isArray(r)?(t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2]):(t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r),t},pd3D.VectorArray.lerp=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},pd3D.VectorArray.lerpBetween=function(t,e,r,n){var i=1-n;return t[0]=i*e[0]+n*r[0],t[1]=i*e[1]+n*r[1],t[2]=i*e[2]+n*r[2],t},pd3D.VectorArray.lerpByDistance=function(t,e,r,n){var i=pd3D.VectorArray.distancePointToPoint(e,r);return 1e-9<i?pd3D.VectorArray.lerpBetween(t,e,r,n/i):(t[0]=e[0],t[1]=e[1],t[2]=+e[2]||0,t)},pd3D.VectorArray.vectorBetweenPoints=function(t,e,r){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t},pd3D.VectorArray.rotateLineSegment=function(t,e,r,n,i,a){a=pd3D.QuatArray.setAxisAngle([],i,a),n=pd3D.VectorArray.distancePointToPoint(r,n),e=pd3D.VectorArray.normalizedDirectionVector([],e,r),n=pd3D.VectorArray.scale([],e,n);return pd3D.VectorArray.applyQuaternion(t,n,a),t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t},pd3D.VectorArray.crossProductFromTriangle=function(t,e,r,n){r=pd3D.VectorArray.vectorBetweenPoints([],e,r),n=pd3D.VectorArray.vectorBetweenPoints([],e,n);return pd3D.VectorArray.cross(t,r,n),!0},pd3D.VectorArray.calcNormalFromTriangle=function(t,e,r,n){pd3D.VectorArray.crossProductFromTriangle(t,e,r,n);var i=t[0],e=t[1],r=t[2],n=i*i+e*e+r*r;return 0<n&&(n=1/Math.sqrt(n),t[0]=i*n,t[1]=e*n,t[2]=r*n,!0)},pd3D.VectorArray.calcNormalFromPath=function(t,e){if(2<e.length){var r=e.length,n=[0,0,0],i=0;t[0]=t[1]=t[2]=0;for(var a=2;a<r;++a)pd3D.VectorArray.calcNormalFromTriangle(n,e[0],e[a-1],e[a])&&(t[0]+=n[0],t[1]+=n[1],t[2]+=n[2],++i);if(0<i)return pd3D.VectorArray.normalize(t),!0}return!1},pd3D.VectorArray.applyMatrix=function(t,e,r){var n=+e[0]||0,i=+e[1]||0,e=+e[2]||0;return t[0]=r[0]*n+r[4]*i+r[8]*e+r[12],t[1]=r[1]*n+r[5]*i+r[9]*e+r[13],t[2]=r[2]*n+r[6]*i+r[10]*e+r[14],t},pd3D.VectorArray.applyQuaternion=function(t,e,r){var n=+e[0]||0,i=+e[1]||0,a=+e[2]||0,o=+r[0]||0,s=+r[1]||0,d=+r[2]||0,h=+r[3]||0,l=h*n+s*a-d*i,e=h*i+d*n-o*a,r=h*a+o*i-s*n,a=-o*n-s*i-d*a;return t[0]=l*h+a*-o+e*-d-r*-s,t[1]=e*h+a*-s+r*-o-l*-d,t[2]=r*h+a*-d+l*-s-e*-o,t},pd3D.VectorArray.sphericalToCartesian=function(t,e,r,n){var i=Math.cos(e),a=Math.sin(e),e=Math.cos(r),r=Math.sin(r),e=n*e;return t[0]=e*i,t[1]=e*a,t[2]=n*r,t},pd3D.VectorArray.intersectLinesInMajorAxis=function(t,e,r,n,i,a){var o,s,d;switch(Math.abs(a)){default:o=0,s=1,d=2;break;case 1:o=1,s=2,d=0;break;case 2:o=0,s=2,d=1}var h=r[o]-e[o],l=r[s]-e[s],c=i[o]-n[o],u=i[s]-n[s],p=u*h-c*l;if(pd.closeTo(p,0))return!1;var a=h*(f=e[s]-n[s])-l*(m=e[o]-n[o]),f=(c*f-u*m)/p,m=a/p;return t[o]=e[o]+f*h,t[s]=e[s]+f*l,t[d]=.25*(e[d]+r[d]+n[d]+i[d]),!0},pd3D.VectorArray.intersectLines3D=function(t,e,r,n,i,a){var o=pd3D.VectorArray.vectorBetweenPoints([],e,r),n=pd3D.VectorArray.vectorBetweenPoints([],n,i),i=pd3D.VectorArray.create();a?pd3D.VectorArray.set(i,a):pd3D.VectorArray.cross(i,o,n);i=pd3D.VectorArray.cross([],n,i),i=pd3D.PlaneArray.createFromNormalAndPoint(i,r);return pd3D.PlaneArray.intersect(t,e,r,i)},pd3D.VectorArray.intersectSphere3D=function(t,e,r,n,i){var a=pd3D.VectorArray.subtract([],n,e),n=pd3D.VectorArray.normalize(pd3D.VectorArray.subtract([],r,e)),r=pd3D.VectorArray.dot(a,n),a=pd3D.VectorArray.dot(a,a)-r*r,i=i*i;if(i<a)return!1;i=Math.sqrt(i-a),a=r-i,r+=i;return r<a&&(i=a,a=r,r=i),!(a<0&&(a=r)<0)&&(t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,!0)},pd3D.VectorArray.spline=function(t){var e,r=[],d=(t=t||{}).vertices||[],h=pd.toInteger(t.degree,2),n=pd.toNumber(t.increment,.05),l=t.weights||null,c=t.knots||null,u=d[0].length,p=d.length;if(h<1)throw new Error("degree must be at least 1 (linear)");if(p<=h)throw new Error("degree must be less than vertex count");if(!l)for(l=[],e=0;e<p;++e)l[e]=1;if(c){if(c.length!==p+h+1)throw new Error("Bad knot vector length")}else{for(c=[],e=0;e<h+1;++e)c[e]=0;for(e=3;e<p;++e)c[e]=p-2;for(e=0;e<h+1;++e)c[p+e]=p-1}var f=[h,c.length-1-h],m=c[f[1]],g=c[f[0]];for(var i=1+.5*n,a=0;a<i;a+=n)r.push(function(t,e){var r,n,i,a;if((t=t*(m-g)+g)<g||m<t)throw new Error("Parameter 't' is out of bounds");for(i=f[0];i<f[1]&&!(t>=c[i]&&t<=c[i+1]);++i);for(var o=[],s=0;s<p;++s){for(o[s]=[],n=0;n<u;++n)o[s][n]=d[s][n]*l[s];o[s][u]=l[s]}for(a=1;a<=h+1;++a)for(s=i;i-h-1+a<s;s--)for(r=(t-c[s])/(c[s+h+1-a]-c[s]),n=0;n<u+1;++n)o[s][n]=(1-r)*o[s-1][n]+r*o[s][n];for(e=e||[],s=0;s<u;++s)e[s]=o[i][s]/o[i][u];return e}(Math.min(a,1)));return r},pd3D.VectorArray.toString=function(t){return"[ "+pd.toStringWithPrecisionRange(t[0],1,9)+", "+pd.toStringWithPrecisionRange(t[1],1,9)+", "+pd.toStringWithPrecisionRange(t[2],1,9)+" ]"},pd3D.PlaneArray={},pd3D.PlaneArray.create=function(t,e,r,n){return[+t||0,+e||0,+r||0,+n||0]},pd3D.PlaneArray.createFromNormalAndPoint=function(t,e){return pd3D.PlaneArray.calcFromNormalAndPoint([],t,e)},pd3D.PlaneArray.createFromPoints=function(t,e,r){var n=pd3D.VectorArray.vectorBetweenPoints([],t,e),r=pd3D.VectorArray.vectorBetweenPoints([],t,r),r=pd3D.VectorArray.cross([],n,r);return pd3D.VectorArray.normalize(r),[r[0],r[1],r[2],-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2])]},pd3D.PlaneArray.createFromTriangle=function(t,e,r){var n=[];return pd3D.VectorArray.calcNormalFromTriangle(n,t,e,r)?(n[3]=-(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]),n):null},pd3D.PlaneArray.createFromPath=function(t){var e=[];return pd3D.VectorArray.calcNormalFromPath(e,t)?pd3D.PlaneArray.createFromNormalAndPoint(e,t[0]):null},pd3D.PlaneArray.set=function(t,e,r,n,i){return 2==arguments.length?pd.isArray(e)?(t[0]=+e[0]||0,t[1]=+e[1]||0,t[2]=+e[2]||0,t[3]=+e[2]||0):t[0]=t[1]=t[2]=t[3]=+e||0:(t[0]=+e||0,t[1]=+r||0,t[2]=+n||0,t[3]=+i||0),t},pd3D.PlaneArray.calcFromNormalAndPoint=function(t,e,r){var n=r[0],i=r[1],r=+r[2]||0;return t[0]=e[0],t[1]=e[1],t[2]=+e[2]||0,pd3D.VectorArray.normalize(t),t[3]=-(t[0]*n+t[1]*i+t[2]*r),t},pd3D.PlaneArray.calcFromTriangle=function(t,e,r,n){return!!pd3D.VectorArray.calcNormalFromTriangle(t,e,r,n)&&(t[3]=-(t[0]*e[0]+t[1]*e[1]+t[2]*e[2]),!0)},pd3D.PlaneArray.calcFromPath=function(t,e){if(pd3D.VectorArray.calcNormalFromPath(t,e)){e=e[0];return t[3]=-(t[0]*e[0]+t[1]*e[1]+t[2]*e[2]),!0}return!1},pd3D.PlaneArray.isPathPlanar=function(t,e,r){if(pd.isArray(e)&&2<e.length){var n;r=pd.toNumber(r,.001);for(var i=0,a=e.length;i<a;++i)if(n=e[i],r<pd3D.PlaneArray.distanceTo(n,t))return!1;return!0}return!1},pd3D.PlaneArray.sameOrientation=pd3D.VectorArray.closeTo,pd3D.PlaneArray.oppositeOrientation=pd3D.VectorArray.isOpposite,pd3D.PlaneArray.isParallel=pd3D.VectorArray.isParallel,pd3D.PlaneArray.distanceTo=function(t,e){return Math.abs(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3])},pd3D.PlaneArray.signedDistanceTo=function(t,e){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},pd3D.PlaneArray.inFront=function(t,e){return-1e-6<=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},pd3D.PlaneArray.sameSide=function(t,e,r){return-1e-6<=(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3])*(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3])},pd3D.PlaneArray.clockwiseWinding=function(t,e,r,n){var i=(e[1]-t[1])*(r[2]-t[2])-(r[1]-t[1])*(e[2]-t[2]),a=(e[2]-t[2])*(r[0]-t[0])-(r[2]-t[2])*(e[0]-t[0]),t=(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]);return 0<=i*n[0]+a*n[1]+t*n[2]},pd3D.PlaneArray.insideTriangle=function(t,e,r,n,i){var a=pd3D.PlaneArray.clockwiseWinding(e,r,t,i),r=pd3D.PlaneArray.clockwiseWinding(r,n,t,i);return a==r&&r==pd3D.PlaneArray.clockwiseWinding(n,e,t,i)},pd3D.PlaneArray.intersect=function(t,e,r,n){e[2]=+e[2]||0,r[2]=+r[2]||0;var i=-(n[0]*e[0])-n[1]*e[1]-n[2]*e[2]-n[3],n=n[0]*r[0]-n[0]*e[0]+(n[1]*r[1]-n[1]*e[1])+(n[2]*r[2]-n[2]*e[2]);if(Math.abs(n)<pd.Const.EPSILON)return!1;n=i/n;return t[0]=n*(r[0]-e[0])+e[0],t[1]=n*(r[1]-e[1])+e[1],t[2]=n*(r[2]-e[2])+e[2],!0},pd3D.PlaneArray.intersectRay=function(t,e,r,n){r=pd3D.VectorArray.translateInVectorDirection([],e,r,1e3);return pd3D.PlaneArray.intersect(t,e,r,n)},pd3D.PlaneArray.closestPoint=function(t,e,r){var n=pd3D.VectorArray.subtract([],e,r);return pd3D.PlaneArray.intersect(t,e,n,r)},pd3D.PlaneArray.closestAxialPoint=function(t,e,r){var n,i,a,o,s=-1,d=1/0;switch(Math.abs(r[0])>pd.Const.EPSILON&&(i=-(r[1]*e[1]+r[2]*e[2]+r[3])/r[0],(n=Math.abs(e[0]-i))<d&&(d=n,s=0)),Math.abs(r[1])>pd.Const.EPSILON&&(a=-(r[0]*e[0]+r[2]*e[2]+r[3])/r[1],(n=Math.abs(e[1]-a))<d&&(d=n,s=1)),Math.abs(r[1])>pd.Const.EPSILON&&(o=-(r[0]*e[0]+r[2]*e[1]+r[1])/r[2],(n=Math.abs(e[2]-o))<d&&(d=n,s=2)),s){case 0:return t[0]=i,t[1]=e[1],t[2]=e[2],!0;case 1:return t[0]=e[0],t[1]=a,t[2]=e[2],!0;case 2:return t[0]=e[0],t[1]=e[1],t[2]=o,!0}return!1},pd3D.PlaneArray.closestPointInGivenAxis=function(t,e,r,n){var i=e[0],a=e[1],e=+e[2]||0;switch(n){default:if(Math.abs(r[2])>pd.Const.EPSILON)return t[0]=i,t[1]=a,t[2]=-(r[0]*i+r[1]*a+r[3])/r[2],!0;break;case 0:if(Math.abs(r[0])>pd.Const.EPSILON)return t[0]=-(r[1]*a+r[2]*e+r[3])/r[0],t[1]=a,t[2]=e,!0;break;case 1:if(Math.abs(r[1])>pd.Const.EPSILON)return t[0]=i,t[1]=-(r[0]*i+r[2]*e+r[3])/r[1],t[2]=e,!0}return!1},pd3D.PlaneArray.makePathPlanar=function(t,e,r){var n,i=!1;if(pd.isArray(t)){r=pd.toNumber(r,.001);for(var a=0,o=t.length;a<o;++a)n=t[a],r<pd3D.PlaneArray.distanceTo(n,e)&&pd3D.PlaneArray.intersectRay(n,n,e,e)&&(i=!0)}return i},pd3D.QuatArray={},pd3D.QuatArray.create=function(t,e,r,n){return[+t||0,+e||0,+r||0,+n||0]},pd3D.QuatArray.normalize=function(t,e){var r=+(e=e||t)[0]||0,n=+e[1]||0,i=+e[2]||0,a=+e[3]||0,a=r*r+n*n+i*i+a*a;return 0<a&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a),t},pd3D.QuatArray.invert=function(t,e){var r=+(e=e||t)[0]||0,n=+e[1]||0,i=+e[2]||0,a=+e[3]||0,e=r*r+n*n+i*i+a*a,e=e?1/e:0;return t[0]=-r*e,t[1]=-n*e,t[2]=-i*e,t[3]=a*e,t},pd3D.QuatArray.conjugate=function(t,e){return e=e||t,t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},pd3D.QuatArray.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],d=r[1],e=r[2],r=r[3];return t[0]=n*r+i*e-a*d+o*s,t[1]=-n*e+i*r+a*s+o*d,t[2]=n*d-i*s+a*r+o*e,t[3]=-n*s-i*d-a*e+o*r,t},pd3D.QuatArray.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},pd3D.QuatArray.setAxisAngle=function(t,e,r){e*=.5;var n=Math.sin(e);return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=Math.cos(e),t},pd3D.QuatArray.rotateBetweenVectors=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],d=r[2],e=n*o+i*s+a*d,r=t[0]=i*d-a*s,d=t[1]=a*o-n*d,o=t[2]=n*s-i*o;return t[3]=e+Math.sqrt(e*e+r*r+d*d+o*o),pd3D.QuatArray.normalize(t)},pd3D.QuatArray.toMatrixArray4x4=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],e=1/Math.sqrt(r*r+n*n+i*i+a*a);return r*=e,a*=e,(t=t||[])[0]=1-2*(n*=e)*n-2*(i*=e)*i,t[1]=2*r*n-2*i*a,t[2]=2*r*i+2*n*a,t[3]=0,t[4]=2*r*n+2*i*a,t[5]=1-2*r*r-2*i*i,t[6]=2*n*i-2*r*a,t[7]=0,t[8]=2*r*i-2*n*a,t[9]=2*n*i+2*r*a,t[10]=1-2*r*r-2*n*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},pd3D.BBoxArray={},pd3D.BBoxArray.create=function(t,e,r){var n={};return t=t||[-1,-1,0],e=e||[1,1,1],n.min=pd3D.VectorArray.create(Math.min(t[0],e[0]),Math.min(t[1],e[1]),Math.min(t[2],e[2])),n.max=pd3D.VectorArray.create(Math.max(t[0],e[0]),Math.max(t[1],e[1]),Math.max(t[2],e[2])),n.axis=pd.toInteger(r,0),n},pd3D.BBoxArray.createFromCenterAndSize=function(t,e,r){var n,i={};return t[0]=pd.toNumber(t[0],0),t[1]=pd.toNumber(t[1],0),t[2]=pd.toNumber(t[2],0),pd.isArray(e)?(e[0]=.5*pd.toNumber(e[0],1),e[1]=.5*pd.toNumber(e[1],1),e[2]=.5*pd.toNumber(e[2],1)):e=[n=.5*pd.toNumber(e,1),n,n],i.min=pd3D.VectorArray.create(t[0]-e[0],t[0]-e[1],t[0]-e[2]),i.max=pd3D.VectorArray.create(t[0]+e[0],t[0]+e[1],t[0]+e[2]),i.axis=pd.toInteger(r,0),i},pd3D.BBoxArray.createFromExtentsArray=function(t,e){var r={};return r.min=pd3D.VectorArray.create(pd.toNumber(t[0],0),pd.toNumber(t[1],0),pd.toNumber(t[2],0)),r.max=pd3D.VectorArray.create(pd.toNumber(t[3],1),pd.toNumber(t[4],1),pd.toNumber(t[5],1)),r.axis=pd.toInteger(e,0),r},pd3D.BBoxArray.minBound=function(t,e,r){return Math.min(e.min[t],r.min[t])},pd3D.BBoxArray.maxBound=function(t,e,r){return Math.max(e.max[t],r.max[t])},pd3D.BBoxArray.containsPoint=function(t,e,r){var n=t.min,t=t.max;return r=pd.toNumber(r,0),e[0]>=n[0]-r&&e[0]<=t[0]+r&&e[1]>=n[1]-r&&e[1]<=t[1]+r&&e[2]>=n[2]-r&&e[2]<=t[2]+r},pd3D.BBoxArray.containsPointInMajorAxis=function(t,e,r,n){var i=t.min,t=t.max;switch(n=pd.toNumber(n,0),r){default:return e[0]>=i[0]-n&&e[0]<=t[0]+n&&e[1]>=i[1]-n&&e[1]<=t[1]+n;case 1:case-1:return e[1]>=i[1]-n&&e[1]<=t[1]+n&&e[2]>=i[2]-n&&e[2]<=t[2]+n;case 2:case-2:return e[0]>=i[0]-n&&e[0]<=t[0]+n&&e[2]>=i[2]-n&&e[2]<=t[2]+n}},pd3D.BBoxArray.containsBox=function(t,e,r){return!(!pd3D.BBoxArray.containsPoint(t,e.min,r)||!pd3D.BBoxArray.containsPoint(t,e.max,r))},pd3D.BBoxArray.overlap=function(t,e,r){return r=pd.toNumber(r,0),t.min[0]<=e.max[0]+r&&t.max[0]>=e.min[0]-r&&t.min[1]<=e.max[1]+r&&t.max[1]>=e.min[1]-r&&t.min[2]<=e.max[2]+r&&t.max[2]>=e.min[2]-r},pd3D.BBoxArray.horzQuadrant=function(t,e,r){var n=t.min,t=t.max;return r=pd.toNumber(r,0),e[0]>t[0]+r?e[1]>t[1]?2:e[1]<n[1]?-2:e[1]<.5*(t[1]+n[1])?-1:1:e[0]<n[0]-r?e[1]>t[1]?5:e[1]<n[1]?-5:e[1]<.5*(t[1]+n[1])?-6:6:e[1]>t[1]+r?e[0]<.5*(t[0]+n[0])?4:3:e[1]<n[1]-r?e[0]<.5*(t[0]+n[0])?-4:-3:0},pd3D.BBoxArray.reset=function(t){return pd3D.VectorArray.set(t.min,1/0,1/0,1/0),pd3D.VectorArray.set(t.max,-1/0,-1/0,-1/0),t.axis=0,t},pd3D.BBoxArray.set=function(t,e,r,n){return pd3D.VectorArray.set(t.min,Math.min(e[0],r[0]),Math.min(e[1],r[1]),Math.min(e[2],r[2])),pd3D.VectorArray.set(t.max,Math.max(e[0],r[0]),Math.max(e[1],r[1]),Math.max(e[2],r[2])),t.axis=pd.toInteger(n,0),t},pd3D.BBoxArray.copy=function(t,e){return pd3D.BBoxArray.set(t,e.min,e.max,e.axis)},pd3D.BBoxArray.setFromCenterAndSize=function(t,e,r,n){var i;return e[0]=pd.toNumber(e[0],0),e[1]=pd.toNumber(e[1],0),e[2]=pd.toNumber(e[2],0),pd.isArray(r)?(r[0]=.5*pd.toNumber(r[0],1),r[1]=.5*pd.toNumber(r[1],1),r[2]=.5*pd.toNumber(r[2],1)):r=[i=.5*pd.toNumber(r,1),i,i],pd3D.VectorArray.set(t.min,e[0]-r[0],e[0]-r[1],e[0]-r[2]),pd3D.VectorArray.set(t.max,e[0]+r[0],e[0]+r[1],e[0]+r[2]),t.axis=pd.toInteger(n,0),t},pd3D.BBoxArray.moveBy=function(t,e,r,n){var i=t.min,a=t.max;return pd.isNumeric(e)&&(i[0]+=e,a[0]+=e),pd.isNumeric(r)&&(i[1]+=r,a[1]+=r),pd.isNumeric(n)&&(i[2]+=n,a[2]+=n),t},pd3D.BBoxArray.expand=function(t,e,r,n){var i=t.min,a=t.max;return pd.isNumeric(e)&&(i[0]-=e,a[0]+=e),pd.isNumeric(r)&&(i[1]-=r,a[1]+=r),pd.isNumeric(n)&&(i[2]-=n,a[2]+=n),t},pd3D.BBoxArray.includePoint=function(t,e){var r=t.min,n=t.max;return r[0]>e[0]&&(r[0]=e[0]),r[1]>e[1]&&(r[1]=e[1]),r[2]>e[2]&&(r[2]=e[2]),n[0]<e[0]&&(n[0]=e[0]),n[1]<e[1]&&(n[1]=e[1]),n[2]<e[2]&&(n[2]=e[2]),t},pd3D.BBoxArray.includeBox=function(t,e){var r=t.min,n=t.max;return r[0]>e.min[0]&&(r[0]=e.min[0]),r[1]>e.min[1]&&(r[1]=e.min[1]),r[2]>e.min[2]&&(r[2]=e.min[2]),n[0]<e.max[0]&&(n[0]=e.max[0]),n[1]<e.max[1]&&(n[1]=e.max[1]),n[2]<e.max[2]&&(n[2]=e.max[2]),t},pd3D.BBoxArray.updateCorners=function(t){var e=t.min,r=t.max;return pd.isArray(t.corners)||(t.corners=[]),8!=t.corners.length?(t.corners.length=8,t.corners[0]=[e[0],e[1],e[2]],t.corners[1]=[r[0],e[1],e[2]],t.corners[2]=[r[0],r[1],e[2]],t.corners[3]=[e[0],r[1],e[2]],t.corners[4]=[e[0],e[1],r[2]],t.corners[5]=[r[0],e[1],r[2]],t.corners[6]=[r[0],r[1],r[2]],t.corners[7]=[e[0],r[1],r[2]]):(pd3D.VectorArray.set(t.corners[0],e[0],e[1],e[2]),pd3D.VectorArray.set(t.corners[1],r[0],e[1],e[2]),pd3D.VectorArray.set(t.corners[2],r[0],r[1],e[2]),pd3D.VectorArray.set(t.corners[3],e[0],r[1],e[2]),pd3D.VectorArray.set(t.corners[4],e[0],e[1],r[2]),pd3D.VectorArray.set(t.corners[5],r[0],e[1],r[2]),pd3D.VectorArray.set(t.corners[6],r[0],r[1],r[2]),pd3D.VectorArray.set(t.corners[7],e[0],r[1],r[2])),t};var l=pd3D.VectorArray.create();function c(t,e,r,n){if(0!=r[0]){var i=(n-e[0])/r[0];return t[0]=n,t[1]=e[1]+i*r[1],t[2]=e[2]+i*r[2],1}}function u(t,e,r,n){if(0!=r[1]){var i=(n-e[1])/r[1];return t[0]=e[0]+i*r[0],t[1]=n,t[2]=e[2]+i*r[2],1}}function p(t,e,r,n){if(0!=r[2]){var i=(n-e[2])/r[2];return t[0]=e[0]+i*r[0],t[1]=e[1]+i*r[1],t[2]=n,1}}function d(t,e,r){t.triangles&&(t.addTriangle(e[0],e[1],e[2]),t.addTriangle(e[0],e[2],e[3]),t.addTriangle(e[4],e[5],e[6]),t.addTriangle(e[4],e[6],e[7])),r&&t.lines&&(t.addLine(e[0],e[1]),t.addLine(e[1],e[2]),t.addLine(e[2],e[3]),t.addLine(e[3],e[0]),t.addLine(e[4],e[5]),t.addLine(e[5],e[6]),t.addLine(e[6],e[7]),t.addLine(e[7],e[4]),t.addLine(e[0],e[7]),t.addLine(e[1],e[6]),t.addLine(e[2],e[5]),t.addLine(e[3],e[4]))}pd3D.BBoxArray.intersectRay=function(t,e,r,n){var i,a=Number.MAX_VALUE,o=l,s=t.min,t=t.max;return e[(n=n||[]).axis=0]>s[0]&&e[0]<t[0]&&e[1]>s[1]&&e[1]<t[1]&&e[2]>s[2]&&e[2]<t[2]?(r[0]<0&&c(o,e,r,s[0])&&o[1]>=s[1]&&o[1]<=t[1]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=-1,a=i),0<r[0]&&c(o,e,r,t[0])&&o[1]>=s[1]&&o[1]<=t[1]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=1,a=i),r[1]<0&&u(o,e,r,s[1])&&o[0]>=s[0]&&o[0]<=t[0]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=-2,a=i),0<r[1]&&u(o,e,r,t[1])&&o[0]>=s[0]&&o[0]<=t[0]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=2,a=i),r[2]<0&&p(o,e,r,s[2])&&o[0]>=s[0]&&o[0]<=t[0]&&o[1]>=s[1]&&o[1]<=t[1]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=-3,a=i),0<r[2]&&p(o,e,r,t[2])&&o[0]>=s[0]&&o[0]<=t[0]&&o[1]>=s[1]&&o[1]<=t[1]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=3,a=i)):(0<r[0]&&e[0]<=s[0]&&c(o,e,r,s[0])&&o[1]>=s[1]&&o[1]<=t[1]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=-1,a=i),r[0]<0&&e[0]>=t[0]&&c(o,e,r,t[0])&&o[1]>=s[1]&&o[1]<=t[1]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=1,a=i),0<r[1]&&e[1]<=s[1]&&u(o,e,r,s[1])&&o[0]>=s[0]&&o[0]<=t[0]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=-2,a=i),r[1]<0&&e[1]>=t[1]&&u(o,e,r,t[1])&&o[0]>=s[0]&&o[0]<=t[0]&&o[2]>=s[2]&&o[2]<=t[2]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=2,a=i),0<r[2]&&e[2]<=s[2]&&p(o,e,r,s[2])&&o[0]>=s[0]&&o[0]<=t[0]&&o[1]>=s[1]&&o[1]<=t[1]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=-3,a=i),r[2]<0&&e[2]>=t[2]&&p(o,e,r,t[2])&&o[0]>=s[0]&&o[0]<=t[0]&&o[1]>=s[1]&&o[1]<=t[1]&&(i=pd3D.VectorArray.distancePointToPointSquared(e,o))<a&&(pd3D.VectorArray.set(n,o),n.axis=3,a=i)),n.axis?n:null},pd3D.BBoxArray.intersect=function(t,e,r,n){r=[r[0]-e[0],r[1]-e[1],r[2]-e[2]];return pd3D.BBoxArray.intersectRay(t,e,r,n)},pd3D.BBoxArray.intersectFace=function(t,e,r,n,i,a){var o,s=Number.MAX_VALUE,d=l,h=[n[0]-r[0],n[1]-r[1],n[2]-r[2]],n=t.min,t=t.max;switch(i=pd.toBoolean(i,!1),(a=a||[]).axis=0,e){default:Math.abs(h[0])>pd.Const.EPSILON&&(c(d,r,h,n[0])&&d[1]>=n[1]&&d[1]<=t[1]&&d[2]>=n[2]&&d[2]<=t[2]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=-1,s=o),i&&c(d,r,h,.5*(t[0]+n[0]))&&d[1]>=n[1]&&d[1]<=t[1]&&d[2]>=n[2]&&d[2]<=t[2]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=1,s=o),c(d,r,h,t[0])&&d[1]>=n[1]&&d[1]<=t[1]&&d[2]>=n[2]&&d[2]<=t[2]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=1,s=o));break;case 1:Math.abs(h[1])>pd.Const.EPSILON&&(u(d,r,h,n[1])&&d[0]>=n[0]&&d[0]<=t[0]&&d[2]>=n[2]&&d[2]<=t[2]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=-2,s=o),i&&u(d,r,h,.5*(t[1]+n[1]))&&d[0]>=n[0]&&d[0]<=t[0]&&d[2]>=n[2]&&d[2]<=t[2]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=2,s=o),u(d,r,h,t[1])&&d[0]>=n[0]&&d[0]<=t[0]&&d[2]>=n[2]&&d[2]<=t[2]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=2,s=o));break;case 2:Math.abs(h[2])>pd.Const.EPSILON&&(p(d,r,h,n[2])&&d[0]>=n[0]&&d[0]<=t[0]&&d[1]>=n[1]&&d[1]<=t[1]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=-3,s=o),i&&p(d,r,h,.5*(t[2]+n[2]))&&d[0]>=n[0]&&d[0]<=t[0]&&d[1]>=n[1]&&d[1]<=t[1]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=3,s=o),p(d,r,h,t[2])&&d[0]>=n[0]&&d[0]<=t[0]&&d[1]>=n[1]&&d[1]<=t[1]&&(o=pd3D.VectorArray.distancePointToPointSquared(r,d))<s&&(pd3D.VectorArray.set(a,d),a.axis=3,s=o))}return a.axis?a:null},pd3D.BBoxArray.constrainPoint=function(t,e,r){var n=t.min,i=t.max,t=!1;return r=pd.toNumber(r,0),e[0]<n[0]+r&&(e[0]=n[0]+r,t=!0),e[0]>i[0]-r&&(e[0]=i[0]-r,t=!0),e[1]<n[1]+r&&(e[1]=n[1]+r,t=!0),e[1]>i[1]-r&&(e[1]=i[1]-r,t=!0),e[2]<n[2]+r&&(e[2]=n[2]+r,t=!0),e[2]>i[2]-r&&(e[2]=i[2]-r,t=!0),t},pd3D.BBoxArray.calculateUVW=function(t,e,r){r=r||[];var n=t.min,t=t.max;return r[0]=pd.safeDivide(e[0]-n[0],t[0]-n[0]),r[1]=pd.safeDivide(e[1]-n[1],t[1]-n[1]),r[2]=pd.safeDivide(e[2]-n[2],t[2]-n[2]),r},pd3D.BBoxArray.copyToMesh=function(t,e,r){if(t&&e){r=r||{};var n=pd.toInteger(r.ignoreAxis,Math.abs(pd.toInteger(t.axis,0))),i=pd.toBoolean(r.outlines,e.hasLines&&e.lines),a=pd.toBoolean(r.flip,!1);pd.isArray(t.corners)&&8==t.corners.length||pd3D.BBoxArray.updateCorners(t);var o=t.corners;if(i&&!e.lines&&e.addIndexBuffer("lines"),r.color&&pd.isArray(r.color)&&e.color(r.color),e.hasVertexNormals&&e.normals){r=new Array(8);a?(1!=n&&(e.normal([0,1,0]),r[0]=e.addVertex(o[0]),r[1]=e.addVertex(o[4]),r[2]=e.addVertex(o[5]),r[3]=e.addVertex(o[1]),e.normal([0,-1,0]),r[4]=e.addVertex(o[2]),r[5]=e.addVertex(o[6]),r[6]=e.addVertex(o[7]),r[7]=e.addVertex(o[3]),d(e,r,i),i=!1),2!=n&&(e.normal([1,0,0]),r[0]=e.addVertex(o[0]),r[1]=e.addVertex(o[3]),r[2]=e.addVertex(o[7]),r[3]=e.addVertex(o[4]),e.normal([-1,0,0]),r[4]=e.addVertex(o[5]),r[5]=e.addVertex(o[6]),r[6]=e.addVertex(o[2]),r[7]=e.addVertex(o[1]),d(e,r,i),i=!1),3!=n&&(e.normal([0,0,1]),r[0]=e.addVertex(o[0]),r[1]=e.addVertex(o[1]),r[2]=e.addVertex(o[2]),r[3]=e.addVertex(o[3]),e.normal([0,0,-1]),r[4]=e.addVertex(o[7]),r[5]=e.addVertex(o[6]),r[6]=e.addVertex(o[5]),r[7]=e.addVertex(o[4]),d(e,r,i),i=!1)):(1!=n&&(e.normal([0,-1,0]),r[0]=e.addVertex(o[0]),r[1]=e.addVertex(o[1]),r[2]=e.addVertex(o[5]),r[3]=e.addVertex(o[4]),e.normal([0,1,0]),r[4]=e.addVertex(o[7]),r[5]=e.addVertex(o[6]),r[6]=e.addVertex(o[2]),r[7]=e.addVertex(o[3]),d(e,r,i),i=!1),2!=n&&(e.normal([-1,0,0]),r[0]=e.addVertex(o[0]),r[1]=e.addVertex(o[4]),r[2]=e.addVertex(o[7]),r[3]=e.addVertex(o[3]),e.normal([1,0,0]),r[4]=e.addVertex(o[2]),r[5]=e.addVertex(o[6]),r[6]=e.addVertex(o[5]),r[7]=e.addVertex(o[1]),d(e,r,i),i=!1),3!=n&&(e.normal([0,0,-1]),r[0]=e.addVertex(o[0]),r[1]=e.addVertex(o[3]),r[2]=e.addVertex(o[2]),r[3]=e.addVertex(o[1]),e.normal([0,0,1]),r[4]=e.addVertex(o[5]),r[5]=e.addVertex(o[6]),r[6]=e.addVertex(o[7]),r[7]=e.addVertex(o[4]),d(e,r,i),i=!1))}else{for(var i=e.vertexCount(),s=0;s<8;++s)e.addVertex(o[s]);a?(1!=n&&(e.addTriangle(i+0,i+4,i+5),e.addTriangle(i+0,i+5,i+1),e.addTriangle(i+2,i+6,i+7),e.addTriangle(i+2,i+7,i+3)),2!=n&&(e.addTriangle(i+0,i+3,i+7),e.addTriangle(i+0,i+7,i+4),e.addTriangle(i+1,i+5,i+6),e.addTriangle(i+1,i+6,i+2)),3!=n&&(e.addTriangle(i+0,i+1,i+2),e.addTriangle(i+0,i+2,i+3),e.addTriangle(i+4,i+7,i+6),e.addTriangle(i+4,i+6,i+5))):(1!=n&&(e.addTriangle(i+0,i+4,i+7),e.addTriangle(i+0,i+7,i+3),e.addTriangle(i+1,i+2,i+6),e.addTriangle(i+1,i+6,i+5)),2!=n&&(e.addTriangle(i+0,i+1,i+5),e.addTriangle(i+0,i+5,i+4),e.addTriangle(i+2,i+3,i+7),e.addTriangle(i+2,i+7,i+6)),3!=n&&(e.addTriangle(i+0,i+3,i+2),e.addTriangle(i+0,i+2,i+1),e.addTriangle(i+4,i+5,i+6),e.addTriangle(i+4,i+6,i+7)))}}return t},pd3D.BBoxArray.copyOutlineToMesh=function(t,e){if(t&&e){pd.isArray(t.corners)&&8==t.corners.length||pd3D.BBoxArray.updateCorners(t);for(var r=t.corners,n=e.vertexCount(),i=0;i<8;++i)e.addVertex(r[i]);e.addLine(n+0,n+1),e.addLine(n+1,n+2),e.addLine(n+2,n+3),e.addLine(n+3,n+0),e.addLine(n+4,n+5),e.addLine(n+5,n+6),e.addLine(n+6,n+7),e.addLine(n+7,n+4),e.addLine(n+0,n+4),e.addLine(n+1,n+5),e.addLine(n+2,n+6),e.addLine(n+3,n+7)}return t},pd3D.Polyline=function(t){t=t||{},this.contours=pd.isArray(t.contours)?t.contours:[],this.flags=0,this.onChange=null,"hasChanged"in t&&(this.hasChanged=pd.toBoolean(t.hasChanged,!1)),"isClosed"in t?this.isClosed=pd.toBoolean(t.isClosed,!1):"closed"in t&&(this.isClosed=pd.toBoolean(t.closed,!1))};Object.defineProperty(pd3D.Polyline.prototype,"hasChanged",{get:function(){return 1&this.flags},set:function(t){t?this.flags|=1:1&this.flags&&--this.flags}}),Object.defineProperty(pd3D.Polyline.prototype,"isClosed",{get:function(){return 2&this.flags},set:function(t){t?this.flags|=2:2&this.flags&&(this.flags-=2)}}),Object.defineProperty(pd3D.Polyline.prototype,"isPlanar",{get:function(){return!(4&this.flags)},set:function(t){t?4&this.flags&&(this.flags-=4):this.flags|=4}}),Object.defineProperty(pd3D.Polyline.prototype,"isNotPlanar",{get:function(){return 4&this.flags},set:function(t){t?this.flags|=4:4&this.flags&&(this.flags-=4)}}),pd3D.Polyline.prototype.clone=function(t,e){var r,n,i,a,o=this.contours,s=o.length;e=e||new pd3D.Polyline,pd.isArray(t)||(t=pd3D.VectorArray.origin);for(var d=0;d<s;++d){r=o[d],null==(i=e.contours[d])&&(i=e.contours[d]=[]);for(var h=0,l=r.length;h<l;++h)n=r[h],null==(a=i[h])&&(a=i[h]=[]),a[0]=n[0]+t[0],a[1]=n[1]+t[1],a[2]=n[2]+t[2];e.contours[d].length=r.length}return e.contours.length=s,e.hasChanged=!0,e.onChange&&e.onChange(this),e},pd3D.Polyline.prototype.setBoundary=function(t){if(!pd.isArray(t)||t.length<1)throw new TypeError("ERROR: Sent empty or invalid array to setBoundary().");if(t[0].length<2)throw new TypeError("ERROR: Contour arrays must have vertices with at least two dimensions.");return this.contours.length<1?this.contours.push(t):this.contours[0]=t,this.hasChanged=!0,this.onChange&&this.onChange(this),this},pd3D.Polyline.prototype.getContourCount=function(){return this.contours.length},pd3D.Polyline.prototype.getContour=function(t){return t=pd.toInteger(t,0),this.contours.length>t?this.contours[t]:null},pd3D.Polyline.prototype.addContour=function(t){if(pd.isArray(t)||(t=[]),0<t.length&&t[0].length<2)throw new TypeError("ERROR: Contour arrays must have vertices with at least two dimensions.");return this.contours.push(t),this.hasChanged=!0,this.onChange&&this.onChange(this),this},pd3D.Polyline.prototype.setContours=function(t,e){if((!pd.isArray(t)||t.length<1)&&(t=[]),0<t[0].length&&t[0][0].length<2)throw new TypeError("ERROR: Contour arrays must have vertices with at least two dimensions.");if(this.contours&&0<this.contours.length&&this.clearContours(),e)for(var r=0,n=t.length;r<n;++r)this.contours.push(t[r]);else this.contours=t;return this.hasChanged=!0,this.onChange&&this.onChange(this),this},pd3D.Polyline.prototype.clearContours=function(){if(this.contours)for(var t=0,e=this.contours.length;t<e;++t)this.contours[t].length=0;return this.contours.length=0,this.hasChanged=!0,this.onChange&&this.onChange(this),this},pd3D.Polyline.prototype.lineTo=function(t,e){return this.contours&&(this.contours.length<1&&this.contours.push([]),e=pd.constrainTo(pd.toInteger(e,this.contours.length-1),0,this.contours.length-1),this.contours[e].push(t)),this},pd3D.Polyline.prototype.splineTo=function(t,e){if(this.contours){this.contours.length<1&&this.contours.push([]),e=pd.constrainTo(pd.toInteger(e,this.contours.length-1),0,this.contours.length-1);for(var r=t.vertices||[],t=pd.toNumber(t.increment,.1),n=this.contours[e],i=pd3D.VectorArray.spline({increment:t,vertices:r}),a=0,o=i.length;a<o;++a)n.push(i[a])}return this},pd3D.Polyline.prototype.finish=function(){return this.hasChanged=!0,this.onChange&&this.onChange(this),this},pd3D.Polygon=function(t){t=t||{},pd3D.Polyline.call(this,t),this.plane=t.plane||t.normal||null,this.color=t.color||null,this.axis=pd.toInteger(t.axis,0),this.center=t.center||null,this.triangles=null,"noOutline"in t&&(this.noOutline=pd.toBoolean(t.noOutline,!1)),0<this.contours.length&&this.checkPlaneEqn()},pd3D.Polygon.prototype=Object.create(pd3D.Polyline.prototype),pd3D.Polygon.prototype.constructor=pd3D.Polygon;var h=null;pd3D.Polygon.initTesselator=function(){var t=new libtess.GluTesselator;return t.gluTessCallback(libtess.gluEnum.GLU_TESS_VERTEX_DATA,function(t,e){e.push(t)}),t.gluTessCallback(libtess.gluEnum.GLU_TESS_BEGIN,function(t){t!==libtess.primitiveType.GL_TRIANGLES&&console.warn("Tesselator: Expected TRIANGLES, but got type: "+t)}),t.gluTessCallback(libtess.gluEnum.GLU_TESS_ERROR,function(t){console.warn("Tesselator: Error number: "+t)}),t.gluTessCallback(libtess.gluEnum.GLU_TESS_COMBINE,function(t){return[t[0],t[1],t[2]]}),t.gluTessCallback(libtess.gluEnum.GLU_TESS_EDGE_FLAG,function(){}),t},pd3D.Polygon.releaseTesselator=function(){h=null},Object.defineProperty(pd3D.Polygon.prototype,"noOutline",{get:function(){return 8&this.flags},set:function(t){t?this.flags|=8:8&this.flags&&(this.flags-=8)}}),pd3D.Polygon.prototype.clone=function(t,e,r){this.checkPlaneEqn(),!this.hasChanged&&this.triangles||this.tesselate3D(),r=r||new pd3D.Polygon;var n=this.triangles;r.triangles||(r.triangles=[]);var i,a,o,s,d=(n=n||(this.triangles=[])).length,h=this.contours,l=h.length;pd.isArray(t)||(t=pd3D.VectorArray.origin),this.center&&(r.center||(r.center=[]),pd3D.VectorArray.add(r.center,this.center,t)),this.plane&&(r.plane||(r.plane=[])),r.color=this.color||null,r.noOutline=this.noOutline,r.hasChanged=d<1,r.axis=0|+this.axis,(this.isNotPlanar||r.isNotPlanar)&&(r.isNotPlanar=this.isNotPlanar);for(var c=0;c<l;++c){i=h[c],null==(o=r.contours[c])&&(o=r.contours[c]=[]);for(var u=0,p=i.length;u<p;++u)a=i[u],null==(s=o[u])&&(s=o[u]=[]),s[0]=a[0]+t[0],s[1]=a[1]+t[1],s[2]=a[2]+t[2];r.contours[c].length=i.length}if(r.contours.length=l,e){pd3D.VectorArray.negate(r.plane,this.plane);for(c=0;c<d;c+=3)a=n[c],null==(s=r.triangles[c])&&(s=r.triangles[c]=[]),s[0]=a[0]+t[0],s[1]=a[1]+t[1],s[2]=a[2]+t[2],a=n[c+2],null==(s=r.triangles[c+1])&&(s=r.triangles[c+1]=[]),s[0]=a[0]+t[0],s[1]=a[1]+t[1],s[2]=a[2]+t[2],a=n[c+1],null==(s=r.triangles[c+2])&&(s=r.triangles[c+2]=[]),s[0]=a[0]+t[0],s[1]=a[1]+t[1],s[2]=a[2]+t[2]}else{pd3D.VectorArray.copyTo(r.plane,this.plane);for(c=0;c<d;++c)a=n[c],null==(s=r.triangles[c])&&(s=r.triangles[c]=[]),s[0]=a[0]+t[0],s[1]=a[1]+t[1],s[2]=a[2]+t[2]}return r.checkPlaneEqn(),r},pd3D.Polygon.prototype.applyOffset=function(t){this.hasChanged=!0;for(var e,r,n=this.contours,i=n.length,a=0;a<i;++a)for(var o=0,s=(e=n[a]).length;o<s;++o)(r=e[o])[0]+=t[0],r[1]+=t[1],r[2]+=t[2];return this.computePlaneEqn(),this},pd3D.Polygon.prototype.computeOffsetPosition=function(t,e){var r=(r=this.center)||(0<this.contours.length&&0<this.contours[0].length?this.contours[0][0]:pd3D.VectorArray.origin),t=[t[0],t[1],t[2]];return pd3D.VectorArray.normalize(t),[t[0]*e+r[0],t[1]*e+r[1],t[2]*e+r[2]]},pd3D.Polygon.prototype.computePlaneEqn=function(){if(0<this.contours.length){var t,e=[0,0,0],r=[0,0,0],n=this.contours[0],i=n.length,a=0;if(0<i){for(var o=n[0].slice(),s=n[0].slice(),d=0;d<i;++d)t=n[d],o[0]>t[0]&&(o[0]=t[0]),o[1]>t[1]&&(o[1]=t[1]),o[2]>t[2]&&(o[2]=t[2]),s[0]<t[0]&&(s[0]=t[0]),s[1]<t[1]&&(s[1]=t[1]),s[2]<t[2]&&(s[2]=t[2]),++a,1<d&&(pd3D.VectorArray.calcNormalFromTriangle(e,n[d-2],n[d-1],n[d])?(r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]):r[2]+=1);0==a&&(r[2]=1),pd3D.VectorArray.normalize(r),this.center=pd3D.VectorArray.lerpBetween(this.center||[],o,s,.5),this.plane?pd3D.PlaneArray.calcFromNormalAndPoint(this.plane,r,this.center):this.plane=pd3D.PlaneArray.createFromNormalAndPoint(r,this.center),this.axis=pd3D.VectorArray.getMajorAxis(r)}}return this.plane||(this.plane=pd3D.PlaneArray.create(0,0,1,0),this.axis=pd3D.VectorArray.getMajorAxis(this.plane)),this},pd3D.Polygon.prototype.checkPlaneEqn=function(){var t;return this.plane||this.computePlaneEqn(),this.plane.length<4&&(t=0<this.contours.length&&2<this.contours[0].length?this.contours[0][0]:pd3D.VectorArray.origin,this.plane[3]=-(this.plane[0]*t[0]+this.plane[1]*t[1]+this.plane[2]*t[2])),3<this.plane.length},pd3D.Polygon.prototype.setNormal=function(t){if(!pd.isArray(t)||t.length<3)throw new TypeError("The new normal must be a valid [x,y,z] vector array.");return this.plane=t,this.checkPlaneEqn(),this},pd3D.Polygon.prototype.intersect=function(t,e,r){return this.checkPlaneEqn(),!!pd3D.PlaneArray.intersect(r,t,e,this.plane)&&(this.isNotPlanar?this._isInsideNonPlanar(r):this._isInside(r))},pd3D.Polygon.prototype.intersectTriangles=function(t,e,r){if(this.checkPlaneEqn(),this.isNotPlanar&&this.triangles&&2<this.triangles.length){for(var n,i,a,o=[],s=[],d=[],h=[],l=[],c=2,u=this.triangles.length;c<u;c+=3)if(i=this.triangles[c-2],n=this.triangles[c-1],a=this.triangles[c],pd3D.VectorArray.subtract(o,i,n),pd3D.VectorArray.subtract(s,a,n),pd3D.VectorArray.cross(h,e,s),1e-6<(i=pd3D.VectorArray.dot(o,h))&&(pd3D.VectorArray.subtract(d,t,n),0<=(a=pd3D.VectorArray.dot(d,h))&&a<=i&&(pd3D.VectorArray.cross(l,d,o),0<=(n=pd3D.VectorArray.dot(e,l))&&a+n<=i)))return r=r||[],i=pd3D.VectorArray.dot(s,l)/i,r[0]=t[0]+i*e[0],r[1]=t[1]+i*e[1],r[2]=t[2]+i*e[2],!0;return!1}var p=pd3D.VectorArray.add([],t,e);return this.intersect(t,p,r)},pd3D.Polygon.prototype._isInsideNonPlanar=function(t){if(this.triangles&&2<this.triangles.length){for(var e,r,n,i=[],a=2,o=this.triangles.length;a<o;a+=3)if(e=this.triangles[a-2],r=this.triangles[a-1],n=this.triangles[a],pd3D.VectorArray.calcNormalFromTriangle(i,e,r,n)&&pd3D.PlaneArray.insideTriangle(t,e,r,n,i))return!0}else if(this.isInsideOuterBoundary(t))return!0;return!1},pd3D.Polygon.prototype._isInside=function(t){if(this.triangles&&2<this.triangles.length){for(var e=2,r=this.triangles.length;e<r;e+=3)if(pd3D.PlaneArray.insideTriangle(t,this.triangles[e-2],this.triangles[e-1],this.triangles[e],this.plane))return!0}else if(this.isInsideOuterBoundary(t))return!0;return!1},pd3D.Polygon.prototype.isInsideOuterBoundary=function(t){if(this.contours&&0<this.contours.length){var e=this.contours[0];if(4==e.length)return pd3D.PlaneArray.insideTriangle(t,e[0],e[1],e[2],this.plane)||pd3D.PlaneArray.insideTriangle(t,e[0],e[2],e[3],this.plane);if(3==e.length)return pd3D.PlaneArray.insideTriangle(t,e[0],e[1],e[2],this.plane);var r,n=[],i=[],a=[],o=0,s=e[e.length-1];n[0]=s[0]-t[0],n[1]=s[1]-t[1],n[2]=s[2]-t[2],pd3D.VectorArray.normalize(n);for(var d=0,h=e.length;d<h;++d)r=e[d],i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],pd3D.VectorArray.normalize(i),pd3D.VectorArray.cross(a,n,i),r=pd3D.VectorArray.dot(this.plane,a),o+=Math.acos(pd3D.VectorArray.dot(n,i))*pd.sign(r),n[0]=i[0],n[1]=i[1],n[2]=i[2];return o>=Math.PI}return!1},pd3D.Polygon.prototype.tesselate2D=function(){if("function"!=typeof earcut)return"object"!=typeof libtess?this.triangles=[]:this.tesselate3D();var t;this.computePlaneEqn();var e,r,n=[],i=this.plane,a=this.center,o=this.contours;if(Math.abs(i[2])>1-pd.Const.EPSILON&&Math.abs(i[0])<pd.Const.EPSILON&&Math.abs(i[1])<pd.Const.EPSILON){for(d=0;d<o.length;++d)for(n.push([]),e=o[d],t=0;t<e.length;++t)n[d].push([e[t][0],e[t][1]]);r=earcut(n);for(var s=-i[3]/i[2],d=0;d<r.length;++d)r[d][2]=s;i[2]<0&&r.reverse()}else{var h=pd3D.QuatArray.create();pd3D.QuatArray.rotateBetweenVectors(h,i,pd3D.VectorArray.unitZ);var l=pd3D.VectorArray.create();for(d=0;d<o.length;++d)for(n.push([]),e=o[d],t=0;t<e.length;++t)l[0]=e[t][0]-a[0],l[1]=e[t][1]-a[1],l[2]=e[t][2]-a[2],pd3D.VectorArray.applyQuaternion(l,l,h),n[d].push([l[0],l[1]]);for(r=earcut(n),pd3D.QuatArray.invert(h,h),d=0;d<r.length;++d)r[d].length<3&&(pd3D.VectorArray.applyQuaternion(r[d],r[d],h),r[d][0]+=a[0],r[d][1]+=a[1],r[d][2]+=a[2])}return this.triangles=r,this.hasChanged=!1,r},pd3D.Polygon.prototype.tesselate3D=function(){if("object"!=typeof libtess)return"function"!=typeof earcut?this.triangles=[]:this.tesselate2D();var t,e,r=[],n=this.contours;if(this.checkPlaneEqn(),1==n.length&&n[0].length<=4)3<=(t=n[0]).length&&(r.push(t[0]),r.push(t[1]),r.push(t[2]),4==t.length&&(r.push(t[0]),r.push(t[2]),r.push(t[3])));else{h=h||pd3D.Polygon.initTesselator(),this.plane&&h.gluTessNormal(this.plane[0],this.plane[1],this.plane[2]);try{h.gluTessBeginPolygon(r);for(var i=0,a=n.length;i<a;++i){t=n[i],h.gluTessBeginContour();for(var o=0,s=t.length;o<s;++o)e=t[o],h.gluTessVertex(e,e);h.gluTessEndContour()}h.gluTessEndPolygon()}catch(t){console.warn(t)}}return this.triangles&&(this.triangles.length=0),this.triangles=r,this.hasChanged=!1,r},pd3D.Polygon.prototype.scaleAndOffset=function(t,e,r){var n,i,a=this.contours;t=pd.toNumber(t,1),e=pd.isArray(e)?e:pd3D.VectorArray.origin,r=pd.toBoolean(r,!1);for(var o=0,s=a.length;o<s;++o){n=a[o],r&&n.reverse();for(var d=0,h=n.length;d<h;++d)i=n[d],n[d]=[i[0]*t+e[0],i[1]*t+e[1],(+i[2]||0)*t+e[2]]}return this.plane&&this.computePlaneEqn(),this.hasChanged=!0,this},pd3D.Polygon.prototype.calcSurfaceArea=function(){var t=0;if(!this.hasChanged&&this.triangles||this.tesselate3D(),!this.triangles||this.triangles.length<3||this.triangles[0].length<2){for(var e,r,n=[],i=0,a=this.contours.length;i<a;++i){e=0;for(var o=2,s=(r=this.contours[i]).length;o<s;++o)pd3D.VectorArray.crossProductFromTriangle(n,r[0],r[o-1],r[o])&&(e+=pd3D.VectorArray.length(n));0<i?t-=Math.abs(e):t+=Math.abs(e)}return Math.abs(t)}for(var d=this.triangles,h=d.length,i=2;i<h;i+=3)t+=pd3D.VectorArray.triangleArea(d[i-2],d[i-1],d[i]);return t},pd3D.Polygon.prototype.trimContoursToPlane=function(t){for(var e,r,n,i,a,o,s,d=[],h=this.contours,l=h.length,c=[],u=0;u<l;++u){n=(e=h[u])[(o=e.length)-1],i=-.5<=pd3D.PlaneArray.signedDistanceTo(n,t),s=[];for(var p=0;p<o;++p)r=p<1?o-1:p-1,n=e[p],(a=-.5<=pd3D.PlaneArray.signedDistanceTo(n,t))!=i&&pd3D.PlaneArray.intersect(d,e[r],e[p],t)&&(.5<=pd3D.VectorArray.distancePointToPoint(n,d)?s.push(d.slice()):a||s.push(n.slice())),a&&s.push(n),i=a;1<s.length&&c.push(s)}return c},pd3D.Polygon.prototype.intersectWithPlane=function(t,e){var r,n,i,a,o,s,d=[],h=this.contours,l=h.length;e=e||[];for(var c=0;c<l;++c){i=(r=h[c])[(s=r.length)-1],a=-.5<=pd3D.PlaneArray.signedDistanceTo(i,t),0;for(var u=0;u<s;++u)n=u<1?s-1:u-1,i=r[u],(o=-.5<=pd3D.PlaneArray.signedDistanceTo(i,t))!=a&&pd3D.PlaneArray.intersect(d,r[n],r[u],t)&&e.push(d.slice()),a=o}return e},pd3D.Polygon.prototype.intersectTrianglesWithPlane=function(t,e){if(!this.hasChanged&&this.triangles||this.tesselate3D(),!this.triangles||this.triangles.length<3)return!1;var r,n,i,a,o,s,d=this.triangles,h=[],l=[];e=e||[];for(var c=0;c<d.length;c+=3)r=d[c+(l.length=0)],n=d[c+1],i=d[c+2],a=0<=pd3D.PlaneArray.signedDistanceTo(r,t),o=0<=pd3D.PlaneArray.signedDistanceTo(n,t),s=0<=pd3D.PlaneArray.signedDistanceTo(i,t),a!=o&&pd3D.PlaneArray.intersect(h,r,n,t)&&l.push(h.slice()),o!=s&&pd3D.PlaneArray.intersect(h,n,i,t)&&l.push(h.slice()),s!=a&&pd3D.PlaneArray.intersect(h,i,r,t)&&l.push(h.slice()),2==l.length&&e.push([l[0],l[1]]);return e},pd3D.Polygon.prototype.copyToMeshIndexed=function(e,t,r){var n;if(!this.hasChanged&&this.triangles||this.tesselate3D(),!this.triangles||this.triangles.length<3)return!1;if(this.triangles[0][0].length<2)return console.warn("ADVERTENCIA: Los triángulos del polígono deben tener vértices de la forma [x,y] o [x,y,z]."),!1;var i,a,o,s,d=e.vertexCount(),h=!isNaN(t)&&t<0,l=null!=r,c=this.contours,u=this.triangles;if(r=r||new pd.Indexer,t=pd.toBoolean(t,!1),!this.noOutline&&e.lines)for(n=0;n<c.length;++n){(i=c[n])[0]._indexId=0,a=s=d+r.addById(i[0]);for(var p=1;p<i.length;++p)i[p]._indexId=0,o=d+r.addById(i[p]),e.addLine(a,o),a=o;e.addLine(o,s)}if(h&&!e.twoSided)for(n=0;n<u.length;n+=3)a=d+r.addById(u[n+0]),o=d+r.addById(u[n+1]),s=d+r.addById(u[n+2]),e.addTriangle(a,s,o),e.addTriangle(a,o,s);else for(n=0;n<u.length;n+=3)a=d+r.addById(u[n+0]),o=d+r.addById(u[n+1]),s=d+r.addById(u[n+2]),t?e.addTriangle(a,s,o):e.addTriangle(a,o,s);return this.color&&e.color(this.color),this.plane&&(t?e.normal(-this.plane[0],-this.plane[1],-this.plane[2]):e.normal(this.plane)),l||r.unique.map(function(t){e.addVertex(t)}),!0},pd3D.Polygon.prototype.copyToMeshRaw=function(t,e){var r,n,i,a=this.isNotPlanar&&null!=t.lines;if(!this.hasChanged&&this.triangles||this.tesselate3D(),!this.triangles||this.triangles.length<3)return!1;if(this.triangles[0][0].length<2)return console.warn("ADVERTENCIA: Los triángulos del polígono deben tener vértices de la forma [x,y] o [x,y,z]."),!1;var o,s=!isNaN(e)&&e<0,d=this.contours,h=this.triangles;if(e=pd.toBoolean(e,!1),this.color&&t.color(this.color),this.plane&&(e?t.normal(-this.plane[0],-this.plane[1],-this.plane[2]):t.normal(this.plane)),!this.noOutline&&t.lines)for(var l=0,c=d.length;l<c;++l){o=d[l],r=n=t.addVertex(o[0]);for(var u=1,p=o.length;u<p;++u)i=t.addVertex(o[u]),t.addLine(n,i),n=i;t.addLine(i,r)}if(s&&!t.twoSided)for(var l=0,f=h.length;l<f;l+=3)r=t.addVertex(h[l+0]),n=t.addVertex(h[l+1]),i=t.addVertex(h[l+2]),t.addTriangle(r,i,n),t.addTriangle(r,n,i),a&&(t.addLine(r,n),t.addLine(n,i),t.addLine(i,r));else for(l=0,f=h.length;l<f;l+=3)r=t.addVertex(h[l+0]),n=t.addVertex(h[l+1]),i=t.addVertex(h[l+2]),e?t.addTriangle(r,i,n):t.addTriangle(r,n,i),a&&(t.addLine(r,n),t.addLine(n,i),t.addLine(i,r));return!0},pd3D.Polygon.prototype.copyTrianglesToMeshIndexed=function(e,t,r){if(!this.hasChanged&&this.triangles||this.tesselate3D(),!this.triangles||this.triangles.length<3)return!1;if(this.triangles[0][0].length<2)return console.warn("ADVERTENCIA: Los triángulos del polígono deben tener vértices de la forma [x,y] o [x,y,z]."),!1;var n,i,a,o=e.vertexCount(),s=null!=r,d=this.triangles;r=r||new pd.Indexer,t=t||!1;for(var h=0,l=d.length;h<l;h+=3)n=o+r.addVectorArray(d[h+0]),i=o+r.addVectorArray(d[h+1]),a=o+r.addVectorArray(d[h+2]),t?e.addTriangle(n,a,i):e.addTriangle(n,i,a);return this.color&&e.color(this.color),this.plane&&(t?e.normal(-this.plane[0],-this.plane[1],-this.plane[2]):e.normal(this.plane)),s||r.unique.map(function(t){e.addVertex(t)}),!0},pd3D.Polygon.prototype.copyTrianglesToMeshRaw=function(t,e){if(!this.hasChanged&&this.triangles||this.tesselate3D(),!this.triangles||this.triangles.length<3||this.triangles[0][0].length<2)return!1;var r,n=0,i=!isNaN(e)&&e<0,a=this.triangles;e=pd.toBoolean(e,!1),this.color&&t.color(this.color),this.plane&&(e?t.normal(-this.plane[0],-this.plane[1],-this.plane[2]):t.normal(this.plane));for(var o=0,s=a.length;o<s;o+=3){for(var d=0;d<3;++d)r=a[o+d],n=t.addVertex([r[0],r[1],r[2]]);i&&!t.twoSided?(t.addTriangle(n-2,n,n-1),t.addTriangle(n-2,n-1,n)):e?t.addTriangle(n-2,n,n-1):t.addTriangle(n-2,n-1,n)}return!0},pd3D.Polygon.prototype.copyTrianglesToMeshRawExt=function(t,e,r,n){if(!this.hasChanged&&this.triangles||this.tesselate3D(),!this.triangles||this.triangles.length<3)return!1;if(this.triangles[0][0].length<2)return console.warn("ADVERTENCIA: Los triángulos del polígono deben tener vértices de la forma [x,y] o [x,y,z]."),!1;e=pd.toNumber(e,1),r=pd.isArray(r)?r:pd3D.VectorArray.origin,n=pd.toBoolean(n,!1);var i,a=0,o=this.triangles;this.color&&t.color(this.color),this.plane&&(n?t.normal(-this.plane[0],-this.plane[1],-this.plane[2]):t.normal(this.plane));for(var s=0,d=o.length;s<d;s+=3){for(var h=0;h<3;++h)i=o[s+h],a=t.addVertex([i[0]*e+r[0],i[1]*e+r[1],(+i[2]||0)*e+r[2]]);n?t.addTriangle(a-2,a,a-1):t.addTriangle(a-2,a-1,a)}return!0},pd3D.Polygon.prototype.copyOutlineToMesh=function(t){var e,r,n=this.contours;if(t.lines||t.addIndexBuffer("lines"),this.isNotPlanar&&this.triangles&&2<this.triangles.length)for(var i,a=0,o=this.triangles,s=0,d=o.length;s<d;s+=3){for(var h=0;h<3;++h)i=o[s+h],a=t.addVertex([i[0],i[1],i[2]]);t.addLine(a-1,a-2),t.addLine(a-1,a),t.addLine(a-2,a)}else for(s=0;s<n.length;++s)if(1<(e=n[s]).length){r=t.vertexCount();for(a=t.addVertex(e[0]),h=1,d=e.length;h<d;++h)a=t.addVertex(e[h]),t.addLine(a-1,a);t.addLine(a,r)}return!0},pd3D.Polygon.prototype.copyOutlineToMeshExt=function(t,e,r){e=pd.toNumber(e,1),r=pd.isArray(r)?r:pd3D.VectorArray.origin;var n,i,a,o,s=this.contours;t.lines||t.addIndexBuffer("lines");for(var d=0;d<s.length;++d)if(1<(n=s[d]).length){a=t.vertexCount();for(var h=0,l=n.length;h<l;++h)i=n[h],o=t.addVertex([+i[0]*e+r[0],+i[1]*e+r[1],+i[2]*e+r[2]]),0<h&&t.addLine(o-1,o);t.addLine(o,a)}return!0},pd3D.Polygon.prototype.copyDraftinglinesToMesh=function(t,e){e=pd.toNumber(e,250);var r,n=this.contours;t.lines||t.addIndexBuffer("lines");for(var i=0;i<n.length;++i){for(var a,o,s=t.vertexCount(),d=0,h=(o=n[i]).length;d<h;++d)r=o[d],a=t.addVertex([r[0],r[1],+r[2]||0]),0<d&&(t.addLine(a-1,a,e),t.addDraftingLine(a-1,a,e));t.addDraftingLine(a,s,e)}return!0},pd3D.Polygon.prototype.checkPlanar=function(t){return this.checkPlaneEqn(),0<this.contours.length&&pd3D.PlaneArray.isPathPlanar(this.plane,this.contours[0],t)},pd3D.Polygon.prototype.makePlanar=function(t){var e=!1;this.checkPlaneEqn();for(var r=0,n=this.contours.length;r<n;++r)pd3D.PlaneArray.makePathPlanar(this.contours[r],this.plane,t)&&(e=!0);return e},pd3D.Polygon.prototype.sameSide=function(t,e){return this.checkPlaneEqn(),-1e-9<=(this.plane[0]*t[0]+this.plane[1]*t[1]+this.plane[2]*t[2]+this.plane[3])*(this.plane[0]*e[0]+this.plane[1]*e[1]+this.plane[2]*e[2]+this.plane[3])},pd3D.Polygon.prototype.inFront=function(t){this.checkPlaneEqn();var e=this.computeOffsetPosition(this.plane,5);return this.sameSide(t,e)},pd3D.Polygon.prototype.extrude=function(t){var e,r,n;this.checkPlaneEqn();var i,a,o,s,d,h=[],l=this.contours;if(this.sameSide(this.computeOffsetPosition(t,5),this.computeOffsetPosition(this.plane,5))){for(i=new pd3D.Polygon,e=0;e<l.length;++e){for(a=[],r=(o=l[e]).length-1;0<=r;r--)s=o[r],a.push([s[0],s[1],+s[2]||0]);i.addContour(a)}i.computePlaneEqn(),h.push(i)}else h.push(this);for(l=h[0].contours,e=0;e<l.length;++e)for(n=(o=l[e]).length,r=0;r<n;++r)n<=(d=r+1)&&(d=0),s=o[r],d=o[d],s[2]=+s[2]||0,d[2]=+d[2]||0,(a=[]).push([d[0],d[1],d[2]]),a.push([s[0],s[1],s[2]]),a.push([s[0]+t[0],s[1]+t[1],s[2]+t[2]]),a.push([d[0]+t[0],d[1]+t[1],d[2]+t[2]]),i=(new pd3D.Polygon).addContour(a),h.push(i);for(i=new pd3D.Polygon,e=0;e<l.length;++e){for(a=[],r=(o=l[e]).length-1;0<=r;r--)s=o[r],a.push([s[0]+t[0],s[1]+t[1],(+s[2]||0)+t[2]]);i.addContour(a)}return h.push(i),h}}();pd3D=pd3D||{};!function(){var i=35044;pd3D.canUse32BitBuffers=!1,pd3D.RENDER_FIRST=-1,pd3D.RENDER_LAST=-2,pd3D.RENDER_ALL=-99;var t=100;pd3D.getUniqueID=function(){return t++},pd3D.peekNextUniqueID=function(){return t};pd3D.Mesh=function(t){t=t||{},this.id=pd3D.getUniqueID(),this.visible=!1!==t.visible,this.defaultNormal=t.defaultNormal||[0,0,1],this.defaultColor=t.defaultColor||[.8,.8,.8,1],this.defaultLineColor=t.defaultLineColor||this.defaultColor,this.defaultCoord=t.defaultCoord||[0,0],this.hasVertexNormals=!1,this.hasVertexColors=!1,this.hasVertexCoords=!1,this.hasLines=!1,this.twoSided=null!=t.twoSided?!!t.twoSided:null,this.usageHint=pd.toInteger(t.usageHint,t.dynamic?35048:i),this.activeSubMesh=null,this.boundingBox=null,this.vertexBuffers={},this.indexBuffers={},this._changeFlag=4,this._data={},this._vtx_index=0,this._tri_index=0,this._lin_index=0,this._pts_index=0,this.addVertexBuffer("vertices","gl_Vertex"),t.coords&&this.addVertexBuffer("coords","gl_TexCoord"),t.normals&&this.addVertexBuffer("normals","gl_Normal"),t.colors&&this.addVertexBuffer("colors","gl_Color"),!t.triangles&&"triangles"in t||this.addIndexBuffer("triangles"),t.points&&this.addIndexBuffer("points"),t.lines&&this.addIndexBuffer("lines")},pd3D.Mesh.prototype={clone:function(t,e){var r,n,i,a,o=this.isReusing;o&&this.reuseEnd(),"normals"in(t=t||{})||(t.normals=pd.isArray(this.normals)),"colors"in t||(t.colors=pd.isArray(this.colors)),"coords"in t||(t.coords=pd.isArray(this.coords)),"triangles"in t||(t.triangles=pd.isArray(this.triangles)),"points"in t||(t.points=pd.isArray(this.points)),"lines"in t||(t.lines=pd.isArray(this.lines));t=new pd3D.Mesh(t);if(t.vertices&&this.vertices){if(i=this.vertices,a=t.vertices,e){if(pd.isArray(e))for(e[0]=+e[0],e[1]=+e[1],e[2]=+e[2],r=0,n=i.length;r<n;++r)a.push([i[r][0]+e[0],i[r][1]+e[1],i[r][2]+e[2]]);else if("x"in e)for(r=0,n=i.length;r<n;++r)a.push([i[r][0]+e.x,i[r][1]+e.y,i[r][2]+e.z])}else for(r=0,n=i.length;r<n;++r)a.push(i[r].slice());t._vtx_index=t.vertices.length}if(t.normals)for(i=this.normals,a=t.normals,r=0,n=i.length;r<n;++r)a.push(i[r].slice());if(t.colors&&this.colors)for(i=this.colors,a=t.colors,r=0,n=i.length;r<n;++r)a.push(i[r].slice());if(t.coords&&this.coords)for(i=this.coords,a=t.coords,r=0,n=i.length;r<n;++r)a.push(i[r].slice());return t.triangles&&this.triangles&&(t.triangles=this.triangles.slice(),t._tri_index=t.triangles.length),t.lines&&this.lines&&(t.lines=this.lines.slice(),t._lin_index=t.lines.length),t.points&&this.points&&(t.points=this.points.slice(),t._pts_index=t.points.length),"twoSided"in this&&(t.twoSided=this.twoSided),this.isReusing=o,t.setChangeFlag(4),t},checkChangeFlag:function(t){return this._changeFlag&t},setChangeFlag:function(t,e){var r;switch(t){case 4:this._changeFlag|=t;break;case 1:e&&null!=(r=this.vertexBuffers[e])&&(r.updateRequired=!0,this._changeFlag|=t);break;case 2:e&&null!=(r=this.indexBuffers[e])&&(r.updateRequired=!0,this._changeFlag|=t)}},checkToCompile:function(){if(this._changeFlag){if(4&this._changeFlag)this.compile();else{if(1&this._changeFlag)for(var t in this.vertexBuffers){(r=this.vertexBuffers[t])&&r.updateRequired&&(r.data=this[r.name],r.compile())}if(2&this._changeFlag)for(var e in this.indexBuffers){var r;(r=this.indexBuffers[e])&&r.updateRequired&&(r.data=this[e],r.compile())}}this._changeFlag=0}},addVertexBuffer:function(t,e,r){r=pd.toInteger(r,this.usageHint);r=this.vertexBuffers[e]=new pd3D.Buffer({usageHint:r,target:34962,type:Float32Array});return this[r.name=t]=[],this.hasVertexNormals=void 0!==this.normals,this.hasVertexColors=void 0!==this.colors,this.hasVertexCoords=void 0!==this.coords,this.setChangeFlag(4),this},addIndexBuffer:function(t,e){e=pd.toInteger(e,this.usageHint);e=this.indexBuffers[t]=new pd3D.Buffer({usageHint:e,target:34963,type:Uint16Array});return this[e.name=t]=[],this.hasLines=void 0!==this.lines,this.setChangeFlag(4),this},hide:function(){return this.visible=!1,this},show:function(t){return this.visible=!1!==t,this},begin:function(t){if(this.activeSubMesh&&0<=pd.toNumber(this.activeSubMesh.mode,-1))throw new Error("Mismatched 'mesh.begin()' and 'mesh.end()' calls.");switch(t){case 0:this.points||this.addIndexBuffer("points");break;case 1:case 2:case 3:this.lines||this.addIndexBuffer("lines");break;case 4:case 5:case 6:case 7:case 8:this.triangles||this.addIndexBuffer("triangles");break;default:throw new TypeError("Given primitive `mode` ("+t.toString()+") is invalid.")}return null!=this.activeSubMesh&&this.endSubMesh(this.activeSubMesh),this.activeSubMesh=new pd3D.SubMesh,this.startSubMesh(this.activeSubMesh),this.activeSubMesh.mode=t,this},normal:function(t){switch(arguments.length){case 0:return this.defaultNormal;case 1:if(pd.isArray(t)&&3<=t.length)3<t.length?this.defaultNormal=[t[0],t[1],t[2]]:this.defaultNormal=t;else{if(!(t instanceof pd3D.Vector))throw new TypeError("Invalid vector, must be either a pd3D.Vector() or an [x,y,z] array.");this.defaultNormal=t.toArray()}break;case 3:case 4:this.defaultNormal=[+t,+arguments[1],+arguments[2]];break;default:throw new Error("Invalid arguments, must be given as x, y and z values.")}return this},color:function(t){switch(arguments.length){case 0:return this.defaultColor;case 2:if(!pd.isArray(t)||t.length<3)throw new TypeError("Invalid color, must be either an [r,g,b] or an [r,g,b,a] array.");t=[t[0],t[1],t[2],pd.constrainTo(+arguments[1],0,1)];case 1:var e;if(pd.isArray(t))if(4==t.length)this.defaultColor=t;else{if(3!=t.length)throw new TypeError("Invalid color, must be either an [r,g,b] or an [r,g,b,a] array.");this.defaultColor=[+t[0],+t[1],+t[2],1]}else t instanceof pd3D.Vector?this.defaultColor=[t.x,t.y,t.z,1]:7<(e=(+t).toString(16)).length?this.defaultColor=[parseInt(e.substring(2,4),16)/255,parseInt(e.substring(4,6),16)/255,parseInt(e.substring(6,8),16)/255,parseInt(e.substring(0,2),16)/255]:(t=pd.toInteger(t,0),this.defaultColor=[(255&t)/255,((65280&t)>>8)/255,((16711680&t)>>16)/255,1]);break;case 3:this.defaultColor=[+arguments[0],+arguments[1],+arguments[2],1];break;case 4:this.defaultColor=[+arguments[0],+arguments[1],+arguments[2],+arguments[3]];break;default:throw new TypeError("Invalid arguments, must be given as r, g, b [, a] values.")}return this},texCoord:function(t){switch(arguments.length){case 0:return this.defaultCoord;case 1:if(pd.isArray(t)&&2<=t.length)2<t.length?this.defaultCoord=[t[0],t[1]]:this.defaultCoord=t;else{if(!(t instanceof pd3D.Vector))throw new TypeError("Invalid vector, must be either a pd3D.Vector() or an [x,y,z] array.");this.defaultCoord=t.toArray(2)}break;case 2:case 3:this.defaultCoord=[+t,+arguments[1]];break;default:throw new Error("Invalid arguments, must be given as an x, y and z values.")}return this},vertex:function(t){var e=-1;return t&&(2==t.length&&(t[2]=0),this.isReusing&&this._vtx_index<this.vertices.length?(e=this._vtx_index,this.vertices[e]=t,this.hasVertexColors&&(this.colors[e]=this.defaultColor),this.hasVertexNormals&&(this.normals[e]=this.defaultNormal),this.hasVertexCoords&&(this.coords[e]=this.defaultCoord),e=this._vtx_index++):(e=this.vertices.length,this.vertices.push(t),this.hasVertexColors&&this.colors.push(this.defaultColor),this.hasVertexNormals&&this.normals.push(this.defaultNormal),this.hasVertexCoords&&this.coords.push(this.defaultCoord),this._vtx_index=e+1)),e},end:function(){var t=this.activeSubMesh;if(this.endSubMesh(t),!t||-1==pd.toNumber(t.mode,-1))throw new Error("Mismatched 'mesh.begin()' and 'mesh.end()' calls.");var e=t.vtx_start,r=t.vtx_stop;switch(t.mode){case 0:for(var n=e;n<r;++n)this.addPoint(n);break;case 1:for(n=e+1;n<r;n+=2)this.addLine(n-1,n);break;case 2:this.addLine(r-1,e);case 3:for(n=e+1;n<r;++n)this.addLine(n-1,n);break;case 4:for(n=e+2;n<r;n+=3)this.addTriangle(n-2,n-1,n);break;case 5:for(var i=!0,n=e+2;n<r;++n)i?this.addTriangle(n-2,n-1,n):this.addTriangle(n-1,n-2,n),i=!i;break;case 6:for(n=e+2;n<r;++n)this.addTriangle(e,n-1,n);break;case 7:for(n=e+3;n<r;n+=4)this.addTriangle(n-3,n-2,n-1),this.addTriangle(n-3,n-1,n);break;case 8:for(n=e+3;n<r;n+=2)this.addTriangle(n-3,n-2,n-1),this.addTriangle(n-3,n-1,n)}return this},getVertex:function(t){if((t=pd.toNumber(t,-1))<0||t>=this.vertices.length)throw new Error("Invalid vertex index, must be a number between zero and `vertices` array length.");return this.vertices[t]},getNormal:function(t){if((t=pd.toNumber(t,-1))<0||t>=this.normals.length)throw new Error("Invalid normal index, must be a number between zero and `normals` array length.");return this.normals[t]},setNormal:function(t,e){if(this.hasVertexNormals){if(this.normals.length!=this.vertices.length){if(this.normals.length<this.vertices.length)for(var r=this.normals.length,n=this.vertices.length;r<n;++r)this.normals[r]=this.defaultNormal;this.normals.length=this.vertices.length}if(t<this.normals.length)return this.normals[t]=e,!0}return!1},reuseStart:function(t){return null!=this.activeSubMesh&&this.endSubMesh(this.activeSubMesh),this.isReusing=!0,null!=t?(this._vtx_index=+t.vtx_start||0,this._tri_index=+t.tri_start||0,this._lin_index=+t.lin_start||0,this._pts_index=+t.pts_start||0):(this._vtx_index=0,this._tri_index=0,this._lin_index=0,this._pts_index=0),this},addVertex:function(t,e,r,n){var i=-1;return t&&(2==t.length&&(t[2]=0),this.isReusing&&this._vtx_index<this.vertices.length?(i=this._vtx_index,this.vertices[i]=t,this.hasVertexColors&&(this.colors[i]=e||this.defaultColor),this.hasVertexNormals&&(this.normals[i]=r||this.defaultNormal),this.hasVertexCoords&&(this.coords[i]=n||this.defaultCoord),this._vtx_index++):(i=this.vertices.length,this.vertices.push(t),this.hasVertexColors&&this.colors.push(e||this.defaultColor),this.hasVertexNormals&&this.normals.push(r||this.defaultNormal),this.hasVertexCoords&&this.coords.push(n||this.defaultCoord),this._vtx_index=i+1)),i},addVertexObject:function(t){var e=-1;if(t){if(!t.pos)throw new TypeError("Vertex data must at least have a valid 'pos' property.");2==t.pos.length&&(t.pos[2]=0),this.isReusing&&this._vtx_index<this.vertices.length?(e=this._vtx_index,this.vertices[e]=t.pos,this.hasVertexColors&&(this.colors[e]=t.color||this.defaultColor),this.hasVertexNormals&&(this.normals[e]=t.normal||this.defaultNormal),this.hasVertexCoords&&(this.coords[e]=t.coord||this.defaultCoord),this._vtx_index++):(e=this.vertices.length,this.vertices.push(t.pos),this.hasVertexColors&&this.colors.push(t.color||this.defaultColor),this.hasVertexNormals&&this.normals.push(t.normal||this.defaultNormal),this.hasVertexCoords&&this.coords.push(t.coord||this.defaultCoord),this._vtx_index=e+1)}return e},addTriangle:function(t,e,r){if(this.isReusing&&this._tri_index<this.triangles.length){var n=this.triangles[this._tri_index];return n[0]=t,n[1]=e,n[2]=r,this._tri_index++}return this.triangles.push([t,e,r]),this._tri_index=this.triangles.length,this._tri_index-1},addQuad:function(t,e,r,n){e=this.addTriangle(t,e,r);return this.addTriangle(t,r,n),e},addLine:function(t,e){if(this.isReusing&&this._lin_index<this.lines.length){var r=this.lines[this._lin_index];return r[0]=t,r[1]=e,this._lin_index++}return this.lines.push([t,e]),this._lin_index=this.lines.length,this.lines.length-1},addLineStrip:function(t){for(var e=pd.isArray(t)?t:arguments,r=e.length,n=this.lineCount(),i=1;i<r;++i)this.addLine(e[i-1],e[i]);return n},addLineLoop:function(t){for(var e=pd.isArray(t)?t:arguments,r=e.length,n=this.lineCount(),i=1;i<r;++i)this.addLine(e[i-1],e[i]);return 2<r&&this.addLine(e[r-1],e[0]),n},addDraftingLine:function(t,e,r,n){var i,a,o,s=this.addLine(t,e);return 0<r&&(i=[this.defaultColor[0],this.defaultColor[1],this.defaultColor[2],0],a=this.vertices[t],o=this.vertices[e],r=new pd3D.Vector(o[0]-a[0],o[1]-a[1],o[2]-a[2]).normalize().scale(r),this.addLine(e,this.addVertex([o[0]+r.x,o[1]+r.y,o[2]+r.z],i)),n||this.addLine(t,this.addVertex([a[0]-r.x,a[1]-r.y,a[2]-r.z],i))),s},addDraftingLines:function(t,e){var r=-1,n=t.length;if(1<n){r=this.addLine(t[0],t[1]);for(var i,a,o,s,d=2;d<n;++d)this.addLine(t[d-1],t[d]);0<e&&(i=[this.defaultColor[0],this.defaultColor[1],this.defaultColor[2],0],a=this.vertices[t[0]],o=this.vertices[t[1]],s=new pd3D.Vector(o[0]-a[0],o[1]-a[1],o[2]-a[2]).normalize().scale(e),this.addLine(t[0],this.addVertex([a[0]-s.x,a[1]-s.y,a[2]-s.z],i)),a=this.vertices[t[n-2]],o=this.vertices[t[n-1]],s.init(o[0]-a[0],o[1]-a[1],o[2]-a[2]).normalize().scale(e),this.addLine(t[n-1],this.addVertex([o[0]+s.x,o[1]+s.y,o[2]+s.z],i)))}return r},addSketchLine:function(t,e,r,n,i){if(0<r){var a=[this.defaultColor[0],this.defaultColor[1],this.defaultColor[2],0],o=this.vertices[t],s=this.vertices[e],d=.4*r,h=(pd.randomNumber(),0),l=new pd3D.Vector(o[0],o[1],o[2]),c=new pd3D.Vector(s[0],s[1],s[2]),u=new pd3D.Vector.subtract(c,l),p=pd.safeDivide(r,u.length()),f=new pd3D.Vector;n=Math.round(pd.constrainTo(pd.toNumber(n,1),1,8));for(var m=0;m<n;++m){for(var g,y=1-.5*p,v=t,D=p;D<y;D+=p)pd3D.Vector.lerp(l,c,D,f),h=(pd.randomNumber()-.5)*d,this.addLine(v,g=this.addVertex([f.x-h,f.y-h,f.z-h])),v=g;this.addLine(v,e)}u.normalize().scale(r),this.addLine(e,this.addVertex([s[0]+u.x,s[1]+u.y,s[2]+u.z],a)),i||this.addLine(t,this.addVertex([o[0]-u.x,o[1]-u.y,o[2]-u.z],a))}return 0},addPoint:function(t){return this.isReusing&&this._pts_index<this.points.length?(this.points[this._pts_index]=t,this._pts_index++):(this.points.push(t),this._pts_index=this.points.length,this.points.length-1)},addPrimitive:function(t,e){if(!pd.isArray(e)||!pd.isArray(e[0]))throw new TypeError("Vertices must be given as an array of vector arrays.");this.begin(t);for(var r=0,n=e.length;r<n;++r)this.vertex(e[r]);return this.end(),this},reuseEnd:function(){return this.vertices&&this.vertices.length>this._vtx_index&&(this.vertices.length=this._vtx_index),this.hasVertexNormals&&this.normals.length>this._vtx_index&&(this.normals.length=this._vtx_index),this.hasVertexColors&&this.colors.length>this._vtx_index&&(this.colors.length=this._vtx_index),this.hasVertexCoords&&this.coords.length>this._vtx_index&&(this.coords.length=this._vtx_index),this.triangles&&this.triangles.length>this._tri_index&&(this.triangles.length=this._tri_index),this.lines&&this.lines.length>this._lin_index&&(this.lines.length=this._lin_index),this.points&&this.points.length>this._pts_index&&(this.points.length=this._pts_index),this.isReusing=!1,this.setChangeFlag(4),this},hasContent:function(){if(this.isReusing){if(0<this._vtx_index&&(0<this._tri_index||0<this._pts_index||0<this._lin_index))return!0}else if(this.vertices&&0<this.vertices.length&&(this.triangles&&0<this.triangles.length||this.points&&0<this.points.length||this.lines&&0<this.lines.length))return!0;return!1},vertexCount:function(){return this.isReusing?this._vtx_index:this.vertices?this.vertices.length:0},triangleCount:function(){return this.isReusing?this._tri_index:this.triangles?this.triangles.length:0},lineCount:function(){return this.isReusing?this._lin_index:this.lines?this.lines.length:0},pointCount:function(){return this.isReusing?this._pts_index:this.points?this.points.length:0},startSubMesh:function(t){return null!=this.activeSubMesh&&this.endSubMesh(this.activeSubMesh),(t=t||new pd3D.SubMesh).vtx_start=t.vtx_stop=this.vertexCount(),t.tri_start=t.tri_stop=this.triangleCount(),t.lin_start=t.lin_stop=this.lineCount(),t.pts_start=t.pts_stop=this.pointCount(),this.activeSubMesh=t},endSubMesh:function(t){return null!=(t=t||this.activeSubMesh)&&(t.vtx_stop=this.vertexCount(),t.tri_stop=this.triangleCount(),t.lin_stop=this.lineCount(),t.pts_stop=this.pointCount()),this.activeSubMesh=null,t},merge:function(t,e){if(t){var r,n,i,a=this.vertexCount(),o=this.isReusing;o&&this.reuseEnd();var s=t.vertices,d=this.vertices;if(e){if(pd.isArray(e))for(e[0]=+e[0],e[1]=+e[1],e[2]=+e[2],r=0,n=s.length;r<n;++r)d.push([s[r][0]+e[0],s[r][1]+e[1],s[r][2]+e[2]]);else if("x"in e)for(r=0,n=s.length;r<n;++r)d.push([s[r][0]+e.x,s[r][1]+e.y,s[r][2]+e.z])}else for(r=0,n=s.length;r<n;++r)d.push(s[r]);if(this.hasVertexNormals)if(d=this.normals,t.hasVertexNormals)for(r=0,n=(s=t.normals).length;r<n;++r)d.push(s[r]);else for(i=t.defaultNormal,r=0,n=t.vertices.length;r<n;++r)d.push(i);if(this.hasVertexColors)if(d=this.colors,t.hasVertexColors)for(r=0,n=(s=t.colors).length;r<n;++r)d.push(s[r]);else for(i=t.defaultColor,r=0,n=t.vertices.length;r<n;++r)d.push(i);if(this.hasVertexCoords)if(d=this.coords,t.hasVertexCoords)for(r=0,n=(s=t.coords).length;r<n;++r)d.push(s[r]);else for(i=t.defaultCoord,r=0,n=t.vertices.length;r<n;++r)d.push(i);if(this.triangles&&t.triangles&&0<t.triangles.length)for(s=t.triangles,d=this.triangles,r=0,n=s.length;r<n;++r)i=s[r],d.push([i[0]+a,i[1]+a,i[2]+a]);if(this.lines&&t.lines&&0<t.lines.length)for(s=t.lines,d=this.lines,r=0,n=s.length;r<n;++r)i=s[r],d.push([i[0]+a,i[1]+a]);if(this.points&&t.points&&0<t.points.length)for(s=t.points,d=this.points,r=0,n=s.length;r<n;++r)d.push(s[r]+a);this.vertices&&(this._vtx_index=this.vertices.length),this.triangles&&(this._tri_index=this.triangles.length),this.lines&&(this._lin_index=this.lines.length),this.points&&(this._pts_index=this.points.length),this.isReusing=o}return this.setChangeFlag(4),this},addLineExtensions:function(t,e,r,n,i){if(t&&0<e&&t.lines&&t.lineCount()){this.lines||this.addIndexBuffer("lines");var a,o,s,d,h=new pd3D.Vector,l=t.vertices,c=this.defaultColor,u=[c[0],c[1],c[2],0],p=t.lineCount();n=pd.constrainTo(pd.toNumber(n,0),0,p),i=pd.constrainTo(pd.toNumber(i,p),0,p);for(var f=n;f<i;++f)o=l[(d=t.lines[f])[0]],a=l[d[1]],h.x=a[0]-o[0],h.y=a[1]-o[1],h.z=a[2]-o[2],s=Math.min(e,.2*h.length()),h.normalize().scale(s),d=this.addVertex(o,c),s=this.addVertex(a,c),r&&this.addLine(d,s),o=this.addVertex([o[0]-h.x,o[1]-h.y,o[2]-h.z],u),this.addLine(d,o),o=this.addVertex([a[0]+h.x,a[1]+h.y,a[2]+h.z],u),this.addLine(s,o);this.defaultColor=c,this.setChangeFlag(1,"gl_Vertex"),this.setChangeFlag(2,"lines")}return this},updateOpacity:function(t){if(this.colors){t=pd.constrainTo(t,0,1);for(var e,r=this.colors.length,n=0;n<r;++n)(e=this.colors[n]).fade||(e[3]=t);this.setChangeFlag(1,"gl_Color")}return this},compile:function(){if(this.isReusing&&this.reuseEnd(),null!=this.activeSubMesh&&this.endSubMesh(this.activeSubMesh),0<this.vertices.length){var t,e,r,n=pd3D.canUse32BitBuffers&&65535<this.vertices.length;for(t in this.vertexBuffers){(r=this.vertexBuffers[t]).data=this[r.name],r.compile()}for(e in this.indexBuffers){(r=this.indexBuffers[e]).type=n?Uint32Array:Uint16Array,r.data=this[e],r.compile()}}return this._changeFlag=0,this},compileBuffer:function(t){var e;return this.isReusing&&this.reuseEnd(),null!=this.activeSubMesh&&this.endSubMesh(this.activeSubMesh),this.vertexBuffers[t]?((e=this.vertexBuffers[t]).data=this[e.name],e.compile()):this.indexBuffers[t]&&((e=this.indexBuffers[t]).type=pd3D.canUse32BitBuffers&&65535<this.vertices.length?Uint32Array:Uint16Array,e.data=this[t],e.compile()),this},compileBuffers:function(t){this.isReusing&&this.reuseEnd(),null!=this.activeSubMesh&&this.endSubMesh(this.activeSubMesh);for(var e=pd3D.canUse32BitBuffers&&65535<this.vertices.length,r=pd.isArray(t)?t:arguments,n=0,i=r.length;n<i;++n){var a,o=r[n];this.vertexBuffers[o]?((a=this.vertexBuffers[o]).data=this[a.name],a.compile()):this.indexBuffers[o]&&((a=this.indexBuffers[o]).type=e?Uint32Array:Uint16Array,a.data=this[o],a.compile())}return this},clear:function(){for(var t in this.isReusing&&this.reuseEnd(),null!=this.activeSubMesh&&this.endSubMesh(this.activeSubMesh),this.vertices&&(this.vertices.length=0),this.normals&&(this.normals.length=0),this.colors&&(this.colors.length=0),this.coords&&(this.coords.length=0),this.triangles&&(this.triangles.length=0),this.points&&(this.points.length=0),this.lines&&(this.lines.length=0),this.vertexBuffers)this.vertexBuffers[t].data=null;for(var e in this.indexBuffers)this.indexBuffers[e].data=null;return this._changeFlag=4,this},destroy:function(){for(var t in this.clear(),this.vertexBuffers){var e=this.vertexBuffers[t];e.buffer&&(gl.bindBuffer(e.target,e.buffer),gl.bufferData(e.target,1,i),gl.deleteBuffer(e.buffer))}for(var r in this.indexBuffers){var n=this.indexBuffers[r];n.buffer&&(gl.bindBuffer(n.target,n.buffer),gl.bufferData(n.target,1,i),gl.deleteBuffer(n.buffer))}return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null),gl.bindBuffer(gl.ARRAY_BUFFER,null),this.vertexBuffers={},this.indexBuffers={},this._changeFlag=0,this},transform:function(t,e,r,n){var i,a=this.vertexCount();r=pd.toNumber(r,0),n=pd.toNumber(n,a),a<=r&&(r=a-1),r<0&&(r=0);for(var o=r;o<n;++o)i=this.vertices[o].slice(),t.applyPointTransformToArray(i),this.vertices[o]=i;if(this.normals&&this.normals.length==a){e=e||t.inverse().transpose();for(o=r;o<n;++o)i=this.normals[o].slice(),pd3D.Vector.normaliseArrayInPlace(e.applyVectorTransformToArray(i)),this.normals[o]=i}return this.setChangeFlag(1,"gl_Vertex"),this.setChangeFlag(1,"gl_Normal"),this},transformInPlace:function(t,e,r,n){var i=this.vertexCount();r=pd.toNumber(r,0),n=pd.toNumber(n,i),i<=r&&(r=i-1),r<0&&(r=0);for(var a=r;a<n;++a)t.applyPointTransformToArray(this.vertices[a]);if(this.normals&&this.normals.length==i){e=e||t.inverse().transpose();for(a=r;a<n;++a)pd3D.Vector.normaliseArrayInPlace(e.applyVectorTransformToArray(this.normals[a]))}return this.setChangeFlag(1,"gl_Vertex"),this.setChangeFlag(1,"gl_Normal"),this},reverseNormals:function(){return this.normals&&(this.isReusing&&this.normals.length>this._vtx_index&&(this.normals.length=this._vtx_index),this.normals=this.normals.map(function(t){return[-t[0],-t[1],-t[2]]}),this.setChangeFlag(1,"gl_Normal")),this},reverseTriangles:function(){if(this.triangles){for(var t,e,r=this.triangleCount(),n=0;n<r;++n)t=(e=this.triangles[n])[1],e[1]=e[2],e[2]=t;this.setChangeFlag(2,"triangles")}return this},translate:function(e,r,n){return this.vertices&&(this.isReusing&&this.vertices.length>this._vtx_index&&(this.vertices.length=this._vtx_index),this.vertices=this.vertices.map(function(t){return[t[0]+e,t[1]+r,t[2]+n]}),this.setChangeFlag(1,"gl_Vertex")),this},scale:function(e,r,n){return this.vertices&&(this.isReusing&&this.vertices.length>this._vtx_index&&(this.vertices.length=this._vtx_index),this.vertices=this.vertices.map(function(t){return[t[0]*e,t[1]*r,t[2]*n]}),this.setChangeFlag(1,"gl_Vertex")),this},swapYZ:function(){return this.vertices&&(this.isReusing&&this.vertices.length>this._vtx_index&&(this.vertices.length=this._vtx_index),this.vertices=this.vertices.map(function(t){return[t[0],-t[2],t[1]]}),this.setChangeFlag(1,"gl_Vertex")),this.normals&&(this.isReusing&&this.normals.length>this._vtx_index&&(this.normals.length=this._vtx_index),this.normals=this.normals.map(function(t){return[t[0],-t[2],t[1]]}),this.setChangeFlag(1,"gl_Normal")),this},mirrorY:function(){return this.vertices&&(this.isReusing&&this.vertices.length>this._vtx_index&&(this.vertices.length=this._vtx_index),this.vertices=this.vertices.map(function(t){return[t[0],-t[1],t[2]]}),this.setChangeFlag(1,"gl_Vertex")),this.normals&&(this.isReusing&&this.normals.length>this._vtx_index&&(this.normals.length=this._vtx_index),this.normals=this.normals.map(function(t){return[t[0],-t[1],t[2]]}),this.setChangeFlag(1,"gl_Normal")),this.reverseTriangles(),this},computeNormals:function(){this.normals||this.addVertexBuffer("normals","gl_Normal"),this.isReusing&&this.reuseEnd();var t=this.vertices.length,e=this.normals.length;e!=t&&(e=this.normals.length=t);for(var r=this.triangles.length,n=0;n<e;++n)this.normals[n]=new pd3D.Vector;for(n=0;n<r;++n){var i=this.triangles[n],a=pd3D.Vector.fromArray(this.vertices[i[0]]),o=pd3D.Vector.fromArray(this.vertices[i[1]]),s=pd3D.Vector.fromArray(this.vertices[i[2]]),a=o.subtract(a).cross(s.subtract(a)).normalize();this.normals[i[0]]=this.normals[i[0]].add(a),this.normals[i[1]]=this.normals[i[1]].add(a),this.normals[i[2]]=this.normals[i[2]].add(a)}for(n=0;n<e;++n)this.normals[n]=this.normals[n].normalize().toArray();return this.setChangeFlag(1,"gl_Normal"),this},computeWireframe:function(t){var e,r,n,i,a,o,s=new pd.IndexCounter;if(this.isReusing&&this.reuseEnd(),t){for(r=this.triangles.length,d=0;d<r;++d)i=(n=this.triangles[d])[0],a=n[1],o=n[2],s.count([Math.min(i,a),Math.max(i,a)]),s.count([Math.min(a,o),Math.max(a,o)]),s.count([Math.min(o,i),Math.max(o,i)]);this.lines||this.addIndexBuffer("lines"),r=s.unique.length;for(var d=0;d<r;++d)0<s.counter[d]%2&&this.lines.push(s.unique[d])}else{for(r=this.triangles.length,d=0;d<r;++d)for(n=this.triangles[d],e=0;e<n.length;++e)i=n[e],a=n[(e+1)%n.length],s.count([Math.min(i,a),Math.max(i,a)]);this.lines||this.addIndexBuffer("lines"),this.lines=s.unique}return this.setChangeFlag(2,"lines"),this},computeBoundingBox:function(){var t,e,r,n;this.boundingBox?((t=this.boundingBox).min.init(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.max=pd3D.Vector.negative(t.min,t.max)):t=this.boundingBox={min:new pd3D.Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),max:new pd3D.Vector(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)},r=t.min,n=t.max;for(var i=this.vertexCount(),a=0;a<i;++a)e=this.vertices[a],r.x>e[0]&&(r.x=e[0]),r.y>e[1]&&(r.y=e[1]),r.z>e[2]&&(r.z=e[2]),n.x<e[0]&&(n.x=e[0]),n.y<e[1]&&(n.y=e[1]),n.z<e[2]&&(n.z=e[2]);return this},getAABB:function(t){var e,r,n;t&&t.min||((t={min:new pd3D.Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}).max=t.min.negative()),r=t.min,n=t.max;for(var i=this.vertexCount(),a=0;a<i;++a)e=this.vertices[a],r.x>e[0]&&(r.x=e[0]),r.y>e[1]&&(r.y=e[1]),r.z>e[2]&&(r.z=e[2]),n.x<e[0]&&(n.x=e[0]),n.y<e[1]&&(n.y=e[1]),n.z<e[2]&&(n.z=e[2]);return t},getBoundingSphere:function(){for(var t=this.getAABB(),e={center:t.min.add(t.max).divide(2),radius:0},r=new pd3D.Vector,n=this.vertexCount(),i=0;i<n;++i)e.radius=Math.max(e.radius,pd3D.Vector.fromArray(this.vertices[i],r).subtract(e.center).length());return e}},pd3D.Mesh.load=function(t,e,r){return"coords"in(e=e||{})||(e.coords=!!t.coords),"normals"in e||(e.normals=!!t.normals),"colors"in e||(e.colors=!!t.colors),"triangles"in e||(e.triangles=!!t.triangles),"points"in e||(e.points=!!t.points),"lines"in e||(e.lines=!!t.lines),r?r.clear():r=new pd3D.Mesh(e),r.vertices=t.vertices,r.coords&&(r.coords=t.coords),r.normals&&(r.normals=t.normals),r.colors&&(r.colors=t.colors),r.triangles&&(r.triangles=t.triangles),r.points&&(r.points=t.points),r.lines&&(r.lines=t.lines),"twoSided"in t&&(r.twoSided=t.twoSided),r.compile(),r},pd3D.SubMesh=function(){this.vtx_start=0,this.vtx_stop=0,this.tri_start=0,this.tri_stop=0,this.lin_start=0,this.lin_stop=0,this.pts_start=0,this.pts_stop=0},pd3D.Buffer=function(t){t=t||{},this.buffer=null,this.target=pd.toInteger(t.target,34962),this.type=t.type||Float32Array,this.usageHint=pd.toInteger(t.usageHint,i),this.name=t.name||"",this.updateRequired=!0,this.spacing=pd.toInteger(t.spacing,1),this.length=pd.toInteger(t.length,0),this.data=0<this.length?this.type(this.length):[]},pd3D.Buffer.prototype.compile=function(t){var e=this.data;if(!pd.isTypedArray(e)){var r=[];if(0<e.length&&!pd.isArray(e[0]))r=e;else if(Array.prototype.flat)r=e.flat();else for(var n=0;n<e.length;n+=1e4)r=Array.prototype.concat.apply(r,e.slice(n,n+1e4));var i=0<e.length?r.length/e.length:0;if(i!=Math.round(i))throw"buffer elements not of consistent size, average size is "+i;e=new this.type(r),this.spacing=i}this.buffer=this.buffer||gl.createBuffer(),this.length=e.length,gl.bindBuffer(this.target,this.buffer),gl.bufferData(this.target,e,t||this.usageHint),this.updateRequired=!1},pd3D.Vector=function(t,e,r){this.x=0,this.y=0,(this.z=0)<arguments.length&&(1==arguments.length?t instanceof pd3D.Vector?(this.x=t.x,this.y=t.y,this.z=t.z):pd.isArray(t)?(this.x=+t[0]||0,this.y=+t[1]||0,this.z=+t[2]||0):(t=+t||0,this.x=t,this.y=t,this.z=t):(this.x=+t||0,this.y=+e||0,this.z=+r||0))},pd3D.Vector.prototype={negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){var t=this.length();return 0<t&&(this.x/=t,this.y/=t,this.z/=t),this},move:function(t,e,r){return 1==arguments.length?t instanceof pd3D.Vector?(this.x+=t.x,this.y+=t.y,this.z+=t.z):pd.isArray(t)?(this.x+=+t[0]||0,this.y+=+t[1]||0,this.z+=+t[2]||0):(t=+t||0,this.x+=t,this.y+=t,this.z+=t):(this.x+=+t||0,this.y+=+e||0,this.z+=+r||0),this},scale:function(t,e,r){return 1==arguments.length?t instanceof pd3D.Vector?(this.x*=t.x,this.y*=t.y,this.z*=t.z):pd.isArray(t)?(this.x*=+t[0]||0,this.y*=+t[1]||0,this.z*=+t[2]||0):(t=+t||0,this.x*=t,this.y*=t,this.z*=t):(this.x*=+t||0,this.y*=+e||0,this.z*=+r||0),this},fromPolarAngles:function(t,e){var r=Math.cos(e);return this.init(r*Math.sin(t),r*Math.cos(t),Math.sin(e)),this},fromArray:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},init:function(t,e,r){return 1==arguments.length?t instanceof pd3D.Vector?(this.x=t.x,this.y=t.y,this.z=t.z):pd.isArray(t)?(this.x=+t[0]||0,this.y=+t[1]||0,this.z=+t[2]||0):(t=+t||0,this.x=t,this.y=t,this.z=t):(this.x=+t||0,this.y=+e||0,this.z=+r||0),this},distanceTo:function(t){var e=t.x-this.x,r=t.y-this.y,t=t.z-this.z;return Math.sqrt(e*e+r*r+t*t)},negative:function(){return new pd3D.Vector(-this.x,-this.y,-this.z)},add:function(t){return t instanceof pd3D.Vector?new pd3D.Vector(this.x+t.x,this.y+t.y,this.z+t.z):new pd3D.Vector(this.x+t,this.y+t,this.z+t)},subtract:function(t){return t instanceof pd3D.Vector?new pd3D.Vector(this.x-t.x,this.y-t.y,this.z-t.z):new pd3D.Vector(this.x-t,this.y-t,this.z-t)},multiply:function(t){return t instanceof pd3D.Vector?new pd3D.Vector(this.x*t.x,this.y*t.y,this.z*t.z):new pd3D.Vector(this.x*t,this.y*t,this.z*t)},divide:function(t){return t instanceof pd3D.Vector?new pd3D.Vector(this.x/t.x,this.y/t.y,this.z/t.z):new pd3D.Vector(this.x/t,this.y/t,this.z/t)},closeTo:function(t,e){return e=pd.toNumber(e,pd.Const.EPSILON),!(this.x>t.x+e||this.x<t.x-e)&&(!(this.y>t.y+e||this.y<t.y-e)&&!(this.z>t.z+e||this.z<t.z-e))},equals:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new pd3D.Vector(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.y,this.x),phi:Math.asin(this.z/this.length())}},toArray:function(t){return t?[this.x,this.y,this.z].slice(0,t):[this.x,this.y,this.z]},clone:function(){return new pd3D.Vector(this.x,this.y,this.z)},angleBetweenPoints:function(t,e){var r=this.distanceTo(t)*this.distanceTo(e),e=(t.x-this.x)*(e.x-this.x)+(t.y-this.y)*(e.y-this.y)+(t.z-this.z)*(e.z-this.z),r=1e-12<Math.abs(r)?e/r:0;return 1<=r?0:r<=-1?Math.PI:Math.acos(r)}},pd3D.Vector.negative=function(t,e){return(e=e||new pd3D.Vector).x=-t.x,e.y=-t.y,e.z=-t.z,e},pd3D.Vector.add=function(t,e,r){return r=r||new pd3D.Vector,e instanceof pd3D.Vector?(r.x=t.x+e.x,r.y=t.y+e.y,r.z=t.z+e.z):(r.x=t.x+e,r.y=t.y+e,r.z=t.z+e),r},pd3D.Vector.subtract=function(t,e,r){return r=r||new pd3D.Vector,e instanceof pd3D.Vector?(r.x=t.x-e.x,r.y=t.y-e.y,r.z=t.z-e.z):(r.x=t.x-e,r.y=t.y-e,r.z=t.z-e),r},pd3D.Vector.multiply=function(t,e,r){return r=r||new pd3D.Vector,e instanceof pd3D.Vector?(r.x=t.x*e.x,r.y=t.y*e.y,r.z=t.z*e.z):(r.x=t.x*e,r.y=t.y*e,r.z=t.z*e),r},pd3D.Vector.divide=function(t,e,r){return r=r||new pd3D.Vector,e instanceof pd3D.Vector?(r.x=t.x/e.x,r.y=t.y/e.y,r.z=t.z/e.z):(r.x=t.x/e,r.y=t.y/e,r.z=t.z/e),r},pd3D.Vector.cross=function(t,e,r){r=r||new pd3D.Vector;var n=t.y*e.z-t.z*e.y,i=t.z*e.x-t.x*e.z,e=t.x*e.y-t.y*e.x;return r.x=n,r.y=i,r.z=e,r},pd3D.Vector.unit=function(t,e){e=e||new pd3D.Vector;var r=t.length();return e.x=t.x/r,e.y=t.y/r,e.z=t.z/r,e},pd3D.Vector.fromAngles=function(t,e,r){return(r=r||new pd3D.Vector).x=Math.cos(t)*Math.cos(e),r.y=Math.sin(t)*Math.cos(e),r.z=Math.sin(e),r},pd3D.Vector.rotateX=function(t,e,r,n){var i=t.y-e.y,a=t.z-e.z,o=Math.cos(r),r=Math.sin(r);return(n=n||new pd3D.Vector).y=i*o-a*r+e.y,n.z=a*o+i*r+e.z,n.x=t.x,n},pd3D.Vector.rotateY=function(t,e,r,n){var i=t.x-e.x,a=t.z-e.z,o=Math.cos(r),r=Math.sin(r);return(n=n||new pd3D.Vector).x=i*o-a*r+e.x,n.z=a*o+i*r+e.z,n.y=t.y,n},pd3D.Vector.rotateZ=function(t,e,r,n){var i=t.x-e.x,a=t.y-e.y,o=Math.cos(r),r=Math.sin(r);return(n=n||new pd3D.Vector).x=i*o-a*r+e.x,n.y=a*o+i*r+e.y,n.z=t.z,n},pd3D.Vector.sphericalToCartesian3D=function(t,e,r,n){var i=Math.cos(t),a=Math.sin(t),t=r*Math.cos(e);return(n=n||new pd3D.Vector).x=t*i,n.y=t*a,n.z=r*Math.sin(e),n},pd3D.Vector.angleBetweenPoints=function(t,e,r){var n=t.distanceTo(e)*t.distanceTo(r),t=(e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y)+(e.z-t.z)*(r.z-t.z),n=1e-12<Math.abs(n)?t/n:0;return 1<=n?0:n<=-1?Math.PI:Math.acos(n)},pd3D.Vector.randomDirection=function(t){return pd3D.Vector.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1),t)},pd3D.Vector.min=function(t,e,r){return(r=r||new pd3D.Vector).x=Math.min(t.x,e.x),r.y=Math.min(t.y,e.y),r.z=Math.min(t.z,e.z),r},pd3D.Vector.max=function(t,e,r){return(r=r||new pd3D.Vector).x=Math.max(t.x,e.x),r.y=Math.max(t.y,e.y),r.z=Math.max(t.z,e.z),r},pd3D.Vector.lerp=function(t,e,r,n){var i;return n=n||new pd3D.Vector,r instanceof pd3D.Vector?(n.x=(1-r.x)*t.x+r.x*e.x,n.y=(1-r.y)*t.y+r.y*e.y,n.z=(1-r.z)*t.z+r.z*e.z):(r=1-(i=+r),n.x=r*t.x+i*e.x,n.y=r*t.y+i*e.y,n.z=r*t.z+i*e.z),n},pd3D.Vector.fromArray=function(t,e){return(e=e||new pd3D.Vector).x=+t[0]||0,e.y=+t[1]||0,e.z=+t[2]||0,e},pd3D.Vector.normaliseArrayInPlace=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return 0<e&&(t[0]/=e,t[1]/=e,t[2]/=e),t},pd3D.Vector.UnitX=new pd3D.Vector(1,0,0),pd3D.Vector.UnitY=new pd3D.Vector(0,1,0),pd3D.Vector.UnitZ=new pd3D.Vector(0,0,1);var r="undefined"!=typeof Float32Array;pd3D.Matrix=function(){var t=Array.prototype.concat.apply([],arguments);t.length||(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=r?new Float32Array(t):t},pd3D.Matrix.prototype={inverse:function(t){return t=t||new pd3D.Matrix,pd3D.Matrix.inverse(this,t)},transpose:function(t){return t=t||new pd3D.Matrix,pd3D.Matrix.transpose(this,t)},multiply:function(t,e){return e=e||new pd3D.Matrix,pd3D.Matrix.multiply(this,t,e)},multiplyBy:function(t,e){return e=e||new pd3D.Matrix,pd3D.Matrix.multiply(this,t,e),this.init(e)},init:function(t){if(null!=t)for(var e=this.m,r=t.m,n=0;n<16;++n)e[n]=r[n];return this},transformPoint:function(t,e){var r=this.m,n=r[12]*t.x+r[13]*t.y+r[14]*t.z+r[15];-1e-12<n&&n<1e-12&&(n=1);var i=(r[0]*t.x+r[1]*t.y+r[2]*t.z+r[3])/n,a=(r[4]*t.x+r[5]*t.y+r[6]*t.z+r[7])/n,n=(r[8]*t.x+r[9]*t.y+r[10]*t.z+r[11])/n;return e?e.init(i,a,n):new pd3D.Vector(i,a,n)},transformVector:function(t,e){var r=this.m,n=r[0]*t.x+r[1]*t.y+r[2]*t.z,i=r[4]*t.x+r[5]*t.y+r[6]*t.z,t=r[8]*t.x+r[9]*t.y+r[10]*t.z;return e?e.init(n,i,t):new pd3D.Vector(n,i,t)},copyToColumnMajorArray:function(t){var e=this.m;return(t=t||new Float32Array(16))[0]=e[0],t[4]=e[1],t[8]=e[2],t[12]=e[3],t[1]=e[4],t[5]=e[5],t[9]=e[6],t[13]=e[7],t[2]=e[8],t[6]=e[9],t[10]=e[10],t[14]=e[11],t[3]=e[12],t[7]=e[13],t[11]=e[14],t[15]=e[15],t},applyPointTransformToArray:function(t){var e=this.m,r=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3],n=e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7],i=e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11],e=e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15];return 0<Math.abs(e)?(t[0]=r/e,t[1]=n/e,t[2]=i/e):(t[0]=r,t[1]=n,t[2]=i),t},applyVectorTransformToArray:function(t){var e=this.m,r=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],n=e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e=e[8]*t[0]+e[9]*t[1]+e[10]*t[2];return t[0]=r,t[1]=n,t[2]=e,t}},pd3D.Matrix.fromArray=function(t,e){if(!t||16!=t.length)throw new TypeError("Argument 'array' must be a valid Array containing 16 numeric values.");return(e=e||new pd3D.Matrix).m=r?new Float32Array(t):t,e},pd3D.Matrix.clone=function(t,e){if(e=e||new pd3D.Matrix,null!=t)for(var r=e.m,n=t.m,i=0;i<16;++i)r[i]=n[i];return e},pd3D.Matrix.inverse=function(t,e){e=e||new pd3D.Matrix;var t=t.m,r=e.m;r[0]=t[5]*t[10]*t[15]-t[5]*t[14]*t[11]-t[6]*t[9]*t[15]+t[6]*t[13]*t[11]+t[7]*t[9]*t[14]-t[7]*t[13]*t[10],r[1]=-t[1]*t[10]*t[15]+t[1]*t[14]*t[11]+t[2]*t[9]*t[15]-t[2]*t[13]*t[11]-t[3]*t[9]*t[14]+t[3]*t[13]*t[10],r[2]=t[1]*t[6]*t[15]-t[1]*t[14]*t[7]-t[2]*t[5]*t[15]+t[2]*t[13]*t[7]+t[3]*t[5]*t[14]-t[3]*t[13]*t[6],r[3]=-t[1]*t[6]*t[11]+t[1]*t[10]*t[7]+t[2]*t[5]*t[11]-t[2]*t[9]*t[7]-t[3]*t[5]*t[10]+t[3]*t[9]*t[6],r[4]=-t[4]*t[10]*t[15]+t[4]*t[14]*t[11]+t[6]*t[8]*t[15]-t[6]*t[12]*t[11]-t[7]*t[8]*t[14]+t[7]*t[12]*t[10],r[5]=t[0]*t[10]*t[15]-t[0]*t[14]*t[11]-t[2]*t[8]*t[15]+t[2]*t[12]*t[11]+t[3]*t[8]*t[14]-t[3]*t[12]*t[10],r[6]=-t[0]*t[6]*t[15]+t[0]*t[14]*t[7]+t[2]*t[4]*t[15]-t[2]*t[12]*t[7]-t[3]*t[4]*t[14]+t[3]*t[12]*t[6],r[7]=t[0]*t[6]*t[11]-t[0]*t[10]*t[7]-t[2]*t[4]*t[11]+t[2]*t[8]*t[7]+t[3]*t[4]*t[10]-t[3]*t[8]*t[6],r[8]=t[4]*t[9]*t[15]-t[4]*t[13]*t[11]-t[5]*t[8]*t[15]+t[5]*t[12]*t[11]+t[7]*t[8]*t[13]-t[7]*t[12]*t[9],r[9]=-t[0]*t[9]*t[15]+t[0]*t[13]*t[11]+t[1]*t[8]*t[15]-t[1]*t[12]*t[11]-t[3]*t[8]*t[13]+t[3]*t[12]*t[9],r[10]=t[0]*t[5]*t[15]-t[0]*t[13]*t[7]-t[1]*t[4]*t[15]+t[1]*t[12]*t[7]+t[3]*t[4]*t[13]-t[3]*t[12]*t[5],r[11]=-t[0]*t[5]*t[11]+t[0]*t[9]*t[7]+t[1]*t[4]*t[11]-t[1]*t[8]*t[7]-t[3]*t[4]*t[9]+t[3]*t[8]*t[5],r[12]=-t[4]*t[9]*t[14]+t[4]*t[13]*t[10]+t[5]*t[8]*t[14]-t[5]*t[12]*t[10]-t[6]*t[8]*t[13]+t[6]*t[12]*t[9],r[13]=t[0]*t[9]*t[14]-t[0]*t[13]*t[10]-t[1]*t[8]*t[14]+t[1]*t[12]*t[10]+t[2]*t[8]*t[13]-t[2]*t[12]*t[9],r[14]=-t[0]*t[5]*t[14]+t[0]*t[13]*t[6]+t[1]*t[4]*t[14]-t[1]*t[12]*t[6]-t[2]*t[4]*t[13]+t[2]*t[12]*t[5],r[15]=t[0]*t[5]*t[10]-t[0]*t[9]*t[6]-t[1]*t[4]*t[10]+t[1]*t[8]*t[6]+t[2]*t[4]*t[9]-t[2]*t[8]*t[5];for(var n=t[0]*r[0]+t[1]*r[4]+t[2]*r[8]+t[3]*r[12],i=0;i<16;++i)r[i]/=n;return e},pd3D.Matrix.transpose=function(t,e){e=e||new pd3D.Matrix;var r=t.m,t=e.m;return t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15],e},pd3D.Matrix.multiply=function(t,e,r){var n,i=t.m,e=e.m;if(t===r){(n=[])[0]=i[0]*e[0]+i[1]*e[4]+i[2]*e[8]+i[3]*e[12],n[1]=i[0]*e[1]+i[1]*e[5]+i[2]*e[9]+i[3]*e[13],n[2]=i[0]*e[2]+i[1]*e[6]+i[2]*e[10]+i[3]*e[14],n[3]=i[0]*e[3]+i[1]*e[7]+i[2]*e[11]+i[3]*e[15],n[4]=i[4]*e[0]+i[5]*e[4]+i[6]*e[8]+i[7]*e[12],n[5]=i[4]*e[1]+i[5]*e[5]+i[6]*e[9]+i[7]*e[13],n[6]=i[4]*e[2]+i[5]*e[6]+i[6]*e[10]+i[7]*e[14],n[7]=i[4]*e[3]+i[5]*e[7]+i[6]*e[11]+i[7]*e[15],n[8]=i[8]*e[0]+i[9]*e[4]+i[10]*e[8]+i[11]*e[12],n[9]=i[8]*e[1]+i[9]*e[5]+i[10]*e[9]+i[11]*e[13],n[10]=i[8]*e[2]+i[9]*e[6]+i[10]*e[10]+i[11]*e[14],n[11]=i[8]*e[3]+i[9]*e[7]+i[10]*e[11]+i[11]*e[15],n[12]=i[12]*e[0]+i[13]*e[4]+i[14]*e[8]+i[15]*e[12],n[13]=i[12]*e[1]+i[13]*e[5]+i[14]*e[9]+i[15]*e[13],n[14]=i[12]*e[2]+i[13]*e[6]+i[14]*e[10]+i[15]*e[14],n[15]=i[12]*e[3]+i[13]*e[7]+i[14]*e[11]+i[15]*e[15];for(var a=0;a<16;++a)i[a]=n[a]}else{(n=(r=r||new pd3D.Matrix).m)[0]=i[0]*e[0]+i[1]*e[4]+i[2]*e[8]+i[3]*e[12],n[1]=i[0]*e[1]+i[1]*e[5]+i[2]*e[9]+i[3]*e[13],n[2]=i[0]*e[2]+i[1]*e[6]+i[2]*e[10]+i[3]*e[14],n[3]=i[0]*e[3]+i[1]*e[7]+i[2]*e[11]+i[3]*e[15],n[4]=i[4]*e[0]+i[5]*e[4]+i[6]*e[8]+i[7]*e[12],n[5]=i[4]*e[1]+i[5]*e[5]+i[6]*e[9]+i[7]*e[13],n[6]=i[4]*e[2]+i[5]*e[6]+i[6]*e[10]+i[7]*e[14],n[7]=i[4]*e[3]+i[5]*e[7]+i[6]*e[11]+i[7]*e[15],n[8]=i[8]*e[0]+i[9]*e[4]+i[10]*e[8]+i[11]*e[12],n[9]=i[8]*e[1]+i[9]*e[5]+i[10]*e[9]+i[11]*e[13],n[10]=i[8]*e[2]+i[9]*e[6]+i[10]*e[10]+i[11]*e[14],n[11]=i[8]*e[3]+i[9]*e[7]+i[10]*e[11]+i[11]*e[15],n[12]=i[12]*e[0]+i[13]*e[4]+i[14]*e[8]+i[15]*e[12],n[13]=i[12]*e[1]+i[13]*e[5]+i[14]*e[9]+i[15]*e[13],n[14]=i[12]*e[2]+i[13]*e[6]+i[14]*e[10]+i[15]*e[14],n[15]=i[12]*e[3]+i[13]*e[7]+i[14]*e[11]+i[15]*e[15]}return r},pd3D.Matrix.identity=function(t){var e=(t=t||new pd3D.Matrix).m;return e[0]=e[5]=e[10]=e[15]=1,e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,t},pd3D.Matrix.perspective=function(t,e,r,n,i){t=Math.tan(t*Math.PI/360)*r,e*=t;return pd3D.Matrix.frustum(-e,e,-t,t,r,n,i)},pd3D.Matrix.frustum=function(t,e,r,n,i,a,o){var s=(o=o||new pd3D.Matrix).m;return s[0]=2*i/(e-t),s[1]=0,s[2]=(e+t)/(e-t),s[3]=0,s[4]=0,s[5]=2*i/(n-r),s[6]=(n+r)/(n-r),s[7]=0,s[8]=0,s[9]=0,s[10]=-(a+i)/(a-i),s[11]=-2*a*i/(a-i),s[12]=0,s[13]=0,s[14]=-1,s[15]=0,o},pd3D.Matrix.ortho=function(t,e,r,n,i,a,o){var s=(o=o||new pd3D.Matrix).m;return s[0]=2/(e-t),s[1]=0,s[2]=0,s[3]=-(e+t)/(e-t),s[4]=0,s[5]=2/(n-r),s[6]=0,s[7]=-(n+r)/(n-r),s[8]=0,s[9]=0,s[10]=-2/(a-i),s[11]=-(a+i)/(a-i),s[12]=0,s[13]=0,s[14]=0,s[15]=1,o},pd3D.Matrix.scale=function(t,e,r,n){var i=(n=n||new pd3D.Matrix).m;return i[0]=+t||0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=+e||0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=+r||0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},pd3D.Matrix.translate=function(t,e,r,n){var i=(n=n||new pd3D.Matrix).m;return i[0]=1,i[1]=0,i[2]=0,i[3]=+t||0,i[4]=0,i[5]=1,i[6]=0,i[7]=+e||0,i[8]=0,i[9]=0,i[10]=1,i[11]=+r||0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},pd3D.Matrix.rotate=function(t,e,r,n,i){if(!t||!e&&!r&&!n)return pd3D.Matrix.identity(i);var a=(i=i||new pd3D.Matrix).m,o=Math.sqrt(e*e+r*r+n*n);t*=pd.Const.DEG2RAD,e/=o,r/=o,n/=o;var s=Math.cos(t),o=Math.sin(t),t=1-s;return a[0]=e*e*t+s,a[1]=e*r*t-n*o,a[2]=e*n*t+r*o,a[3]=0,a[4]=r*e*t+n*o,a[5]=r*r*t+s,a[6]=r*n*t-e*o,a[7]=0,a[8]=n*e*t-r*o,a[9]=n*r*t+e*o,a[10]=n*n*t+s,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,i},pd3D.Matrix.skew=function(t,e,r){r=r||new pd3D.Matrix;var n=Math.tan(e*pd.Const.DEG2RAD),e=r.m;switch(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,t){default:case e[15]=1:e[4]=n;break;case 2:e[8]=n;break;case 3:e[1]=n;break;case 4:e[9]=n;break;case 5:e[2]=n;break;case 6:e[6]=n}return r},pd3D.Matrix.lookAt=function(t,e,r,n,i,a,o,s,d,h){var l=(h=h||new pd3D.Matrix).m,r=new pd3D.Vector(t,e,r),a=new pd3D.Vector(n,i,a),s=new pd3D.Vector(o,s,d),d=r.subtract(a).unit(),a=s.cross(d).unit(),s=d.cross(a).unit();return l[0]=a.x,l[1]=a.y,l[2]=a.z,l[3]=-a.dot(r),l[4]=s.x,l[5]=s.y,l[6]=s.z,l[7]=-s.dot(r),l[8]=d.x,l[9]=d.y,l[10]=d.z,l[11]=-d.dot(r),l[12]=0,l[13]=0,l[14]=0,l[15]=1,h},pd3D.MatrixAccumulator=function(){this.tempMatrix1=new pd3D.Matrix,this.tempMatrix2=new pd3D.Matrix,this.resultMatrix=new pd3D.Matrix},pd3D.MatrixAccumulator.prototype.toMatrix=function(){return this.resultMatrix},pd3D.MatrixAccumulator.prototype.reset=function(){return pd3D.Matrix.identity(this.resultMatrix),this},pd3D.MatrixAccumulator.prototype.scale=function(t,e,r){return 1==arguments.length?e=r=t:2==arguments.length&&(r=1),pd3D.Matrix.scale(t,e,r,this.tempMatrix1),pd3D.Matrix.multiply(this.resultMatrix,this.tempMatrix1,this.tempMatrix2),this.resultMatrix.init(this.tempMatrix2),this},pd3D.MatrixAccumulator.prototype.translate=function(t,e,r){return pd3D.Matrix.translate(t,e,r,this.tempMatrix1),pd3D.Matrix.multiply(this.resultMatrix,this.tempMatrix1,this.tempMatrix2),this.resultMatrix.init(this.tempMatrix2),this},pd3D.MatrixAccumulator.prototype.rotate=function(t,e,r,n){return pd3D.Matrix.rotate(t,e,r,n,this.tempMatrix1),pd3D.Matrix.multiply(this.resultMatrix,this.tempMatrix1,this.tempMatrix2),this.resultMatrix.init(this.tempMatrix2),this},pd3D.MatrixAccumulator.prototype.inverse=function(){return pd3D.Matrix.inverse(this.resultMatrix,this.tempMatrix2),this.resultMatrix.init(this.tempMatrix2),this},pd3D.MatrixAccumulator.prototype.transpose=function(){return pd3D.Matrix.transpose(this.resultMatrix,this.tempMatrix2),this.resultMatrix.init(this.tempMatrix2),this},pd3D.MatrixAccumulator.prototype.multiply=function(t){return pd3D.Matrix.multiply(this.resultMatrix,t,this.tempMatrix2),this.resultMatrix.init(this.tempMatrix2),this},pd3D.MatrixAccumulator.prototype.init=function(t){return this.resultMatrix.init(t),this},pd3D.MatrixAccumulator.prototype.transformPoint=function(t,e){return this.resultMatrix.transformPoint(t,e)},pd3D.MatrixAccumulator.prototype.transformVector=function(t,e){return this.resultMatrix.transformVector(t,e)},pd3D.PolarMatrix=function(){pd3D.Matrix.call(this),this.angleY=0,this.angleZ=0,this.isIdentity=!0,this._matrixY=new pd3D.Matrix,this._matrixZ=new pd3D.Matrix,this._matrixY.hasChanged=!1,this._matrixZ.hasChanged=!1,this._matrixY.isIdentity=!0,this._matrixZ.isIdentity=!0},pd3D.PolarMatrix.prototype=Object.create(pd3D.Matrix.prototype),pd3D.PolarMatrix.prototype.constructor=pd3D.PolarMatrix,pd3D.PolarMatrix.prototype._update=function(){var t=this.angleY,e=this._matrixY;e.hasChanged&&(Math.abs(t)>pd.Const.EPSILON?(pd3D.Matrix.rotate(t,0,1,0,e),e.isIdentity=!1):(e.isIdentity=!0,pd3D.Matrix.identity(e)));var r=this.angleZ,t=this._matrixZ;return t.hasChanged&&(Math.abs(r)>pd.Const.EPSILON?(pd3D.Matrix.rotate(r,0,0,1,t),t.isIdentity=!1):(t.isIdentity=!0,pd3D.Matrix.identity(t))),(e.hasChanged||t.hasChanged)&&(t.isIdentity?e.isIdentity?(this.isIdentity=!0,pd3D.Matrix.identity(this)):(pd3D.Matrix.clone(e,this),this.isIdentity=!1):(e.isIdentity?pd3D.Matrix.clone(t,this):pd3D.Matrix.multiply(t,e,this),this.isIdentity=!1),e.hasChanged=!1,t.hasChanged=!1),this},pd3D.PolarMatrix.prototype.setXZ=function(t,e){var r=this._matrixY;pd.closeTo(this.angleY,t)||(r.hasChanged=!0,this.angleY=t);t=this._matrixZ;return pd.closeTo(this.angleZ,e)||(t.hasChanged=!0,this.angleZ=e),(r.hasChanged||t.hasChanged)&&this._update(),this},pd3D.PolarMatrix.prototype.setAziAlt=function(t,e){return this.setXZ(90-e,t)},pd3D.PolarMatrix.prototype.setDirection=function(t){var e,r=this.angleZ-90,n=90-this.angleY;return pd.isArray(t)?1e-12<(e=pd3D.VectorArray.length(t))&&(r=t[0]*t[0]<1e-12?0:Math.atan2(t[1],t[0])*pd.Const.RAD2DEG,n=Math.asin(t[2]/e)*pd.Const.RAD2DEG):(e=t.length())<1e-9?r=n=0:(r=t.x*t.x<1e-12?0:Math.atan2(t.y,t.x)*pd.Const.RAD2DEG,n=Math.asin(t.z/e)*pd.Const.RAD2DEG),this.setXZ(90-n,90+r)},pd3D.PolarMatrix.prototype.multiplyBy=function(t,e){return e=e||new pd3D.Matrix,this.isIdentity||(t?e=pd3D.Matrix.multiply(t,this,e):pd3D.Matrix.clone(this,e)),e},pd3D.Transform=function(){this.isIdentity=!0,this.hasChanged=!1,this._cachedMatrix=new pd3D.Matrix,Object.defineProperty(this,"m",{get:function(){return this.hasChanged&&this.checkForChanges(),this._cachedMatrix.m}}),this.getMatrix=function(){return this.hasChanged&&this.checkForChanges(),this._cachedMatrix},this._xformData=[0,0,0,0,0,0,1,1,1],this._cachedData=[0,0,0,0,0,0,1,1,1],this._cachedTranslation=new pd3D.Matrix,this._cachedRotation=new pd3D.Matrix,this._cachedScale=new pd3D.Matrix,this._vectorRotation=!1,this._cachedTranslation.isIdentity=!0,this._cachedRotation.isIdentity=!0,this._cachedScale.isIdentity=!0},pd3D.Transform.prototype=Object.create(pd3D.Matrix.prototype),pd3D.Transform.prototype.constructor=pd3D.Transform,pd3D.Transform.prototype.reset=function(){var t=this._xformData;return t[0]=t[1]=t[2]=0,t[3]=t[4]=t[5]=0,t[6]=t[7]=t[8]=1,this._cachedTranslation.isIdentity=!0,this._cachedRotation.isIdentity=!0,this._cachedScale.isIdentity=!0,this.hasChanged=!0,this},pd3D.Transform.prototype.setTranslation=function(t,e,r){var n=pd.Const.EPSILON,i=this._xformData;if(1==arguments.length){var a=t;if(!pd.isArray(a))throw new TypeError("Parameters must be either three numeric values or an [tx,ty,tz] vector array.");t=+a[0]||0,e=+a[1]||0,r=+a[2]||0}return(Math.abs(t-i[0])>n||Math.abs(e-i[1])>n||Math.abs(r-i[2])>n)&&(this.hasChanged=!0),i[0]=t,i[1]=e,i[2]=r,this},pd3D.Transform.prototype.addTranslation=function(t,e,r){var n=pd.Const.EPSILON,i=this._xformData;if(1==arguments.length){var a=t;if(!pd.isArray(a))throw new TypeError("Parameters must be either three numeric values or a [tx,ty,tz] vector array.");t=+a[0]||0,e=+a[1]||0,r=+a[2]||0}return(Math.abs(t)>n||Math.abs(e)>n||Math.abs(r)>n)&&(this.hasChanged=!0),i[0]+=t,i[1]+=e,i[2]+=r,this},pd3D.Transform.prototype.setVectorRotation=function(t,e,r,n){var i=pd.Const.EPSILON,a=this._xformData;if(t=pd.toNumber(t,0),2==arguments.length){var o=e;if(!pd.isArray(o))throw new TypeError("Parameters must be either three numeric values or a [rx,ry,rz] vector array.");e=+o[0]||0,r=+o[1]||0,n=+o[2]||0}this._vectorAngles||(this._vectorAngles=[]),this._vectorAngles[0]=t,this._vectorAngles[1]=e,this._vectorAngles[2]=r,this._vectorAngles[3]=n;o=e*e+r*r+n*n;return 0<o&&(e*=o=1/Math.sqrt(o),r*=o,n*=o),e*=t,r*=t,n*=t,this._vectorRotation||(o=this._cachedData,this.hasChanged=!0,o[3]=e-1,o[4]=r-1,o[5]=n-1),(Math.abs(e-a[3])>i||Math.abs(r-a[4])>i||Math.abs(n-a[5])>i)&&(this.hasChanged=!0),a[3]=e,a[4]=r,a[5]=n,this._vectorRotation=!0,this},pd3D.Transform.prototype.setAxialRotation=function(t,e,r){var n=pd.Const.EPSILON,i=this._xformData;if(1==arguments.length){var a=t;if(!pd.isArray(a))throw new TypeError("Parameters must be either three numeric values or a [rx,ry,rz] vector array.");t=+a[0]||0,e=+a[1]||0,r=+a[2]||0}return this._vectorRotation&&(a=this._cachedData,this.hasChanged=!0,a[3]=t-1,a[4]=e-1,a[5]=r-1),(Math.abs(t-i[3])>n||Math.abs(e-i[4])>n||Math.abs(r-i[5])>n)&&(this.hasChanged=!0),i[3]=t,i[4]=e,i[5]=r,this._vectorRotation=!1,this},pd3D.Transform.prototype.addRotation=function(t,e,r){var n=pd.Const.EPSILON,i=this._xformData;if(this._vectorRotation)throw new Error("Cannot acumulate vector rotations, use `setAxialRotation()` to reset to axial mode.");if(1==arguments.length){var a=t;if(!pd.isArray(a))throw new TypeError("Parameters must be either three numeric values or a [rx,ry,rz] vector array.");t=+a[0]||0,e=+a[1]||0,r=+a[2]||0}return(Math.abs(t)>n||Math.abs(e)>n||Math.abs(r)>n)&&(this.hasChanged=!0),i[3]+=t,i[4]+=e,i[5]+=r,this},pd3D.Transform.prototype.setScale=function(t,e,r){var n=pd.Const.EPSILON,i=this._xformData;if(1==arguments.length){var a=t;if(!pd.isArray(a))throw new TypeError("Parameters must be either three numeric values or a [sx,sy,sz] vector array.");t=+a[0]||0,e=+a[1]||0,r=+a[2]||0}return(Math.abs(t-i[6])>n||Math.abs(e-i[7])>n||Math.abs(r-i[8])>n)&&(this.hasChanged=!0),i[6]=t,i[7]=e,i[8]=r,this},pd3D.Transform.prototype.addScale=function(t,e,r){var n=pd.Const.EPSILON,i=this._xformData;if(1==arguments.length){var a=t;if(!pd.isArray(a))throw new TypeError("Parameters must be either three numeric values or a [sx,sy,sz] vector array.");t=+a[0]||0,e=+a[1]||0,r=+a[2]||0}return(Math.abs(t-1)>n||Math.abs(e-1)>n||Math.abs(r-1)>n)&&(this.hasChanged=!0),i[6]*=t,i[7]*=e,i[8]*=r,this},pd3D.Transform.prototype.checkForChanges=function(){var t,e,r,n=!1,i=this._xformData,a=this._cachedData,o=pd.Const.EPSILON;return(Math.abs(a[0]-i[0])>o||Math.abs(a[1]-i[1])>o||Math.abs(a[2]-i[2])>o)&&(r=this._cachedTranslation,Math.abs(i[0])>o||Math.abs(i[1])>o||Math.abs(i[2])>o?(pd3D.Matrix.translate(i[0],i[1],i[2],r),r.isIdentity=!1):(pd3D.Matrix.identity(r),r.isIdentity=!0),a[0]=i[0],a[1]=i[1],a[2]=i[2],n=!0),(Math.abs(a[3]-i[3])>o||Math.abs(a[4]-i[4])>o||Math.abs(a[5]-i[5])>o)&&(e=!0,r=this._cachedRotation,this._vectorRotation?e=(t=this._vectorAngles)&&Math.abs(t[0])>o?(pd3D.Matrix.rotate(t[0],t[1],t[2],t[3],r),!1):(pd3D.Matrix.identity(r),!0):(Math.abs(i[5])>o&&(pd3D.Matrix.rotate(i[5],0,0,1,r),e=!1),Math.abs(i[3])>o&&(e?pd3D.Matrix.rotate(i[3],1,0,0,r):pd3D.Matrix.multiply(r,pd3D.Matrix.rotate(i[3],1,0,0),r),e=!1),Math.abs(i[4])>o&&(e?pd3D.Matrix.rotate(i[4],0,1,0,r):pd3D.Matrix.multiply(r,pd3D.Matrix.rotate(i[5],0,1,0),r),e=!1)),r.isIdentity=e,a[3]=i[3],a[4]=i[4],a[5]=i[5],n=!0),(Math.abs(a[6]-i[6])>o||Math.abs(a[7]-i[7])>o||Math.abs(a[8]-i[8])>o)&&(r=this._cachedScale,Math.abs(i[0]-1)>o||Math.abs(i[1]-1)>o||Math.abs(i[2]-1)>o?(pd3D.Matrix.scale(i[6],i[7],i[8],r),r.isIdentity=!1):(pd3D.Matrix.identity(r),r.isIdentity=!0),a[6]=i[6],a[7]=i[7],a[8]=i[8],n=!0),n&&(this.isIdentity=!0,(r=this._cachedTranslation).isIdentity||(pd3D.Matrix.clone(r,this._cachedMatrix),this.isIdentity=!1),(r=this._cachedRotation).isIdentity||(this.isIdentity?pd3D.Matrix.clone(r,this._cachedMatrix):pd3D.Matrix.multiply(this._cachedMatrix,r,this._cachedMatrix),this.isIdentity=!1),(r=this._cachedScale).isIdentity||(this.isIdentity?pd3D.Matrix.clone(r,this._cachedMatrix):pd3D.Matrix.multiply(this._cachedMatrix,r,this._cachedMatrix),this.isIdentity=!1),this.isIdentity&&pd3D.Matrix.identity(this._cachedMatrix)),this.hasChanged=!1,this},pd3D.Transform.prototype.multiplyBy=function(t,e){return e=e||new pd3D.Matrix,this.isIdentity||(t?e=pd3D.Matrix.multiply(t,this,e):pd3D.Matrix.clone(this,e)),e},pd3D.Transform.prototype.copyTo=function(t){return t=t||new pd3D.Matrix,pd3D.Matrix.clone(this,t),t},pd3D.Material=function(t){t=t||{},this.id=pd3D.getUniqueID(),this.name=t.name||"Material_"+pd.toStringWithLeadingZeros(this.id,5)},pd3D.Node=function(t,e){this.id=pd3D.getUniqueID(),this.nodeType=e||"Node",this.name=t||this.nodeType+"_"+pd.toStringWithLeadingZeros(this.id,5),this.transformMatrix=null,this.inverseMatrix=null,this.visible=!0,this.active=!0,this.geometry={},this.children=[],this.hasChanged=!1,this.callbackOnDraw=null},pd3D.Node.prototype.hide=function(){return this.visible=!1,this},pd3D.Node.prototype.show=function(t){return t=!1!==t,this.visible=t,this},pd3D.Node.prototype.getTransform=function(){return this.transformMatrix},pd3D.Node.prototype.setTransform=function(t){return this.transformMatrix=t,this.transformMatrix?this.inverseMatrix=pd3D.Matrix.inverse(this.transformMatrix,this.inverseMatrix):this.inverseMatrix=null,this},pd3D.Node.prototype.addChild=function(t){if(!t)throw new TypeError("ERROR: Undefined object not added as child node.");if(!(t instanceof pd3D.Node)){if(!(t.draw||t.drawSurfaces&&t.drawOutlines))throw new TypeError("ERROR: Unsupported object not added as child node.");t.id||(t.id=pd3D.getUniqueID()),t.name||(t.name="Object_"+pd.toStringWithLeadingZeros(t.id,5))}return this.children.push(t),this.hasChanged=!0,this},pd3D.Node.prototype.getChildByIndex=function(t){return 0<=t&&t<this.children.length?this.children[t]:null},pd3D.Node.prototype.findChildrenById=function(t,e){var r,n=e||[];if(pd.isNumeric(t)){this.id==t&&n.push(this);for(var i=0,a=this.children.length;i<a;++i)null!=(r=this.children[i])&&(r.id==t?n.push(r):r.findChildrenById&&r.findChildrenById(t,n))}return n},pd3D.Node.prototype.findChildrenByName=function(t,e){var r,n=e||[];if(t&&t.length){this.name==t&&n.push(this);for(var i=0,a=this.children.length;i<a;++i)null!=(r=this.children[i])&&(r.name==t?n.push(r):r.findChildrenByName&&r.findChildrenByName(t,n))}return n},pd3D.Node.prototype.removeChildByIndex=function(t){return 0<=t&&t<this.children.length&&(this.children.splice(t,1),this.hasChanged=!0),this},pd3D.Node.prototype.removeChild=function(t,e){if(t){var r=this.children.indexOf(t);if(-1<r)return this.children.splice(r,1),this.hasChanged=!0,this;if(e)for(var n=0,i=this.children.length;n<i;++n)this.children[n]&&this.children[n].removeChild&&this.children[n].removeChild(t)}return this},pd3D.Node.prototype.clearChildren=function(){for(var t,e=0,r=this.children.length;e<r;++e)(t=this.children[e])&&t.clear&&t.clear();return this.children.length=0,this.hasChanged=!0,this},pd3D.Node.prototype.addMesh=function(t,e){if(!(t&&t instanceof pd3D.Mesh))throw new TypeError("ERROR: Only valid pd3D.Mesh objects can be added as pd3D.Node geometry.");if(!(e&&e instanceof pd3D.Material))throw new TypeError("ERROR: Only valid pd3D.Material objects can be assigned to pd3D.Node geometry.");var r=e.id.toString();return this.geometry[r]||(this.geometry[r]={material:e,meshes:[]}),this.geometry[r].meshes.push(t),this.hasChanged=!0,this},pd3D.Node.prototype.addMeshes=function(t,e){if(!t||!pd.isArray(t))throw new TypeError("ERROR: Only valid arrays of pd3D.Mesh objects can be added as pd3D.Node geometry.");if(!(e&&e instanceof pd3D.Material))throw new TypeError("ERROR: Only valid pd3D.Material objects can be assigned to pd3D.Node geometry.");var r=e.id.toString();this.geometry[r]||(this.geometry[r]={material:e,meshes:[]});for(var n=0,i=t.length;n<i;++n){var a=t[n];a&&a instanceof pd3D.Mesh&&(this.geometry[r].meshes.push(a),this.hasChanged=!0)}return this},pd3D.Node.prototype.findMeshById=function(t){for(var e in this.geometry)if(this.geometry.hasOwnProperty(e))for(var r=this.geometry[e].meshes,n=0,i=r.length;n<i;++n)if(r[n].id==t)return r[n];for(var a,o,n=0,i=this.children.length;n<i;++n)if((a=this.children[n])&&a.findMeshById&&null!=(o=a.findMeshById(t)))return o;return null},pd3D.Node.prototype.getMeshList=function(){var t,e=[];for(t in this.geometry)if(this.geometry.hasOwnProperty(t))for(var r=this.geometry[t].meshes,n=0,i=r.length;n<i;++n)e.push(r[n]);return e},pd3D.Node.prototype.getMeshesByMaterial=function(t){if(!t||!t.id)throw new TypeError("ERROR: Only valid pd3D.Material objects can be used to obtain meshes.");t=t.id.toString();return this.geometry[t]?this.geometry[t].meshes:[]},pd3D.Node.prototype.setMaterialForAllMeshes=function(t){if(!t||!t.id)throw new TypeError("ERROR: New material must be valid pd3D.Material object.");var e,r=[];for(e in this.geometry)if(this.geometry.hasOwnProperty(e))for(var n=this.geometry[e].meshes,i=0,a=n.length;i<a;++i)r.push(n[i]);this.geometry={},this.hasChanged=!0;var o=t.id.toString();this.geometry[o]={material:t,meshes:r};for(i=0,a=this.children.length;i<a;++i)this.children[i].setMaterial&&this.children[i].setMaterial(new_material);return this},pd3D.Node.prototype.swapMaterials=function(t,e){if(!(t&&t.id&&e&&e.id))throw new TypeError("ERROR: Both arguments must be valid pd3D.Material objects.");if(t.id!=e.id){var r,n=t.id.toString(),i=e.id.toString();this.geometry[n]&&(r=this.geometry[n].meshes,this.geometry[i]?Array.prototype.push.apply(this.geometry[i].meshes,r):this.geometry[i]={material:e,meshes:r},delete this.geometry[n]);for(var a=0,o=this.children.length;a<o;++a)this.children[a].swapMaterials&&this.children[a].swapMaterials(t,e)}return this},pd3D.Node.prototype.clearGeometry=function(t){if(!t)for(var e in this.geometry)if(this.geometry.hasOwnProperty(e))for(var r=this.geometry[e].meshes,n=0,i=r.length;n<i;++n)r[n].clear();return this.geometry={},this.hasChanged=!0,this},pd3D.Node.prototype.destroy=function(){for(var t in this.geometry)if(this.geometry.hasOwnProperty(t))for(var e=this.geometry[t].meshes,r=0,n=e.length;r<n;++r)e[r].destroy();for(var i,r=0,n=this.children.length;r<n;++r)null!=(i=this.children[r])&&(i.destroy?i.destroy():i.clear&&i.clear());return this.geometry={},this.children.length=0,this.hasChanged=!0,this},pd3D.Node.prototype.reverseNormals=function(){for(var t in this.geometry)if(this.geometry.hasOwnProperty(t))for(var e=this.geometry[t].meshes,r=0,n=e.length;r<n;++r)e[r].reverseNormals();for(var i,r=0,n=this.children.length;r<n;++r)(i=this.children[r])&&i.reverseNormals&&i.reverseNormals();return this},pd3D.Node.prototype.reverseTriangles=function(){for(var t in this.geometry)if(this.geometry.hasOwnProperty(t))for(var e=this.geometry[t].meshes,r=0,n=e.length;r<n;++r)e[r].reverseTriangles();for(var i,r=0,n=this.children.length;r<n;++r)(i=this.children[r])&&i.reverseTriangles&&i.reverseTriangles();return this},pd3D.Node.prototype.swapYZ=function(){for(var t in this.geometry)if(this.geometry.hasOwnProperty(t))for(var e=this.geometry[t].meshes,r=0,n=e.length;r<n;++r)e[r].swapYZ();for(var i,r=0,n=this.children.length;r<n;++r)(i=this.children[r])&&i.swapYZ&&i.swapYZ();return this},pd3D.Node.prototype.mirrorY=function(){for(var t in this.geometry)if(this.geometry.hasOwnProperty(t))for(var e=this.geometry[t].meshes,r=0,n=e.length;r<n;++r)e[r].mirrorY();for(var i,r=0,n=this.children.length;r<n;++r)(i=this.children[r])&&i.mirrorY&&i.mirrorY();return this},pd3D.Node.prototype.translate=function(t,e,r){for(var n in this.geometry)if(this.geometry.hasOwnProperty(n))for(var i=this.geometry[n].meshes,a=0,o=i.length;a<o;++a)i[a].translate(t,e,r);for(var s,a=0,o=this.children.length;a<o;++a)(s=this.children[a])&&s.translate&&s.translate(t,e,r);return this},pd3D.Node.prototype.applyMatrix=function(t,e){if(t){var r,n,e=e||t.inverse().transpose();for(r in this.geometry)if(this.geometry.hasOwnProperty(r))for(var i=this.geometry[r].meshes,a=0,o=i.length;a<o;++a)i[a].transform(t,e);for(a=0,o=this.children.length;a<o;++a)(n=this.children[a])&&n.applyMatrix&&n.applyMatrix(t,e)}return this},pd3D.Node.prototype.getAABB=function(t,e){for(var r in t&&t.min||((t={min:new pd3D.Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}).max=t.min.negative()),this.geometry)if(this.geometry.hasOwnProperty(r))for(var n=this.geometry[r].meshes,i=0,a=n.length;i<a;++i)e&&n[i].computeBoundingBox(),n[i].getAABB(t);for(var o,i=0,a=this.children.length;i<a;++i)(o=this.children[i])&&o.getAABB&&o.getAABB(t,e);return t},pd3D.Node.prototype.compileGeometry=function(){var t,e=[];for(t in this.geometry)if(this.geometry.hasOwnProperty(t)){for(var r,n=this.geometry[t].meshes,i=0,a=n.length;i<a;++i)(r=n[i])&&r.hasContent()&&r.compile();this.geometry[t].meshes.length<1&&e.push(t)}if(0<e.length)for(i=0,a=e.length;i<a;++i)delete this.geometry[e[i]];return this},pd3D.Node.prototype.compile=function(){for(var t,e=0,r=this.children.length;e<r;++e)(t=this.children[e])&&t.compile&&t.compile();return this.compileGeometry()},pd3D.Node.prototype.intersectRay=function(t,e,r){if(r=r||null,this.visible){for(var n in this.geometry)if(this.geometry.hasOwnProperty(n))for(var i=this.geometry[n].meshes,a=0,o=i.length;a<o;++a)r=pd3D.RayTrace.intersectMesh(t,e,i[a],r);for(var s,a=0,o=this.children.length;a<o;++a)(s=this.children[a])&&s.intersectRay&&(r=s.intersectRay(t,e,r))}return r},pd3D.Node.prototype.obstructedRay=function(t,e){if(this.visible){for(var r in this.geometry)if(this.geometry.hasOwnProperty(r))for(var n=this.geometry[r].meshes,i=0,a=n.length;i<a;++i)if(pd3D.RayTrace.getFirstHitOnMesh(t,e,n[i]))return!0;for(var o,i=0,a=this.children.length;i<a;++i)if((o=this.children[i])&&o.obstructedRay&&o.obstructedRay(t,e))return!0}return!1},pd3D.Node.prototype.clear=function(){return this.clearChildren(),this.clearGeometry(),this.transformMatrix=null,delete this.transformMatrix,this.inverseMatrix=null,delete this.inverseMatrix,this.hasChanged=!0,this},pd3D.RayTrace=function(t,e,r,n){this.t=0<arguments.length?t:Number.MAX_VALUE,this.mesh=n||null,this.normal=r,this.hit=e},pd3D.RayTrace.prototype.mergeWith=function(t){0<t.t&&t.t<this.t&&(this.t=t.t,t.mesh?this.mesh=t.mesh:this.mesh&&(this.mesh=null),this.normal=t.normal,this.hit=t.hit)},pd3D.RayTrace.insideBox=function(t,e,r){return t.x>=e.x&&t.x<=r.x&&t.y>=e.y&&t.y<=r.y&&t.z>=e.z&&t.z<=r.z},pd3D.RayTrace.intersectBox=function(t,e,r,n){var i=r.subtract(t).divide(e),a=n.subtract(t).divide(e),o=pd3D.Vector.min(i,a),a=pd3D.Vector.max(i,a),o=o.max(),a=a.min();if(0<o&&o<a){e=t.add(e.multiply(o));return r=r.add(1e-6),n=n.subtract(1e-6),new pd3D.RayTrace(o,e,new pd3D.Vector((e.x>n.x)-(e.x<r.x),(e.y>n.y)-(e.y<r.y),(e.z>n.z)-(e.z<r.z)))}return null},pd3D.RayTrace.intersectSphere=function(t,e,r,n){var i=t.subtract(r),a=e.dot(e),o=2*e.dot(i),i=o*o-4*a*(i.dot(i)-n*n);if(0<i){a=(-o-Math.sqrt(i))/(2*a),e=t.add(e.multiply(a));return new pd3D.RayTrace(a,e,e.subtract(r).divide(n))}return null},pd3D.RayTrace.intersectTriangle=function(t,e,r,n,i){var a=n.subtract(r),o=i.subtract(r),s=a.cross(o).unit(),d=s.dot(r.subtract(t))/s.dot(e);if(0<d){n=t.add(e.multiply(d)),i=n.subtract(r),t=o.dot(o),e=o.dot(a),r=o.dot(i),o=a.dot(a),a=a.dot(i),i=t*o-e*e,o=(o*r-e*a)/i,i=(t*a-e*r)/i;if(0<=o&&0<=i&&o+i<=1)return new pd3D.RayTrace(d,n,s)}return null},pd3D.RayTrace.intersectMesh=function(t,e,r,n){var i=null;if(n=n||null,!r.boundingBox||pd3D.RayTrace.insideBox(t,r.boundingBox.min,r.boundingBox.max)||pd3D.RayTrace.intersectBox(t,e,r.boundingBox.min,r.boundingBox.max))for(var a,o=r.vertices,s=r.triangles.length,d=r.triangles,h=new pd3D.Vector,l=new pd3D.Vector,c=new pd3D.Vector,u=0;u<s;++u)a=d[u],pd3D.Vector.fromArray(o[a[0]],h),pd3D.Vector.fromArray(o[a[1]],l),pd3D.Vector.fromArray(o[a[2]],c),null!=(i=pd3D.RayTrace.intersectTriangle(t,e,h,l,c))&&(n?(i.mesh=r,n.mergeWith(i)):n=new pd3D.RayTrace(i.t,i.hit,i.normal,r));return n},pd3D.RayTrace.getFirstHitOnMesh=function(t,e,r){if(!r.boundingBox||pd3D.RayTrace.insideBox(t,r.boundingBox.min,r.boundingBox.max)||pd3D.RayTrace.intersectBox(t,e,r.boundingBox.min,r.boundingBox.max))for(var n,i=r.vertices,a=r.triangles.length,o=r.triangles,s=new pd3D.Vector,d=new pd3D.Vector,h=new pd3D.Vector,l=0;l<a;++l)if(n=o[l],pd3D.Vector.fromArray(i[n[0]],s),pd3D.Vector.fromArray(i[n[1]],d),pd3D.Vector.fromArray(i[n[2]],h),null!=(n=pd3D.RayTrace.intersectTriangle(t,e,s,d,h)))return new pd3D.RayTrace(n.t,n.hit,n.normal,r);return null}}(),pd3D.Shapes=pd3D.Shapes||{},function(){var E=.5*Math.PI,_=2*Math.PI;function z(t){var e=t[0],r=t[1],n=+t[2]||0,i=e*e+r*r+n*n;0<i&&(i=1/Math.sqrt(i),t[0]=e*i,t[1]=r*i,t[2]=n*i)}pd3D.Shapes.plane=function(t,e){var r=!1,n=(t=t||{}).detailX||t.detail||1,i=t.detailY||t.detail||1,a={};e||(e=new pd3D.Mesh(t),r=!0);for(var o=0;o<=i;++o)for(var s=o/i,d=0;d<=n;++d){var h=d/n;a.pos=[2*h-1,2*s-1,0],e.coords&&(a.coord=[h,s]),e.addVertexObject(a),d<n&&o<i&&(h=d+o*(n+1),e.addTriangle(h,h+1,h+n+1),e.addTriangle(h+n+1,h+1,h+n+2))}return r&&e.compile(),e};var y=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];function v(t){return new pd3D.Vector(2*(1&t)-1,(2&t)-1,(4&t)/2-1)}pd3D.Shapes.cube=function(t,e){t=t||{};var r=!1,n=[1,1,1],i={};pd.isArray(t.size)?(n[0]=.5*pd.toNumber(t.size[0],1),n[1]=.5*pd.toNumber(t.size[1],1),n[2]=.5*pd.toNumber(t.size[2],1)):(n[0]=.5*pd.toNumber(t.size,1),n[1]=n[2]=n[0]),e||(e=new pd3D.Mesh(t),r=!0);for(var a=e.vertexCount(),o=0;o<y.length;++o){for(var s=a+4*o,d=Math.floor(.5*o),h=y[o],l=0;l<4;++l){var c=h[l];i.pos=v(c).scale(n[d]).toArray(),e.coords&&(i.coord=[1&l,(2&l)/2]),e.normals&&(i.normal=h.slice(4,7)),e.addVertexObject(i)}if(e.triangles)if(t.invert){if(e.addTriangle(s+2,s+1,s),e.addTriangle(s+3,s+1,s+2),e.normals)for(var u=0;u<4;++u){var p=e.normals[s+u];p[0]=-p[0],p[1]=-p[1],p[2]=-p[2]}}else e.addTriangle(s,s+1,s+2),e.addTriangle(s+2,s+1,s+3)}if(e.lines&&(e.addLine(a+0,a+1),e.addLine(a+1,a+3),e.addLine(a+3,a+2),e.addLine(a+2,a+0),e.addLine(a+4,a+5),e.addLine(a+5,a+7),e.addLine(a+7,a+6),e.addLine(a+6,a+4),e.addLine(a+0,a+4),e.addLine(a+1,a+6),e.addLine(a+3,a+7),e.addLine(a+2,a+5)),pd.isArray(t.center)&&e.vertices){var f=t.center;f[0]=pd.toNumber(f[0],0),f[1]=pd.toNumber(f[1],0),f[2]=pd.toNumber(f[2],0);for(var o=a,m=e.vertexCount();o<m;++o){var g=e.vertices[o];g[0]+=f[0],g[1]+=f[1],g[2]+=f[2]}}return r&&e.compile(),e},pd3D.Shapes.rectangle=function(t,r){var e,n,i,a,o,s,d,h,l=!1,c=(t=t||{}).transform||null,u=pd.toNumber(t.scale,1),p=.5*pd.toNumber(t.width,250),f=.5*pd.toNumber(t.height,100),m=pd.toNumber(t.borderWidth,0)*u,g=pd.toBoolean(t.background,!0),y=pd.toBoolean(t.border,!1),v=[0,0,0,0],D=[0,0,0],b=-1,x={edge1:-1,edge2:-1},M=t.min||[0,0,0],T=t.max||[M[0]+p,M[1]+f,M[2]],A=_/Math.max(4,4*pd.toNumber(t.segments,6)),w={pos:[]},p=.5*(T[0]-M[0]),f=.5*(T[1]-M[1]);if(t.cornerRadius&&(pd.isArray(t.cornerRadius)?(h=t.cornerRadius,v[0]=pd.toNumber(h[0]||0)*u,v[1]=pd.toNumber(h[1]||0)*u,v[2]=pd.toNumber(h[2]||0)*u,v[3]=pd.toNumber(h[3]||0)*u):(n=pd.toNumber(t.cornerRadius,0)*u,v[0]=n,v[1]=n,v[2]=n,v[3]=n),h=Math.min(p,f),v[0]=pd.sign(v[0])*Math.min(h,Math.abs(v[0])),v[1]=pd.sign(v[0])*Math.min(h,Math.abs(v[1])),v[2]=pd.sign(v[0])*Math.min(h,Math.abs(v[2])),v[3]=pd.sign(v[0])*Math.min(h,Math.abs(v[3]))),t.center&&pd.isArray(t.center)?(D[0]=pd.toNumber(t.center[0],0),D[1]=pd.toNumber(t.center[1],0),D[2]=pd.toNumber(t.center[2],0),M[0]=D[0]-p,T[0]=D[0]+p,M[1]=D[1]-p,T[1]=D[1]+p,M[2]=T[2]=+D[2]||0):(M[2]=+M[2]||0,T[2]=+T[2]||0,D[0]=.5*(M[0]+T[0]),D[1]=.5*(M[1]+T[1]),D[2]=.5*(M[2]+T[2])),r||(r=new pd3D.Mesh(t),l=!0),g=g&&r.triangles,y=y&&r.lines,r.normals&&(h=[0,0,1],c&&c.applyVectorTransformToArray(h),r.normal(h)),g||y&&!(m<.001)){if(g?pd.isArray(t.backgroundColor)&&r.color(t.backgroundColor):y&&pd.isArray(t.borderColor)&&r.color(t.borderColor),t.notch){if(x.length=pd.toNumber(t.notchLength,15),x.width=.5*pd.toNumber(t.notchWidth,Math.abs(x.length)),x.position=pd.toNumber(t.notchPosition,.5),x.edge=pd.toInteger(t.notchEdge,-1),x.type=pd.toInteger(t.notchType,0),x.vertices=[],x.length*=u,x.width*=u,pd.isArray(t.notchTarget))x.x=+t.notchTarget[0]||0,x.y=+t.notchTarget[1]||0;else if(0<=x.edge)switch(x.edge){case pd.Align.BOTTOM:x.x=pd.mapTo(x.position,0,1,M[0],T[0]),x.y=M[1]-x.length;break;case pd.Align.RIGHT:x.x=T[0]+x.length,x.y=pd.mapTo(x.position,0,1,M[1],T[1]);break;case pd.Align.TOP:x.x=pd.mapTo(x.position,0,1,M[0],T[0]),x.y=T[1]+x.length;break;case pd.Align.LEFT:x.x=M[0]-x.length,x.y=pd.mapTo(x.position,0,1,M[1],T[1]);break;default:x.x=D[0],x.y=D[1]}(x.x<M[0]||x.x>T[0]||x.y<M[1]||x.y>T[1])&&(x.type?x.x<D[0]?x.y<D[1]?(i=x.x+pd.safeDivide(M[1]-x.y,D[1]-x.y)*(D[0]-x.x),(a=x.y+pd.safeDivide(M[0]-x.x,D[0]-x.x)*(D[1]-x.y))+x.width>=M[1]?(x.edge1=3,x.vertices[0]=[M[0],Math.max(a+x.width,M[1])],x.vertices[0][1]<M[1]+Math.abs(v[0])&&(v[0]=0)):(x.edge1=0,x.vertices[0]=[Math.max(i-x.width,M[0]),M[1]],x.vertices[0][0]<M[0]+Math.abs(v[0])&&(v[0]=0)),x.vertices[1]=[x.x,x.y],i+x.width>=M[0]?(x.edge2=0,x.vertices[2]=[Math.max(i+x.width,M[0]),M[1]],x.vertices[2][0]<M[0]+Math.abs(v[0])&&(v[0]=0)):(x.edge2=3,x.vertices[2]=[M[0],Math.max(a-x.width,M[1])],x.vertices[2][1]<M[1]+Math.abs(v[0])&&(v[0]=0))):(i=x.x-pd.safeDivide(x.y-T[1],D[1]-x.y)*(D[0]-x.x),a=x.y+pd.safeDivide(M[0]-x.x,D[0]-x.x)*(D[1]-x.y),i+x.width>=M[0]?(x.edge1=2,x.vertices[0]=[Math.max(i+x.width,M[0]),T[1]],x.vertices[0][0]<M[0]+Math.abs(v[3])&&(v[3]=0)):(x.edge1=3,x.vertices[0]=[M[0],Math.min(a+x.width,T[1])],x.vertices[0][1]>T[1]-Math.abs(v[3])&&(v[3]=0)),x.vertices[1]=[x.x,x.y],a-x.width<=T[1]?(x.edge2=3,x.vertices[2]=[M[0],Math.min(a-x.width,T[1])],x.vertices[2][1]>T[1]-Math.abs(v[3])&&(v[3]=0)):(x.edge2=2,x.vertices[2]=[Math.max(i-x.width,M[0]),T[1]],x.vertices[2][0]<M[0]+Math.abs(v[3])&&(v[3]=0))):x.y<D[1]?(i=x.x+pd.safeDivide(M[1]-x.y,D[1]-x.y)*(D[0]-x.x),a=x.y+pd.safeDivide(T[0]-x.x,D[0]-x.x)*(D[1]-x.y),i-x.width<=T[0]?(x.edge1=0,x.vertices[0]=[Math.min(i-x.width,T[0]),M[1]],x.vertices[0][0]>T[0]-Math.abs(v[1])&&(v[1]=0)):(x.edge1=1,x.vertices[0]=[T[0],Math.max(a-x.width,M[1])],x.vertices[0][1]<M[1]+Math.abs(v[1])&&(v[1]=0)),x.vertices[1]=[x.x,x.y],a+x.width>M[1]?(x.edge2=1,x.vertices[2]=[T[0],Math.max(a+x.width,M[1])],x.vertices[2][1]<M[1]+Math.abs(v[1])&&(v[1]=0)):(x.edge2=0,x.vertices[2]=[Math.min(i+x.width,T[0]),M[1]],x.vertices[2][0]>T[0]-Math.abs(v[1])&&(v[1]=0))):(i=x.x+pd.safeDivide(T[1]-x.y,D[1]-x.y)*(D[0]-x.x),a=x.y+pd.safeDivide(T[0]-x.x,D[0]-x.x)*(D[1]-x.y),i+x.width<=T[0]?(x.edge1=2,x.vertices[0]=[Math.min(i+x.width,T[0]),T[1]],x.vertices[0][0]>T[0]-Math.abs(v[2])&&(v[2]=0)):(x.edge1=1,x.vertices[0]=[T[0],Math.min(a-x.width,T[1])],x.vertices[0][1]>T[1]-Math.abs(v[2])&&(v[2]=0)),x.vertices[1]=[x.x,x.y],a+x.width<=T[1]?(x.edge2=1,x.vertices[2]=[T[0],Math.min(a+x.width,T[1])],x.vertices[2][1]>T[1]-Math.abs(v[2])&&(v[2]=0)):(x.edge2=2,x.vertices[2]=[Math.min(i-x.width,T[0]),T[1]],x.vertices[2][0]>T[0]-Math.abs(v[2])&&(v[2]=0))):x.x<D[0]?x.y<D[1]?(x.x>=M[0]?(x.edge1=x.edge2=0,x.vertices[0]=[pd.constrainTo(x.x-x.width,M[0],T[0]),M[1]],x.vertices[1]=[x.x,x.y],x.vertices[2]=[pd.constrainTo(x.x+x.width,M[0]+2*x.width,T[0]),M[1]]):x.y>=M[1]?(x.edge1=x.edge2=3,x.vertices[0]=[M[0],pd.constrainTo(x.y+x.width,M[1]+2*x.width,T[1])],x.vertices[1]=[x.x,x.y],x.vertices[2]=[M[0],pd.constrainTo(x.y-x.width,M[1],T[1])]):(x.edge1=3,x.edge2=0,i=M[0]-x.x,a=M[1]-x.y,o=Math.sqrt(i*i+a*a),i=pd.safeDivide(i,o),a=pd.safeDivide(a,o),x.vertices[0]=[M[0],pd.constrainTo(M[1]+2*i*x.width,M[1],T[1])],x.vertices[1]=[x.x,x.y],x.vertices[2]=[pd.constrainTo(M[0]+a*x.width,M[0],T[0]),M[1]]),e=Math.abs(v[0]),(x.vertices[0][0]<M[0]+e&&x.vertices[0][1]<M[1]+e||x.vertices[2][0]<M[0]+e&&x.vertices[2][1]<M[1]+e)&&(v[0]=0)):(x.x>=M[0]?(x.edge1=x.edge2=2,x.vertices[0]=[pd.constrainTo(x.x+x.width,M[0]+2*x.width,T[0]),T[1]],x.vertices[1]=[x.x,x.y],x.vertices[2]=[pd.constrainTo(x.x-x.width,M[0],T[0]),T[1]]):x.y<=T[1]?(x.edge1=x.edge2=3,x.vertices[0]=[M[0],pd.constrainTo(x.y+x.width,M[1],T[1])],x.vertices[1]=[x.x,x.y],x.vertices[2]=[M[0],pd.constrainTo(x.y-x.width,M[1],T[1]-2*x.width)]):(x.edge1=2,x.edge2=3,i=M[0]-x.x,a=x.y-T[1],o=Math.sqrt(i*i+a*a),i=pd.safeDivide(i,o),a=pd.safeDivide(a,o),x.vertices[0]=[pd.constrainTo(M[0]+2*a*x.width,M[0],T[0]),T[1]],x.vertices[1]=[x.x,x.y],x.vertices[2]=[M[0],pd.constrainTo(T[1]-2*i*x.width,M[1],T[1])]),e=Math.abs(v[3]),(x.vertices[0][0]<M[0]+e&&x.vertices[0][1]>T[1]-e||x.vertices[2][0]<M[0]+e&&x.vertices[2][1]>T[1]-e)&&(v[3]=0)):x.y<D[1]?(x.x<=T[0]?(x.edge1=x.edge2=0,x.vertices[0]=[pd.constrainTo(x.x-x.width,M[0],T[0]-2*x.width),M[1]],x.vertices[1]=[x.x,x.y],x.vertices[2]=[pd.constrainTo(x.x+x.width,M[0],T[0]),M[1]]):x.y>=M[1]?(x.edge1=x.edge2=1,x.vertices[0]=[T[0],pd.constrainTo(x.y-x.width,M[1],T[1])],x.vertices[1]=[x.x,x.y],x.vertices[2]=[T[0],pd.constrainTo(x.y+x.width,M[1]+2*x.width,T[1])]):(x.edge1=0,x.edge2=1,i=x.x-T[0],a=M[1]-x.y,o=Math.sqrt(i*i+a*a),i=pd.safeDivide(i,o),a=pd.safeDivide(a,o),x.vertices[0]=[pd.constrainTo(T[0]-2*a*x.width,M[0],T[0]),M[1]],x.vertices[1]=[x.x,x.y],x.vertices[2]=[T[0],pd.constrainTo(M[1]+2*i*x.width,M[1],T[1])]),e=Math.abs(v[1]),(x.vertices[0][0]>T[0]-e&&x.vertices[0][1]<M[1]+e||x.vertices[2][0]>T[0]-e&&x.vertices[2][1]<M[1]+e)&&(v[1]=0)):(x.x<=T[0]?(x.edge1=x.edge2=2,x.vertices[0]=[pd.constrainTo(x.x+x.width,M[0],T[0]),T[1]],x.vertices[1]=[x.x,x.y],x.vertices[2]=[pd.constrainTo(x.x-x.width,M[0],T[0]-2*x.width),T[1]]):x.y<=T[1]?(x.edge1=x.edge2=1,x.vertices[0]=[T[0],pd.constrainTo(x.y-x.width,M[1],T[1]-2*x.width)],x.vertices[1]=[x.x,x.y],x.vertices[2]=[T[0],pd.constrainTo(x.y+x.width,M[1],T[1])]):(x.edge1=1,x.edge2=2,i=x.x-T[0],a=x.y-T[1],o=Math.sqrt(i*i+a*a),i=pd.safeDivide(i,o),a=pd.safeDivide(a,o),x.vertices[0]=[T[0],pd.constrainTo(T[1]-2*i*x.width,M[1],T[1])],x.vertices[1]=[x.x,x.y],x.vertices[2]=[pd.constrainTo(T[0]-2*a*x.width,M[0],T[0]),T[1]]),e=Math.abs(v[2]),(x.vertices[0][0]>T[0]-e&&x.vertices[0][1]>T[1]-e||x.vertices[2][0]>T[0]-e&&x.vertices[2][1]>T[1]-e)&&(v[2]=0)))}if(s=k(D[0],D[1]),3==x.edge1&&0==x.edge2?P(x):(n=v[0],.4999<(e=Math.abs(n))?(k(M[0],M[1]+e),0<n&&I([M[0]+e,M[1]+e],-Math.PI,-E,e),k(M[0]+e,M[1])):k(M[0],M[1])),0==x.edge1&&0==x.edge2&&P(x),0==x.edge1&&1==x.edge2?P(x):(n=v[1],.4999<(e=Math.abs(n))?(k(T[0]-e,M[1]),0<n&&I([T[0]-n,M[1]+e],-E,0,n),k(T[0],M[1]+e)):k(T[0],M[1])),1==x.edge1&&1==x.edge2&&P(x),1==x.edge1&&2==x.edge2?P(x):(n=v[2],.4999<(e=Math.abs(n))?(k(T[0],T[1]-e),0<n&&I([T[0]-e,T[1]-e],0,E,e),k(T[0]-e,T[1])):k(T[0],T[1])),2==x.edge1&&2==x.edge2&&P(x),2==x.edge1&&3==x.edge2?P(x):(n=v[3],.4999<(e=Math.abs(n))?(k(M[0]+e,T[1]),0<n&&I([M[0]+e,T[1]-e],E,Math.PI,e),k(M[0],T[1]-e)):k(M[0],T[1])),3==x.edge1&&3==x.edge2&&P(x),d=r.vertexCount(),y&&.001<m)if(r.hasVertexColors&&pd.isArray(t.borderColor)){var O,V=pd.toNumber(t.borderZOffset,0)*u;r.color(t.borderColor);for(var C=s+1;C<d;++C)O=r.getVertex(C),w.pos=[O[0],O[1],O[2]+V],r.coords&&(w.coord=r.coords[C]),r.addVertexObject(w);if(1<m){for(var S=[],N=r.vertexCount(),C=d;C<N;++C)S.push(r.getVertex(C));pd3D.Shapes.thickLine({vertices:S,side:pd.toInteger(t.borderAlign,pd.Align.INSIDE),shaft:m,closed:!0},r)}else{N=r.vertexCount();r.addLine(d,N-1);for(C=d+1;C<N;++C)r.addLine(C-1,C)}}else{r.addLine(s+1,d-1);for(C=s+2;C<d;++C)r.addLine(C-1,C)}if(g){r.addTriangle(s,d-1,s+1);for(C=s+2;C<d;++C)C==b?(r.addTriangle(b-1,b,b+1),r.addTriangle(s,C-1,C+1),C++):r.addTriangle(s,C-1,C)}return l&&r.compile(),t=null,r}function k(t,e){return w.pos=[t,e,D[2]],c&&c.applyPointTransformToArray(w.pos),r.coords&&(w.coord=[((e=w.pos)[0]-M[0])/p,(e[1]-M[2])/f]),r.addVertexObject(w)}function I(t,e,r,n){r-=.5*A;for(var i=e+A;i<r;i+=A)k(t[0]+n*Math.cos(i),t[1]+n*Math.sin(i))}function P(t){k(t.vertices[0][0],t.vertices[0][1]),b=k(t.vertices[1][0],t.vertices[1][1]),k(t.vertices[2][0],t.vertices[2][1])}l&&r.compile()},pd3D.Shapes.circle=function(t,e){t=t||{};var r,n,i,a=!1,o=pd.toNumber(t.radius,1),s=pd.toNumber(t.radiusInner,-1),d=pd.isArray(t.center)?t.center:[0,0,0],h=_/pd.toNumber(t.segments,24),l=pd.toBoolean(t.background,!0),c=pd.toBoolean(t.border,!0),u=pd.toNumber(t.fromAngle,0)*pd.Const.DEG2RAD,p=pd.toNumber(t.toAngle,360)*pd.Const.DEG2RAD,f=e.vertexCount(),m={pos:[]},g=null;if(e||(e=new pd3D.Mesh(t),a=!0),t.transform instanceof pd3D.Matrix&&(g=t.transform),e.normals&&(t=[0,0,1],g&&g.applyVectorTransformToArray(t),e.normal(t)),l=l&&e.triangles,c=c&&e.lines,0<o)if(0<s)for(var y,v,D,b,x=u;x<p;x+=h)r=Math.sin(x),n=Math.cos(x),m.pos=[d[0]+s*r,d[1]+s*n,d[2]],e.coords&&(m.coord=[r,n]),y=e.addVertexObject(m),m.pos=[d[0]+o*r,d[1]+o*n,d[2]],D=e.addVertexObject(m),u<x&&(l&&(e.addTriangle(D,b,v),e.addTriangle(y,D,v)),c&&(e.addLine(v,y),e.addLine(b,D))),v=y,b=D;else{m.pos=[d[0],d[1],d[2]],e.coords&&(m.coord=[0,0]);var M=e.addVertexObject(m);m.pos=[d[0]+o*Math.sin(u),d[1]+o*Math.cos(u),d[2]],e.coords&&(m.coord=[0,1]),e.addVertexObject(m),i=M+2;for(x=u+h;x<p;x+=h)r=Math.sin(x),n=Math.cos(x),m.pos=[d[0]+o*r,d[1]+o*n,d[2]],e.coords&&(m.coord=[r,n]),e.addVertexObject(m),l&&(e.addTriangle(M,i-1,i),e.addTriangle(M,i,i-1)),c&&e.addLine(i-1,i),i++}return g&&e.transform(g,null,f),a&&e.compile(),e},pd3D.Shapes.sphere=function(t,e){var n=!1;function r(t,e,r){return n?[t,r,e]:[t,e,r]}function i(t){return t+(t-t*t)/2}var a=(t=t||{}).detail||6,o=new pd.Indexer;e?e.clear():e=new pd3D.Mesh(t);for(var s,d=0;d<8;++d)for(var h,l=[],n=0<(h=v(d)).x*h.y*h.z,c=0;c<=a;++c){for(var u=0;c+u<=a;++u){var p=c/a,f=u/a,m=(a-c-u)/a,g=new pd3D.Vector(i(p),i(f),i(m)).unit().multiply(h),m={vertex:g.toArray()};e.coords&&(g=g.toAngles(),m.coord=[(g.theta+Math.PI)/_,(g.phi+E)/Math.PI]),l.push(o.addObject(m))}if(0<c)for(u=0;c+u<=a;++u){p=(c-1)*(a+1)+(c-1-(c-1)*(c-1))/2+u,f=c*(a+1)+(c-c*c)/2+u;e.triangles.push(r(l[p],l[p+1],l[f])),c+u<a&&e.triangles.push(r(l[f],l[p+1],l[f+1]))}}return e.vertices=o.unique.map(function(t){return t.vertex}),e.coords&&(e.coords=o.unique.map(function(t){return t.coord})),e.normals&&(e.normals=e.vertices.map(function(t){return[t[0],t[1],t[2]]})),(t.radius||t.center)&&(s=t.center||[0,0,0],h=t.scale||(t.radius?[t.radius,t.radius,t.radius]:[1,1,1]),e.vertices=e.vertices.map(function(t){return[s[0]+t[0]*h[0],s[1]+t[1]*h[1],s[2]+t[2]*h[2]]})),e.compile(),e},pd3D.Shapes.sphereLatLng=function(t,e){t=t||{};var r,n,i,a,o,s,d,h,l=pd.Const.DEG2RAD,c=t.latIncrement?pd.constrainTo(t.latIncrement,1,45)*l:t.increment?pd.constrainTo(t.increment,1,45)*l:5*l,u=t.lngIncrement?pd.constrainTo(t.lngIncrement,1,45)*l:t.increment?pd.constrainTo(t.increment,1,45)*l:5*l,p=t.scale||(t.radius?[t.radius,t.radius,t.radius]:[1,1,1]),f=t.center||[0,0,0],m=Math.ceil(Math.PI/c),g=Math.ceil(_/u),y=0;e?e.clear():e=new pd3D.Mesh(t),n=E+c;for(var v=0;v<=m;++v){n-=c,a=Math.cos(n),o=Math.sin(n),y=e.vertices.length-(g+1),r=e.vertices.length,i=-E-u;for(var D=0;D<=g;++D)i+=u,s=a*Math.sin(i),d=a*Math.cos(i),h=o,e.vertices.push([f[0]+s*p[0],f[1]+d*p[1],f[2]+h*p[2]]),e.normals&&e.normals.push([s,d,h]),e.coords&&e.coords.push([1-D/g,1-v/m]),0<v&&0<D&&(e.triangles.push([r,r-1,y-1]),e.triangles.push([y,r,y-1])),y++,r++}if(e.lines){for(var b=t.graticule?pd.constrainTo(t.graticule,1,10):2,x=t.poleGraticule?pd.constrainTo(t.poleGraticule,1,10):3,v=b;v<m;v+=b){r=v*(g+1);for(D=0;D<=g;++D)e.lines.push([r-1,r++])}for(D=0;D<g;D+=b){D%x==0&&(r=g+1+D,e.lines.push([r-(g+1),r]));for(v=2;v<m;++v)r=v*(g+1)+D,e.lines.push([r-(g+1),r]);D%x==0&&(r=m*(g+1)+D,e.lines.push([r-(g+1),r]))}}return e.compile(),e},pd3D.Shapes.thickLine=function(t,e){var r=t.vertices;if(r&&1<r.length){t=t||{};var n=!1;e||(e=new pd3D.Mesh(t),n=!0);var i,a,o,s,d,h,l,c,u=r.length,p=pd.toInteger(t.side,0),f=pd.toNumber(t.scale,1),m=pd.toInteger(t.joints,0),g=pd.toInteger(t.endcap,0),y=pd.toNumber(t.width,0),v=t.normal||[0,0,1],D=e.triangles&&pd.toBoolean(t.triangles,!0),b=e.lines&&pd.toBoolean(t.lines,!1),x=pd.toBoolean(t.closed,!1),M=e.vertexCount(),T=[],A=[],w=[],O=[],V=[],C=[],S=[],N=[],k=[];if(t.style&&(c=t.style,p=pd.toInteger(c.lineSide,p),y=pd.toNumber(c.lineWidth,y),m=pd.toInteger(c.lineJoint,m),g=pd.toInteger(c.lineCap,g),D=e.triangles&&pd.toBoolean(c.triangles,D),b=e.lines&&pd.toBoolean(c.lines,b)),x&&(g=0),f>pd.Const.EPSILON&&(y*=f),"offset"in t)var f=pd.constrainTo(pd.toNumber(t.offset,.5),0,1),I=(1-f)*y,P=f*y;else switch(p){default:P=I=.5*y;break;case pd.Align.OUTSIDE:P=0,I=y;break;case pd.Align.INSIDE:P=y,I=0}if(1.001<y){_=x?0:1,i=r[E=x?u-1:0],a=r[_],N[0]=a[0]-i[0],N[1]=a[1]-i[1],N[2]=(+a[2]||0)-(+i[2]||0),t.normals&&(v=t.normals[E]),d=Math.sqrt(N[0]*N[0]+N[1]*N[1]+N[2]*N[2]),w[0]=N[1]*v[2]-N[2]*v[1],w[1]=N[2]*v[0]-N[0]*v[2],w[2]=N[0]*v[1]-N[1]*v[0],z(w);for(var E,_,L=0;L<u;++L){u<=(_=L+1)&&(_=0),i=r[E=L],a=r[_],!x&&_<1&&0<E?(k[0]=i[0]-r[E-1][0],k[1]=i[1]-r[E-1][1],k[2]=(+i[2]||0)-(+r[E-1][2]||0)):(k[0]=a[0]-i[0],k[1]=a[1]-i[1],k[2]=(+a[2]||0)-(+i[2]||0)),t.normals&&(v=t.normals[E]),h=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]),O[0]=k[1]*v[2]-k[2]*v[1],O[1]=k[2]*v[0]-k[0]*v[2],O[2]=k[0]*v[1]-k[1]*v[0],z(O),R=d*h,l=N[0]*k[0]+N[1]*k[1]+N[2]*k[2],l=1<=(F=R>pd.Const.EPSILON?l/R:0)?0:F<=-1?Math.PI:Math.acos(F),pd3D.VectorArray.cross(A,N,k),1!=g||E&&_||(z(B=k.slice()),0==E&&(i=[i[0]-.5*B[0]*y,i[1]-.5*B[1]*y,i[2]-.5*B[2]*y]),0==_&&(i=[i[0]+.5*B[0]*y,i[1]+.5*B[1]*y,i[2]+.5*B[2]*y])),R=Math.cos(.5*l),F=pd.safeDivide(P,R),B=pd.safeDivide(I,R),T[0]=w[0]+O[0],T[1]=w[1]+O[1],T[2]=w[2]+O[2],z(T);var R=Math.min(d,h)+1.4142136*y,B=Math.min(B,R),F=Math.min(F,R);V[0]=i[0]+T[0]*B,V[1]=i[1]+T[1]*B,V[2]=i[2]+T[2]*B,C[0]=i[0]-T[0]*F,C[1]=i[1]-T[1]*F,C[2]=i[2]-T[2]*F,l<2.0943951022?(e.addVertex(C.slice()),o=e.addVertex(V.slice()),0<L?(D&&(e.addTriangle(o-3,o,o-1),e.addTriangle(o-3,o-2,o)),b&&(e.addLine(o-3,o-1),e.addLine(o-2,o))):!x&&b&&e.addLine(o-1,o)):A[2]<0?((d<B||h<B)&&(B=Math.min(d,h)),s=Math.sin(.5*l)*P,S[0]=i[0]-T[0]*P,S[1]=i[1]-T[1]*P,S[2]=i[2]-T[2]*P,e.addVertex([S[0]+O[0]*s,S[1]+O[1]*s,S[2]+O[2]*s]),e.addVertex([S[0]+w[0]*s,S[1]+w[1]*s,S[2]+w[2]*s]),o=e.addVertex(V.slice()),0<L?(D&&(e.addTriangle(o-3,o,o-2),e.addTriangle(o-4,o-3,o-2),e.addTriangle(o-1,o-2,o)),b&&(e.addLine(o-3,o),e.addLine(o-4,o-2),e.addLine(o-2,o-1))):!x&&b&&e.addLine(o-1,o)):((d<F||h<F)&&(F=Math.min(d,h)),s=Math.sin(.5*l)*I,S[0]=i[0]+T[0]*I,S[1]=i[1]+T[1]*I,S[2]=i[2]+T[2]*I,e.addVertex([S[0]+w[0]*s,S[1]+w[1]*s,S[2]+w[2]*s]),e.addVertex(C.slice()),o=e.addVertex([S[0]+O[0]*s,S[1]+O[1]*s,S[2]+O[2]*s]),0<L?(D&&(e.addTriangle(o-4,o-2,o-1),e.addTriangle(o-4,o-3,o-2),e.addTriangle(o-1,o-2,o)),b&&(e.addLine(o-4,o-1),e.addLine(o-3,o-2),e.addLine(o-2,o))):!x&&b&&e.addLine(o-1,o)),w[0]=O[0],w[1]=O[1],w[2]=O[2],d=h,N[0]=k[0],N[1]=k[1],N[2]=k[2]}x?(D&&(e.addTriangle(M,o-1,o),e.addTriangle(M,o,M+1)),b&&(e.addLine(M,o-1),e.addLine(M+1,o))):b&&e.addLine(o-1,o)}else if(e.lines){e.addVertex(r[0]);for(L=1;L<u-1;++L)o=e.addVertex(r[L]),e.addLine(o-1,o);o=e.addVertex(r[u-1]),e.addLine(o-1,o),x&&e.addLine(M,o),M=e.vertexCount()}t.transform instanceof pd3D.Matrix&&e.transform(t.transform,null,M),n&&e.compile()}return e},pd3D.Shapes.arrow=function(t,e){var r=!1,n=!1;t=t||{},e||(e=new pd3D.Mesh(t),r=!0);var i=pd.toInteger(t.type,0),a=pd.toNumber(t.scale,1),o=pd.toNumber(t.shaft,0),s=pd.toNumber(t.indent,0),d=pd.toNumber(t.thickness,.25),h=Math.max(1,pd.toNumber(t.length,0<i?25:40)),l=Math.max(1,pd.toNumber(t.width,h*(0<i?1:.6))),c=e.triangles&&pd.toBoolean(t.triangles,!0),u=e.lines&&pd.toBoolean(t.lines,!1);t.style&&(D=t.style,i=pd.toInteger(D.arrowType,i),o=pd.toNumber(D.lineWidth,o),s=pd.toNumber(D.arrowIndent,s),d=pd.toNumber(D.arrowThickness,d),l=Math.max(1,pd.toNumber(D.arrowWidth,l)),h=Math.max(1,pd.toNumber(D.arrowLength,h)),c=e.triangles&&pd.toBoolean(D.triangles,c),u=e.lines&&pd.toBoolean(D.lines,u));var p=-1,f=-1,m=l/h;t.vertices&&0<t.vertices.length&&(t.side=pd.Align.CENTER,n=t.ignoreEnd=!0,pd3D.Shapes.thickLine(t,e)),a>pd.Const.EPSILON&&(l*=a,h*=a,s*=a,o*=a);var g=4;1<=d?g=1/(d*a/h):0<d&&(g=1/d);var y=h/g,v=l/g,D=t.to;null==D&&(D=t.vertices&&0<t.vertices.length?t.vertices[t.vertices.length-1]:[0,0,0]);a=t.from||null;null==a&&t.vertices&&1<t.vertices.length&&(a=t.vertices[t.vertices.length-2]);d=o<1.001?0:.5*o,o=.5*l,l=e.vertexCount();switch(i){default:case 0:s=Math.min(s,.9*h),pd.closeTo(s,0,.1)&&!n?(e.addVertex([0,0,0]),e.addVertex([-h,o,0]),e.addVertex([-h,-o,0]),c&&e.addTriangle(l,l+1,l+2),u&&(e.addLine(l,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l))):(e.addVertex([0,0,0]),e.addVertex([-h,o,0]),p=e.addVertex([-h+s,d,0]),f=e.addVertex([-h+s,-d,0]),e.addVertex([-h,-o,0]),c&&(e.addTriangle(l,l+1,l+2),e.addTriangle(l,l+3,l+4)),u&&(e.addLine(l,l+1),e.addLine(l+1,l+2),e.addLine(l+3,l+4),e.addLine(l+4,l)));break;case 1:e.addVertex([0,0,0]),e.addVertex([-(g+.25)*y,(g+.25)*v,0]),e.addVertex([-(g+.75)*y,(g-.25)*v,0]),p=e.addVertex([-y-d,d*m,0]),f=e.addVertex([-y-d,-d*m,0]),e.addVertex([-(g+.75)*y,-(g-.25)*v,0]),e.addVertex([-(g+.25)*y,-(g+.25)*v,0]),c&&(e.addTriangle(l,l+1,l+3),e.addTriangle(l+1,l+2,l+3),e.addTriangle(l+4,l+5,l+6),e.addTriangle(l,l+4,l+6)),u&&(e.addLine(l,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l+3),e.addLine(l+4,l+5),e.addLine(l+5,l+6),e.addLine(l+6,l));break;case 2:e.addVertex([0,0,0]),e.addVertex([-g*y,g*v,0]),e.addVertex([-(g+1)*y,g*v,0]),p=e.addVertex([-y-d,d*m,0]),f=e.addVertex([-y-d,-d*m,0]),e.addVertex([-(g+1)*y,-g*v,0]),e.addVertex([-g*y,-g*v,0]),c&&(e.addTriangle(l,l+1,l+3),e.addTriangle(l+1,l+2,l+3),e.addTriangle(l+4,l+5,l+6),e.addTriangle(l,l+4,l+6)),u&&(e.addLine(l,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l+3),e.addLine(l+4,l+5),e.addLine(l+5,l+6),e.addLine(l+6,l));break;case 3:e.addVertex([0,0,0]),e.addVertex([-(g+.5)*y,(g+.5)*v,0]),e.addVertex([-(g+.5)*y,(g-.5)*v,0]),p=e.addVertex([-y-d,d*m,0]),f=e.addVertex([-y-d,-d*m,0]),e.addVertex([-(g+.5)*y,-(g-.5)*v,0]),e.addVertex([-(g+.5)*y,-(g+.5)*v,0]),c&&(e.addTriangle(l,l+1,l+3),e.addTriangle(l+1,l+2,l+3),e.addTriangle(l+4,l+5,l+6),e.addTriangle(l,l+4,l+6)),u&&(e.addLine(l,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l+3),e.addLine(l+4,l+5),e.addLine(l+5,l+6),e.addLine(l+6,l));break;case 4:e.addVertex([0,0,0]),e.addVertex([-g*y,g*v,0]),e.addVertex([-(g+.5)*y,g*v,0]),e.addVertex([-(g+.5)*y,(g-.5)*v,0]),p=e.addVertex([-y-d,d*m,0]),f=e.addVertex([-y-d,-d*m,0]),e.addVertex([-(g+.5)*y,-(g-.5)*v,0]),e.addVertex([-(g+.5)*y,-g*v,0]),e.addVertex([-g*y,-g*v,0]),c&&(e.addTriangle(l,l+1,l+4),e.addTriangle(l+1,l+2,l+3),e.addTriangle(l+1,l+3,l+4),e.addTriangle(l+5,l+6,l+8),e.addTriangle(l+6,l+7,l+8),e.addTriangle(l,l+5,l+8)),u&&(e.addLine(l,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l+3),e.addLine(l+3,l+4),e.addLine(l+5,l+6),e.addLine(l+6,l+7),e.addLine(l+7,l+8),e.addLine(l+8,l))}return 0<=p&&0<=f&&(d<.1&&e.lines?e.addLine(l-1,f):(c&&0<d&&(e.addTriangle(l,p,f),n&&(e.addTriangle(l-1,p,l-2),e.addTriangle(l-1,f,p))),u&&(n?(e.addLine(l-2,p),e.addLine(l-1,f)):0<d&&e.addLine(p,f)))),pd.isArray(D)&&(f=pd3D.Matrix.translate(+D[0]||0,+D[1]||0,+D[2]||0),pd.isArray(a)&&(a=Math.atan2(D[1]-a[1],D[0]-a[0])*pd.Const.RAD2DEG,pd.closeTo(a,0)||(f=pd3D.Matrix.multiply(f,pd3D.Matrix.rotate(a,0,0,1),f))),e.transform(f,null,l)),t.transform instanceof pd3D.Matrix&&e.transform(t.transform,null,l),r&&e.compile(),e},pd3D.Shapes.Type={CIRCLE:1,CIRCLE_HOLLOW:-1,TRIANGLE:2,TRIANGLE_HOLLOW:-2,SQUARE:3,SQUARE_HOLLOW:-3,DIAMOND:4,DIAMOND_HOLLOW:-4,STAR:5,STAR_HOLLOW:-5,SPOKES:6,CROSS:-6},pd3D.Shapes.polygon=function(t,e,r){var n=!1;t=t||{},e||(e=new pd3D.Mesh(t),n=!0);var i,a,o,s,d,h,l,c=null,u=pd.toInteger(t.type,0),p=pd.toNumber(t.size,20),f=pd.toNumber(t.rotation,0),m=pd.toNumber(t.thickness,2.5),g=pd.constrainTo(pd.toNumber(t.angle,360),0,360),y=pd.constrainTo(pd.toInteger(t.segments,24),2,720),v=e.triangles&&pd.toBoolean(t.triangles,!0),D=e.lines&&pd.toBoolean(t.lines,!1),b={pos:[]},x=t.center||null;null==x&&t.vertices&&0<t.vertices.length&&(x=t.vertices[t.vertices.length-1]),r=pd.toNumber(r,0),pd.closeTo(r,0)&&(r=pd.toNumber(t.scale,0)),pd.closeTo(r,0)&&(r=1),pd.isArray(t.offset)&&(null==x&&(x=[0,0,0]),x[0]+=(+t.offset[0]||0)*r,x[1]+=(+t.offset[1]||0)*r,x[2]+=(+t.offset[2]||0)*r);var M=t.from||null;null==M&&t.vertices&&1<t.vertices.length&&(M=t.vertices[t.vertices.length-2]),pd.closeTo(g,0)&&(g=360),r>pd.Const.EPSILON&&(m*=r,p*=r),pd.isArray(t.color)&&e.color(t.color),t.transform instanceof pd3D.Matrix&&(c=t.transform),e.normals&&(T=[0,0,1],c&&c.applyVectorTransformToArray(T),e.normal(T));var T=e.vertexCount();switch(u){case 2:case-2:y=3,m*=2,f+=60;break;case 3:case-3:y=4,m*=1.41421356,f+=45;break;case 4:case-4:y=4,m*=1.41421356;break;case 5:case-5:y*=2,f+=180;break;case-6:y=4}switch(u){default:case 1:case 2:case 3:case 4:case 5:var A=p,w=Math.max(2,pd.toInteger(t.tickIncr,2));if(0<A){b.pos=[0,0,0],e.coords&&(b.coord=[0,0]);var O=e.addVertexObject(b);y<2&&(y=pd.mapAndConstrainTo(g,0,360,2,24)),f*=pd.Const.DEG2RAD,g*=pd.Const.DEG2RAD;for(var V=l=0,C=1+(N=.5*(k=1/Math.round(y)));V<C;V+=k)E=Math.min(V,1)*g,d=Math.cos(E+f),h=Math.sin(E+f),5==u&&(A=l++%w?p-m:p),b.pos=[A*d,A*h,0],e.coords&&(b.coord=[d,h]),i=e.addVertexObject(b),N<V&&(v&&e.addTriangle(O,a,i),D&&e.addLine(a,i)),a=i;D&&g<_&&(e.addLine(O,O+1),e.addLine(O,i))}break;case-1:case-2:case-3:case-4:case-5:var A=p,S=Math.max(0,p-m),w=Math.max(2,pd.toInteger(t.tickIncr,2));if(0<A){y<2&&(y=pd.mapAndConstrainTo(g,0,360,2,24)),f*=pd.Const.DEG2RAD,g*=pd.Const.DEG2RAD;for(var N,V=l=0,C=1+(N=.5*(k=1/Math.round(y)));V<C;V+=k)E=Math.min(V,1)*g,d=Math.cos(E+f),h=Math.sin(E+f),-5==u&&(A=l++%w?p-m:p),b.pos=[S*d,S*h,0],e.coords&&(b.coord=[d,h]),i=e.addVertexObject(b),b.pos=[A*d,A*h,0],o=e.addVertexObject(b),N<V&&(v&&(e.addTriangle(o,a,s),e.addTriangle(i,a,o)),D&&(e.addLine(a,i),e.addLine(s,o))),a=i,s=o;D&&g<_&&(e.addLine(T,T+1),e.addLine(a,s))}break;case 6:case-6:A=p,r=pd.toNumber(t.tickSize,m)*r,S=Math.max(0,p-r);if(0<A){y<2&&(y=pd.mapAndConstrainTo(g,0,360,2,24)),l=0;var k=1/Math.round(y),I=new pd3D.Matrix;if(m<1e-6&&D)for(var P=[new pd3D.Vector(0,S,0),new pd3D.Vector(0,A,0)],V=0;V<1;V+=k)E=Math.min(V,1)*g,I=pd3D.Matrix.rotate(E+f,0,0,1,I),b.pos=I.transformPoint(P[0]).toArray(),i=e.addVertexObject(b),b.pos=I.transformPoint(P[1]).toArray(),e.addVertexObject(b),D&&e.addLine(i,i+1);else{m=Math.max(1e-6,m*=.5);for(var E,P=[new pd3D.Vector(-m,S,0),new pd3D.Vector(m,S,0),new pd3D.Vector(m,A,0),new pd3D.Vector(-m,A,0)],V=0;V<1;V+=k)E=Math.min(V,1)*g,I=pd3D.Matrix.rotate(E+f,0,0,1,I),b.pos=I.transformPoint(P[0]).toArray(),i=e.addVertexObject(b),b.pos=I.transformPoint(P[1]).toArray(),e.addVertexObject(b),b.pos=I.transformPoint(P[2]).toArray(),e.addVertexObject(b),b.pos=I.transformPoint(P[3]).toArray(),e.addVertexObject(b),v&&(e.addTriangle(i,i+1,i+2),e.addTriangle(i,i+2,i+3)),D&&(e.addLine(i,i+1),e.addLine(i+1,i+2),e.addLine(i+2,i+3),e.addLine(i+3,i))}}}return pd.isArray(M)&&(y=0,y=null!=x?Math.atan2(x[1]-M[1],x[0]-M[0])*pd.Const.RAD2DEG:Math.atan2(-M[1],-M[0])*pd.Const.RAD2DEG,pd.closeTo(y,0)||e.transform(pd3D.Matrix.rotate(y,0,0,1),null,T)),null!=x&&e.transform(pd3D.Matrix.translate(x[0],x[1],x[2]),null,T),c&&e.transform(c,null,T),n&&e.compile(),e},pd3D.Shapes.circularArrow=function(t,e){var r=!1;t=t||{},e||(e=new pd3D.Mesh(t),r=!0);var n=pd.Const.DEG2RAD,i=pd.toNumber(t.width,1),a=pd.toNumber(t.radius,1),o=t.center||[0,0,0],s=pd.toNumber(t.fromAngle,0)*n,d=pd.toNumber(t.toAngle,Math.PI)*n,h=e.triangles&&pd.toBoolean(t.triangles,!0),l=e.lines&&pd.toBoolean(t.lines,!1),c=e.vertexCount(),u=2.5*n,p=d-s,f=Math.ceil(Math.abs(p)/u),n=a+i,u=a-i,m=a+.5*i,g=a-.5*i;f<3&&(f=3);var y=s,v=p/f,D=Math.sin(s),b=Math.cos(s);e.addVertex([o[0]+a*D,o[1]+a*b,o[2]]),y+=v,D=Math.sin(y),b=Math.cos(y),e.addVertex([o[0]+n*D,o[1]+n*b,o[2]]),e.addVertex([o[0]+u*D,o[1]+u*b,o[2]]),h&&e.addTriangle(c,c+2,c+1),e.addVertex([o[0]+g*D,o[1]+g*b,o[2]]),e.addVertex([o[0]+m*D,o[1]+m*b,o[2]]),l&&(e.addLine(c,c+1),e.addLine(c,c+2),e.addLine(c+2,c+3),e.addLine(c+1,c+4));for(var x=e.vertexCount(),M=2;M<f;++M)y+=v,D=Math.sin(y),b=Math.cos(y),e.addVertex([o[0]+g*D,o[1]+g*b,o[2]]),e.addVertex([o[0]+m*D,o[1]+m*b,o[2]]),h&&(e.addTriangle(x-1,x-2,x),e.addTriangle(x+1,x-1,x)),l&&(e.addLine(x-2,x),e.addLine(x-1,x+1)),x+=2;return e.addVertex([o[0]+u*D,o[1]+u*b,o[2]]),e.addVertex([o[0]+n*D,o[1]+n*b,o[2]]),D=Math.sin(d),b=Math.cos(d),e.addVertex([o[0]+a*D,o[1]+a*b,o[2]]),h&&e.addTriangle(x,x+2,x+1),l&&(e.addLine(x-2,x),e.addLine(x-1,x+1),e.addLine(x,x+2),e.addLine(x+1,x+2)),t.transform instanceof pd3D.Matrix&&e.transform(t.transform,null,c),r&&e.compile(),e}}(),String.prototype.trim||function(){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(t,"")}}(),function(){var u,p,g,y=null,f=null,B=.1,F=.5*B,z=.8,Y=1.25,U=1,q=.1,H=0,j=0,G=.8,W=.25,K=null,X=null,m=0,$=null;pd3D.FontInstance=function(t){t=t||{},this.isTriangulated=!0,this._width=pd.toNumber(t.width,.1),this._aspectRatio=pd.toNumber(t.aspectRatio,1.25),this._chamfer=pd.toNumber(t.chamfer,.1),this._italic=pd.toNumber(t.italic,0),this._skew=pd.toNumber(t.skew,0),this._weight=pd.toNumber(t.weight,0),this._weight>pd.Const.EPSILON?this._width=this._weight/900*.35:this._weight=Math.round(this._width/.35*900),this._extrusion=pd.toNumber(t.extrusion,0),this._updateMetrics=!0,this._metrics=[[],[]],this._letterSpacing=pd.toNumber(t.letterSpacing,.25),this._wordSpacing=pd.toNumber(t.wordSpacing,.8),this._lineSpacing=pd.toNumber(t.lineSpacing,.5),this._smallCapsRatio=pd.toNumber(t.smallCapsRatio,.8),this._includeOutline=!1;var a=null,o=null,s=!1,d=null,h=!1;this.maxTextWidth=0,this.blockHeight=0,this.blockWidth=0,this.setSize=function(t){return pd.isArray(t)?(h=!0,d=pd3D.Matrix.scale(+t[0]||1,+t[1]||1,+t[2]||1,d)):(t=+t||0,h=!pd.closeTo(t,0)&&(d=pd3D.Matrix.scale(t,t,t,d),!0)),this},this.setRotationPolar=function(t,e,r){return s=pd.closeTo(t,0)?pd.closeTo(e,0)?(o=pd3D.Matrix.identity(o),!1):(o=r?pd3D.Matrix.rotate(-e,0,1,0,o):pd3D.Matrix.rotate(e,1,0,0,o),!0):(o=pd3D.Matrix.rotate(t,0,0,1,o),pd.closeTo(e,0)||(r?o.multiplyBy(pd3D.Matrix.rotate(-e,0,1,0)):o.multiplyBy(pd3D.Matrix.rotate(e,1,0,0))),!0),this},this.setRotation=function(t,e,r,n){return s=pd.closeTo(t,0)?(o=pd3D.Matrix.identity(o),!1):(o=pd3D.Matrix.rotate(t,e,r,n,o),!0),this},this.addRotation=function(t,e,r,n){return pd.closeTo(t,0)||(o?o.multiplyBy(pd3D.Matrix.rotate(t,e,r,n)):o=pd3D.Matrix.rotate(t,e,r,n,o),s=!0),this},this.clearRotations=function(){return o=pd3D.Matrix.identity(o),s=!1,this},this.drawText=function(t,e,r,n,i){return a=pd3D.Matrix.translate(e[0],e[1],e[2],a),s&&null!=o&&a.multiplyBy(o),h&&null!=d&&a.multiplyBy(d),this.addText(t,n||pd.Align.CENTER,i||pd.Align.CENTER,a,r),this}},pd3D.FontInstance.prototype.italicSlant=function(t){return arguments.length?(this._italic=pd.constrainTo(parseFloat(t),-1,1),this):this._italic},pd3D.FontInstance.prototype.verticalSkew=function(t){return arguments.length?(this._skew=pd.constrainTo(parseFloat(t),-1,1),this):this._skew},pd3D.FontInstance.prototype.averageKerning=function(t){return arguments.length?(this._letterSpacing=pd.constrainTo(parseFloat(t)-1,0,10),this):this._letterSpacing+1},pd3D.FontInstance.prototype.letterSpacing=function(t){return arguments.length?(this._letterSpacing=pd.constrainTo(parseFloat(t),0,10),this):this._letterSpacing},pd3D.FontInstance.prototype.wordSpacing=function(t){return arguments.length?(this._wordSpacing=pd.constrainTo(parseFloat(t),0,10),this):this._wordSpacing},pd3D.FontInstance.prototype.lineSpacing=function(t){return arguments.length?(this._lineSpacing=pd.constrainTo(parseFloat(t),0,10),this):this._lineSpacing},pd3D.FontInstance.prototype.smallCapsRatio=function(t){return arguments.length?(this._smallCapsRatio=pd.constrainTo(parseFloat(t),.1,1),this):this._smallCapsRatio},pd3D.FontInstance.prototype.aspectRatio=function(t,e,r){return arguments.length?(this._aspectRatio=pd.constrainTo(t,.1,10),e>pd.Const.EPSILON&&(this._letterSpacing=pd.constrainTo(e-1,0,10)),r>pd.Const.EPSILON&&(this._wordSpacing=pd.constrainTo(r,0,10)),this._updateMetrics=!0,this):this._aspectRatio},pd3D.FontInstance.prototype.weight=function(t){if(!arguments.length)return this._weight;var e=pd.constrainTo(parseFloat(t),0,900);return pd.closeTo(this._weight,e,.5)||(this._width=333333e-9*e,this._weight=Math.round(e),this._updateMetrics=!0),this},pd3D.FontInstance.prototype.chamfer=function(t){if(!arguments.length)return this._chamfer/.275*1e3;var e=275e-6*pd.constrainTo(parseFloat(t),1,1e3);return pd.closeTo(this._chamfer,e,.001)||(this._updateMetrics=!0,this._chamfer=e),this},pd3D.FontInstance.prototype.includeOutline=function(t){return arguments.length?(this._includeOutline=!!t,this):this._includeOutline},pd3D.FontInstance.prototype.extrusion=function(t){return arguments.length?(this._extrusion=pd.toNumber(t,0),this):this._extrusion},pd3D.FontInstance.prototype.resetMetrics=function(){return this._aspectRatio=pd.constrainTo(this._aspectRatio,.1,10),this._letterSpacing=.25,this._wordSpacing=.8,this._lineSpacing=.5,this._italic=0,this._skew=0,this._calculateFontVertices(),this},pd3D.FontInstance.prototype._calculateFontVertices=function(){var t=this._width,e=this._chamfer,r=this._aspectRatio,n=t/2.414213,i=.5*r,a=.5*(t=Math.min(i,t)),o=t+.01,s=this._metrics[0],d=this._metrics[1];s[0]=0,s[1]=t,s[2]=e,s[3]=Math.max(t,e+n),s[4]=i-a,s[5]=i+a,s[6]=Math.max(o,Math.min(r-t,r-e-n)),s[7]=Math.max(o,r-e),s[8]=Math.max(o,r-t),s[9]=r,s[10]=pd.mapAndConstrainTo(e,0,t,0,t),d[0]=0,d[1]=t,d[2]=e,d[3]=Math.max(t,e+n),d[4]=.5+a-e-n,d[5]=Math.min(.5,.5+a-e),d[6]=.5-a,d[7]=.5,d[8]=.5+a,d[9]=Math.max(.5,.5-a+e),d[10]=Math.max(d[8],.5-a+e+n),d[11]=Math.min(1-t,1-e-n),d[12]=1-e,d[13]=1-t,d[14]=1,d[4]=Math.min(d[4],d[6]),d[3]>d[4]&&(d[3]=d[4]=.5*(d[3]+d[4])),d[10]>d[11]&&(d[10]=d[11]=.5*(d[10]+d[11])),this._updateMetrics=!1},pd3D.FontInstance.prototype.getLineWidth=function(t){var e,r,n,i=0,a=0,o=this._aspectRatio,s=this._width,d=this._smallCapsRatio,h=this._letterSpacing*o,l=this._wordSpacing,c=!1,u=!1,p=t.length,f=!0;0<p&&97<=(n=t.charCodeAt(0))&&n<123&&(u=!0);for(var m=0;m<p;m++){switch(e=c,c=u,m<p-(a=r=1)?u=97<=(n=t.charCodeAt(m+1))&&n<123:f=u=!1,t.charAt(m)){default:c&&(r=d);break;case"i":r=d;case"I":a=Math.max(.5,1.25*s/o);break;case"\b":case"\f":a=r=0;break;case" ":a=l;break;case"1":case"{":case"}":a=.5;break;case"(":case")":case"[":case"]":a=s/o+.2;break;case'"':a=s/o*2+.1;break;case"|":case"`":a=.5;break;case",":case".":case":":case";":(e||u)&&(r=d);case"!":case"'":a=s/o}i+=a*o*r,f&&(i+=u?h*d:h*r)}return i},pd3D.FontInstance.prototype.getTextWidth=function(t){for(var e,r=t.match(/[^\r\n]+/g),n=0,i=0,a=r.length;i<a;++i)n<(e=this.getLineWidth(r[i].trim()))&&(n=e);return n},pd3D.FontInstance.prototype.addText=function(t,e,r,n,i){if(this._updateMetrics&&this._calculateFontVertices(),!t||t.length<1)return i;n=n||new pd3D.Matrix,v.init(n),B=this._width,F=.5*B,z=this._smallCapsRatio,Y=this._aspectRatio,q=this._chamfer,H=this._italic,j=this._skew,p=this._lineSpacing,G=this._wordSpacing,W=this._letterSpacing*Y,g=this._includeOutline&&i.hasLines,m=this._extrusion,K=this._metrics[0],X=this._metrics[1],y=i||new pd3D.Mesh,u=y.defaultColor,f=y.defaultLineColor,g&&y.hasVertexColors&&y.defaultLineColor!=y.defaultColor||(f=null),y.triangles||y.addIndexBuffer("triangles"),$=m>pd.Const.EPSILON?y.hasVertexNormals?T:M:x;var a,o,s,d=t.match(/[^\r\n]+/g),h=d?d.length:0,l=0,t=Math.max(1,h+(h-1)*p);switch(r){default:case pd.Align.BASELINE:break;case pd.Align.TOP:case pd.Align.TOP_LEFT:case pd.Align.TOP_RIGHT:h<2&&(t+=.5*p),v.multiplyBy(pd3D.Matrix.translate(0,-1,0));break;case pd.Align.CENTER:v.multiplyBy(pd3D.Matrix.translate(0,.5*t-1,0));break;case pd.Align.BOTTOM:case pd.Align.BOT_LEFT:case pd.Align.BOT_RIGHT:h<2&&(t+=.5*p),v.multiplyBy(pd3D.Matrix.translate(0,-1+t,0))}for(var c=0;c<h;++c){switch(a=d[c].trim(),s=0,l<(o=this.getLineWidth(a))&&(l=o),e){default:s=.5*-o;break;case pd.Align.LEFT:case pd.Align.TOP_LEFT:case pd.Align.BOT_LEFT:case pd.Align.BASELINE:break;case pd.Align.RIGHT:case pd.Align.TOP_RIGHT:case pd.Align.BOT_RIGHT:s=-o}pd.closeTo(s,0)?A(a):(v.multiplyBy(pd3D.Matrix.translate(s,0,0)),A(a),v.multiplyBy(pd3D.Matrix.translate(-s,0,0))),1<d.length&&v.multiplyBy(pd3D.Matrix.translate(0,-(1+p),0))}return this.maxTextWidth<l&&(this.maxTextWidth=l),this.blockHeight=t,this.blockWidth=l,y.hasVertexColors&&y.color(u),y};var n=new pd3D.Vector,v=new pd3D.Matrix,Z=0;function D(t,e){var r=Z+(t+H*(e-.5))*U,e=(e+j*e*(t-.5))*U,t=v.m;return n.init(t[0]*r+t[1]*e+t[3],t[4]*r+t[5]*e+t[7],t[8]*r+t[9]*e+t[11]).divide(t[12]*r+t[13]*e+t[15]),n.toArray()}function b(t,e){return n.init(Z+(t+H*(e-.5))*U,(e+j*e*(t-.5))*U,m),v.transformPoint(n,n),n.toArray()}function x(t,e,r){var n,i,a,o=t.length;y.hasVertexColors&&y.color(u);for(var s=y.addVertex(D(t[0][0],t[0][1])),d=1;d<o;++d)y.addVertex(D(t[d][0],t[d][1]));if(.001<B)for(o=e.length,d=0;d<o;++d)y.addTriangle(s+e[d][0],s+e[d][1],s+e[d][2]),3<e[d].length&&y.addTriangle(s+e[d][0],s+e[d][2],s+e[d][3]);if(g&&r){if(f&&y.hasVertexColors)for(o=t.length,y.color(f),s=y.addVertex(D(t[0][0],t[0][1])),d=1;d<o;++d)y.addVertex(D(t[d][0],t[d][1]));for(n=s,o=r.length,d=0;d<o;++d){for(i=s+r[d],a=n+1;a<=i;++a)y.addLine(a-1,a);y.addLine(i,n),n=i+1}}}function M(t,e,r){for(var n,i,a,o,s=t.length,d=y.addVertex(D(t[0][0],t[0][1])),h=1;h<s;++h)y.addVertex(D(t[h][0],t[h][1]));for(o=y.addVertex(b(t[0][0],t[0][1])),h=1;h<s;++h)y.addVertex(b(t[h][0],t[h][1]));for(s=e.length,h=0;h<s;++h)y.addTriangle(d+e[h][2],d+e[h][1],d+e[h][0]),3<e[h].length&&y.addTriangle(d+e[h][3],d+e[h][2],d+e[h][0]),y.addTriangle(o+e[h][0],o+e[h][1],o+e[h][2]),3<e[h].length&&y.addTriangle(o+e[h][0],o+e[h][2],o+e[h][3]);for(h=0;h<s;++h)y.addTriangle(d+e[h][2],d+e[h][1],d+e[h][0]),3<e[h].length&&y.addTriangle(d+e[h][3],d+e[h][2],d+e[h][0]),y.addTriangle(o+e[h][0],o+e[h][1],o+e[h][2]),3<e[h].length&&y.addTriangle(o+e[h][0],o+e[h][2],o+e[h][3]);if(r){for(n=d,s=r.length,vtx_dif=o-d,h=0;h<s;++h){for(i=d+r[h],a=n+1;a<=i;++a)y.addTriangle(a-1,a,a+vtx_dif),y.addTriangle(a-1,a+vtx_dif,a-1+vtx_dif);y.addTriangle(i,n,n+vtx_dif),y.addTriangle(i,n+vtx_dif,i+vtx_dif),n=i+1}if(g){for(n=d,h=0;h<s;++h){for(i=d+r[h],a=n+1;a<=i;++a)y.addLine(a-1,a);y.addLine(i,n),n=i+1}for(n=o,h=0;h<s;++h){for(i=o+r[h],a=n+1;a<=i;++a)y.addLine(a-1,a);y.addLine(i,n),n=i+1}for(h=0;h<s;++h)for(a=r[h];0<=a;--a)y.addLine(a+d,a+o)}}}function T(t,e,r){var n,i,a,o,s,d,h,l,c,u,p=t.length,f=[0,0,-1],m=y.defaultNormal;for(v.applyVectorTransformToArray(f),y.defaultNormal=f.slice(),a=y.addVertex(D(t[0][0],t[0][1])),s=1;s<p;++s)y.addVertex(D(t[s][0],t[s][1]));for(pd3D.VectorArray.negate(f),y.defaultNormal=f.slice(),o=y.addVertex(b(t[0][0],t[0][1])),s=1;s<p;++s)y.addVertex(b(t[s][0],t[s][1]));for(p=e.length,s=0;s<p;++s)y.addTriangle(a+e[s][2],a+e[s][1],a+e[s][0]),3<e[s].length&&y.addTriangle(a+e[s][3],a+e[s][2],a+e[s][0]),y.addTriangle(o+e[s][0],o+e[s][1],o+e[s][2]),3<e[s].length&&y.addTriangle(o+e[s][0],o+e[s][2],o+e[s][3]);for(s=0;s<p;++s)y.addTriangle(a+e[s][2],a+e[s][1],a+e[s][0]),3<e[s].length&&y.addTriangle(a+e[s][3],a+e[s][2],a+e[s][0]),y.addTriangle(o+e[s][0],o+e[s][1],o+e[s][2]),3<e[s].length&&y.addTriangle(o+e[s][0],o+e[s][2],o+e[s][3]);if(r){for(n=0,p=r.length,s=0;s<p;++s){for(i=r[s],d=n+1;d<=i;++d)h=D(t[d-1][0],t[d-1][1]),l=D(t[d][0],t[d][1]),c=b(t[d][0],t[d][1]),u=b(t[d-1][0],t[d-1][1]),pd3D.VectorArray.calcNormalFromTriangle(f,h,l,c),y.defaultNormal=f.slice(),y.addTriangle(y.addVertex(h),y.addVertex(l),y.addVertex(c)),y.addTriangle(y.addVertex(h),y.addVertex(c),y.addVertex(u));h=D(t[i][0],t[i][1]),l=D(t[n][0],t[n][1]),c=b(t[n][0],t[n][1]),u=b(t[i][0],t[i][1]),pd3D.VectorArray.calcNormalFromTriangle(f,h,l,c),y.defaultNormal=f.slice(),y.addTriangle(y.addVertex(h),y.addVertex(l),y.addVertex(c)),y.addTriangle(y.addVertex(h),y.addVertex(c),y.addVertex(u)),n=i+1}if(g){for(n=a,s=0;s<p;++s){for(i=a+r[s],d=n+1;d<=i;++d)y.addLine(d-1,d);y.addLine(i,n),n=i+1}for(n=o,s=0;s<p;++s){for(i=o+r[s],d=n+1;d<=i;++d)y.addLine(d-1,d);y.addLine(i,n),n=i+1}for(s=0;s<p;++s)for(d=r[s];0<=d;--d)y.addLine(d+a,d+o)}}y.defaultNormal=m}function A(t){var e,r,n,i=t.length,a=!1,o=!1,s=H,d=j,h=0;(Z=0)<i&&97<=(n=t.charCodeAt(0))&&n<123&&(o=!0);for(var l=0;l<i;l++){O=N=0,r=a,a=o,o=l<i-(e=U=1)&&(97<=(n=t.charCodeAt(l+1))&&n<123);t.charAt(l);switch(t.charAt(l)){default:S=.25*Y,N=X[1]+pd.mapAndConstrainTo(B,0,.3,.2,.1),$([[K[0],X[0]],[K[9],X[0]],[K[9],X[14]],[K[0],X[14]],[K[1],X[1]],[K[8],X[1]],[K[8],X[13]],[K[0],X[13]]],[[0,1,7,4],[1,2,6,7],[2,3,5,6],[3,0,4,5]],[3,7]);break;case" ":e=G;break;case"\f":h=veryClose(h,0)?.15:0,H=s+h,e=0;break;case"!":N=X[1]+pd.mapAndConstrainTo(B,0,.3,.2,.1),$([[K[0],X[0]],[K[1],X[0]],[K[1],X[1]],[K[0],X[1]],[K[0],N],[K[1],N],[K[1],X[14]],[K[0],X[14]]],[[0,1,2,3],[4,5,6,7]],[3,7]),e=B/Y;break;case'"':S=K[1]+.1,$([[K[0],X[13]],[K[0]+F,X[13]-B],[K[1],X[13]],[K[1],X[14]],[K[0],X[14]],[S,X[13]],[S+F,X[13]-B],[S+B,X[13]],[S+B,X[14]],[S,X[14]]],[[0,1,2],[0,2,3,4],[5,6,7],[6,7,8,9]],[4,9]),e=B/Y*2+.1;break;case"'":$([[K[0],X[13]],[K[0]+F,X[13]-B],[K[1],X[13]],[K[1],X[14]],[K[0],X[14]]],[[0,1,2],[0,2,3,4]],[4]),e=B/Y;break;case"#":O=pd.mapAndConstrainTo(Y,0,5,0,.2*Y),N=pd.mapAndConstrainTo(B,0,.3,.2,.05);var c=.3*Y,u=Math.atan(1/c),p=B/Math.sin(u),f=Math.cos(u),m=X[7]-N,g=X[7]-N-B,y=X[7]+N+B,v=X[7]+N,D=m*f,b=g*f,x=y*f,M=v*f,T=X[14]*f,A=pd.mapAndConstrainTo(Y,0,2,0,O+N),w=K[0]+O,c=K[0]+A,f=K[9]-A-T-p,A=K[9]-O;$([[c,X[0]],[c+p,X[0]],[c+b+p,g],[f+b,g],[f,X[0]],[f+p,X[0]],[f+b+p,g],[A,g],[A,m],[f+D+p,m],[f+M+p,v],[A,v],[A,y],[f+x+p,y],[f+T+p,X[14]],[f+T,X[14]],[f+x,y],[c+x+p,y],[c+T+p,X[14]],[c+T,X[14]],[c+x,y],[w,y],[w,v],[c+M,v],[c+D,m],[w,m],[w,g],[c+b,g],[c+D+p,m],[c+M+p,v],[f+M,v],[f+D,m]],[[0,1,2,27],[3,4,5,6],[9,10,30,31],[13,14,15,16],[17,18,19,20],[23,24,28,29],[26,7,8,25],[22,11,12,21]],[27,31]);break;case"$":$([[K[2],X[0]],[K[4],X[0]],[K[4],X[0]-.2],[K[5],X[0]-.2],[K[5],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[5]],[K[7],X[8]],[K[3],X[8]],[K[1],X[10]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[9],X[11]],[K[9],X[12]],[K[7],X[14]],[K[5],X[14]],[K[5],X[14]+.2],[K[4],X[14]+.2],[K[4],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[9]],[K[2],X[6]],[K[6],X[6]],[K[8],X[4]],[K[8],X[3]],[K[6],X[1]],[K[3],X[1]],[K[1],X[3]],[K[0],X[3]],[K[0],X[2]]],[[0,5,29,30],[5,6,28,29],[6,7,27,28],[7,8,26,27],[8,9,25,26],[9,10,24,25],[10,11,23,24],[11,12,22,23],[12,13,17,22],[13,14,16,17],[14,15,16],[30,31,33,0],[31,32,33],[1,2,3,4],[18,19,20,21]],[33]);break;case"%":var O,V=Math.min(.15,B),C=pd.mapAndConstrainTo(B,0,.2,.05,.15),S=K[9]-1.5*C,N=(O=F/Math.sin(Math.atan(1/Y)))/Y;$([[K[0],X[0]],[K[0]+O,X[0]],[K[9],X[14]-N],[K[9],X[14]],[K[9]-O,X[14]],[K[0],X[0]+N],[S-(O=1.5*C),(N=X[0]+1.5*C)-O],[S+O,N-O],[S+O,N+O],[S-O,N+O],[S-(O-=V),N-O],[S-O,N+O],[S+O,N+O],[S+O,N-O],[(S=K[0]+1.5*C)-(O=1.5*C),(N=X[14]-1.5*C)-O],[S+O,N-O],[S+O,N+O],[S-O,N+O],[S-(O-=V),N-O],[S-O,N+O],[S+O,N+O],[S+O,N-O]],[[0,1,5],[1,2,4,5],[2,3,4],[6,7,13,10],[7,8,12,13],[8,9,11,12],[9,6,10,11],[14,15,21,18],[15,16,20,21],[16,17,19,20],[17,14,18,19]],[5,9,13,17,21]);break;case"&":S=K[4],O=Math.min(K[4]-.05,K[0]+Math.max(0,X[9]-.5)),$([[S,X[0]-.2],[S+B,X[0]-.2],[S+B,X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[3]],[K[8],X[3]],[K[6],X[1]],[S+B,X[1]],[S+B,X[6]],[K[6],X[6]],[K[6],X[8]],[S+B,X[8]],[S+B,X[13]],[K[6]-O,X[13]],[K[8]-O,X[11]],[K[9]-O,X[11]],[K[9]-O,X[12]],[K[7]-O,X[14]],[S+B,X[14]],[S+B,X[14]+.2],[S,X[14]+.2],[S,X[14]],[K[2]+O,X[14]],[K[0]+O,X[12]],[K[0]+O,X[7]],[K[0],X[5]],[K[0],X[2]],[K[2],X[0]],[S,X[0]],[K[3],X[1]],[K[1],X[3]],[K[1],X[4]],[K[3],X[6]],[S,X[6]],[S,X[1]],[K[3],X[8]],[K[1]+O,X[11]],[K[3]+O,X[13]],[S,X[13]],[S,X[8]]],[[0,1,20,21],[2,3,7,8],[3,4,6,7],[4,5,6],[9,10,11,12],[13,14,18,19],[14,15,17,18],[15,16,17],[22,23,38,39],[23,24,37,38],[24,25,36,37],[25,33,36],[33,34,40,36],[25,26,32,33],[26,27,31,32],[27,28,30,31],[28,29,35,30]],[29,35,40]);break;case"(":O=(N=.2)*Y,$([[K[1]+O,X[0]-N],[K[1],X[2]],[K[1],X[12]],[K[1]+O,X[14]+N],[K[0],X[12]],[K[0],X[2]]],[[0,1,5],[1,2,4,5],[2,3,4]],[5]),e=B/Y+.2;break;case")":N=.2,O=K[1]-K[0],S=K[1]+.2*Y,$([[K[0],X[0]-N],[S,X[2]],[S,X[12]],[K[0],X[14]+N],[S-O,X[12]],[S-O,X[2]]],[[0,1,5],[1,2,4,5],[2,3,4]],[5]),e=B/Y+.2;break;case"*":var k=pd.mapAndConstrainTo(B,.1,.3,.1,X[0]),I=pd.mapAndConstrainTo(B,.1,.3,.9,X[14]),P=pd.mapAndConstrainTo(Y,0,5,0,.2*Y),E=K[9]-P,_=K[0]+P,u=Math.atan((E-_)/((I-k)*Y));O=F/Math.sin(u),N=F/Math.cos(u),$([[K[4],k],[K[5],k],[K[5],X[6]-N],[E-O,k],[E,k],[E,k+N],[K[5]+O,X[6]],[E,X[6]],[E,X[8]],[K[5]+O,X[8]],[E,I-N],[E,I],[E-O,I],[K[5],X[8]+N],[K[5],I],[K[4],I],[K[4],X[8]+N],[_+O,I],[_,I],[_,I-N],[K[4]-O,X[8]],[_,X[8]],[_,X[6]],[K[4]-O,X[6]],[_,k+N],[_,k],[_+O,k],[K[4],X[6]-N]],[[0,1,2,27],[2,3,5,6],[3,4,5],[6,7,8,9],[9,10,12,13],[10,11,12],[13,14,15,16],[16,17,19,20],[17,18,19],[20,21,22,23],[23,24,26,27],[24,25,26],[27,16,20,23],[2,13,16,27],[2,6,9,13]],[27]);break;case"+":k=pd.mapAndConstrainTo(B,.1,.3,.1,X[0]),I=pd.mapAndConstrainTo(B,.1,.3,.9,X[14]);O=pd.mapAndConstrainTo(Y,0,5,0,.2*Y),$([[K[4],k],[K[5],k],[K[5],X[6]],[S=K[9]-O,X[6]],[S,X[8]],[K[5],X[8]],[K[5],I],[K[4],I],[K[4],X[8]],[S=K[0]+O,X[8]],[S,X[6]],[K[4],X[6]]],[[1,6,7,0],[2,3,4,5],[8,9,10,11]],[11]);break;case"-":O=pd.mapAndConstrainTo(Y,0,5,.1*Y,.3*Y),$([[K[0]+O,X[6]],[S=K[9]-O,X[6]],[S,X[8]],[K[0]+O,X[8]]],[[0,1,2,3]],[3]);break;case",":S=F,N=X[1]+pd.mapAndConstrainTo(B,0,.3,.2,.1),(r||o)&&(U=z),$([[K[0],X[0]],[K[0]+F,X[0]],[K[0]+F,X[0]-B],[K[1],X[0]],[K[1],X[1]],[K[0],X[1]]],[[0,3,4,5],[1,2,3]],[5]),e=B/Y;break;case".":S=.25*Y,N=X[1]+pd.mapAndConstrainTo(B,0,.3,.2,.1),(r||o)&&(U=z),$([[K[0],X[0]],[X[1],X[0]],[K[1],X[1]],[K[0],X[1]]],[[0,1,2,3]],[3]),e=B/Y;break;case"/":N=(O=F/Math.sin(Math.atan(1/Y)))/Y,$([[K[0],X[0]-.2],[K[0]+O,X[0]-.2],[K[9],X[14]+.2-N],[K[9],X[14]+.2],[K[9]-O,X[14]+.2],[K[0],X[0]-.2+N]],[[0,1,5],[1,2,4,5],[2,3,4]],[5]);break;case"0":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[2]],[K[3],X[1]],[K[1],X[3]],[K[8],X[11]-B],[K[8],X[3]],[K[6],X[1]],[K[1],X[3]+B],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]]],[[0,1,12,8],[1,2,11,12],[2,3,17,11],[3,4,16,17],[4,5,15,16],[5,6,14,15],[6,7,9,14],[7,0,8,9],[9,10,17,13]],[7,12,17]);break;case"1":$([[O=.25*Y-F,N=X[0]],[O+=B,N],[O,N=X[14]],[O-=B,N],[O-=B,N=X[13]],[O+=B,N]],[[0,1,2,3],[3,4,5]],[5]),e=.5;break;case"2":$([[K[0],X[0]],[K[9],X[0]],[K[9],X[1]],[K[1],X[1]],[K[1],X[4]],[K[3],X[6]],[K[7],X[6]],[K[9],X[9]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[11]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[10]],[K[6],X[8]],[K[2],X[8]],[K[0],X[5]]],[[0,1,2,3],[3,4,20,0],[4,5,19,20],[5,6,18,19],[6,7,17,18],[7,8,16,17],[8,9,15,16],[9,10,14,15],[10,11,13,14],[11,12,13]],[20]);break;case"3":$([[K[0],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[5]],[K[9]-Math.max(0,X[9]-.5),X[7]],[K[9],X[9]],[K[9],X[12]],[K[7],X[14]],[K[0],X[14]],[K[0]+K[10],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[10]],[K[6],X[8]],[.5*Y,X[8]],[.5*Y,X[6]],[K[6],X[6]],[K[8],X[4]],[K[8],X[3]],[K[6],X[1]],[K[0]+K[10],X[1]]],[[0,1,19,20],[1,2,18,19],[2,3,17,18],[3,4,16,17],[4,13,16],[13,14,15,16],[4,5,12,13],[5,6,11,12],[6,7,10,11],[7,8,9,10]],[20]);break;case"4":S=.7*Y,O=B/Math.sin(Math.atan(1/Y)),N=B/Y,$([[S-F,X[0]],[S+F,X[0]],[S+F,.35-F],[K[9],.35-F],[K[9],.35+F],[S+F,.35+F],[S+F,X[14]],[S+F-O,X[14]],[K[0],.35+F],[K[0],.35-F],[S-F,.35-F],[K[0]+O,.35+F],[S-F,X[14]-N],[S-F,.35+F]],[[0,1,6,12],[7,8,11,6],[9,10,13,8],[2,3,4,5]],[10,13]);break;case"5":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[5]],[K[7],X[8]],[K[1],X[8]],[K[1],X[13]],[K[9]-K[10],X[13]],[K[9],X[14]],[K[0],X[14]],[K[0],X[6]],[K[6],X[6]],[K[8],X[4]],[K[8],X[3]],[K[6],X[1]],[K[3],X[1]],[K[1],X[3]],[K[0],X[3]],[K[0],X[2]]],[[0,1,14,15],[1,2,13,14],[2,3,12,13],[3,4,11,12],[4,5,10,11],[5,6,9,10],[6,7,8,9],[0,15,16,18],[16,17,18]],[18]);break;case"6":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[5]],[K[7],X[8]],[K[1],X[8]],[K[1],X[11]],[K[3],X[13]],[K[9]-K[10],X[13]],[K[9],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[2]],[K[3],X[1]],[K[1],X[3]],[K[1],X[6]],[K[6],X[6]],[K[8],X[4]],[K[8],X[3]],[K[6],X[1]]],[[0,1,19,13],[1,2,18,19],[2,3,17,18],[3,4,16,17],[4,5,15,16],[0,13,14,12],[12,14,6,11],[6,7,10,11],[7,8,9,10]],[12,19]);break;case"7":$([[K[8]-q,X[0]],[K[9]-q,X[0]],[K[9],X[14]],[K[0],X[14]],[K[0]+K[10],X[13]],[K[8],X[13]]],[[0,1,2,5],[2,3,4,5]],[5]);break;case"8":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[5]],[K[9]-Math.max(0,X[9]-.5),X[7]],[K[9],X[9]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[9]],[K[0]+Math.max(0,X[9]-.5),X[7]],[K[0],X[5]],[K[0],X[2]],[K[3],X[1]],[K[1],X[3]],[K[1],X[4]],[K[3],X[6]],[K[6],X[6]],[K[8],X[4]],[K[8],X[3]],[K[6],X[1]],[K[3],X[8]],[K[1],X[10]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[10]],[K[6],X[8]]],[[0,1,21,14],[1,2,20,21],[2,3,19,20],[3,4,18,19],[4,29,18],[18,29,22,17],[4,5,28,29],[5,6,27,28],[6,7,26,27],[7,8,25,26],[8,9,24,25],[9,10,23,24],[10,11,22,23],[11,17,22],[11,12,16,17],[12,13,15,16],[13,0,14,15]],[13,21,29]);break;case"9":$([[K[0],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[9]],[K[2],X[6]],[K[8],X[6]],[K[8],X[3]],[K[6],X[1]],[K[0]+K[10],X[1]],[K[3],X[8]],[K[1],X[10]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[8]]],[[0,1,11,12],[1,2,10,11],[2,3,18,10],[3,4,17,18],[4,5,16,17],[5,6,15,16],[6,7,14,15],[7,8,13,14],[8,9,19,13]],[12,19]);break;case":":N=pd.mapAndConstrainTo(B,0,.3,.2,.05),(r||o)&&(U=z),$([[K[0],X[7]-N-B],[K[1],X[7]-N-B],[K[1],X[7]-N],[K[0],X[7]-N],[K[0],X[7]+N],[K[1],X[7]+N],[K[1],X[7]+N+B],[K[0],X[7]+N+B]],[[0,1,2,3],[4,5,6,7]],[3,7]),e=B/Y;break;case";":N=pd.mapAndConstrainTo(B,0,.3,.2,.05),(r||o)&&(U=z),$([[K[0],X[7]-N-B],[K[0]+F,X[7]-N-B],[K[0]+F,X[7]-N-B-B],[K[1],X[7]-N-B],[K[1],X[7]-N],[K[0],X[7]-N],[K[0],X[7]+N],[K[1],X[7]+N],[K[1],X[7]+N+B],[K[0],X[7]+N+B]],[[0,3,4,5],[1,2,3],[6,7,8,9]],[5,9]),e=B/Y;break;case"<":O=B/Math.sin(Math.atan(1/Y)),$([[f=.75*Y-(N=.5*O),.1],[f+O,.1],[(c=.25*Y-N)+O,.5],[f+O,.9],[f,.9],[c,.5]],[[1,2,5,0],[2,3,4,5]],[5]);break;case"=":O=pd.mapAndConstrainTo(Y,0,5,0,.2*Y),N=pd.mapAndConstrainTo(B,0,.3,.2,.05),$([[K[0]+O,X[7]-N-B],[S=K[9]-O,X[7]-N-B],[S,X[7]-N],[S=K[0]+O,X[7]-N],[S,X[7]+N],[S=K[9]-O,X[7]+N],[S,X[7]+N+B],[K[0]+O,X[7]+N+B]],[[0,1,2,3],[4,5,6,7]],[3,7]);break;case">":O=B/Math.sin(Math.atan(1/Y)),$([[c=.25*Y-(N=.5*O),.1],[c+O,.1],[(f=.75*Y-N)+O,.5],[c+O,.9],[c,.9],[f,.5]],[[1,2,5,0],[2,3,4,5]],[5]);break;case"?":N=Math.min(X[6],X[1]+pd.mapAndConstrainTo(B,0,.3,.2,.1)),$([[K[4],X[0]],[K[5],X[0]],[K[5],X[1]],[K[4],X[1]],[K[4],N],[K[5],N],[K[5],X[6]],[K[7],X[6]],[K[9],X[9]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[11]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[10]],[K[6],X[8]],[K[4],X[8]]],[[0,1,2,3],[4,5,6,20],[6,7,19,20],[7,8,18,19],[8,9,17,18],[9,10,16,17],[10,11,15,16],[11,12,14,15],[12,13,14]],[3,20]);break;case"@":S=.5*Y,N=pd.mapAndConstrainTo(B,0,.3,.2,.05);m=Math.min(S,K[1]+N+B),P=Math.max(S,K[8]-N-B),E=Math.min(X[7],X[1]+N+B),_=Math.max(X[7],X[13]-N-B);$([[K[2],X[0]],[K[9],X[0]],[K[9]-K[10],X[1]],[K[3],X[1]],[K[1],X[3]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[1]+N+B],[P+B,E],[P+B,_+B],[m-B,_+B],[m-B,E-B],[K[9],E-B],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[2]],[m,E],[m,_],[P,_],[P,E]],[[0,1,2,3],[3,4,19,0],[4,5,18,19],[5,6,17,18],[6,7,16,17],[7,8,15,16],[8,9,14,15],[9,20,13,14],[10,11,22,23],[11,12,21,22],[12,13,20,21]],[19,23]);break;case"a":U=z;case"A":$([[K[0],X[0]],[K[1],X[0]],[K[1],X[6]],[K[8],X[6]],[K[8],X[0]],[K[9],X[0]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[1],X[8]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[8]]],[[4,5,6,14],[6,7,13,14],[7,8,12,13],[8,9,11,12],[9,0,1,11],[2,3,15,10]],[9,15]);break;case"b":U=z;case"B":$([[K[0],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[5]],[K[9]-Math.max(0,X[9]-.5),X[7]],[K[9],X[9]],[K[9],X[12]],[K[7],X[14]],[K[0],X[14]],[K[1],X[1]],[K[1],X[6]],[K[6],X[6]],[K[8],X[4]],[K[8],X[3]],[K[6],X[1]],[K[1],X[8]],[K[1],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[10]],[K[6],X[8]]],[[0,1,14,9],[1,2,13,14],[2,3,12,13],[3,4,11,12],[4,20,11],[4,5,19,20],[5,6,18,19],[6,7,17,18],[7,8,16,17],[8,0,9,16],[10,11,20,15]],[8,14,20]);break;case"c":U=z;case"C":$([[K[2],X[0]],[K[9],X[0]],[K[9]-K[10],X[1]],[K[3],X[1]],[K[1],X[3]],[K[1],X[11]],[K[3],X[13]],[K[9]-K[10],X[13]],[K[9],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[2]]],[[2,3,0,1],[3,4,11,0],[4,5,10,11],[5,6,9,10],[6,7,8,9]],[11]);break;case"d":U=z;case"D":$([[K[0],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[12]],[K[7],X[14]],[K[0],X[14]],[K[1],X[1]],[K[1],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[3]],[K[6],X[1]]],[[0,1,11,6],[1,2,10,11],[2,3,9,10],[3,4,8,9],[4,5,7,8],[5,0,6,7]],[5,11]);break;case"e":U=z;case"E":$([[K[0],X[0]],[K[9],X[0]],[K[9]-K[10],X[1]],[K[1],X[1]],[K[1],X[6]],[K[5],X[6]],[K[5],X[8]],[K[1],X[8]],[K[1],X[13]],[K[9]-K[10],X[13]],[K[9],X[14]],[K[0],X[14]]],[[2,3,0,1],[3,8,11,0],[8,9,10,11],[4,5,6,7]],[11]);break;case"f":U=z;case"F":$([[K[0],X[0]],[K[1],X[0]],[K[1],X[6]],[K[5],X[6]],[K[5],X[8]],[K[1],X[8]],[K[1],X[13]],[K[9]-K[10],X[13]],[K[9],X[14]],[K[0],X[14]]],[[0,1,6,9],[6,7,8,9],[2,3,4,5]],[9]);break;case"g":U=z;case"G":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[8]],[Math.min(K[8],K[5]),X[8]],[Math.min(K[8],K[5]),X[6]],[K[8],X[6]],[K[8],X[3]],[K[6],X[1]],[K[3],X[1]],[K[1],X[3]],[K[1],X[11]],[K[3],X[13]],[K[9]-K[10],X[13]],[K[9],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[2]]],[[0,1,8,9],[1,2,7,8],[2,3,6,7],[3,4,5,6],[9,10,17,0],[10,11,16,17],[11,12,15,16],[12,13,14,15]],[17]);break;case"h":U=z;case"H":$([[K[0],X[0]],[K[1],X[0]],[K[1],X[6]],[K[8],X[6]],[K[8],X[0]],[K[9],X[0]],[K[9],X[14]],[K[8],X[14]],[K[8],X[8]],[K[1],X[8]],[K[1],X[14]],[K[0],X[14]]],[[0,1,10,11],[2,3,8,9],[4,5,6,7]],[11]);break;case"i":U=z;case"I":S=.5*Math.max(.5*Y,1.25*B),N=Math.min(.5*(S-F),B),$([[O=S-F-N,X[0]],[O+=B+N+N,X[0]],[O,X[1]],[O-=N,X[1]],[O,X[13]],[O+=N,X[13]],[O,X[14]],[O-=B+N+N,X[14]],[O,X[13]],[O+=N,X[13]],[O,X[1]],[O-=N,X[1]]],[[0,1,2,11],[3,4,9,10],[6,7,8,5]],[11]),e=Math.max(.5,1.25*B/Y);break;case"j":U=z;case"J":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[14]],[K[4],X[14]],[K[4],X[13]],[K[8],X[13]],[K[8],X[3]],[K[6],X[1]],[K[3],X[1]],[K[1],X[3]],[K[0],X[3]],[K[0],X[2]]],[[0,1,8,9],[1,2,7,8],[2,3,6,7],[3,4,5,6],[9,10,12,0],[10,11,12]],[12]);break;case"k":U=z;case"K":var L=.5/(Y-(S=.5*Y));O=B/Math.sin(Math.atan(L)),N=(.5-F)/L,K[9]-O-N<K[1]&&(S=K[1]+(O-B/(2*L)),N=K[9]-O-K[1]),$([[K[0],X[0]],[K[1],X[0]],[K[1],X[6]],[K[9]-O-N,X[6]],[Math.max(K[1],K[9]-O),X[0]],[K[9],X[0]],[S,X[7]],[K[9],X[14]],[Math.max(K[1],K[9]-O),X[14]],[K[9]-O-N,X[8]],[K[1],X[8]],[K[1],X[14]],[K[0],X[14]]],[[0,1,11,12],[2,3,9,10],[3,6,9],[3,4,5,6],[6,7,8,9]],[12]);break;case"l":U=z;case"L":$([[K[0],X[0]],[K[9],X[0]],[K[9]-K[10],X[1]],[K[1],X[1]],[K[1],X[14]],[K[0],X[14]]],[[0,1,2,3],[3,4,5,0]],[5]);break;case"m":U=z;case"M":S=.5*Y,O=Math.atan((S-B)/(.5-F)),N=pd.constrainTo(B/Math.sin(O),0,.75),$([[K[0],X[0]],[K[1],X[0]],[K[1],X[14]-N],[S,X[8]>N?X[8]-N:X[0]],[K[8],X[14]-N],[K[8],X[0]],[K[9],X[0]],[K[9],X[14]],[K[8],X[14]],[S,X[8]>N?X[8]:X[0]+N],[K[1],X[14]],[K[0],X[14]]],[[1,10,11,0],[2,3,9,10],[3,4,8,9],[8,5,6,7]],[11]);break;case"n":U=z;case"N":O=Math.atan(1/Y),N=B/Math.cos(O),$([[K[0],X[0]],[K[1],X[0]],[K[1],X[14]-N],[K[8],X[0]],[K[9],X[0]],[K[9],X[14]],[K[8],X[14]],[K[8],X[0]+N],[K[1],X[14]],[K[0],X[14]]],[[1,8,9,0],[2,3,7,8],[4,5,6,3]],[9]);break;case"o":U=z;case"O":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[2]],[K[3],X[1]],[K[1],X[3]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[3]],[K[6],X[1]]],[[0,1,15,8],[1,2,14,15],[2,3,13,14],[3,4,12,13],[4,5,11,12],[5,6,10,11],[6,7,9,10],[7,0,8,9]],[7,15]);break;case"p":U=z;case"P":$([[K[0],X[0]],[K[1],X[0]],[K[1],X[6]],[K[7],X[6]],[K[9],X[9]],[K[9],X[12]],[K[7],X[14]],[K[0],X[14]],[K[1],X[8]],[K[1],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[10]],[K[6],X[8]]],[[0,1,9,7],[2,3,13,8],[3,4,12,13],[4,5,11,12],[5,6,10,11],[6,7,9,10]],[7,13]);break;case"q":U=z;case"Q":O=.1*Y,$([[K[2],X[0]],[K[9],X[0]],[Math.max(K[9]-O,K[9]-K[10]),X[1]],[K[9]-O,X[1]],[K[9]-O,X[12]],[K[7]-O,X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[2]],[K[3],X[1]],[K[1],X[3]],[K[1],X[11]],[K[3],X[13]],[K[6]-O,X[13]],[K[8]-O,X[11]],[K[8]-O,X[1]]],[[0,1,2,9],[3,4,14,15],[4,5,13,14],[5,6,12,13],[6,7,11,12],[7,8,10,11],[8,0,9,10]],[8,15]);break;case"r":U=z;case"R":L=(.5-F)/(Y-(S=.6*Y+F));O=B/Math.sin(Math.atan(L)),N=(.5-F)/L,K[9]-O-N<K[1]&&(S=K[1]+(O-B/(2*L)),N=K[9]-O-K[1]),$([[K[0],X[0]],[K[1],X[0]],[K[1],X[6]],[Math.max(K[1],S-O),X[6]],[Math.max(K[1],K[9]-O),X[0]],[K[9],X[0]],[S>K[7]?K[7]:S,X[6]],[K[7],X[6]],[K[9],X[9]],[K[9],X[12]],[K[7],X[14]],[K[0],X[14]],[K[1],X[8]],[K[1],X[13]],[K[6],X[13]],[K[8],X[11]],[K[8],X[10]],[K[6],X[8]]],[[0,1,13,11],[2,7,17,12],[3,4,5,6],[7,8,16,17],[8,9,15,16],[9,10,14,15],[10,11,13,14]],[11,17]);break;case"s":U=z;case"S":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[5]],[K[7],X[8]],[K[3],X[8]],[K[1],X[10]],[K[1],X[11]],[K[3],X[13]],[K[6],X[13]],[K[8],X[11]],[K[9],X[11]],[K[9],X[12]],[K[7],X[14]],[K[2],X[14]],[K[0],X[12]],[K[0],X[9]],[K[2],X[6]],[K[6],X[6]],[K[8],X[4]],[K[8],X[3]],[K[6],X[1]],[K[3],X[1]],[K[1],X[3]],[K[0],X[3]],[K[0],X[2]]],[[0,1,21,22],[1,2,20,21],[2,3,19,20],[3,4,18,19],[4,5,17,18],[5,6,16,17],[6,7,15,16],[7,8,14,15],[8,9,13,14],[9,10,12,13],[10,11,12],[22,23,25,0],[23,24,25]],[25]);break;case"t":U=z;case"T":$([[K[4],X[0]],[K[5],X[0]],[K[5],X[13]],[K[9],X[13]],[K[9],X[14]],[K[0],X[14]],[K[0],X[13]],[K[4],X[13]]],[[0,1,2,7],[4,5,6,3]],[7]);break;case"u":U=z;case"U":$([[K[2],X[0]],[K[7],X[0]],[K[9],X[2]],[K[9],X[14]],[K[8],X[14]-K[10]],[K[8],X[3]],[K[6],X[1]],[K[3],X[1]],[K[1],X[3]],[K[1],X[14]-K[10]],[K[0],X[14]],[K[0],X[2]]],[[0,1,6,7],[1,2,5,6],[2,3,4,5],[7,8,11,0],[8,9,10,11]],[11]);break;case"v":U=z;case"V":S=.5*Y;u=Math.atan(S);O=Math.min(S,B/Math.cos(u)),N=Math.min(X[13],B/Math.sin(u)),$([[S,X[0]],[K[9],X[14]],[K[9]-O,X[14]],[S,X[0]+N],[K[0]+O,X[14]],[K[0],X[14]]],[[0,1,2,3],[0,3,4,5]],[5]);break;case"w":U=z;case"W":S=.5*Y,O=Math.atan((S-B)/(.5-F));var R=(N=pd.constrainTo(B/Math.sin(O),0,.75))*q;$([[K[0]+q,X[0]],[Math.min(S,K[1]+q),X[0]],[S,X[8]>N?X[6]:X[14]-N],[Math.max(S,K[8]-q),X[0]],[K[9]-q,X[0]],[K[9],X[14]],[K[8],X[14]],[Math.max(S,K[8]-q)+R,X[0]+N],[S,X[8]>N?X[6]+N:X[14]],[Math.min(S,K[1]+q)-R,X[0]+N],[K[1],X[14]],[K[0],X[14]]],[[0,1,9],[0,9,11],[9,10,11],[1,2,8,9],[2,3,7,8],[3,4,7],[4,7,5],[5,6,7]],[11]);break;case"x":U=z;case"X":S=.5*Y,N=(O=F/Math.sin(Math.atan(1/Y)))/Y,$([[K[0],X[0]],[K[0]+O,X[0]],[S,X[7]-N],[K[9]-O,X[0]],[K[9],X[0]],[K[9],X[0]+N],[S+O,X[7]],[K[9],X[14]-N],[K[9],X[14]],[K[9]-O,X[14]],[S,X[7]+N],[K[0]+O,X[14]],[K[0],X[14]],[K[0],X[14]-N],[S-O,X[7]],[K[0],X[0]+N]],[[0,1,15],[1,2,14,15],[2,3,5,6],[3,4,5],[6,7,9,10],[7,8,9],[10,11,13,14],[11,12,13],[2,6,10,14]],[15]);break;case"y":U=z;case"Y":S=.5*Y;R=1/Y*(K[4]-K[0]);N=(O=F/Math.sin(Math.atan(1/Y)))/Y,$([[K[4],X[0]],[K[5],X[0]],[K[5],X[14]-R-N],[K[9],X[14]-N],[K[9],X[14]],[K[9]-O,X[14]],[S,X[7]+N],[K[0]+O,X[14]],[K[0],X[14]],[K[0],X[14]-N],[K[4],X[14]-R-N]],[[2,6,10],[0,1,2,10],[2,3,5,6],[3,4,5],[6,7,9,10],[7,8,9]],[10]);break;case"z":U=z;case"Z":O=Math.atan(1/Y),N=B/Math.sin(O),$([[K[0],X[0]],[K[9],X[0]],[K[9],X[1]],[K[0]+N,X[1]],[K[9],X[13]],[K[9],X[14]],[K[0],X[14]],[K[0],X[13]],[K[9]-N,X[13]],[K[0],X[1]]],[[0,1,2,9],[3,4,8,9],[5,6,7,4]],[9]);break;case"\\":N=(O=F/Math.sin(Math.atan(1/Y)))/Y,$([[K[9]-O,X[0]-.2],[K[9],X[0]-.2],[K[9],X[0]-.2+N],[K[0]+O,X[14]+.2],[K[0],X[14]+.2],[K[0],X[14]+.2-N]],[[0,1,2],[2,3,5,0],[3,4,5]],[5]);break;case"[":O=(N=.2)*Y,$([[K[0],X[0]-N],[K[1]+O,X[0]-N],[K[1]+O,X[1]-N],[K[1],X[1]-N],[K[1],X[13]+N],[K[1]+O,X[13]+N],[K[1]+O,X[14]+N],[K[0],X[14]+N]],[[0,1,2,3],[3,4,7,0],[4,5,6,7]],[7]),e=B/Y+.2;break;case"]":N=.2,O=K[1]-K[0],S=K[1]+.2*Y,$([[K[0],X[0]-N],[S,X[0]-N],[S,X[14]+N],[K[0],X[14]+N],[K[0],X[13]+N],[S-O,X[13]+N],[S-O,X[1]-N],[K[0],X[1]-N]],[[0,1,6,7],[1,2,5,6],[2,3,4,5]],[7]),e=B/Y+.2;break;case"^":S=.5*Y;u=Math.atan(Y);O=B/Math.cos(u),N=B/Math.sin(u),$([[K[0],X[7]],[K[0]+O,X[7]],[S,Math.max(X[7],X[14]-N)],[K[9]-O,X[7]],[K[9],X[7]],[S,X[14]]],[[1,2,5,0],[2,3,4,5]],[5]);break;case"_":S=.25*Y,N=X[0]-F,$([[K[0],X[0]],[K[9],X[0]],[K[9],X[1]],[K[0],X[1]]],[[0,1,2,3]],[3]);break;case"°":case"°":case"`":S=.25*Y;V=Math.min(.15,B),C=pd.mapAndConstrainTo(B,0,.2,.05,.15);N=X[14]-1.5*C,$([[S-(O=1.5*C),N-O],[S+O,N-O],[S+O,N+O],[S-O,N+O],[S-(O-=V),N-O],[S-O,N+O],[S+O,N+O],[S+O,N-O]],[[0,1,7,4],[1,2,6,7],[2,3,5,6],[3,0,4,5]],[3,7]),e=.5;break;case"{":N=.2,O=pd.mapAndConstrainTo(Y,0,5,.25*Y,.1*Y),O=B+Math.max(.1/Y,O),S=.25*Y-.5*O+.5*Math.max(.1,B),$([[S+O,X[0]-N],[S+B,X[2]],[S+B,X[5]],[S-Math.max(.1,B)+B,X[7]],[S+B,X[9]],[S+B,X[12]],[S+O,X[14]+N],[S,X[12]],[S,X[10]],[S-Math.max(.1,B),X[7]],[S,X[4]],[S,X[2]]],[[0,1,11],[1,2,10,11],[2,3,9,10],[3,4,8,9],[4,5,7,8],[5,6,7]],[11]),e=.5;break;case"|":N=.2,$([[(S=.25*Y)-F,X[0]-N],[S+F,X[0]-N],[S+F,X[14]+N],[S-F,X[14]+N]],[[0,1,2,3]],[3]),e=.5;break;case"}":N=.2,O=pd.mapAndConstrainTo(Y,0,5,.25*Y,.1*Y),O=B+Math.max(.1/Y,O),S=.25*Y+.5*O-.5*Math.max(.1,B),$([[S-O,X[0]-N],[S,X[2]],[S,X[4]],[S+Math.max(.1,B),X[7]],[S,X[10]],[S,X[12]],[S-O,X[14]+N],[S-B,X[12]],[S-B,X[9]],[S+Math.max(.1,B)-B,X[7]],[S-B,X[5]],[S-B,X[2]]],[[0,1,11],[1,2,10,11],[2,3,9,10],[3,4,8,9],[4,5,7,8],[5,6,7]],[11]),e=.5;break;case"~":O=pd.mapAndConstrainTo(Y,0,5,0,.2*Y);N=.333333333*(K[9]-K[0]-O-O),c=K[0]+O+N,f=K[9]-O-N;$([[K[0]+O,.25],[c,.6-F],[f,.4-F],[K[9]-O,.75],[f,.4+F],[c,.6+F]],[[0,1,5],[1,2,4,5],[2,3,4]],[5])}Z+=e*Y*U,Z+=o?W*z:W*U}H=s,j=d}pd3D.Font=new pd3D.FontInstance}();var pdDOM=pdDOM||{};!function(){pdDOM.mobileOS="",pdDOM.isMobile=!1,pdDOM.devicePixelRatio=window.devicePixelRatio||1,pdDOM.pageScale=1,function(){var t,e,r=navigator.userAgent||navigator.vendor||window.opera;if(pdDOM.mobileOS=r.match(/(iPhone|iPod|iPad|Android|BlackBerry)/)||[],pdDOM.isMobile=0<pdDOM.mobileOS.length,pdDOM.isMobile)/windows phone/i.test(r)?pdDOM.isWindowsPhone=!0:/android/i.test(r)?pdDOM.isAndroid=!0:/iPad|iPhone|iPod/.test(r)&&!window.MSStream&&(pdDOM.isiOS=!0,/iPhone/.test(r)&&(pdDOM.isiPhone=!0));else{var n=r.toLowerCase();if(0<=n.indexOf("macintosh")&&(pdDOM.isMacintosh=!0),navigator.vendor&&0<=navigator.vendor.indexOf("Apple")&&navigator.userAgent&&!navigator.userAgent.match("CriOS")){r=(r=(t=n).match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?{name:e[1].replace("OPR","Opera"),version:e[2]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})),r=parseFloat(r.version);return pdDOM.isSafariOldVersion=r<11,pdDOM.isSafari=!0}0<=n.indexOf("firefox")&&(pdDOM.isFirefox=!0),0<=n.indexOf("windows")&&(pdDOM.isWindows10=0<=n.indexOf("10."),pdDOM.isWindows=!0)}}();var i=!0,n=null,a=!0;pdDOM.checkForSafariCanvasFix=function(t,e,r){return pdDOM.isSafariOldVersion&&1.5<window.devicePixelRatio&&(a=1441<t||901<e?(a&&r&&(null==n?n=r({content:"<strong>ADVERTENCIA:</strong>: La resolucón del canvas WebGL fue reducida, ya que Safari tiene inconventienes en pantallas Retina escaladas<br />cuando las dimensiones son mayores a 1440x900 pixeles.",style:"primary",timeout:12e3}):n.hasClass("snackbar-opened")||n.snackbar("show")),!(pdDOM.devicePixelRatio=1)):(r&&n&&n.hasClass("snackbar-opened")&&n.snackbar("hide"),pdDOM.devicePixelRatio=window.devicePixelRatio,!0)),pdDOM},pdDOM.getClientWidth=function(){var t=window.innerWidth,e=document.documentElement.clientWidth;return e<t?t:e},pdDOM.getClientHeight=function(){var t=window.innerHeight,e=document.documentElement.clientHeight;return e<t?t:e},pdDOM.setFullSizeCanvasByDevice=function(t,e,r,n){return i&&pdDOM.devicePixelRatio<2&&(i=!1,.5<pdDOM.getLocalStorageItem("hiresWebGL")&&(pdDOM.devicePixelRatio=Math.max(2,window.devicePixelRatio))),pdDOM.checkForSafariCanvasFix(e,r,n),t&&t.canvas&&(t.canvas.width=e*pdDOM.devicePixelRatio,t.canvas.height=r*pdDOM.devicePixelRatio,t.canvas.style.height=r,t.canvas.style.width=e,t.viewport(0,0,t.canvas.width,t.canvas.height)),pdDOM},pdDOM.applyFirefoxPageScaleFix=function(t,e,r,n){return t&&pdDOM.isFirefox&&(t.css({"-moz-transform":"scale("+n+")","-moz-transform-origin":"0 0"}),n<1?t.css({width:e*pdDOM.pageScale+"px",height:r*pdDOM.pageScale+"px"}):t.css({width:"100%",height:"100%"})),pdDOM},pdDOM.getParamString=function(t,e,r){var n,i=[];for(n in t)i.push(encodeURIComponent(r?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")},pdDOM.getUrlParams=function(t){var n={};return(t=t||window.location.search).replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,r){n[e]=r}),n},pdDOM.hasClass=function(t,e){var r=new RegExp("(\\s|^)"+e+"(\\s|$)");if(t instanceof SVGElement){e=t.getAttribute("class");return e?!!e.match(r):!1}return!!t.className.match(r)},pdDOM.addClass=function(e,t,r){r=pd.toBoolean(r,!1),pd.isArray(t)&&t.forEach(function(t){pdDOM.addClass(e,t,r)});var n=e.getAttribute("class"),i=new RegExp("(\\s|^)"+t+"(\\s|$)");return n&&n.match(i)||(e instanceof SVGElement?(n=r?0<n.length?t+" "+n:t:0<n.length?n+" "+t:t,e.setAttribute("class",n)):e.className=r?0<e.className.length?t+" "+e.className:t:0<e.className.length?e.className+" "+t:t),pdDOM},pdDOM.removeClass=function(e,t){pd.isArray(t)&&t.forEach(function(t){pdDOM.removeClass(e,t)});var r=e.getAttribute("class"),t=new RegExp("(\\s|^)"+t+"(\\s|$)");return r&&r.match(t)&&(e instanceof SVGElement?(r=r.replace(t," ").trim(),e.setAttribute("class",r)):e.className=e.className.replace(t," ").trim()),pdDOM},pdDOM.toggleClass=function(e,t,r){pd.isArray(t)&&t.forEach(function(t){pdDOM.toggleClass(e,t,r)});var n=pdDOM.hasClass(e,t);return(r=pd.toBoolean(r,!n))&&!n?pdDOM.addClass(e,t):!r&&n&&pdDOM.removeClass(e,t),pdDOM},pdDOM.getComputedElementStyle=function(t,e){var r="";if(window.getComputedStyle)r=getComputedStyle(t).getPropertyValue(e);else if(t.currentStyle)try{r=t.currentStyle[e]}catch(t){}return r},pdDOM.getElementFontSizeInPixels=function(t){return parseFloat(pdDOM.getComputedElementStyle(t||document.documentElement,"font-size"))},pdDOM.convertEmToPixels=function(t,e){return parseFloat(t)*pdDOM.getElementFontSizeInPixels(e)},pdDOM.convertToInlineStyles=function(t,e){if(e=e||{},t){e.recursive&&Array.prototype.forEach.call(t.children,function(t){pdDOM.convertToInlineStyles(t,e)});for(var r=getComputedStyle(t),n=0;n<r.length;++n){var i,a=r.item(n);(!e.properties||0<=e.properties.indexOf(a))&&(i=r.getPropertyValue(a),t.style[a]=i)}}};var o="http://www.w3.org/2000/svg";function s(t,e,r){for(;t.hasChildNodes();)t.removeChild(t.lastChild);if(e&&pd.isString(e)){var n,i=pd.toNumber(r.x,0),a=pd.toNumber(r.lineHeight,1.1),o=pd.toNumber(r.dy,0),s=e.match(/[^\r\n]+/g);if(pd.isArray(s)&&1<s.length)for(var d=0,h=s.length;d<h;++d)(n=pdDOM.svgElem("tspan",{x:i,dy:(0<d?a:o)+"em"})).appendChild(document.createTextNode(s[d].trim())),t.appendChild(n);else t.appendChild(document.createTextNode(e.trim()))}else t.appendChild(document.createTextNode(""));return t}pdDOM.svgElem=function(t,e){e=e||{};var r,n=document.createElementNS(o,t);for(r in e)n.setAttributeNS(null,r,e[r]);return n},pdDOM.svgText=function(t,e){e=pdDOM.svgElem("text",e);return e.appendChild(document.createTextNode(t)),e},pdDOM.svgTextMultiLine=function(t,e){var r=pdDOM.svgElem("text",e);return s(r,t,e),r},pdDOM.svgAttr=function(t,e){if(t&&pd.isObject(e))for(var r in e)null==e[r]?t.removeAttributeNS(o,r):t.setAttributeNS(null,r,e[r]);return pdDOM},pdDOM.svgSetText=function(t,e,r){if(t){if(pd.isObject(r))for(var n in r)t.setAttributeNS(null,n,r[n]);t.firstChild&&(t.firstChild.nodeValue=e)}return pdDOM},pdDOM.svgSetTextMultiLine=function(t,e,r){if(t&&pd.isObject(r))for(var n in r)t.setAttributeNS(null,n,r[n]);return s(t,e,r),pdDOM},pdDOM.svgHide=function(t){return t.setAttributeNS(null,"display","none"),pdDOM},pdDOM.svgShow=function(t){return t.setAttributeNS(null,"display","inline"),pdDOM};var d=["webkit","moz","MS","o",""];pdDOM.cssAnimation=function(r,n,i,a){pdDOM.addClass(r,n),function(t,e,r){for(var n=0;n<d.length;++n)d[n]||(e=e.toLowerCase()),t.addEventListener(d[n]+e,r,!1)}(r,"AnimationEnd",function t(e){!function(t,e,r){for(var n=0;n<d.length;++n)d[n]||(e=e.toLowerCase()),t.removeEventListener(d[n]+e,r)}(r,"AnimationEnd",t),pdDOM.removeClass(r,n),"function"==typeof i&&i(e,a)})},pdDOM.enableDragDrop=function(t,e){function r(t){(t=t||window.event).dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()}return!(!window.FileReader||!t||"function"!=typeof e)&&(t.addEventListener("dragenter",r),t.addEventListener("dragleave",r),t.addEventListener("dragover",r),t.addEventListener("drop",function(t){return(t=t||window.event).stopPropagation(),t.preventDefault(),e(t.dataTransfer.files,t),!1}),!0)},pdDOM.copyToClipboard=function(t){var e=!1;if(t){var r=document.createElement("textarea"),n=window.pageYOffset||document.documentElement.scrollTop;r.style.fontSize="12pt",r.style.border="0",r.style.padding="0",r.style.margin="0",r.style.position="absolute",r.style.left="-9999px",r.style.top=n+"px",r.setAttribute("readonly",""),r.value=t.toString(),document.body.appendChild(r),r.focus(),r.select();try{e=document.execCommand("copy")}catch(t){e=!1}setTimeout(function(){document.body.removeChild(r),r=null},500)}return e},pdDOM.getKbdIncrement=function(t,e){switch(t.which){case 37:return e?1:0;case 38:return 1;case 39:return e?-1:0;case 40:return-1;case 33:return 10;case 34:return-10}return 0},pdDOM.getScrollIncrement=function(t){t=t.originalEvent||t;if(t){if(t.deltaY)return t.deltaY<0?1:-1;if(t.deltaX)return t.deltaX<0?1:-1;if(void 0!==t.wheelDeltaY)return t.wheelDeltaY<0?1:-1;if(void 0!==t.wheelDeltaX)return t.wheelDeltaX<0?1:-1;if(t.wheelDelta)return t.wheelDelta<0?1:-1;if(t.detail)return t.detail<0?1:-1}return 0},pdDOM.Parameter=function(t){t=t||{},this.type=pd.toInteger(t.type,0),this.units=pd.toInteger(t.units,0),this.value=t.value||0,this.min=pd.toNumber(t.min,0),this.max=pd.toNumber(t.max,1),this.step=pd.toNumber(t.step,.01),this.minor=pd.toNumber(t.minor,5*this.step),this.major=pd.toNumber(t.major,20*this.step),this.precision=pd.toInteger(t.precision,Math.max(0,-Math.ceil(Math.log(this.step))))},pdDOM.Parameter.NUMBER=0,pdDOM.Parameter.INTEGER=1,pdDOM.Parameter.VECTOR=2,pdDOM.Parameter.COLOR=3,pdDOM.hiResTimeStamp=function(){if(window.performance){var t=window.performance;if(t.now)return function(){return t.now()};if(t.webkitNow)return function(){return t.webkitNow()};if(t.mozNow)return function(){return t.mozNow()};if(t.oNow)return function(){return t.oNow()}}return function(){return Date.now()}}(),pdDOM.ThrottledUpdate=function(e,r,n){var i=this,a=null;if("function"!=typeof e)throw new TypeError("ERROR: Callback must be a function.");function o(){i.cancel(),e(n)}return r=pd.isNumeric(r)?parseFloat(r):50,this.trigger=function(){return a=a||setTimeout(o,r),i},this.restart=function(t){return a&&clearTimeout(a),r=pd.toNumber(t,r),a=setTimeout(o,r),i},this.timeout=function(t){return i.cancel(),e(t=t||n),i},this.cancel=function(){return a&&clearTimeout(a),a=null,i},this},pdDOM.throttledCalculation=function(r){if("object"!=typeof(r=r||{}).iterator||"function"!=typeof r.iterator.next)throw new Error("ERROR: Calculation requires a valid iterator object.");if("function"!=typeof r.callbackCalculate)throw new Error("ERROR: Calculation callback must be a function.");var n=r.iterator;return r.iterations=r.iterations||1e6,r.timeout=r.timeout||100,pdDOM.getGlobalAnimationQueue().addOrReplace(function(){var t=0,e=pdDOM.hiResTimeStamp()+r.timeout;if(n)for(;null!=(n=n.next())&&(r.callbackCalculate(n),!(++t>=r.iterations||pdDOM.hiResTimeStamp()>e)););return!n||n.cancelled?(r.callbackOnComplete&&r.callbackOnComplete(r),!0):(r.callbackOnTimeout&&r.callbackOnTimeout(n,r),!1)}).start(),!0};var t=null;function h(t){return.206893034<t?t*t*t:(t-4/29)/7.787037}function l(t){return.008856<t?Math.pow(t,1/3):7.787037*t+4/29}function c(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function u(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function p(t){var e=u(255*t[0]),r=u(255*t[1]),n=u(255*t[2]),i=l((.4124564*e+.3575761*r+.1804375*n)/.95047),t=l(.2126729*e+.7151522*r+.072175*n);return[116*t-16,500*(i-t),200*(t-l((.0193339*e+.119192*r+.9503041*n)/1.08883))]}function f(t,e,r,n){var i,a=1-r,o=p(t),s=p(e),i=(i=[a*o[0]+r*s[0],a*o[1]+r*s[1],a*o[2]+r*s[2]],o=(i[0]+16)/116,s=o+i[1]/500,i=o-i[2]/200,[c(3.2404542*(s=.95047*h(s))-1.5371385*(o=h(o))-.4985314*(i=1.08883*h(i)))/255,c(-.969266*s+1.8760108*o+.041556*i)/255,c(.0556434*s-.2040259*o+1.0572252*i)/255]);return(n=n||[])[0]=pd.constrainTo(i[0],0,1),n[1]=pd.constrainTo(i[1],0,1),n[2]=pd.constrainTo(i[2],0,1),n[3]=a*t[3]+r*e[3],n}function m(e,r){var n=[];e=e||[],pd.isArray(e)&&(e[0]=+e[0]||0,e[1]=+e[1]||0,e[2]=+e[2]||0,e[3]=pd.toNumber(e[3],1)),r=r||[],pd.isArray(e)&&(r[0]=+r[0]||0,r[1]=+r[1]||0,r[2]=+r[2]||0,r[3]=pd.toNumber(r[3],1)),this.interpolate=function(t){return 1===t?r:f(e,r,t,n)}}function g(a,o){var s=[];a=a||[],pd.isArray(a)&&(a[0]=+a[0]||0,a[1]=+a[1]||0,a[2]=+a[2]||0),o=o||[],pd.isArray(a)&&(o[0]=+o[0]||0,o[1]=+o[1]||0,o[2]=+o[2]||0),this.interpolate=function(t){return 1===t?o:(e=o,n=s,i=1-(r=t),t=[+(t=a)[0]||0,+t[1]||0,+t[2]||0],e=[+e[0]||0,+e[1]||0,+e[2]||0],(n=n||[])[0]=i*t[0]+r*e[0],n[1]=i*t[1]+r*e[1],n[2]=i*t[2]+r*e[2],n);var e,r,n,i}}function y(e,r){r=pd.toNumber(r,1),e=pd.toNumber(e,0),this.interpolate=function(t){return(1-t)*e+t*r}}pdDOM.getGlobalAnimationQueue=function(){return t=t||new pdDOM.AnimationQueue},pdDOM.AnimationQueue=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},r=[],n=[],i=[],a=!1,o=0,s=0,d=0;function h(t){r.indexOf(t)<0&&r.push(t)}function l(t,e){t((d-s)/1e3,o,t._payload)&&n.push(e)}function c(){if(a){if(0<i.length&&(i.forEach(h),i.length=0),d=(new Date).getTime(),r.forEach(l),0<n.length){n.sort(function(t,e){return e-t});for(var t=n.length-1;0<=t;t--)r.splice(n[t],1);n.length=0}o++,e(c),s=d}}return this.frameCount=function(){return o},this.add=function(t,e){return t&&"function"==typeof t&&(t._payload=e||null,a?i.push(t):h(t)),this},this.addOrReplace=function(t,e){return t&&"function"==typeof t&&(t._payload=e||null,0<=(e=r.indexOf(t))?r[e]=t:a?i.push(t):h(t)),this},this.contains=function(t){return 0<=r.indexOf(t)},this.remove=function(t){return!t||"function"!=typeof t||0<=(t=r.indexOf(t))&&(a?n.push(t):r.splice(t,1)),this},this.start=function(){return a||(a=!0,s=(new Date).getTime(),c()),this},this.stop=function(){return a=!1,this},t=t||this,this},pdDOM.Animation=function(t,e){var r=this;return this._queue=[],e&&this._queue.push(e),e=e||{},this.active=!1,this.delay=pd.constrainTo(pd.toNumber(e.delay,0),0,3600),this.duration=pd.constrainTo(pd.toNumber(e.duration,1),.001,3600),this.easing=e.easing||pd.Easing.inOutSine,this.fromValue=pd.toNumber(e.fromValue,0),this.toValue=pd.toNumber(e.toValue,1),this.getter=e.getter||null,this.callback=t||null,this.onStart=e.onStart||null,this.onComplete=e.onComplete||null,this.progress=0,this.speed=1/this.duration,this.update=function(t){return r._handleUpdate(t)},this._delayValue=0,t=e=null,this},pdDOM.Animation.prototype._handleUpdate=function(t){if(.999<this.progress)return this.active=!1,this.progress=1,this.callback&&this.callback(this.toValue,this),(!this.onComplete||!1!==this.onComplete(this))&&(!(0<this._queue.length)||(this.start(this._queue.shift()),!1));if(1e-6<this._delayValue){if(this._delayValue-=t,!(this._delayValue<0))return!1;this._delayValue=0}var e;return this.callback&&(e=this.easing?this.easing(this.progress):this.progress,this.callback((1-e)*this.fromValue+e*this.toValue,this)),1<=(this.progress+=this.speed*t)&&(this.progress=1),!1},pdDOM.Animation.prototype._handleStart=function(t){void 0!==(t=t||(0<this._queue.length?this._queue.shift():{})).delay&&(this.delay=pd.toNumber(t.delay,0)),void 0!==t.duration&&(this.duration=pd.toNumber(t.duration,1)),void 0!==t.easing&&(this.easing=t.easing),void 0!==t.getter&&(this.getter=t.getter),void 0!==t.onStart&&(this.onStart=t.onStart),void 0!==t.onComplete&&(this.onComplete=t.onComplete),t.callback&&"function"==typeof t.callback&&(this.callback=t.callback);var e=pd.toNumber(t.toValue,this.toValue),t=pd.toNumber(t.fromValue,this.fromValue);return this.getter&&(t=pd.toNumber(this.getter(),t)),this.duration=pd.constrainTo(pd.toNumber(this.duration,1),.001,3600),this.speed=1/this.duration,this.delay=pd.constrainTo(this.delay,0,3600),this._delayValue=this.delay,pd.closeTo(t,e)&&pd.closeTo(e,this.toValue)||(this.active?(this.progress=Math.min(.5,this.progress),this.fromValue=t-this.progress*(e-t),this.toValue=e):(this.progress=0,this.fromValue=t,this.toValue=e,pdDOM.getGlobalAnimationQueue().addOrReplace(this.update).start(),this.active=!0,this.onStart&&this.onStart(this))),this},pdDOM.Animation.prototype.then=function(t){return t&&this._queue.push(t),this},pdDOM.Animation.prototype.start=function(t){return this._handleStart(t),this},pdDOM.Animation.prototype.cancel=function(){return this.active=!1,pdDOM.getGlobalAnimationQueue().remove(this.update),this.onComplete&&this.onComplete(this),this},pdDOM.Transition=function(t){return t=t||{},this.target=t.target,this.property=t.property||"",this.type=pd.toInteger(t.type,-1),this.easing=t.easing&&"function"==typeof t.easing?t.easing:null,this.mapping=pd.isArray(t.mapping)?t.mapping:null,this.interpolator=t.interpolator||null,this.isMethod=this.target&&"function"==typeof this.target[this.property],this._cachedTransform=[0,0,0,0,0,0,0,0,0],this._cachedTransform.active=!1,this.interpolator||this.determineType(this.type,t.from,t.to),t=null,this};var v=pdDOM.Transition;pdDOM.Transition.VALUE=0,pdDOM.Transition.VECTOR=1,pdDOM.Transition.COLOR=2,pdDOM.Transition.prototype.determineType=function(t,e,r){if(t<0&&pd.isArray(r)){if(!pd.isArray(e))throw new Error("From and to values must be of the same type and length.");3<r.length&&3<e.length?t=v.COLOR:2<r.length&&2<e.length&&(t=v.VECTOR)}switch(t){default:case v.VALUE:this.interpolator=new y(e,r),this.type=v.VALUE;break;case v.VECTOR:this.interpolator=new g(e,r),this.type=t;break;case v.COLOR:this.interpolator=new m(e,r),this.type=t}return this},pdDOM.Transition.prototype.update=function(t){var e=this.interpolator;return!!e&&(this.easing&&(t=this.easing(t)),this.mapping&&(t=pd.mapTo(t,0,1,this.mapping[0],this.mapping[1])),this.isMethod?this.target[this.property](e.interpolate(t)):this.target[this.property]=e.interpolate(t),!0)},pdDOM.AnimationSequence=function(t){(t=t||{}).easing=t.easing||pd.Easing.linear,pdDOM.Animation.call(this,null,t),this.host=t.host||null,this.processOnDraw=pd.toBoolean(t.processOnDraw,!1),this.transitionSequence=t.transitions||[],this.activeStep=null,this._onFullyComplete=this.onComplete,this.onComplete=null},pdDOM.AnimationSequence.prototype=Object.create(pdDOM.Animation.prototype),pdDOM.AnimationSequence.prototype.constructor=pdDOM.AnimationSequence,pdDOM.AnimationSequence.prototype._nextStep=function(){var t=null;return 0<this.transitionSequence.length&&(t=this.transitionSequence.shift()).duration<0&&(t.callback&&t.callback(this,this.host),t=this._nextStep()),t},pdDOM.AnimationSequence.prototype._processPropertyChanges=function(t,e){var r=!1;if(t&&t instanceof Object&&e&&e instanceof Object)for(var n in e)t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(t[n]=e[n],r=!0);return r},pdDOM.AnimationSequence.prototype._handleProgress=function(t,e){e.activeStep&&!e.activeStep.paused&&(e.processOnDraw||e.process(),gl.update())},pdDOM.AnimationSequence.prototype._handleComplete=function(t){if(t.checkNextStep=!0,!t.processOnDraw||t.activeStep&&t.activeStep.paused){if(t.activeStep=t._nextStep(),t.active=t.checkNextStep=!1,!t.activeStep)return t._onFullyComplete&&t._onFullyComplete(t),!0;t._handleStart({duration:t.activeStep.duration,fromValue:0,toValue:1})}else t.active=0<t.transitionSequence.length;return!t.active},pdDOM.AnimationSequence.prototype.addTransition=function(t,e){var r=[];if(t=Math.max(.017,pd.toNumber(t,1)),1<arguments.length)for(var n=1;n<arguments.length;++n)if(e=arguments[n],pd.isArray(e))for(var i=0;i<e.length;++i)e[i].update&&(e[i].target||(e[i].target=this.host),r.push(e[i]));else e.update&&(e.target||(e.target=this.host),r.push(e));return this.transitionSequence.push({transitions:r,duration:t}),this},pdDOM.AnimationSequence.prototype.addCallback=function(t){return t&&this.transitionSequence.push({callback:t,duration:-1}),this},pdDOM.AnimationSequence.prototype.addPause=function(t){return 0<(t=pd.toNumber(t,1))&&this.transitionSequence.push({transitions:[],duration:t,paused:!0}),this},pdDOM.AnimationSequence.prototype.addChanges=function(t,e){var r=this;return 1==arguments.length&&(e=t,t=this.host),t&&t instanceof Object&&e&&e instanceof Object&&this.addCallback(function(){r._processPropertyChanges(t,e)&&gl.update()}),this},pdDOM.AnimationSequence.prototype.process=function(){if(this.activeStep&&!this.activeStep.paused&&0<this.activeStep.duration){var t=this.progress;this.easing&&(t=this.easing(t));for(var e=this.activeStep.transitions,r=0,n=e.length;r<n;++r)e[r].update(t)}return this.checkNextStep&&(this.activeStep=this._nextStep(),this.active=this.checkNextStep=!1,this.activeStep?this._handleStart({duration:this.activeStep.duration,fromValue:0,toValue:1}):this.cancel()),this},pdDOM.AnimationSequence.prototype.start=function(){return 0<this.transitionSequence.length&&(!this.activeStep||.999<=this.progress)&&(this.activeStep=this._nextStep()),this.activeStep&&0<this.activeStep.duration&&(this.checkNextStep=!1,this._handleStart({callback:this._handleProgress,onComplete:this._handleComplete,duration:this.activeStep.duration,easing:pd.Easing.linear,fromValue:0,toValue:1})),this},pdDOM.AnimateNode=function(t){if(!(t instanceof pd3D.Node))throw new TypeError("Can only animate a pd3D.Node object.");this.node=t,this.transform=t.transformMatrix=new pd3D.Transform,this.animation=new pdDOM.AnimationSequence({host:this});var r=[0,0,0],n=[0,0,0],i=[1,1,1];Object.defineProperty(this,"translation",{get:function(){return r},set:function(t){var e;pd.isArray(t)&&(e=gl.animationQueue.frameCount(),r.frameIndex!=e&&(r.frameIndex=e,r[0]=0,r[1]=0,r[2]=0),r[0]+=+t[0]||0,r[1]+=+t[1]||0,r[2]+=+t[2]||0)}}),Object.defineProperty(this,"rotation",{get:function(){return n},set:function(t){var e;pd.isArray(t)&&(e=gl.animationQueue.frameCount(),n.frameIndex!=e&&(n.frameIndex=e,n[0]=0,n[1]=0,n[2]=0),n[0]+=+t[0]||0,n[1]+=+t[1]||0,n[2]+=+t[2]||0)}}),Object.defineProperty(this,"scale",{get:function(){return i},set:function(t){var e;pd.isArray(t)&&(e=gl.animationQueue.frameCount(),i.frameIndex!=e&&(i.frameIndex=e,i[0]=1,i[1]=1,i[2]=1),i[0]*=+t[0]||0,i[1]*=+t[1]||0,i[2]*=+t[2]||0)}}),this.clearDynamicTransform=function(){return r[0]=r[1]=r[2]=0,n[0]=n[1]=n[2]=0,i[0]=i[1]=i[2]=1,this},t.callbackOnDraw=function(){this.animation&&this.animation.active&&this.animation.process(),this.transform.addTranslation(this.translation),this.transform.addRotation(this.rotation),this.transform.addScale(this.scale)},this.remove=function(){this.node.transformMatrix=null,this.node.callbackOnDraw=null}},pdDOM.localStorage=null;try{pdDOM.localStorage=window.localStorage}catch(t){}pdDOM.localStorage||(pdDOM.localStorage={getItem:function(t){return t&&this.hasOwnProperty(t)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(t){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[t])},setItem:function(t,e){t&&(document.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length)},length:0,removeItem:function(t){t&&this.hasOwnProperty(t)&&(document.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},pdDOM.localStorage.length=(document.cookie.match(/\=/g)||pdDOM.localStorage).length);var D=!0;pdDOM.setLocalStorageItem=function(t,e){var r=pdDOM.localStorage;if(r&&t&&t.length)try{r.setItem(t,e)}catch(t){D&&(alert("ERROR - Unable to store value:\n"+t),D=!1)}},pdDOM.getLocalStorageItem=function(t){return t&&t.length?pdDOM.localStorage.getItem(t):null},pdDOM.removeLocalStorageItems=function(t){if(pd.isArray(t)){for(var e=pdDOM.localStorage,r=0,n=t.length;r<n;++r)e.removeItem(t[r]);return!0}return!1},pdDOM.fromXML=function(t){var e,r,n,i,a={};if(1==t.nodeType){if(0<t.attributes.length){a["@attributes"]={};for(var o=0;o<t.attributes.length;++o){var s=t.attributes.item(o);a["@attributes"][s.nodeName]=s.nodeValue}}}else 3==t.nodeType&&(a=t.nodeValue.trim());if(t.hasChildNodes())if(1===t.childNodes.length&&3===t.childNodes[0].nodeType)a=t.childNodes[0].nodeValue.trim();else for(var d=0;d<t.childNodes.length;++d)void 0===a[i=(n=t.childNodes.item(d)).nodeName]?""!==(e=pdDOM.fromXML(n))&&(a[i]=e):(void 0===a[i].push&&(r=a[i],a[i]=[],a[i].push(r)),""!==(e=pdDOM.fromXML(n))&&a[i].push(e));if(!pd.isArray(a)&&"object"==typeof a){var h=Object.keys(a);if(1==h.length&&"#text"==h[0])return a["#text"];if(0===h.length)return null}return a},pdDOM.toXML=function(t,e){var d=document.implementation.createDocument("","",null);d||(d=(new DOMParser).parseFromString("<dummy />","text/xml")).removeChild(d.documentElement),e=e||"jsonXML";e=d.createElement(e);return function t(e,r){var n,i,a;if(r.constructor===String||r.constructor===Number||r.constructor===Boolean){if(e.appendChild(d.createTextNode(r.toString())),r===r.valueOf())return}else r.constructor===Date&&e.appendChild(d.createTextNode(r.toGMTString()));for(a in r)if(!isFinite(a))if(n=r[a],"keyValue"===a)null!==n&&!0!==n&&e.appendChild(d.createTextNode(n.constructor===Date?n.toGMTString():String(n)));else if("@attributes"===a)for(var o in n)e.setAttribute(o,n[o]);else if("@"===a.charAt(0))e.setAttribute(a.slice(1),n);else if(n.constructor===Array)for(var s=0;s<n.length;++s)t(i=d.createElement(a),n[s]),e.appendChild(i);else i=d.createElement(a),n instanceof Object?t(i,n):null!==n&&!0!==n&&i.appendChild(d.createTextNode(n.toString())),e.appendChild(i)}(e,t),d.appendChild(e),d}}(),function(){var h={true:!0,false:!(pdDOM.jsonToURI=function t(e){function r(t){return/[^\w-.]/.test(t)?t.replace(/[^\w-.]/g,function(t){return"$"===t?"!":(t=t.charCodeAt(0))<256?"*"+("00"+t.toString(16)).slice(-2):"**"+("0000"+t.toString(16)).slice(-4)}):t}var n,i;switch(typeof e){case"number":return isFinite(e)?"~"+pd.toStringWithPrecisionRange(e,0,6):"~null";case"boolean":return"~"+e;case"string":return"~'"+r(e);case"object":if(!e)return"~null";if(n=[],pd.isArray(e)){for(var a=0;a<e.length;++a)n[a]=t(e[a])||"~null";return"~("+(n.join("")||"~")+")"}for(var o in e){!e.hasOwnProperty(o)||(i=t(e[o]))&&n.push(r(o)+i)}return"~("+n.join("~")+")";default:return}}),null:null};pdDOM.uriToJSON=function(i){if(!i)return i;i=i.replace(/%27/g,"'");var a=0,o=i.length;function s(t){if(i.charAt(a)!==t)throw new Error("bad JSURL syntax: expected "+t+", got "+(i&&i.charAt(a)));a++}function d(){for(var t,e=a,r="";a<o&&"~"!==(t=i.charAt(a))&&")"!==t;)switch(t){case"*":e<a&&(r+=i.substring(e,a)),e="*"===i.charAt(a+1)?(r+=String.fromCharCode(parseInt(i.substring(a+2,a+6),16)),a+=6):(r+=String.fromCharCode(parseInt(i.substring(a+1,a+3),16)),a+=3);break;case"!":e<a&&(r+=i.substring(e,a)),r+="$",e=++a;break;default:a++}return r+i.substring(e,a)}return function t(){var e,r;switch(s("~"),r=i.charAt(a)){case"(":if(a++,"~"===i.charAt(a))if(e=[],")"===i.charAt(a+1))a++;else for(;e.push(t()),"~"===i.charAt(a););else if(e={},")"!==i.charAt(a))do{}while(e[d()]=t(),"~"===i.charAt(a)&&++a);s(")");break;case"'":a++,e=d();break;default:for(n=a++;a<o&&/[^)~]/.test(i.charAt(a));)a++;var n=i.substring(n,a);if(/[\d\-]/.test(r))e=parseFloat(n);else if(void 0===(e=h[n]))throw new Error("bad value keyword: "+n)}return e}()}}(),pdDOM.Interaction=pdDOM.Interaction||{},function(){var k=!1,I=!1,P=null,E=null,_=0,L=0,e=3e3,x={x:0,y:0},M=0,T=0,A=0,R={},B=-1,F=-1,w={x:0,y:0},O={x:0,y:0},V={x:0,y:0},z=1250;function o(t){var e=null;return t.target?e=t.target:t.srcElement&&(e=t.srcElement),e&&3==e.nodeType&&(e=e.parentNode),e}function Y(t){var e,r,n=pd.toNumber(t.pageX,0),i=pd.toNumber(t.pageY,0),a=o(t);return a&&a.getBoundingClientRect&&(e=1/pdDOM.pageScale,n-=(r=a.getBoundingClientRect()).left*e,i-=r.top*e),{target:a,button:pd.toInteger(t.button,0),identifier:pd.toNumber(t.identifier,t.pointerId),pageX:t.pageX,pageY:t.pageY,x:n,y:i}}function U(){for(var t in L=_=0,E=null,F=B=-1,R)R.hasOwnProperty(t)&&delete R[t]}function t(t){"touch"==t.pointerType.toLowerCase()&&(_=Math.max(0,_-1),L=t.timeStamp,_<=0&&U())}function q(t){return(t=pd.toNumber(t,0))<.001?t=3+3*pdDOM.devicePixelRatio:t<=.999&&(t*=3+3*pdDOM.devicePixelRatio),V.x>t||V.y>t}window.PointerEvent&&(k=!0,document.addEventListener("pointerdown",function(t){"touch"==t.pointerType.toLowerCase()&&(t.isPrimary&&t.timeStamp-L>e&&U(),_=Math.min(10,_+1),L=t.timeStamp)}),document.addEventListener("pointercancel",t),document.addEventListener("pointerup",t)),("ontouchstart"in window||"ontouchstart"in document.documentElement||window.DocumentTouch&&document instanceof DocumentTouch)&&(I=!0),pdDOM.Interaction.hasMoved=q,pdDOM.Interaction.activeTouchList=R,Object.defineProperty(pdDOM.Interaction,"hasPointerEvents",{get:function(){return k}}),Object.defineProperty(pdDOM.Interaction,"hasTouchEvents",{get:function(){return I}}),Object.defineProperty(pdDOM.Interaction,"activeTouchCount",{get:function(){return _}}),Object.defineProperty(pdDOM.Interaction,"activeTouchTimeStamp",{get:function(){return L},set:function(t){L=+t}}),Object.defineProperty(pdDOM.Interaction,"activeTouchTimeOutInMS",{get:function(){return e},set:function(t){e=Math.max(500,+t)}}),Object.defineProperty(pdDOM.Interaction,"activeTouchElement",{get:function(){return E}}),pdDOM.InteractionEvent=function(t){this.event=t,this.isTouchEvent=!1,this.touchCount=_,this.timeStamp=t.timeStamp,this.button=t.button,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.altKey=t.altKey,this.scale=1,this.rotation=0,this.dragX=0,this.dragY=0,this.x=pd.toNumber(t.pageX,0),this.y=pd.toNumber(t.pageY,0),this.primaryX=this.x,this.primaryY=this.y},pdDOM.InteractionEvent.prototype.hasMoved=q,pdDOM.InteractionEvent.prototype.getDragStartPosX=function(){return w.x},pdDOM.InteractionEvent.prototype.getDragStartPosY=function(){return w.x},pdDOM.InteractionEvent.prototype.getDragDistanceX=function(){return O.x},pdDOM.InteractionEvent.prototype.getDragDistanceY=function(){return O.y},pdDOM.InteractionEvent.prototype.preventDefault=function(){this.event&&this.event.preventDefault&&this.event.preventDefault()},pdDOM.InteractionEvent.prototype.stopPropagation=function(){this.event&&this.event.stopPropagation&&this.event.stopPropagation()},pdDOM.InteractionEvent.prototype.stopImmediatePropagation=function(){this.event&&this.event.stopImmediatePropagation&&this.event.stopImmediatePropagation()},pdDOM.Interaction.createEvent=function(t,e){var r=!1,n=!1,i=!1,a=P,o=0,s=0,d=new pdDOM.InteractionEvent(t);if(t.type&&0<t.type.length)if(k&&"p"==t.type.charAt(0)){if(r=t.pointerType&&"touch"==t.pointerType){var h,l=0;for(h in d.isTouchEvent=!0,R[t.pointerId]&&(a=R[t.pointerId]),R){R.hasOwnProperty(h)&&(u=R[h])&&(o+=u.pageX,s+=u.pageY,l++)}0<l&&(i=!0,o/=l,s/=l,0<=B&&(p=R[B])&&(d.primaryX=p.pageX,d.primaryY=p.pageY,1<l&&0<F&&(f=R[F])&&(m=f.pageX-p.pageX,g=f.pageY-p.pageY,M=Math.sqrt(m*m+g*g),d.rotation=-Math.atan2(g,m)*pd.Const.RAD2DEG,n=!0)))}}else if(I&&"t"==t.type.charAt(0)){r=d.isTouchEvent=!0;var c=t.touches||t.targetTouches;if((!c||c.length<1)&&(c=t.changedTouches||t.originalEvent.changedTouches,_<1&&(_=c.length)),_=c?c.length:0,d.touchCount=_,d.button=_-1,c&&0<c.length){for(var u,p,f,m,g,y=-1,v=-1,l=0,D=0,b=c.length;D<b;++D)u=c[D],B===u.identifier&&(y=D),F===u.identifier&&(v=D),o+=u.pageX,s+=u.pageY,l++;0<l&&(i=!0,o/=l,s/=l,d.button<0&&(d.button=c.length-1),0<=y&&(p=c[y])&&(d.primaryX=p.pageX,d.primaryY=p.pageY,0<=v&&(f=c[v])&&(m=f.pageX-p.pageX,g=f.pageY-p.pageY,M=Math.sqrt(m*m+g*g),d.rotation=-Math.atan2(g,m)*pd.Const.RAD2DEG,n=!0))),u=c[Math.max(0,y)],d.x=u.pageX,d.y=u.pageY}}switch(e&&e.getBoundingClientRect&&(m=1/pdDOM.pageScale,(e=e.getBoundingClientRect()).left&&(o-=e.left*m,d.primaryX-=e.left*m,d.x-=e.left*m),e.top&&(s-=e.top*m,d.primaryY-=e.top*m,d.y-=e.top*m)),t.type.toLowerCase()){case"pointerdown":if(!r){w.x=d.x,w.y=d.y,O.x=0,O.y=0,V.x=0,V.y=0;break}d.button=_;case"mousedown":case"touchstart":V.x=0,V.y=0,O.x=0,O.y=0,w.x=d.x,w.y=d.y,n&&(T=M,A=d.rotation,d.rotation=0);break;case"pointermove":r?d.button=_-1:d.button<0&&t.button<0&&(0<t.buttons?1&t.buttons?d.button=0:4&t.buttons?d.button=1:2&t.buttons?d.button=2:8&t.buttons?d.button=3:16&t.buttons?d.button=4:32&t.buttons&&(d.button=5):a&&(d.button=a.button));case"touchmove":case"mousemove":r?(L=t.timeStamp,0<=d.button&&i?(d.dragX=o-x.x,d.dragY=s-x.y):a&&(d.dragX=d.x-a.x,d.dragY=d.y-a.y),0<d.button&&n&&(n=d.rotation,d.scale=0<T?M/T:1,T=M,d.rotation-=A,A=n),t.preventDefault()):a&&(d.dragX=d.x-a.x,d.dragY=d.y-a.y),(!r||Math.abs(d.dragX)<50&&Math.abs(d.dragY)<50)&&(V.x+=Math.abs(d.dragX),V.y+=Math.abs(d.dragY),O.x+=d.dragX,O.y+=d.dragY);break;case"touchend":case"touchcancel":case"pointerup":case"pointercancel":r&&d.button<0&&(d.button=Math.max(0,_-1));break;case"mouseup":0<=d.button&&(_=0);break;case"wheel":case"mousewheel":case"dommousescroll":d.delta=pd.sign(pdDOM.getScrollIncrement(t));break;case"keydown":d.delta=pdDOM.getKbdIncrement(t),0!=d.delta&&(d.delta=pd.sign(d.delta))}return r&&i&&(x.x=o,x.y=s),a&&(a.x=d.x,a.y=d.y),d},pdDOM.Interaction.makeInteractive=function(h,l){l=l||{},h.style.touchAction="none",h.classList.add("no-select","no-touch");var o=0,s=0,d=0,r=0,c=0,u=0,p=pdDOM.isFirefox&&pdDOM.isWindows10?0:1,f=l.dragElement||document;l.simple=pd.toBoolean(l.simple,!1)&&!pdDOM.isWindows10;var e=null,m=null;function n(){m=null,l.onlongpress&&l.onlongpress(e)}function g(t){m&&(clearTimeout(m),m=null),m=setTimeout(n,z),e=t}function y(){m&&(clearTimeout(m),m=null)}function v(t,e){setTimeout(function(){t(e)},25)}function i(t){!P&&l.onmove&&(t.preventDefault(),t=pdDOM.Interaction.createEvent(t,h),l.onmove(t))}function t(t){var e,r=!1;t.preventDefault(),t.timeStamp||(t.timeStamp=Date.now()),o=Date.now(),null==E&&(E=h,L=t.timeStamp,l.onmove&&h.removeEventListener("pointermove",i),h.addEventListener("pointermove",b),h.addEventListener("pointercancel",A),h.addEventListener("pointerup",A),r=!0),t.pointerType&&"touch"==t.pointerType?(R[t.pointerId]=Y(t),B<0&&(B=+t.pointerId),B!=t.pointerId&&(F<0||F==B)&&(F=+t.pointerId)):P=Y(t),r&&(l.onpress&&(e=pdDOM.Interaction.createEvent(t,h),l.onpress(e)),l.onlongpress&&g(e=e||pdDOM.Interaction.createEvent(t,h)),h.setPointerCapture&&t.pointerId>=p&&h.setPointerCapture(t.pointerId))}function a(t){var e;t.preventDefault(),t.timeStamp||(t.timeStamp=Date.now()),d=Date.now(),l.onmove&&h.removeEventListener("mousemove",i),f.addEventListener("mousemove",x),f.addEventListener("mouseup",w),P=Y(t),l.onpress&&(e=pdDOM.Interaction.createEvent(t,h),l.onpress(e)),l.onlongpress&&g(e=e||pdDOM.Interaction.createEvent(t,h))}function D(t){var e=!1;l.allowDefaultOnTouch||"boolean"==typeof t.cancelable&&!t.cancelable||t.preventDefault(),t.timeStamp||(t.timeStamp=Date.now()),c=Date.now(),null==E&&(E=h,f.addEventListener("touchmove",M),f.addEventListener("touchcancel",O),f.addEventListener("touchend",O),e=!0);var r=t.touches||t.targetTouches;_=r?r.length:Math.min(10,_+1),L=t.timeStamp;var n,i,a,o=t.changedTouches;if(o&&0<o.length)for(var s=0,d=o.length;s<d;++s)R[o[s].identifier]=Y(o[s]);(B<0||F<0)&&(n=t,i=B,r=F,i=pd.toNumber(i,-1),r=pd.toNumber(r,-1),(n=n.touches||n.targetTouches)&&0<n.length&&(1<n.length&&i==(r=n[1].identifier)&&(i=-1),i<0&&(i=n[0].identifier)),B=(r=[i,r])[0],F=r[1]),e&&(l.onpress&&(a=pdDOM.Interaction.createEvent(t,h),l.onpress(a)),l.onlongpress&&g(a=a||pdDOM.Interaction.createEvent(t,h)))}function b(t){l.allowDefaultOnTouch&&t.pointerType&&"touch"==t.pointerType||t.preventDefault();var e=R[t.pointerId];e&&(e.pageX=t.pageX,e.pageY=t.pageY),q()&&(o=d=0,m&&y()),l.ondrag&&(t=pdDOM.Interaction.createEvent(t,h),Math.abs(t.dragX)<50&&Math.abs(t.dragY)<50&&l.ondrag(t))}function x(t){t.preventDefault(),l.ondrag&&(t=pdDOM.Interaction.createEvent(t,h),l.ondrag(t)),q()&&(d=0,m&&y())}function M(t){l.allowDefaultOnTouch||"boolean"==typeof t.cancelable&&!t.cancelable||t.preventDefault(),q()&&(c=0,m&&y()),l.ondrag&&(t=pdDOM.Interaction.createEvent(t,h),Math.abs(t.dragX)<50&&Math.abs(t.dragY)<50&&l.ondrag(t))}function T(){h.removeEventListener("pointermove",b),h.removeEventListener("pointercancel",A),h.removeEventListener("pointerup",A),l.onmove&&h.addEventListener("pointermove",i)}function A(t){var e,r=!1,n=Date.now();if(l.allowDefaultOnTouch&&t.pointerType&&"touch"==t.pointerType||t.preventDefault(),t.timeStamp||(t.timeStamp=n),h.releasePointerCapture&&t.pointerId>=p)try{h.releasePointerCapture(t.pointerId)}catch(t){}if(m&&y(),e=pdDOM.Interaction.createEvent(t,h),0<o&&z<n-o&&(e.longPress=!0),t.pointerType&&"touch"==t.pointerType){delete R[t.pointerId],B==t.pointerId?B=F=-1:F==t.pointerId&&(F=-1);var i,a=0;for(i in R)R.hasOwnProperty(i)&&a++;a<=0&&(T(),r=!0)}else P=null,T(),U(),r=!0;r&&(l.onlongclick&&e.longPress&&v(l.onlongclick,e),l.onrelease?l.onrelease(e):l.ondoubletap&&0<o&&o-s<400&&(e.isTouchEvent||0<e.button)&&v(l.ondoubletap,e),s=o,0<d&&(d=0),o=0)}function w(t){var e=Date.now();t.preventDefault(),t.timeStamp||(t.timeStamp=e),m&&y(),t=pdDOM.Interaction.createEvent(t,h),0<d&&z<e-d&&(t.longPress=!0),f.removeEventListener("mousemove",x),f.removeEventListener("mouseup",w),l.onmove&&h.addEventListener("mousemove",i),l.onrelease&&l.onrelease(t),l.onlongclick&&t.longPress?v(l.onlongclick,t):l.ondoubletap&&0<d&&d-r<400&&0<t.button&&v(l.ondoubletap,t),r=d,d=0,P=null}function O(t){var e,r=!1,n=Date.now();l.allowDefaultOnTouch||"boolean"==typeof t.cancelable&&!t.cancelable||t.preventDefault(),t.timeStamp||(t.timeStamp=n),m&&y(),e=pdDOM.Interaction.createEvent(t,h),0<c&&z<n-c&&(e.longPress=!0);var i=t.touches||t.targetTouches;_=i?i.length:0,L=t.timeStamp;var a=t.changedTouches;if(a&&0<a.length)for(var o=0,s=a.length;o<s;++o){var d=a[o].identifier;delete R[d],B==d?B=F=-1:F==d&&(F=-1)}_<=0&&(f.removeEventListener("touchmove",M),f.removeEventListener("touchcancel",O),f.removeEventListener("touchend",O),r=!0,U()),r&&(0<c&&z<n-c&&(e.longPress=!0),l.onrelease&&l.onrelease(e),e.longPress&&l.onlongclick?v(l.onlongclick,e):l.ondoubletap&&0<c&&c-u<400&&v(l.ondoubletap,e),u=c,c=0)}function V(t){l.ondoubletap&&(t.preventDefault(),t=pdDOM.Interaction.createEvent(t,h),l.ondoubletap(t))}function C(t){var e;!l.onscroll||(e=pdDOM.Interaction.createEvent(t,h)).delta&&(l.onscroll(e),t.preventDefault())}function S(t){l.onkeydown?l.onkeydown(t):C(t)}function N(t){l.onkeyup&&l.onkeyup(t)}return k&&!l.simple?(h.addEventListener("pointerdown",t),l.onmove&&h.addEventListener("pointermove",i)):(h.addEventListener("mousedown",a),l.onmove&&h.addEventListener("mousemove",i),I&&h.addEventListener("touchstart",D)),l.ondoubletap&&h.addEventListener("dblclick",V),l.onscroll&&(h.addEventListener("DOMMouseScroll",C),h.addEventListener("mousewheel",C),h.addEventListener("wheel",C)),(l.onkeydown||l.onscroll)&&h.addEventListener("keydown",S),l.onkeyup&&h.addEventListener("keyup",N),this.setCallback=function(t,e){if(!l[t])switch(t){case"onmove":h.addEventListener("pointermove",i),h.addEventListener("mousemove",i);break;case"ondoubletap":h.addEventListener("dblclick",V);break;case"onscroll":h.addEventListener("DOMMouseScroll",C),h.addEventListener("mousewheel",C),h.addEventListener("wheel",C),l.onkeydown||h.addEventListener("keydown",S);break;case"keydown":l.onscroll||h.addEventListener("keydown",S);break;case"keyup":h.addEventListener("keyup",N)}l[t]=e},this.dispose=function(){k&&!l.simple?(h.removeEventListener("pointerdown",t),l.onmove&&h.removeEventListener("pointermove",i)):(h.removeEventListener("mousedown",a),l.onmove&&h.addEventListener("mousemove",i)),I&&h.removeEventListener("touchstart",D),l.ondoubletap&&h.addEventListener("dblclick",V),l.onscroll&&(h.removeEventListener("DOMMouseScroll",C),h.removeEventListener("mousewheel",C),h.removeEventListener("wheel",C)),(l.onkeydown||l.onscroll)&&h.removeEventListener("keydown",S),l.onkeyup&&h.removeEventListener("keyup",N)},this}}(),function(){function M(t){return ko.isObservable(t)?+t():+t}function T(t,e){t=ko.isObservable(t)?t():t;return pd.toNumber(t,e)}function A(t){return ko.isObservable(t)?t():t}function w(t,e,r,n,i,a,o,s,d){e&&t&&i<a&&(t.shiftKey?o=pd.toNumber(d,50*o):t.ctrlKey||t.metaKey||(o=pd.toNumber(s,5*o)),a=pd.constrainTo(parseFloat(n())+e*o,i,a),n(pd.snapTo(a,e*o)))}ko.loadExternalTemplates=function(e){var r='script[src][type="text/html"]:not([loaded])',t=$(r);ko.utils.arrayForEach(t,function(t){t=$(t);t.load(t.attr("src"),function(){this.attr("loaded",!0),$(r).length||e()}.bind(t))})},ko.observableArray.fn.refresh=function(t){var e=this.indexOf(t);0<=e&&(this.splice(e,1),this.splice(e,0,t))},ko.extenders.paged=function(o,t){var s=ko.observable(1),d=ko.observable(pd.toInteger(t,5)),h=ko.observable(!1),l=ko.observable(!1),c=ko.observable(1),t=ko.computed(function(){var t=s(),e=o().length,r=Math.max(1,d()),n=Math.max(1,Math.ceil(e/r)),i=pd.constrainTo((t-1)*r,0,e-r),a=pd.constrainTo(i+r,0,e);return c(n),h(i<e-r),l(0<i),n<t&&s(n),o().slice(i,a)});return t.totalPages=c,t.currentPage=s,t.itemsPerPage=d,t.nextEnabled=h,t.prevEnabled=l,t.next=function(){h()&&(h(!1),s(s()+1))},t.prev=function(){l()&&(l(!1),s(s()-1))},t},ko.extenders.fixedPrecision=function(n,i){var t=ko.pureComputed({read:n,write:function(t){var e=n(),r=isNaN(t)?0:parseFloat(t),r=pd.toStringWithPrecision(r,i);r!==e?n(r):t!==e&&n.notifySubscribers(r)}}).extend({notify:"always"});return t(n()),t},ko.bindingHandlers.href={update:function(t,e){ko.bindingHandlers.attr.update(t,function(){return{href:e()}})}},ko.bindingHandlers.src={update:function(t,e){ko.bindingHandlers.attr.update(t,function(){return{src:e()}})}},ko.bindingHandlers.hidden={update:function(t,e){var r=ko.utils.unwrapObservable(e());ko.bindingHandlers.visible.update(t,function(){return!r})}},ko.bindingHandlers.booleanValue={init:function(t,e){var r=e(),e=ko.computed({read:function(){return r().toString()},write:function(t){r("true"===t)}});ko.applyBindingsToNode(t,{value:e})}},ko.bindingHandlers.numeric={init:function(t,e,r,n,i){var a=e();if(!ko.isWriteableObservable(a))throw"You must pass a Knockout observable or writeable computed";var o=r.get("precisionMax")||0,s=r.get("precision")||0,r=ko.computed({disposeWhenNodeIsRemoved:t,read:function(){var t=parseFloat(a()),e=M(o),r=M(s);return r<e?pd.toStringWithPrecisionRange(t,r,e):r<0?t.toString():t.toFixed(r)},write:function(t){a(parseFloat(t))}});"SELECT"==t.nodeName||"INPUT"==t.nodeName?ko.applyBindingsToNode(t,{value:r},i):ko.applyBindingsToNode(t,{text:r},i)}},ko.bindingHandlers.currencyValue={init:function(t,e){var e=e()||{},n=ko.isObservable(e.value)?e.value:ko.observable(0),i=ko.unwrap(e.symbol)||"£",e=ko.pureComputed({read:function(){return i+parseFloat(n()).toFixed(2)},write:function(t){var e=n(),r=parseFloat(t.replace(i,""));r!==e?n(r):t!==e.toString()&&n.valueHasMutated()}});ko.applyBindingsToNode(t,{value:e})}},ko.bindingHandlers.angleValue={init:function(t,e){var n=e(),e=ko.pureComputed({read:function(){return pd.toStringWithPrecisionRange(n(),2,9)+"°"},write:function(t){var e=n(),r=parseFloat(t);r!==e?n(r):t!==e.toString()&&n.valueHasMutated()}});ko.applyBindingsToNode(t,{value:e})}},ko.bindingHandlers.angleText={init:function(t,e){var r=e(),e=ko.pureComputed(function(){var t=r();return isNaN(t)?"-":pd.toStringWithPrecisionRange(t,2,9)+"°"});ko.applyBindingsToNode(t,{text:e})}},ko.bindingHandlers.timeText={init:function(t,e){var r=e(),e=ko.pureComputed(function(){return pd.DateTime.formatTime(r())});ko.applyBindingsToNode(t,{text:e})}},ko.bindingHandlers.dateText={init:function(t,e){var r=e(),e=ko.pureComputed(function(){return pd.DateTime.formatDate(pd.wrapAt(r(),0,365))});ko.applyBindingsToNode(t,{text:e})}},ko.bindingHandlers.toFixed={init:function(t,e,r){var n=e(),i=r.get("precision"),a=r.get("prefix"),o=r.get("suffix");ko.isObservable(n)||(s=e()||{},n=ko.isObservable(s.value)?s.value:ko.observable(0),i=s.precision),null==i&&(i=2);var s=ko.pureComputed(function(){var t=T(n,0),e=a?A(a):"",r=Math.round(M(i));return e+=i<0?t.toString():t.toFixed(r),o&&(e+=A(o)),e});ko.applyBindingsToNode(t,{text:s})}},ko.bindingHandlers.fixedPrecision={init:function(t,e,r){var n=e(),i=r.get("precision");ko.isObservable(n)||(a=e()||{},n=ko.isObservable(a.value)?a.value:ko.observable(0),i=a.precision),null==i&&(i=2);var a=ko.pureComputed(function(){var t=Math.round(M(i));return parseFloat(+n()||0).toFixed(t)});ko.applyBindingsToNode(t,{text:a})}},ko.bindingHandlers.contentEditable={init:function(t,e){var r=e();ko.applyBindingsToNode(t,{text:r}),t.addEventListener("blur",function(){ko.isWriteableObservable(r)&&r(this.textContent.trim())}),t.contentEditable=!0}},ko.bindingHandlers.clickWithoutFocus={init:function(t,e,r,n,i){var a=$(t);ko.utils.registerEventHandler(a,window.PointerEvent?"pointerdown":"mousedown touchstart",function(t){(void 0!==t.button&&t.button<=0||0==t.which)&&t.type&&"touchstart"==t.type&&a.click(),t.preventDefault()}),ko.bindingHandlers.click.init(t,e,r,n,i)}},ko.bindingHandlers.repeatButton={init:function(t,e,r,n,i){var a=$(t),o=r.get("interval")||100,s=r.get("delay")||400,d=null,h=null;ko.utils.registerEventHandler(t,window.PointerEvent?"pointerdown":"mousedown touchstart",function(t){(void 0!==t.button&&t.button<=0||0==t.which)&&(t.type&&"touchstart"==t.type&&a.click(),h=setTimeout(function(){d=setInterval(function(){a.click()},M(o))},M(s))),t.preventDefault()}),ko.utils.registerEventHandler(t,"mouseup mouseout touchend touchcancel touchleave pointerup pointerleave",function(){d&&(clearInterval(d),d=null),h&&(clearTimeout(h),h=null)}),ko.bindingHandlers.click.init(t,e,r,n,i)}},ko.bindingHandlers.radioButton={init:function(t,e,r){var n=e();if(!ko.isWriteableObservable(n))throw"You must pass a Knockout observable or writeable computed";t=(t=$(t)).hasClass("btn")?t:$(".btn",t),n.shiftKey=!1;var i=r();t.each(function(){var e=$(this),r=void 0!==i.radioValue?i.radioValue:void 0!==e.attr("data-value")?e.attr("data-value"):void 0!==e.attr("value")?e.attr("value"):e.text();return e.on("click",function(t){n.shiftKey=t.shiftKey,n(ko.utils.unwrapObservable(r)),e.blur()}),e.blur(),ko.computed({disposeWhenNodeIsRemoved:this,read:function(){var t=n()===ko.utils.unwrapObservable(r);e.toggleClass("btn-info",t).toggleClass("active",t)}})})}},ko.bindingHandlers.checkButton={init:function(t,e){var r=e();if(!ko.isWriteableObservable(r))throw"You must pass a Knockout observable or writeable computed";var n=$(t);function i(){var t=!!r();n.toggleClass("active",t),n.hasClass("btn")&&n.toggleClass("btn-info",t)}i(),r.subscribe(i),n.on("click",function(){r(!n.hasClass("active")),n.blur()})}},ko.bindingHandlers.radioMenuItem={init:function(t,e,r){var n=e();if(!ko.isWriteableObservable(n))throw"You must pass a Knockout observable or writeable computed";t="menuitem"==(t=$(t)).attr("role")?t:$("a[role=menuitem]",t);var i=r();t.each(function(){var e=$(this),r=void 0!==i.radioValue?i.radioValue:void 0!==e.attr("data-value")?e.attr("data-value"):void 0!==e.attr("value")?e.attr("value"):e.text();return e.on("click",function(){n(ko.utils.unwrapObservable(r)),e.blur()}),e.blur(),ko.computed({disposeWhenNodeIsRemoved:this,read:function(){var t=n()===ko.utils.unwrapObservable(r);e.toggleClass("active",t),e.find(".icon").toggleClass("icon-radio-unchecked",!t).toggleClass("icon-radio-checked",t)}})})}},ko.bindingHandlers.checkMenuItem={init:function(t,e){var r=e();if(!ko.isWriteableObservable(r))throw"You must pass a Knockout observable or writeable computed";var n=$(t);function i(){var t=!!r();n.toggleClass("active",t),n.find(".icon").toggleClass("icon-unchecked",!t).toggleClass("icon-checked",t)}i(),r.subscribe(i),n.on("click",function(){r(!n.hasClass("active")),n.blur()})}},ko.bindingHandlers.table={init:function(){return{controlsDescendantBindings:!0}},update:function(t,e){var e=ko.utils.unwrapObservable(e())||[],e=pd.isArray(e)?{data:e}:e,r=ko.utils.unwrapObservable(e.data),n=ko.utils.unwrapObservable(e.dataClass),i=ko.utils.unwrapObservable(e.header),a=ko.utils.unwrapObservable(e.headerClass),o=[],s=0,d=0,h="",l="<table>";if(i&&i.length){l+="<thead>";for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.length){l+='<tr class="top'+c+'">';for(var p=0;p<u.length;++p){var f=u[p];l+="<th",o=[],d=s=0,h=pd.isObject(f)?(f.itemClass&&o.push(f.itemClass.toString()),f.colspan&&(s=pd.toNumber(f.colspan)),f.rowspan&&(d=pd.toNumber(f.rowspan)),f.value?f.value.toString():""):f?f.toString():"",a&&o.push(a),o.length&&(l+=' class="'+o.join(" ")+'"'),0<s&&(l+=' colspan="'+Math.round(s)+'"'),0<d&&(l+=' rowspan="'+Math.round(d)+'"'),l+=">"+h+"</th>"}l+="</tr>"}}l+="</thead>"}if(r&&r.length){l+="<tbody>",n=n&&' class="'+n.toString()+'"',o=[];for(c=d=s=0;c<r.length;++c){var m=r[c];if(m&&m.length){l+="<tr>";for(p=0;p<m.length;++p){l+="<td";var g=m[p];n&&(l+=n),l+=">"+(h=g?g.toString():"")+"</td>"}l+="</tr>"}}l+="</tbody>"}for(l+="</table>";t.firstChild;)ko.removeNode(t.firstChild);e=t.ownerDocument.createElement("div");e.innerHTML=l;for(var y=e.firstChild;y.firstChild;)t.appendChild(y.firstChild)}},ko.bindingHandlers.editableDimension={init:function(r,t,e,n,i){var a=t(),t=e().numericOptions||{},o=e.get("step")||0,s=t.formatter||a.formatter;s&&ko.isObservable(s)||(s=ko.pureComputed({read:function(){return pd.Dimension.formatDimension(+a(),pd.Dimension.type,-1,!0)},write:function(t){a(pd.Dimension.parseDimension(t))},owner:this}));var d=t.incrementor||a.incrementor;d&&"function"==typeof d||(d=function(t,e){var r;t&&e&&((r=M(o))<1e-6&&(r=pd.Dimension.getDefaultStep()),r=pd.Dimension.incrementDimension(t,e,a(),r),a(r))}),ko.utils.registerEventHandler(r,"wheel mousewheel DOMMouseScroll",function(t){var e=pdDOM.getScrollIncrement(t);e&&(d(t,e,a),t.preventDefault())}),ko.utils.registerEventHandler(r,"keydown",function(t){return 13==t.which?(s($(r).val()),void $(r).focus().select()):void(!d||(e=pdDOM.getKbdIncrement(t))&&d(t,e,a));var e}),ko.utils.registerEventHandler(r,"blur",function(){s($(r).val())});var h=e.get("dblclick")||null;h&&ko.utils.registerEventHandler(r,"dblclick",function(t){h(t,$(r),a)}),"SELECT"==r.nodeName||"INPUT"==r.nodeName?ko.applyBindingsToNode(r,{value:s},i):ko.applyBindingsToNode(r,{text:s},i)}},ko.setValueWithoutUndo=function(t,e){t&&(t.undoIgnore=!0,t(e),t.undoIgnore=!1)},ko.UndoRedoQueue=function(){var o=ko.observableArray([]),s=ko.observableArray([]),d=!1,n=!1;function r(t){return{value:ko.utils.unwrapObservable(t()),item:t}}this.isWorking=function(){return d},this.canUndo=ko.pureComputed(function(){return 256<o().length&&o().shift(),0<o().length}),this.canRedo=ko.pureComputed(function(){return 0<s().length}),this.undo=function(){if(0<o().length){var t,e,r=[],n=o.pop();d=!0;for(var i=0,a=n.length;i<a;i++)e=n[i].item,t="state"in n[i]?n[i].state:ko.utils.unwrapObservable(e()),e(n[i].value),e.onUndo&&"function"==typeof e.onUndo&&e.onUndo(n[i].value),"state"in n[i]&&(n[i].state=n[i].value),n[i].value=t,r.push(n[i]);0<r.length&&s.push(r),d=!1}return this},this.redo=function(){if(0<s().length){var t,e,r=[],n=s.pop();d=!0;for(var i=0,a=n.length;i<a;i++)e=n[i].item,t="state"in n[i]?n[i].state:ko.utils.unwrapObservable(e()),e(n[i].value),e.onUndo&&"function"==typeof e.onUndo&&e.onUndo(n[i].value),"state"in n[i]&&(n[i].state=n[i].value),n[i].value=t,r.push(n[i]);0<r.length&&o.push(r),d=!1}return this},this.reset=function(){return o([]),s([]),this};var i=[];this.storeValues=function(){for(var t=i.length=0,e=arguments.length;t<e;t++)ko.isObservable(arguments[t])&&i.push(r(arguments[t]));return this},this.checkForChanges=function(){if(0<i.length){for(var t=[],e=i.length,r=0;r<e;r++)i[r].value!=ko.utils.unwrapObservable(i[r].item())&&t.push(i[r]);0<t.length&&(o.push(t),s([])),i.length=0}return this};var a=[],h=[],l=20,c=2500,u=-1,p=0;function f(){var t,e;!d&&!n&&!this.undoIgnore&&0<=this.undoIndex&&(t=(new Date).getTime(),e=+this.undoIdleThreshold||c,this.undoIndex!=u?t-p<l&&0<o().length?o()[o().length-1].push(r(this)):(o.push([r(this)]),s([])):(this.undoNoCollation||t-this.undoTime>e)&&(o.push([r(this)]),s([])),u=this.undoIndex,this.undoTime=t,p=t)}this.addUndoEntry=function(t,e,r){return d||n||!ko.isObservable(t)||t.undoIgnore||(e={state:r,value:e,item:t},(t=(new Date).getTime())-p<l&&0<o().length?o()[o().length-1].push(e):(o.push([e]),s([])),u=-1,this.undoTime=t,p=t),this},this.add=function(){for(var t=0,e=arguments.length;t<e;t++)ko.isObservable(arguments[t])&&(a.push({item:arguments[t],value:ko.utils.unwrapObservable(arguments[t]())}),h.push(arguments[t].subscribe(f,arguments[t],"beforeChange")),arguments[t].undoIndex=a.length-1,arguments[t].undoIgnore=!1,arguments[t].undoTime=0);return this},this.addPostMonitor=function(){for(var t=0,e=arguments.length;t<e;t++)ko.isObservable(arguments[t])&&(a.push({item:arguments[t],value:ko.utils.unwrapObservable(arguments[t]())}),h.push(arguments[t].subscribe(f,arguments[t])),arguments[t].undoIndex=a.length-1,arguments[t].undoIgnore=!1,arguments[t].undoTime=0);return this},this.clear=function(){for(var t=0,e=h.length;t<e;t++)h.dispose();return h.length=0,a.length=0,n=!1,this};var m=[];return this.pause=function(){if(!d&&!n){m.length=0,n=!0;for(var t=0,e=a.length;t<e;t++)m.push(r(a[t].item))}return this},this.resume=function(){if(!d){if(n&&0<m.length){for(var t=[],e=0,r=m.length;e<r;e++)m[e].value!=ko.utils.unwrapObservable(m[e].item())&&t.push(m[e]);0<t.length&&(o.push(t),s([])),m.length=0}n=!1}return this},this.stop=function(){return d=!0,this},this.start=function(){return d=!1,n&&this.resume(),this},this},ko.undoableObservable=function(t){var r=ko.observable(t),n=ko.observableArray([]),i=ko.observableArray([]),e=ko.computed({read:function(){return r()},write:function(t){var e=r();void 0!==e&&n.push(e),r(t),i([])}});return e.undoable=ko.pureComputed(function(){return 0<n().length}),e.redoable=ko.pureComputed(function(){return 0<i().length}),e.undo=function(){var t;0<n().length&&(t=n.pop(),i.push(r()),r(t),e.onUndo&&"function"==typeof e.onUndo&&e.onUndo(t))},e.redo=function(){var t;0<i().length&&(t=i.pop(),n.push(r()),r(t),e.onUndo&&"function"==typeof e.onUndo&&e.onUndo(t))},e.reset=function(){n([]),i([])},e.getUndoStack=function(){return n()},e.getRedoStack=function(){return i()},e},ko.bindingHandlers.valueSlider={init:function(t,e,r){var h=e();if(!ko.isWriteableObservable(h))throw"You must pass a Knockout observable or writeable computed";var s=$(t),l=r.get("min")||0,c=r.get("max")||100,u=r.get("step")||.1,p=r.get("minor")||null,f=r.get("major")||null,e=r.get("enable")||!0,n=r.get("dblclick")||null,i=r.get("tapclick")||null,a=r.get("height")||"4px",m=r.get("wrap")||!1,g=M(e);function o(){var t=M(l),e=M(c),e=pd.safeDivide(parseFloat(h())-t,e-t),t=A(a).toString();s.css("background-size",1+99*e+"% "+t)}var y=pd.toInteger(r.get("width"),1);function d(t){s.css("opacity",t?"1.0":"0.35"),g=!!t}s.toggleClass("value-slider",!0),h.subscribe(o),o(),ko.isObservable(e)&&(e.subscribe(d),g||d(!1));var v=0,D=r.get("incrementor")||h.incrementor;function b(t,e){var r,n,i,a,o;g&&e&&(r=M(l),n=M(c),i=M(u),a=T(p,5*i),o=T(f,50*i),e(t,s,h,r,n,i,a,o),t.preventDefault())}function x(t){g&&n&&b(t,n)}D||"function"==typeof D||(D=w),pdDOM.Interaction.makeInteractive(t,{onpress:function(t){g&&0<=t.button&&t.button<2&&(y=Math.max(s.width(),1),v=parseFloat(h()))},ondrag:function(t){var e,r,n,i,a,o,s,d;g&&0<=t.button&&t.button<2&&(e=t.dragX*pdDOM.pageScale,r=M(l),n=M(c),i=M(u),s=T(p,5*i),a=T(f,50*i),o=A(m),(d=0)==t.button?d=e/y*(n-r):1==t.button&&(d=.25*pd.sign(e)*pd.interpolate(i,a,Math.min(1,(Math.abs(e)-1)/20)),t.metaKey=!0),v=o?pd.wrapAt(v+d,r,n):pd.constrainTo(v+d,r,n),s=t.shiftKey?a:1==t.button||t.ctrlKey||t.metaKey?i:s,h(pd.snapTo(v,s)))},onrelease:function(t){i&&g&&0<=t.button&&t.button<2&&!t.hasMoved()&&b(t,i)},onscroll:function(t){var e,r,n,i,a;g&&t.delta&&(e=M(l),r=M(c),n=M(u),i=T(p,5*n),a=T(f,50*n),D(t,t.delta,s,h,e,r,n,i,a),t.preventDefault())},ondoubletap:x,onlongclick:x,simple:!0})}},ko.bindingHandlers.numericSlider={init:function(t,e,r,n,i){var a=$(t),o=e(),s=r().numericOptions||{};ko.isObservable(o)&&ko.utils.registerEventHandler(t,"input change",function(){o(parseFloat(a.val()))});var d=s.incrementor||o.incrementor;return d&&"function"==typeof d?(ko.utils.registerEventHandler(t,"wheel mousewheel DOMMouseScroll",function(t){var e=pdDOM.getScrollIncrement(t);e&&(d(t,e),t.preventDefault())}),ko.utils.registerEventHandler(t,"keydown",function(t){var e=pdDOM.getKbdIncrement(t);e&&d(t,e)})):(ko.utils.registerEventHandler(t,"wheel mousewheel DOMMouseScroll",function(t){var e=pd.toNumber(a.attr("step"),.1);w(t,pdDOM.getScrollIncrement(t),0,o,pd.toNumber(a.attr("min"),0),pd.toNumber(a.attr("max"),100),e,pd.toNumber(a.attr("minor"),5*e),pd.toNumber(a.attr("major"),50*e)),t.preventDefault()}),ko.utils.registerEventHandler(t,"keydown",function(t){var e=pd.toNumber(a.attr("step"),.1);w(t,pdDOM.getKbdIncrement(t),0,o,pd.toNumber(a.attr("min"),0),pd.toNumber(a.attr("max"),100),e,pd.toNumber(a.attr("minor"),5*e),pd.toNumber(a.attr("major"),50*e))})),ko.bindingHandlers.value.init(t,e,r,n,i)},update:function(t,e,r,n,i){ko.bindingHandlers.value.update(t,e,r,n,i)}},ko.bindingHandlers.numericInput={init:function(r,t,e,n,i){var a=t(),t=e().numericOptions||{},o=t.formatter||a.formatter;o&&ko.isObservable(o)||(o=a);var s=t.incrementor||a.incrementor;return s&&"function"==typeof s&&ko.utils.registerEventHandler(r,"wheel mousewheel DOMMouseScroll",function(t){var e=pdDOM.getScrollIncrement(t);e&&(s(t,e,a),t.preventDefault())}),ko.utils.registerEventHandler(r,"keydown",function(t){return 13==t.which?(o($(r).val()),void $(r).focus().select()):void(!s||(e=pdDOM.getKbdIncrement(t))&&s(t,e,a));var e}),ko.utils.registerEventHandler(r,"blur",function(){o($(r).val())}),ko.bindingHandlers.value.init(r,o,e,n,i)}};ko.components.register("numeric-slider",{viewModel:function(t){var a=this;this.min=t.min||0,this.max=t.max||100,this.step=t.step||1,this.value=t.value||ko.observable(parseFloat(ko.unwrap(t.min))),this.title=t.title||"No Title",this.units=t.units||"",this.suffix=t.suffix||null,this.noLimits=t.noLimits||!1,t.formatter&&ko.isObservable(t.formatter)?this.formatter=t.formatter:this.value.formatter&&ko.isObservable(this.value.formatter)?this.formatter=this.value.formatter:(this.decimals=pd.isNumeric(t.decimals)?parseInt(t.decimals,10):t.decimals||2,this.formatter=ko.pureComputed({read:function(){var t=A(a.suffix),e=pd.toInteger(M(a.decimals),2),e=e<=0?parseInt(a.value(),10).toString():pd.toStringWithPrecisionRange(+a.value(),e,9);return t&&(e+=t),e},write:function(t){var e,r=pd.parseEqn(t);pd.toInteger(M(a.decimals),2)<=0&&(r=Math.round(r)),M(a.noLimits)||(e=M(a.min),t=M(a.max),r=pd.constrainTo(r,e,t)),a.value(r)},owner:this})),t.incrementor&&"function"==typeof t.incrementor?this.incrementor=t.incrementor:this.value.incrementor&&"function"==typeof this.value.incrementor?this.incrementor=this.value.incrementor:(this.largeIncrement=t.largeIncrement||100,this.smallIncrement=t.smallIncrement||10,this.incrementor=function(t,e){var r,n,i;(e=parseFloat(e))&&(r=M(a.largeIncrement),i=M(a.smallIncrement),n=M(a.step),e=t.shiftKey?5<Math.abs(e)?10*pd.sign(e)*r:pd.sign(e)*r:t.ctrlKey||t.metaKey?5<Math.abs(e)?pd.sign(e)*i:pd.sign(e):5<Math.abs(e)?r*pd.sign(e):i*pd.sign(e),e*=n,i=pd.incrementBy(+a.value(),e),M(a.noLimits)||(n=M(a.min),e=M(a.max),i=pd.constrainTo(i,n,e)),a.formatter(i))}),this.incrementValue=function(t,e,r){this.incrementor(r,t)}},template:'        <table class="numeric-slider">            <tr>                <td colspan="3">                    <h4>                        <span data-bind="html: title"></span>                        <small class=\'pull-right\' data-bind="html: units"></small>                    </h4>                </td>            </tr>            <tr>                <td>                    <div class="btn-group" role="group">                        <button type="button" class="btn btn-default btn-increment no-touch" data-bind="repeatButton: $data.incrementValue.bind($data, -10)"><span class="glyphicon glyphicon-chevron-left"></span></button>                        <button type="button" class="btn btn-default btn-increment no-touch" data-bind="repeatButton: $data.incrementValue.bind($data, -1)"><small><span class="glyphicon glyphicon-chevron-left"></span></small></button>                    </div>                </td>                <td class="pad-sides-4px">                    <input type="text" data-bind="numericInput: $data.value, numericOptions: { formatter: $data.formatter, incrementor: $data.incrementor }" class="form-control text-center text-dark" />                </td>                <td>                    <div class="btn-group" role="group">                        <button type="button" class="btn btn-default btn-increment no-touch" data-bind="repeatButton: $data.incrementValue.bind($data, 1)"><small><span class="glyphicon glyphicon-chevron-right"></span></small></button>                        <button type="button" class="btn btn-default btn-increment no-touch" data-bind="repeatButton: $data.incrementValue.bind($data, 10)"><span class="glyphicon glyphicon-chevron-right"></span></button>                    </div>                </td>            </tr>            <tr>                <td colspan="3">                    <input type="range" class="numeric" data-bind="attr: { min: $data.min, max: $data.max, step: $data.step }, numericSlider: $data.value, numericOptions: { incrementor: $data.incrementor }"/>                </td>            </tr>        </table>'})}();var pdKO=pdKO||{};!function(){function u(t,e){t&&(t.undoIgnore=!0,t(e),t.undoIgnore=!1)}function n(t,e){var o=this,r=!1,n=(e=e||{}).sliderid||"#slider-edit",i=e.id||"#popover-edit",s=!0,d=null;function h(t,e){var r,n=o.getTextInput()[0];n&&(t=pd.toInteger(t,0),e=pd.toInteger(e,t),(r=d.val().length)<e&&(e=r),e<t&&(t=e),t<0&&(t=0),n.setSelectionRange?n.setSelectionRange(t,e):n.selectionStart&&(n.selectionStart=t,n.selectionEnd=e))}this.title=ko.observable(e.title||"Edit Numeric Value"),this.min=ko.observable(pd.toNumber(e.min,0)),this.max=ko.observable(pd.toNumber(e.max,100)),this.step=ko.observable(pd.toNumber(e.step,.1)),this.major=ko.observable(pd.toNumber(e.major,10)),this.minor=ko.observable(pd.toNumber(e.minor,1)),this.decimals=ko.observable(pd.toInteger(e.decimals,2)),this.value=ko.observable(pd.toNumber(e.value,0)),this.value.subscribe(function(){s=!0}),this.units=pd.UnitType.NONE,this.constrainToMin=ko.observable(pd.toBoolean(e.constrainToMin,!0)),this.constrainToMax=ko.observable(pd.toBoolean(e.constrainToMax,!0)),this.action=ko.observable(e.action||null),this.payload=ko.observable(e.payload||null),this.getTextInput=function(){return d||(d=$(n).find("input[type=text]"))&&d.on("click",function(){d.prop("readonly",!1)}),d},this.selectAndFocus=function(){return this.getTextInput().focus().select(),o.emit("editor:focus",o.payload()),o},this.openAt=function(t,e,r){return pdKO.showPopoverAtPoint($(i),t,e,{placement:r}),o},this.open=function(t,e){return null==t?$(i).popoverX("show"):pdKO.showPopoverOnElement($(i),t,{placement:e}),o},this.close=function(){return $(i).popoverX("hide"),o},this.isPopupVisible=function(){return r},this.symbols=ko.observable(!1),this.calcButton=function(t){var e,r,n=(d=d||o.getTextInput()).val(),i=d.prop("selectionStart"),a=d.prop("selectionEnd");switch(pd.isNumeric(t)&&(t=String.fromCharCode(t)),t){case"<":i<a?(r=n.substring(0,i)+n.substring(a,n.length),d.val(r),h(i)):i==a&&0<i&&i<n.length-1?(r=n.substring(0,i-1)+n.substring(a,n.length),d.val(r),h(i-1)):s?d.val(""):(d.val(n.substring(0,n.length-1)),h(9999));break;case"$":return void o.symbols(!o.symbols());case"@":switch((pdDOM.isMobile||pdDOM.isWindows10)&&d.prop("readonly",!0),o.units){case pd.UnitType.LENGTH:e=pd.Dimension.parseDimension(d.val());break;case pd.UnitType.TIME_HRS:e=pd.DateTime.parseTimeToDecimalHours(d.val());break;default:e=pd.parseEqn(d.val())}isNaN(e)||(o.value(e),pdDOM.isMobile||pdDOM.isWindows10?h(9999):(d.focus().select(),d.focus().select()),s=!0);break;default:i<a||i==a&&0<i&&i<n.length-1?(r=n.substring(0,i)+t+n.substring(a,n.length),d.val(r),h(i+1)):(s?d.val(t):d.val(n+t),h(9999)),s=!1}o.symbols()&&o.symbols(!1)},this.handlePopoverShow=function(){s=r=!0;var t=o.getTextInput();o.emit("editor:show",o.payload()),pdDOM.isMobile||pdDOM.isWindows10?(t.prop("readonly",!0),h(9999)):(setTimeout(function(){o.selectAndFocus()},250),t.prop("readonly",!1))},this.handlePopoverHide=function(){r=!1,o.emit("editor:hide",o.payload()),o.action(null)},pd.addSimpleEventHandling(o),this.set=function(t){return pdKO.setWritableObservables(t,o),this}}pdKO.setWritableObservables=function(t,e){var r=0;if(t&&e)for(var n in t)t.hasOwnProperty(n)&&ko.isWritableObservable(e[n])&&(e[n](t[n]),++r);return r},pdKO.SaveAsViewModel=function(t,e){var r=this,n=(e=e||{}).id||"#modal-save";this.title=ko.observable(e.title||"Save File"),this.filename=ko.observable(e.filename||"[No Name]"),this.extension=ko.observable(e.extension||".json"),this.message=ko.observable(e.message||"Enter the filename to save your data as:"),this.action=ko.observable(e.action||null),this.selectAndFocus=function(){return $(n).find("input[type=text]").focus().select(),this},this.open=function(){return $(n).modal("show"),this},this.close=function(){return $(n).modal("hide"),this},this.handlePopoverShow=function(){pdDOM.isMobile||pdDOM.isWindows10||setTimeout(function(){r.selectAndFocus()},250)},this.submitFile=function(){var t=r.filename().toString();if(t&&0<t.length){var e=r.extension();if(!pd.endsWith(t,e))return r.filename(t+e),void r.selectAndFocus();e=r.action()||null;if(e&&e(t))return void r.close()}return r.selectAndFocus(),this},this.set=function(t){return pdKO.setWritableObservables(t,r),this},e=null},pdKO.confirmExecuteScript=function(){var t=localStorage.getItem("allowScripts"),e=new Date(t).getTime(),r=new Date,t=r.getTime();if(e<t||t+864e5<e){if(!confirm("This will execute the JavaScript commands in this file.\n\nEverything is fully sandboxed so it can't go too wrong, worst case you may need to reload the page. However you should always check scripts for any malicious content before you run them.\n\nAllow drag/drop scripts for the rest of today?"))return!1;r.setHours(24,0,0,0),localStorage.setItem("allowScripts",r.toString())}return!0},pdKO.executeScript=function(t){return!!(t&&(t instanceof window.FileReader&&(t=t.result),"string"==typeof t||t instanceof String||(t=t.toString()),t.length&&pdKO.confirmExecuteScript()))&&(window.eval("(function() {\n\n"+t+"\n})();\n"),!0)},pdKO.importFiles=function(t,e){if(e=e||{},window.FileReader&&null!=t&&0<t.length&&(!e.model||!function(e,r){var t=!1,n=-1,i=[],a=null,o={},s=new FileReader,d=0,h=0,l={materials:o,node:null};if(r){for(var c=0,u=e.length;c<u;++c)pd.endsWith(e[c].name,".obj")?(n<0&&(n=c),t=!0):pd.endsWith(e[c].name,".mtl")?(i.push({index:c,type:"mtl"}),t=!0):pd.endsWith(e[c].name,".stl")?(i.push({index:c,type:"stl"}),t=!0):pd.endsWith(e[c].name,".ply")?(i.push({index:c,type:"ply"}),t=!0):pd.endsWith(e[c].name,".mod")&&(i.push({index:c,type:"mod"}),t=!0);return t&&(d=i.length,setTimeout(p,50),1)}function p(){if(h==d)0<=n?(s.onload=f,a=e[n],s.readAsText(a)):r(l.node);else if(h<d){var t=i[h];switch(a=e[t.index],t.type){case"mtl":s.onload=m,s.readAsText(a);break;case"stl":s.onload=g,s.readAsText(a);break;case"ply":s.onload=y,s.readAsText(a);break;case"mod":s.onload=v,s.readAsText(a)}}h++}function f(){l.node=pd3D.parseOBJ(s,l),r(l.node)}function m(){var t=a.name.split("/").pop();o[t]=pd3D.parseMTL(s),p()}function g(){l.node=pd3D.parseSTL(s,l),p()}function y(){l.node=pd3D.parsePLY(s,l),p()}function v(){l.node=pd3D.parseMOD(s,l),p()}}(t,e.model))){var r=!1,n=new FileReader,i=t[0];if(pd.isArray(e.extra))for(var a=0,o=e.extra.length;a<o;++a){var s=e.extra[a];"function"!=typeof s.callback||s.match&&!pd.endsWith(i.name.toLowerCase(),s.match.toLowerCase())&&i.type!==s.match||(n.onload=function(t,e,r){return function(){t.callback(e,r)}}(s,n,i),n.readAsText(i),r=!0)}r||"function"!=typeof e.json||i.type&&!/text|json/i.test(i.type)||!pd.endsWith(i.name,".json")||(n.onload=function(){e.json(n,i)},n.readAsText(i),r=!0),r||i.type&&!/text|javascript/i.test(i.type)||!pd.endsWith(i.name,".js")||pdKO.confirmExecuteScript()&&(n.onload=function(){pdKO.executeScript(n),"function"==typeof e.script&&e.script()},n.readAsText(i),r=!0),r||("function"==typeof e.error?e.error(i):window.alert("ERROR: File does not contain a recognisable data format."))}},pdKO.ModelViewModel=function(t,r,n){var i=this;this.units=ko.observable(pd.toInteger(r.units,0)),this.units.subscribe(function(t){var e=pd.Dimension.type,t=parseInt(t,10);(t==pd.DimensionType.IMPERIAL&&e!=pd.DimensionType.IMPERIAL||t!=pd.DimensionType.IMPERIAL&&e==pd.DimensionType.IMPERIAL)&&(e=t==pd.DimensionType.IMPERIAL?6.35:5,i.snapGrid(pd.snapTo(i.snapGrid(),e)),i.snapStep(e)),pd.Dimension.type=r.units=t,n&&(n.setModelSnap(n.preferredModelSnap),n.environment._groundMesh&&n.environment.updateGroundPlane(n)),i.snapGrid.valueHasMutated()}),this.shadowsShow=ko.observable(r.shadowsShow||!1),this.shadowsShow.subscribe(function(t){r.shadowsShow=!!t,n&&window.gl&&(r.shadowsShow?(n.updateBoundingBox(!0),n.environment.hasOwnShadowMap||n.createShadowMap(2048,window.gl.RGB)):n.environment.hasOwnShadowMap&&n.clearShadowMap(),window.gl.update())}),this.onShowDimensionsChange=null,this.onDimensionSizeChange=null;var e=new pdDOM.ThrottledUpdate(function(){i.onDimensionSizeChange&&i.onDimensionSizeChange(i),window.gl&&window.gl.update()},50);this.dimensionsShow=ko.observable(r.dimensionsShow||!1),this.dimensionsShow.subscribe(function(t){r.dimensionsShow=!!t,i.onShowDimensionsChange&&i.onShowDimensionsChange(i),window.gl&&window.gl.update()}),this.dimensionSize=ko.observable(pd.toNumber(r.dimensionSize,.65)),this.dimensionSize.subscribe(function(t){r.dimensionSize=pd.constrainTo(parseFloat(t),.05,2),r.dimensionsShow&&e.trigger()}),this.modelSize=ko.observable(1e4),this.snapStep=ko.observable(pd.Dimension.type==pd.DimensionType.IMPERIAL?6.35:5),this.snapMax=ko.computed(function(){return pd.snapTo(.1*i.modelSize(),100*i.snapStep())},this),this.snapMin=ko.computed(function(){return-i.snapMax()},this),this.snapActive=ko.observable(r.snapActive||!1),this.snapActive.subscribe(function(t){r.snapActive=!!t,gl.orbitalView.snapGrid=r.snapActive?r.snapGrid:0}),this.snapAlignBounds=ko.observable(r.snapAlignBounds||!1),this.snapAlignBounds.subscribe(function(t){r.snapAlignBounds=!!t}),this.snapAlignCenter=ko.observable(r.snapAlignCenter||!1),this.snapAlignCenter.subscribe(function(t){r.snapAlignCenter=!!t}),this.snapAlignGrid=ko.observable(r.snapAlignGrid||!1),this.snapAlignGrid.subscribe(function(t){r.snapAlignGrid=!!t,i.snapActive()&&r.snapAlignGrid?(n&&n.setModelSnap(r.snapGrid),gl.orbitalView.snapGrid=r.snapGrid):gl.orbitalView.snapGrid=1}),this.snapToAdjacent=ko.observable(r.snapToAdjacent||!1),this.snapToAdjacent.subscribe(function(t){r.snapToAdjacent=!!t}),this.snapToSelected=ko.observable(r.snapToSelected||!1),this.snapToSelected.subscribe(function(t){r.snapToSelected=!!t}),this.snapToAll=ko.observable(r.snapToAll||!1),this.snapToAll.subscribe(function(t){r.snapToAll=!!t}),this.snapGrid=ko.observable(pd.toNumber(r.snapGrid,25)),this.snapGrid.subscribe(function(t){r.snapGrid=parseFloat(t),i.snapActive()&&i.snapAlignGrid()&&(n&&n.setModelSnap(r.snapGrid),gl.orbitalView.snapGrid=r.snapGrid)}),this.snapGrid.incrementor=function(t,e){t&&e&&(e=pd.Dimension.incrementDimension(t,e,i.snapGrid(),i.snapStep()),i.snapGrid(Math.max(0,e)))},this.snapGrid.formatter=ko.pureComputed({read:function(){return pd.Dimension.formatDimension(+i.snapGrid(),pd.Dimension.type,-1,!0)},write:function(t){i.snapGrid(pd.Dimension.parseDimension(t))},owner:this}),this.extentsMax=ko.computed(function(){return pd.snapTo(i.modelSize(),i.snapGrid())},this),this.extentsMin=ko.computed(function(){return-i.extentsMax()},this),this.set=function(t){return pdKO.setWritableObservables(t,i),this}},pdKO.showPopoverOn=function(t){var e=pd.isString(t)?$(t):t,r=e.attr("data-placement")||"top",t=$(e.attr("data-target"));t&&(t.popoverX({$target:e,placement:r}),t.popoverX("show"))},pdKO.showPopoverAtPoint=function(t,e,r,n){var i=(n=n||{}).$target||$("#overlay-popover-pos");if(t&&0<i.length){var a=n.placement||"bottom",o=e-4,s=r-4,e=.5*t.width()+5,r=t.height()+5;return o<e?a="right":o>window.innerWidth-e?a="left":s>window.innerHeight-r?a="top":s<r&&(a="bottom"),o+=pd.toNumber(n.offsetX,0),s+=pd.toNumber(n.offsetY,0),o*=pdDOM.pageScale,s*=pdDOM.pageScale,i.show().css({left:o+"px",top:s+"px"}),t.popoverX({$target:i,placement:a}),t.popoverX("show"),i!=n.$target&&i.hide(),!0}return!1},pdKO.showPopoverOnElement=function(t,e,r){if(t&&0<t.length&&e&&0<e.length){var n=(r=r||{}).placement||"bottom",i=r.$target||$("#overlay-popover-pos");if(0<i.length&&i[0]!=e[0]){var a=e.offset(),o=e.outerWidth(),s=e.outerHeight(),d=pd.toNumber(r.offsetX,0),h=pd.toNumber(r.offsetY,0);0<=n.indexOf("left")?d+=0:0<=n.indexOf("right")?d+=Math.round(o)-8:d+=Math.round(.5*o)-4,0<=n.indexOf("top")?h+=0:0<=n.indexOf("bot")?h+=Math.round(s)-8:h+=Math.round(.5*s)-4;var l=5,c=t.width()+l,u=t.height()+l,p=a.left+d,f=a.top+h;switch(pdDOM.isFirefox&&(p*=pdDOM.pageScale,f*=pdDOM.pageScale),n){case"left":p<=c&&(d=pd.toNumber(r.offsetX,0),d+=Math.round(o)-8,p=a.left+d,n="right");break;case"right":p>window.innerWidth-c&&(d=pd.toNumber(r.offsetX,0),p=a.left+d,n="left");break;case"top":f<=u&&(h=pd.toNumber(r.offsetY,0),h+=Math.round(s)-8,f=a.top+h,n="bottom");break;case"bottom":f>=window.innerHeight-u&&(h=pd.toNumber(r.offsetY,0),f=a.top+h,n="top")}switch(n){case"left":case"right":f<.5*u?(n+=" "+n+"-top",f-=Math.round(.1*u)-4):f>window.innerHeight-.5*u&&(n+=" "+n+"-bottom",f+=Math.round(.1*u)-4);break;case"top":case"bottom":p<.5*c?(n+=" "+n+"-left",p-=Math.round(.1*c)-4):p>window.innerWidth-.5*c&&(n+=" "+n+"-right",p+=Math.round(.1*c)-4)}i.show().css({left:p+"px",top:f+"px"}),t.popoverX({$target:i,placement:n}),t.popoverX("show"),i!=r.$target&&i.hide()}else{a=e.offset(),o=e.outerWidth(),s=e.outerHeight();a.right=a.left+o,a.bottom=a.top+o;l=5,u=t.height()+l,c=t.width()+l;switch(n){case"left":a.left<=c&&(n="right");break;case"right":a.right>window.innerWidth-c&&(n="left");break;case"top":a.top<=u&&(n="bottom");break;case"bottom":a.bottom>=window.innerHeight-u&&(n="top")}switch(n){case"left":case"right":a.top<.5*u?n+=" "+n+"-top":a.bottom>window.innerHeight-.5*u&&(n+=" "+n+"-bottom");break;case"top":case"bottom":a.left<.5*c?n+=" "+n+"-left":a.right>window.innerWidth-.5*c&&(n+=" "+n+"-right")}t.popoverX({$target:e,placement:n}),t.popoverX("show")}return!0}return!1},pdKO.NumericEditViewModel=function(t,e){var a=this;(e=e||{}).id=e.id||"#popover-editnum",e.sliderid=e.sliderid||"#slider-editnum",e.title=e.title||"Edit Numeric Value",n.call(this,t,e),this.value.subscribe(function(t){var e;(t=pd.toNumber(t,0))<a.min()?a.value(a.min()):t>a.max()?a.value(a.max()):a.value.undoIgnore||(e=a.action()||null)&&e(t,a.payload())}),this.value.incrementor=function(t,e){var r,n,i;t&&e&&(r=a.min(),i=a.max(),n=a.step(),r<i&&(t.shiftKey?n=a.major():t.ctrlKey||t.metaKey||(n=a.minor()),i=pd.constrainTo(parseFloat(a.value())+e*n,r,i),a.value(pd.snapTo(i,e*n))))},this.value.formatter=ko.pureComputed({read:function(){var t=a.value();switch(a.units){case pd.UnitType.LENGTH:return pd.Dimension.formatDimension(t,pd.Dimension.type,-1,!0);case pd.UnitType.TIME_HRS:return pd.DateTime.formatTime(parseFloat(t));default:var e=pd.toInteger(a.decimals(),2);return 0<e?pd.toStringWithPrecisionRange(t,e,9):parseInt(t,10).toString()}},write:function(t){var e=0;switch(a.units){case pd.UnitType.LENGTH:e=pd.Dimension.parseDimension(t);break;case pd.UnitType.TIME_HRS:e=pd.DateTime.parseTimeToDecimalHours(t);break;default:e=pd.parseEqn(t);pd.toInteger(a.decimals(),2)<=0&&(e=Math.round(e))}var r=a.min(),t=a.max();e=pd.constrainTo(e,r,t),a.value(e)},owner:this})},pdKO.NumericEditViewModel.prototype=Object.create(n.prototype),pdKO.NumericEditViewModel.prototype.constructor=pdKO.NumericEditViewModel,pdKO.DimensionEditViewModel=function(t,e){var r=this;(e=e||{}).id=e.id||"#popover-editdim",e.sliderid=e.sliderid||"#slider-editdim",e.title=e.title||"Edit Dimension",n.call(this,t,e),this.showAbout=ko.observable(pd.toBoolean(e.showAbout,!0)),this.about=ko.observable(pd.toInteger(e.about,1)),this.units=pd.UnitType.LENGTH,this.value.subscribe(function(t){return t=pd.toNumber(t,0),r.constrainToMin()&&t<r.min()?(r.value(r.min()),void r.value.valueHasMutated()):r.constrainToMax()&&t>r.max()?(r.value(r.max()),void r.value.valueHasMutated()):void(r.value.undoIgnore||(e=r.action()||null)&&e(t,r.payload()));var e}),this.value.incrementor=function(t,e){t&&e&&(e=pd.Dimension.incrementDimension(t,e,r.value(),r.step()),r.constrainToMin()&&(e=Math.max(r.min(),e)),r.constrainToMax()&&(e=Math.min(r.max(),e)),r.value(e))},this.value.formatter=ko.pureComputed({read:function(){return pd.Dimension.formatDimension(+r.value(),pd.Dimension.type,-1,!0)},write:function(t){r.value(pd.Dimension.parseDimension(t))},owner:this})},pdKO.DimensionEditViewModel.prototype=Object.create(n.prototype),pdKO.DimensionEditViewModel.prototype.constructor=pdKO.DimensionEditViewModel,pdKO.CameraViewModel=function(i,a){var o=this,t=!1;this.viewAzimuth=ko.observable(60).extend({fixedPrecision:2}),this.viewAzimuth.subscribe(function(t){o.viewAzimuth.undoIgnore||(gl.orbitalView.cameraAzi=pd.wrapAt(parseFloat(t),-180,180),o.updateViewTypeFromCamera(),gl.update())}),this.viewAltitude=ko.observable(30).extend({fixedPrecision:2}),this.viewAltitude.subscribe(function(t){o.viewAltitude.undoIgnore||(gl.orbitalView.cameraAlt=pd.wrapAt(parseFloat(t),-180,180),o.updateViewTypeFromCamera(),gl.update())}),this.viewAngle=ko.observable(45).extend({fixedPrecision:2}),this.viewAngle.subscribe(function(t){o.viewAngle.undoIgnore||(gl.orbitalView.cameraFOV=pd.constrainTo(parseFloat(t),0,160),gl.orbitalView.hasChanged=gl.PROJECTION,o.updateViewTypeFromCamera(),gl.update())}),this.incrementZoom=function(t,e,r){(t=parseFloat(t))&&(r&&(r.ctrlKey||r.metaKey?t/=10:r.shiftKey&&(t*=10)),gl.orbitalView.hasChanged=gl.PROJECTION,gl.orbitalView.zoom(.025*t),u(o.viewZoom,gl.orbitalView.zoomFactor))},this._setZoom=function(t){t=pd.constrainTo(pd.toNumber(t,0),-1,1),1e-4<Math.abs(t)?gl.orbitalView.zoom(t):(gl.orbitalView.hasChanged=gl.PROJECTION,gl.orbitalView.center()),u(o.viewZoom,gl.orbitalView.zoomFactor)},this.setZoom=this._setZoom,this.viewZoom=ko.observable(1).extend({fixedPrecision:3}),this.viewZoom.subscribe(function(t){o.viewZoom.undoIgnore||(t=pd.constrainTo(pd.toNumber(t,0),gl.orbitalView._zoomFactorMin,3),gl.orbitalView.setZoomFactor(t))}),this.handlePopoverShow=function(){t=!0,o.updateViewTypeFromCamera(),pd.closeTo(o.viewAzimuth(),gl.orbitalView.cameraAzi,.001)&&pd.closeTo(o.viewAltitude(),gl.orbitalView.cameraAlt,.001)&&pd.closeTo(o.viewAngle(),gl.orbitalView.cameraFOV,.001)||o.updateCameraOnViewChange(),i.UndoManager&&i.UndoManager.storeValues(o.viewAzimuth,o.viewAltitude,o.viewAngle)},this.handlePopoverHide=function(){i.UndoManager&&i.UndoManager.checkForChanges(),t=!1},this.isPopupVisible=function(){return t},this.updateCameraOnViewChange=function(t,e){u(o.viewAzimuth,gl.orbitalView.cameraAzi),u(o.viewAltitude,gl.orbitalView.cameraAlt),u(o.viewAngle,gl.orbitalView.cameraFOV),.99<e&&null!=a&&5==o.viewType()&&i.Animation&&i.Animation.pause(!1)},this.updateViewTypeFromCamera=function(){var t;.5<gl.orbitalView.cameraFOV?0!=o.viewType()&&o.setViewType(0,!0):(t=!1,null!=a&&(a.getSunAnglesArray(pdKO.sunPos),pd.closeTo(gl.orbitalView.cameraAlt,pdKO.sunPos[1],.1)&&pd.closeTo(gl.orbitalView.cameraAzi,pd.wrapAt(90-(pdKO.sunPos[0]+a.northOffset()),-180,180),.1)&&(t=!0)),t?o.setViewType(5,!0):pd.closeTo(gl.orbitalView.cameraAlt,90,.5)?o.setViewType(2,!0):pd.closeTo(gl.orbitalView.cameraAlt,0,.5)?pd.closeTo(gl.orbitalView.cameraAzi,90,.5)||pd.closeTo(gl.orbitalView.cameraAzi,-90,.5)?o.setViewType(3,!0):pd.closeTo(gl.orbitalView.cameraAzi,0,.5)||pd.closeTo(gl.orbitalView.cameraAzi,180,.5)?o.setViewType(4,!0):o.setViewType(1,!0):o.setViewType(1,!0))},this.setViewType=function(t,e){e?u(o.viewType,t):o.viewType(t)},this.viewType=ko.observable(0).extend({notify:"always"}),this.viewType.subscribe(function(t){if(t=parseInt(t,10),!o.viewType.undoIgnore){var e={},r=o.viewType.shiftKey?-90:130;switch(gl.orbitalView.orbitMode||(e.target=gl.orbitalView.defaultTarget,e.cameraDistance=gl.orbitalView.defaultDistance,e.zoomFactor=1),gl.orbitalView.orthoMode=0,t){case-1:var n=2.5<gl.orbitalView.cameraAlt&&gl.orbitalView.cameraAlt<87.5;e.cameraAzi=n?gl.orbitalView.cameraAzi:-45,e.cameraAlt=n?gl.orbitalView.cameraAlt:45,e.cameraFOV=0;break;default:case 0:e.cameraAzi=gl.orbitalView.cameraAzi,(pd.closeTo(gl.orbitalView.cameraAlt,45,.1)||gl.orbitalView.cameraAlt<2.5||87.5<gl.orbitalView.cameraAlt)&&(e.cameraAzi-=r),e.cameraAzi=pd.snapTo(e.cameraAzi+r,90)-45,e.cameraAlt=30,e.cameraFOV=45;break;case 1:e.cameraAzi=gl.orbitalView.cameraAzi,(.5<gl.orbitalView.cameraFOV||!pd.closeTo(gl.orbitalView.cameraAlt,45,.1))&&(e.cameraAzi-=r),e.cameraAzi=pd.snapTo(e.cameraAzi+r,90)-45,e.cameraAlt=45,e.cameraFOV=0;break;case 2:e.cameraAzi=gl.orbitalView.cameraAzi,(.5<gl.orbitalView.cameraFOV||!pd.closeTo(gl.orbitalView.cameraAlt,90,.1))&&(e.cameraAzi=-180),gl.orbitalView.orthoMode=1,e.cameraAzi=pd.snapTo(e.cameraAzi+r,90),e.cameraAlt=90,e.cameraFOV=0;break;case 3:pd.closeTo(gl.orbitalView.cameraAlt,0,.1)&&pd.closeTo(gl.orbitalView.cameraAzi,-90,.1)?e.cameraAzi=90:e.cameraAzi=-90,gl.orbitalView.orthoMode=2,e.cameraAlt=0,e.cameraFOV=0;break;case 4:pd.closeTo(gl.orbitalView.cameraAlt,0,.1)&&pd.closeTo(gl.orbitalView.cameraAzi,0,.1)?e.cameraAzi=180:e.cameraAzi=0,gl.orbitalView.orthoMode=2,e.cameraAlt=0,e.cameraFOV=0;break;case 5:null!=a&&(a.getSunAnglesArray(pdKO.sunPos),e.cameraAzi=pd.wrapAt(90-(pdKO.sunPos[0]+a.northOffset()),-180,180),e.cameraAlt=pdKO.sunPos[1],e.cameraFOV=0,i.Animation&&i.Animation.pause(!0))}gl.orbitalView.animateTo(e,o.updateCameraOnViewChange),gl.orbitalView._viewAngleMin=5==t?.75:.01}}),this.set=function(t){return pdKO.setWritableObservables(t,o),this}},pdKO.DisplayViewModel=function(t,e,r){var n=this;this.surfaceOpacity=ko.observable(pd.toNumber(e.surfaceOpacity,.8)),this.surfaceOpacity.subscribe(function(t){e.surfaceOpacity=parseFloat(t),r&&(r.environment.surfaceOpacity=e.surfaceOpacity),gl.update()}),this.outlineOpacity=ko.observable(pd.toNumber(e.outlineOpacity,.9)),this.outlineOpacity.subscribe(function(t){e.outlineOpacity=parseFloat(t),r&&(r.environment.outlineOpacity=e.outlineOpacity),gl.update()}),this.surfaceShininess=ko.observable(pd.toNumber(e.surfaceShininess,75)),this.surfaceShininess.subscribe(function(t){e.surfaceShininess=parseFloat(t),r&&(r.environment.surfaceShininess=e.surfaceShininess),gl.update()}),this.ambientFactor=ko.observable(pd.toNumber(e.ambientFactor,.6)),this.ambientFactor.subscribe(function(t){e.ambientFactor=parseFloat(t),r&&(r.environment.ambientFactor=e.ambientFactor),gl.update()}),this.handlePopoverShow=function(){t.UndoManager&&t.UndoManager.storeValues(n.surfaceOpacity,n.outlineOpacity,n.surfaceShininess,n.ambientFactor)},this.handlePopoverHide=function(){t.UndoManager&&t.UndoManager.checkForChanges()},this.set=function(t){return pdKO.setWritableObservables(t,n),this}},pdKO.sunPos=[0,0],pdKO.DateTimeViewModel=function(i,a,o){var s=this;function e(t){return t.toFixed(2)+"°"}o.getSunAnglesArray(pdKO.sunPos),this.onDateTimeChange=null;var d=!1,h=new pdDOM.ThrottledUpdate(function(){s.timeOfDay.azimuthAngle&&(s.timeOfDay.azimuthAngle(e(o.azimuthAngle())),s.timeOfDay.altitudeAngle(e(o.altitudeAngle()))),s.onDateTimeChange&&s.onDateTimeChange(s,d),d=!1},50);function n(t){var e=pdKO.sunPos[0],r=pdKO.sunPos[1],n=o.getSunAnglesArray(pdKO.sunPos);t&&(a&&(a.dayOfMonth=o.dayOfMonth(),a.monthOfYear=o.monthOfYear(),a.year=o.year()),s.updateDawnDuskValues(),d=!0),n[0]==e&&n[1]==r||h.trigger()}function r(e){var r=0,n=s.dayOfYear();e<n&&(e+=365),pd.closeTo(n,e)||(pdDOM.getGlobalAnimationQueue().addOrReplace(function(t){return 1<=(r+=2*t)?(s.setDayOfYear(e),i&&i.Animation&&i.Animation.pause(!1),!0):(t=pd.Easing.inOutSine(r),s.setDayOfYear((1-t)*n+t*e),!1)}).start(),i&&i.Animation&&i.Animation.pause(!0))}function l(e){var r=0,n=s.timeOfDay();pd.closeTo(n,e)||(pdDOM.getGlobalAnimationQueue().addOrReplace(function(t){return 1<=(r+=2*t)?(s.setTimeOfDay(e),i&&i.Animation&&i.Animation.pause(!1),!0):(t=pd.Easing.inOutSine(r),s.setTimeOfDay((1-t)*n+t*e),!1)}).start(),i&&i.Animation&&i.Animation.pause(!0))}this.dayOfYear=ko.observable(o.dayOfYear()),this.dayOfYear.subscribe(function(t){o.setDayOfYear(parseInt(t,10)),n(!0)}),this.dayOfYear.formatter=ko.pureComputed({read:function(){return o.formatAsDate(s.dayOfYear(),o.year())},write:function(t){var e,r=Date.parse(t.toString());pd.isNumeric(r)?((e=new Date).setTime(r),t=o.calcDayOfYearIndex(e.getDate(),e.getMonth(),e.getFullYear()),r=o.year()!=e.getFullYear(),o.year(e.getFullYear()),s.dayOfYear(t),r&&n(!0)):s.dayOfYear.valueHasMutated()},owner:this}),this.dayOfYear.incrementor=function(t,e){var r,n;(e=parseFloat(e))&&(r=parseInt(s.dayOfYear(),10),5<Math.abs(e)||t&&t.shiftKey?(t=(n=o.getDateObject()).getMonth()+(0<e?1:-1),n.setMonth(pd.wrapAt(t,0,12,!0)),r=o.calcDayOfYearIndex(n.getDate(),n.getMonth(),n.getFullYear())):r+=0<e?1:-1,s.dayOfYear(pd.wrapAt(r,0,o.isLeapYear()?366:365,!0)))},this.setDayOfYear=function(t){this.dayOfYear(Math.round(pd.wrapAt(t,0,365)))},this.createSolarPositionObservables=function(){s.timeOfDay.altitudeAngle=ko.observable(e(o.altitudeAngle())),s.timeOfDay.azimuthAngle=ko.observable(e(o.azimuthAngle()))},this.createTwilightObservables=function(){var t=o.getDuskDawnData();return s.dayOfYear.civilTwilight=ko.observable(o.formatAsTime(t.civilDawn)+" / "+o.formatAsTime(t.civilDusk)),s.dayOfYear.nauticalTwilight=ko.observable(o.formatAsTime(t.nauticalDawn)+" / "+o.formatAsTime(t.nauticalDusk)),s.dayOfYear.astronomicalTwilight=ko.observable(o.formatAsTime(t.astronomicalDawn)+" / "+o.formatAsTime(t.astronomicalDusk)),s},this.createSolarNoonAndDayLengthObservables=function(){return s.dayOfYear.dayLength=ko.observable(o.formatAsTime(o.sunsetTime()-o.sunriseTime())),s.dayOfYear.solarNoon=ko.observable(o.formatAsTime(o.solarNoon())),s},this.dayOfYear.sunriseTime=ko.observable(o.formatAsTime(o.sunriseTime())),this.dayOfYear.sunsetTime=ko.observable(o.formatAsTime(o.sunsetTime())),this.updateDawnDuskValues=function(){var t=o.getDuskDawnData();return s.dayOfYear.sunriseTime(o.formatAsTime(t.sunrise)),s.dayOfYear.sunsetTime(o.formatAsTime(t.sunset)),s.timeOfDay.azimuthAngle&&(s.timeOfDay.azimuthAngle(e(o.azimuthAngle())),s.timeOfDay.altitudeAngle(e(o.altitudeAngle()))),s.dayOfYear.solarNoon&&(s.dayOfYear.solarNoon(o.formatAsTime(t.solarNoon)),s.dayOfYear.dayLength(o.formatAsTime(t.sunset-t.sunrise))),s.dayOfYear.civilTwilight&&(s.dayOfYear.civilTwilight(o.formatAsTime(t.civilDawn)+" / "+o.formatAsTime(t.civilDusk)),s.dayOfYear.nauticalTwilight(o.formatAsTime(t.nauticalDawn)+" / "+o.formatAsTime(t.nauticalDusk)),s.dayOfYear.astronomicalTwilight(o.formatAsTime(t.astronomicalDawn)+" / "+o.formatAsTime(t.astronomicalDusk))),s},this.setUsefulDate=function(t){switch(t){case 0:r((o.latitude()<0?o.getSolsticeDec():o.getSolsticeJun()).dayOfYear);break;case 1:r((o.latitude()<0?o.getEquinoxMar():o.getEquinoxSep()).dayOfYear);break;case 2:r((o.latitude()<0?o.getSolsticeJun():o.getSolsticeDec()).dayOfYear);break;case 3:r((o.latitude()<0?o.getEquinoxSep():o.getEquinoxMar()).dayOfYear)}},this.setNextUsefulDate=function(){var t=o.dayOfYear(),e=o.getEquinoxMar().dayOfYear,r=o.getSolsticeJun().dayOfYear,n=o.getEquinoxSep().dayOfYear,i=o.getSolsticeDec().dayOfYear;o.latitude()<0?t<e?s.setUsefulDate(1):t<r?s.setUsefulDate(2):t<n?s.setUsefulDate(3):t<i?s.setUsefulDate(0):s.setUsefulDate(1):t<e?s.setUsefulDate(3):t<r?s.setUsefulDate(0):t<n?s.setUsefulDate(1):t<i?s.setUsefulDate(2):s.setUsefulDate(3)},this.timeOfDay=ko.observable(60*o.clockTime()),this.timeOfDay.subscribe(function(t){o.setTimeOfDay(parseFloat(t)/60),a.clockTime=o.clockTime(),n(!1)}),this.timeOfDay.formatter=ko.pureComputed({read:function(){return o.formatAsTime(s.timeOfDay()/60)},write:function(t){t=pd.DateTime.parseTimeToDecimalHours(t),t=pd.constrainTo(pd.isNumeric(t)?t:0,0,24);s.timeOfDay(60*t)},owner:this}),this.timeOfDay.incrementor=function(t,e){(e=parseFloat(e))&&(e=t.shiftKey?Math.abs(e)<5?30*pd.sign(e):Math.abs(e)<10?15*pd.sign(e):180*pd.sign(e):t.ctrlKey||t.metaKey?Math.abs(e)<10?pd.sign(e):5*pd.sign(e):Math.abs(e)<10?5*pd.sign(e):30*pd.sign(e),e=pd.incrementBy(s.timeOfDay(),e),s.timeOfDay(pd.wrapAt(e,0,1440,!0)))},this.clockTime=ko.computed({read:function(){return s.timeOfDay()/60},write:function(t){t=pd.toNumber(t,o.clockTime()),s.timeOfDay(60*t)},owner:s}),this.setTimeOfDay=function(t){this.timeOfDay(Math.round(pd.wrapAt(t,0,1440)))},this.setUsefulTime=function(t){switch(t){case 0:l(60*o.getDawnTime(o.twilight.ASTRONOMICAL));break;case 1:l(60*o.getDawnTime(o.twilight.NAUTICAL));break;case 2:l(60*o.getDawnTime(o.twilight.CIVIL));break;case 3:l(60*o.getDawnTime(o.twilight.SOLAR_DISK_TOP_WITH_ATM_REFRACTION));break;case 4:l(720);break;case 5:l(60*o.solarNoon());break;case 6:l(60*o.getDuskTime(o.twilight.SOLAR_DISK_TOP_WITH_ATM_REFRACTION));break;case 7:l(60*o.getDuskTime(o.twilight.CIVIL));break;case 8:l(60*o.getDuskTime(o.twilight.NAUTICAL));break;case 9:l(60*o.getDuskTime(o.twilight.ASTRONOMICAL))}},this.setNextUsefulTime=function(){var t=o.clockTime()+1/120,e=o.getDuskDawnData(),r=12,n=4,i=e.solarNoon,a=5;e.solarNoon<12&&(r=e.solarNoon,n=5,i=12,a=4),t<e.astronomicalDawn?s.setUsefulTime(0):t<e.nauticalDawn?s.setUsefulTime(1):t<e.civilDawn?s.setUsefulTime(2):t<e.sunrise?s.setUsefulTime(3):t<r?s.setUsefulTime(n):t<i?s.setUsefulTime(a):t<e.sunset?s.setUsefulTime(6):t<e.civilDusk?s.setUsefulTime(7):t<e.nauticalDusk?s.setUsefulTime(8):t<e.astronomicalDusk?s.setUsefulTime(9):s.setUsefulTime(0)},this.datetime=ko.computed({read:function(){return[s.dayOfYear(),s.timeOfDay()]},write:function(t){2==t.length&&(s.dayOfYear(parseInt(t[0],10)),s.timeOfDay(parseFloat(t[1])))},owner:s}),this.handlePopoverShow=function(){i.UndoManager&&(s.datetime.undoIgnore=!0,i.UndoManager.storeValues(s.dayOfYear,s.timeOfDay))},this.handlePopoverHide=function(){i.UndoManager&&(s.datetime.undoIgnore=!1,i.UndoManager.checkForChanges())},this.set=function(t){return pdKO.setWritableObservables(t,s),this}},pdKO.LocationViewModel=function(t,e,r,n){var o=this;n=pd.toNumber(n,50),this.onLocationChange=null,this.onNorthOffsetChange=null;var i=new pdDOM.ThrottledUpdate(function(){r.getSunAnglesArray(pdKO.sunPos),e&&(e.latitude=r.latitude(),e.longitude=r.longitude(),e.timezone=r.timezone()),o.onLocationChange&&o.onLocationChange(o)},50),a=null;function s(t){$&&$.snackbar&&(null!=a?t&&!a.hasClass("snackbar-opened")?a.snackbar("show"):!t&&a.hasClass("snackbar-opened")&&a.snackbar("hide"):t&&(a=$.snackbar({id:"snackbar-time-zone",content:"<p><strong>ADVERTENCIA: Zona horaria inválida</strong><br />La zona horaria seleccionada debe estar dentro de ±4 horas de la longitud actual,<br /> donde cada hora equivale a 15 grados <var>(ref = longitud / 15)</var>.</p>",htmlAllowed:!0,style:"warning",timeout:8e3})))}this.latitude=ko.observable(r.latitude()),this.latitude.subscribe(function(t){r.latitude(parseFloat(t)),i.trigger()}),this.longitude=ko.observable(r.longitude()),this.longitude.subscribe(function(t){r.longitude(parseFloat(t)).calculate(),o.timezone(r.timezone()),i.trigger()}),this.timezone=ko.observable(r.timezone()),this.timezone.subscribe(function(t){t=parseFloat(t);var e=Math.round(r.longitude()/15);Math.abs(t-e)<4.01?(r.timezone(t),i.trigger(),a&&!o.timezone.ignore&&s(!1)):(o.timezone.ignore=!0,o.timezone(r.timezone()),s(!(o.timezone.ignore=!1)))}),this.timezone.formatter=ko.pureComputed(function(){return"GMT"+(0<=o.timezone()?"+":"-")+r.formatAsTime(Math.abs(o.timezone()))}),this.timezone.incrementor=function(t,e){if(e=parseFloat(e)){e=pd.sign(e);for(var r,n=document.getElementById("input-timezone"),i=parseFloat(n.options[n.selectedIndex].value),a=n.selectedIndex+e;0<=a&&a<n.length;){if(r=parseFloat(n.options[a].value),!pd.closeTo(i,r,.1)){i=r;break}a+=e}o.timezone(i)}},this.northOffset=ko.observable(r.northOffset()),n<1e-6?this.northOffset.extend({deferred:!0}):this.northOffset.extend({rateLimit:n}),this.northOffset.subscribe(function(t){r.northOffset(pd.constrainTo(parseFloat(t),-180,180)),e&&(e.northOffset=r.northOffset()),o.onNorthOffsetChange&&o.onNorthOffsetChange(o)}),this.elevation=ko.observable(pd.toNumber(e?e.elevation:null,150)),this.elevation.subscribe(function(t){e&&(e.elevation=pd.constrainTo(parseFloat(t),-400,1e4))}),this.elevation.formatter=ko.pureComputed({read:function(){var t=pd.Dimension.type!=pd.DimensionType.METRIC_IMPERIAL?pd.DimensionType.METRIC_SI:pd.DimensionType.METRIC_IMPERIAL;return pd.Dimension.formatDimension(1e3*o.elevation(),t,1,!0)},write:function(t){var e=pd.Dimension.type!=pd.DimensionType.METRIC_IMPERIAL?pd.DimensionType.METRIC_SI:pd.DimensionType.METRIC_IMPERIAL;o.elevation(pd.Dimension.parseDimension(t,e)/1e3)},owner:this}),this.location=ko.computed({read:function(){return[o.latitude(),o.longitude(),parseFloat(o.timezone())]},write:function(t){3==t.length&&(o.latitude(parseFloat(t[0])),o.longitude(parseFloat(t[1])),o.timezone(parseFloat(t[2])))},owner:o}),this.handlePopoverShow=function(){t.UndoManager&&(o.location.undoIgnore=!0,t.UndoManager.storeValues(o.latitude,o.longitude,o.timezone,o.northOffset,o.elevation))},this.handlePopoverHide=function(){t.UndoManager&&(o.location.undoIgnore=!1,t.UndoManager.checkForChanges())},this.set=function(t){return pdKO.setWritableObservables(t,o),this}},pdKO.AnimationViewModel=function(a,t,o){var s=this;this.pause=ko.observable(!1),this.playing=ko.observable(!1),this.animateTime=ko.observable(t.animateTime||!1),this.animateDate=ko.observable(t.animateDate||!1),this.animateLatitude=ko.observable(t.animateLatitude||!1),this.animateLongitude=ko.observable(t.animateLongitude||!1),this.daylightOnly=ko.observable(t.daylightOnly||!1),this.speed=ko.observable(pd.toNumber(t.speed,10));var d=1,h=0,l=0;function e(){if(s.pause())return!1;var t,e,r=!1,n=Math.max(1,parseFloat(s.speed())),i=!1;return 10<n&&(n=pd.mapAndConstrainTo(n-10,0,10,10,200)),s.animateTime()?(t=+a.DateTime.timeOfDay(),1.01<Math.abs(t-l)&&(l=t),t=l+=.1*n,s.daylightOnly()&&(e=60*o.getDawnTime(o.twilight.CIVIL),60*o.getDuskTime(o.twilight.CIVIL)<t?t=1441:t<e&&(t=e)),1440<=t&&s.animateDate()&&(a.DateTime.setDayOfYear(+a.DateTime.dayOfYear()+1),h=+a.DateTime.dayOfYear(),t=l=s.daylightOnly()?60*o.getDawnTime(o.twilight.CIVIL):0,i=!0),a.DateTime.timeOfDay(pd.wrapAt(t,0,1440)),a.DateTime.onDateTimeChange(a.DateTime,i),r=!0):s.animateDate()&&(e=+a.DateTime.dayOfYear(),1.01<Math.abs(e-h)&&(h=e),(i=Math.floor(h+=.05*n))!=e&&(a.DateTime.setDayOfYear(i),a.DateTime.onDateTimeChange(a.DateTime,!0),r=!0)),s.animateLatitude()&&((t=pd.snapTo(o.latitude()+.01*n*d,.01))<-89.8&&(d=1,t=-90),89.8<t&&(d=-1,t=90),a.Location.latitude(t),a.Location.onLocationChange(),r=!0),s.animateLongitude()&&(a.Location.longitude(pd.snapTo(pd.wrapAt(o.longitude()+.01*n,-180,180),.01)),a.Location.onLocationChange(),r=!0),r&&window.gl&&window.gl.update(),!s.playing()&&(c(),!0)}function r(){s.playing(!0),a.Location.location.undoIgnore=!0,a.DateTime.datetime.undoIgnore=!0,a.UndoManager.storeValues(a.Location.location,a.DateTime.datetime),$("#btn-play-icon").attr("class","icon icon-stop"),$("#btn-play").toggleClass("btn-default",!1).toggleClass("btn-info",!0).toggleClass("active",!0),h=+a.DateTime.dayOfYear(),l=+a.DateTime.timeOfDay(),pdDOM.getGlobalAnimationQueue().addOrReplace(e).start(),s.pause(!1)}function c(){a.UndoManager.checkForChanges(),$("#btn-play-icon").attr("class","icon icon-play"),$("#btn-play").toggleClass("btn-default",!0).toggleClass("btn-info",!1).toggleClass("active",!1),a.Location.location.undoIgnore=!1,a.DateTime.datetime.undoIgnore=!1,s.playing(!1),s.pause(!1)}this.canAnimate=ko.computed(function(){return s.animateTime()||s.animateDate()||s.animateLatitude()||s.animateLongitude()},this),this.rewind=function(){s.animateDate()&&(a.DateTime.dayOfYear(0),o.setDayOfYear(0)),s.animateTime()&&a.DateTime.timeOfDay(s.daylightOnly()?60*o.getDawnTime(o.twilight.CIVIL):0),s.animateLatitude()&&a.Location.latitude(-90),s.animateLongitude()&&a.Location.longitude(-180)},this.play=function(){s.playing(!s.playing()),(s.playing()?r:c)()},this.faster=function(){s.speed(s.speed()+2),s.canAnimate()&&!s.playing()&&r()},this.stop=function(){s.playing(!1)},this.handlePopoverShow=function(){a.UndoManager&&a.UndoManager.storeValues(s.animateTime,s.animateDate,s.animateLatitude,s.animateLongitude,s.daylightOnly,s.speed)},this.handlePopoverHide=function(){t.animateTime=s.animateTime(),t.animateDate=s.animateDate(),t.animateLatitude=s.animateLatitude(),t.animateLongitude=s.animateLongitude(),t.daylightOnly=s.daylightOnly(),t.speed=+s.speed(),a.UndoManager&&a.UndoManager.checkForChanges()},this.set=function(t){return pdKO.setWritableObservables(t,s),this}},pdKO.SliderViewModel=function(e,r,n,i){var a=this;function o(t){return(+t).toFixed(3)}function s(t){return(+t).toFixed(1)+"°"}function d(t){return n.formatAsTime(t/60)}function h(t){return n.formatAsDate(t)}function l(){u(e.Camera.viewZoom,gl.orbitalView.zoomFactor)}function c(t){switch(t=pd.toInteger(t,0),gl.orbitalView&&(4==t?gl.orbitalView.on("change",l):gl.orbitalView.off("change",l)),t){case 0:r.index=t,i.set({type:i.TYPE_NUMERIC,observable:e.Location.latitude,format:s,title:"Site\nLatitude",tickMajor:15,tickMinor:5,stepMajor:15,stepMinor:1,wrap:!1,min:-90,max:90,step:.1});break;case 1:r.index=t,i.set({type:i.TYPE_NUMERIC,observable:e.Location.longitude,format:s,title:"Site\nLongitude",tickMajor:15,tickMinor:5,stepMajor:15,stepMinor:1,wrap:r.wrap,min:-180,max:180,step:.1});break;case 2:r.index=t,i.set({type:i.TYPE_DATE,observable:e.DateTime.dayOfYear,format:h,title:"Day of\nthe Year",year:n.year(),tickMajor:28,tickMinor:7,stepMajor:10,stepMinor:1,wrap:r.wrap,min:0,max:364,step:1});break;case 3:r.index=t,i.set({type:i.TYPE_TIME,observable:e.DateTime.timeOfDay,format:d,title:"Time of\nthe Day",tickMajor:60,tickMinor:15,stepMajor:60,stepMinor:5,wrap:r.wrap,min:0,max:1440,step:1}),i.updateDayNight(n);break;case 4:r.index=t,i.set({type:i.TYPE_NUMERIC,observable:e.Camera.viewZoom,format:o,title:"View\nZoom",tickMajor:.25,tickMinor:.05,stepMajor:.05,stepMinor:.01,wrap:r.wrap,min:0,max:3,step:.001})}}this.show=ko.observable(pd.toBoolean(r.show,!1)),this.show.subscribe(function(t){r.show=!!t,i.show(r.show)}),this.toggle=function(){a.show(!a.show()),$("#btn-slider-toggle").blur()},this.wrap=ko.observable(r.wrap||!1),this.wrap.subscribe(function(t){r.wrap=!!t,i.wrap(r.wrap)}),this.detail=ko.observable(r.detail||!1),this.detail.subscribe(function(t){r.detail=!!t,i.detailMode(r.detail)}),this.index=ko.observable(r.index||0),this.index.subscribe(function(t){c(t)}),this.setIndex=function(t){a.index(t)},this.set=function(t){return pdKO.setWritableObservables(t,a),this},c(r.index)}}(),Date.prototype.isLeapYear=function(){var t=this.getFullYear();return 0==(3&t)&&(t%100!=0||t%400==0)},Date.prototype.getDOY=function(){var t=this.getMonth(),e=this.getDate()-1,e=[0,31,59,90,120,151,181,212,243,273,304,334][t]+e;return 1<t&&this.isLeapYear()&&e++,e},Date.prototype.setDOY=function(t){var e=this.isLeapYear(this.getFullYear());t=pd.constrainTo(t,0,e?365:364);for(var r=[0,31,59,90,120,151,181,212,243,273,304,334],n=pd.constrainTo(Math.ceil(t/30)+1,0,11);0<=n;n--)if(r[n]<=t)return this.setMonth(Math.floor(pd.constrainTo(n,0,11))),void this.setDate(Math.floor(pd.constrainTo(t-r[n]+1,1,31)));this.setMonth(0),this.setDate(1)},pd.DateTime=function(t){this.clockTime=11,this.dayOfMonth=21,this.monthOfYear=2,this.year=2018,t&&this.copyFrom(t)},pd.DateTime.prototype.copyFrom=function(t){return t&&pd.isObject(t)&&("clockTime"in t&&(this.clockTime=Math.round(pd.constrainTo(pd.toNumber(t.clockTime,this.clockTime),0,24))),"dayOfMonth"in t&&(this.dayOfMonth=pd.constrainTo(pd.toInteger(t.dayOfMonth,this.dayOfMonth),0,31)),"monthOfYear"in t&&(this.monthOfYear=pd.constrainTo(pd.toInteger(t.monthOfYear,this.monthOfYear),0,11)),"year"in t&&(this.year=pd.constrainTo(pd.toInteger(t.year,this.year),-4712,3500))),this},pd.DateTime.prototype.JSONSchema=function(){return{type:"object",description:"Defines a specific date and time.",properties:{clockTime:{description:"The local clock time, in decimal hours (0.0 to 24.0).",type:"number",minimum:0,maximum:24},dayOfMonth:{description:"The day of the month component of the date (1 to 31).",type:"integer",minimum:0,maximum:31},monthOfYear:{description:"The month of the year component of the date (0 to 11).",type:"integer",minimum:0,maximum:11},year:{description:"The 4 digit year component of the date.",type:"integer",minimum:-4712,maximum:3500}}}},pd.DateTime.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],pd.DateTime.DAY_COUNT_LEAP_YEAR=[0,31,60,91,121,152,182,213,244,274,305,335],pd.DateTime.DAY_COUNT=[0,31,59,90,120,151,181,212,243,273,304,334],pd.DateTime.MONTH_NAMES=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],pd.DateTime.isLeapYear=function(t){return 0==(3&t)&&(t%100!=0||t%400==0)},pd.DateTime.getDOY=function(t,e,r){return e=pd.constrainTo(e,0,11),(pd.DateTime.isLeapYear(r)?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT)[e]+t-1},pd.DateTime.getDayAndMonth=function(t,e){var r=pd.DateTime.isLeapYear(e);t=pd.constrainTo(t,0,r?365:364);for(var e=pd.constrainTo(Math.ceil(t/30)+1,0,11),n=r?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT,i=e;0<=i;i--){if(t>=n[i])return{month:Math.floor(pd.constrainTo(i,0,11)),day:Math.floor(pd.constrainTo(t-n[i]+1,1,31))}}return{month:0,day:1}},pd.DateTime.getMonthName=function(t){return 0<=t&&t<=11?pd.DateTime.MONTH_NAMES[t]:""},pd.DateTime.generateDateSuffix=function(t){return(t=t||new Date).getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+"-"+("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+"-"+("0"+t.getSeconds()).slice(-2)},pd.DateTime.snapToNearestMonth=function(t,e){var e=pd.DateTime.isLeapYear(e),r=e?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT,e=e?365:364;t=pd.constrainTo(t,0,e);for(var n=0;n<=12;++n)if(t<r[n]+15)return r[n];return e},pd.DateTime.getMonthStartDay=function(t,e){return t=pd.constrainTo(t,0,11),(pd.DateTime.isLeapYear(e)?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT)[t]},pd.DateTime.getMonthEndDay=function(t,e){var r=(t=pd.constrainTo(t,0,11)+1)<11?1:0;return pd.DateTime.isLeapYear(e)?pd.DateTime.DAY_COUNT_LEAP_YEAR[t]-r:pd.DateTime.DAY_COUNT[t]-r},pd.DateTime.getDayCountArray=function(t){return pd.DateTime.isLeapYear(t)?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT},pd.DateTime.formatDate=function(t,e,r){var n=pd.DateTime.isLeapYear(e);t=pd.constrainTo(t,0,n?365:364);for(var i=pd.constrainTo(Math.ceil(t/30)+1,0,11),a=n?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT,o=i;0<=o;o--)if(t>=a[o]){var s=Math.floor(pd.constrainTo(o,0,11)),d=Math.floor(pd.constrainTo(t-a[o]+1,1,31));return d<10&&(d="0"+d),r&&0<e?d+" "+pd.DateTime.MONTH_NAMES[s]+" "+e:d+" "+pd.DateTime.MONTH_NAMES[s]}return""},pd.DateTime.formatAsMMMDD=function(t,e){var r=pd.DateTime.isLeapYear(e);t=pd.wrapAt(t,0,r?366:365,!0);for(var e=pd.constrainTo(Math.ceil(t/30)+1,0,11),n=r?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT,i=e;0<=i;i--)if(t>=n[i]){var a=Math.floor(pd.constrainTo(i,0,11)),o=Math.floor(pd.constrainTo(t-n[i]+1,1,31));return o<10&&(o="0"+o),pd.DateTime.MONTH_NAMES[a]+o}return""},pd.DateTime.formatMonthName=function(t){return t=Math.floor(pd.constrainTo(t,0,11)),pd.DateTime.MONTH_NAMES[t]},pd.DateTime.formatTime=function(t,e){var r=pd.sign(t);if(23.9999<(t=pd.wrapAt(t,0,24))&&(t=0),e){var e=3600*Math.abs(t),n=pd.constrainTo(Math.floor(t),0,24),i=pd.constrainTo(Math.floor(60*(t-n)),0,60),e=pd.constrainTo(Math.round(e-(3600*n+60*i)),0,60);return 59.5<e&&(i=i<59?i+1:0,e=0),59.5<i&&(n=n<23?n+1:0,i=0),n<10&&(n="0"+n),i<10&&(i="0"+i),e<10&&(e="0"+e),r<0?"-"+n+":"+i+":"+e:n+":"+i+":"+e}n=Math.floor(t);return 59.5<(i=pd.constrainTo(Math.round(60*(t-n)),0,60))&&(n=n<23?n+1:0,i=0),n<10&&(n="0"+n),i<10&&(i="0"+i),r<0?"-"+n+":"+i:n+":"+i},pd.DateTime.formatDuration=function(t,e){var r=pd.sign(t);if(t=Math.abs(t),e){var n=Math.floor(t),e=3600*Math.abs(t),i=pd.constrainTo(Math.floor(60*(t-n)),0,60),e=pd.constrainTo(Math.round(e-(3600*n+60*i)),0,60);return 59.5<e&&(i=i<59?i+1:0,e=0),59.5<i&&(n=n<23?n+1:0,i=0),n<10&&(n="0"+n),i<10&&(i="0"+i),e<10&&(e="0"+e),r<0?"-"+n+":"+i+":"+e:n+":"+i+":"+e}n=Math.floor(t);return 59.5<(i=pd.constrainTo(Math.round(60*(t-n)),0,60))&&(n=n<23?n+1:0,i=0),n<10&&(n="0"+n),i<10&&(i="0"+i),r<0?"-"+n+":"+i:n+":"+i},pd.DateTime.formatTimezone=function(t){return 0<=t?"+"+pd.DateTime.formatDuration(t,!1):pd.DateTime.formatDuration(t,!1)},pd.DateTime.parseTime=function(t){if(""==t)return null;var e=0,r=0;if(0<=t.indexOf(".")&&t.indexOf(":")<0){var n=parseFloat(t);r=60*(n-(e=Math.floor(n)))}else{var i=t.match(/(\d+)(:(\d\d))?\s*(p|a?)/i);if(null==i)return null;24<(e=parseInt(i[1],10))&&(r=e,0<(e=Math.floor(r/100))&&(r-=100*e),i[3]=r.toString()),0<i[4].length&&("a"==i[4]?12==e&&(e=0):e<12&&(e+=12)),r=parseInt(i[3],10)||0}e=pd._fastWrap(e,0,24);i=new Date;return i.setHours(e),i.setMinutes(r),i.setSeconds(0,0),i},pd.DateTime.parseTimeToDecimalHours=function(t){t=pd.DateTime.parseTime(t);return t?pd.constrainTo(t.getHours()+t.getMinutes()/60,0,24):0},pd.DateTimeRange=function(t,e){this.fromDay=0,this.toDay=365,this.fromTime=0,this.toTime=24,this.timeStep=1/6,this.daysInTheYear=365,this.sunriseToSunset=!1,this.solar=null,(t||e)&&this.set(t,e)},pd.DateTimeRange.prototype.sanityCheck=function(t){var e=(t=t||this.solar)&&t.isLeapYear&&t.isLeapYear()?366:365;return this.daysInTheYear=e,this.solar=t,this.fromDay=pd.wrapAt(pd.toInteger(this.fromDay,0),0,e-1),this.toDay=pd.wrapAt(pd.toInteger(this.toDay,e),0,e),this.toDay<this.fromDay&&(this.toDay+=e),this.toDay-this.fromDay>=e&&(this.toDay=this.fromDay+e-1),this.fromTime=pd.wrapAt(pd.toNumber(this.fromTime,0),0,24),this.toTime=pd.wrapAt(pd.toNumber(this.toTime,24),0,24),this.toTime<=this.fromTime&&(this.toTime+=24),24<this.toTime-this.fromTime&&(this.toTime=this.fromTime+24),this.timeStep=pd.constrainTo(pd.toNumber(this.timeStep,1/6),1/60,24),this},pd.DateTimeRange.prototype.set=function(t,e){return"fromDay"in(t=t||{})&&(this.fromDay=t.fromDay),"toDay"in t&&(this.toDay=t.toDay),"fromTime"in t&&(this.fromTime=t.fromTime),"toTime"in t&&(this.toTime=t.toTime),"timeStep"in t&&(this.timeStep=t.timeStep),e=e||t.solar||this.solar,this.sanityCheck(e),this},pd.DateTimeIterator=function(t,e){pd.DateTimeRange.call(this,t,e),this.dayStartsAt=0,this.dayEndsAt=24,this.currentTime=0,this.currentDay=0,this.progressMax=1,this.progress=0,this.cancelled=!1,this.working=!1,(this.iterator=this).callbackCalculate=null,this.callbackOnTimeout=null,this.callbackOnComplete=null,(t||e)&&this.init(t,e)},pd.DateTimeIterator.prototype=Object.create(pd.DateTimeRange.prototype),pd.DateTimeIterator.prototype.constructor=pd.DateTimeIterator,pd.DateTimeIterator.prototype.reset=function(t,e){t=t||null,this.solar||(this.solar=new pd.SolarPosition),e?this.solar.copyLocation(e):t.solar&&this.solar.copyLocation(t.solar),this.set(t,this.solar),this.progressMax=Math.max(1,Math.round(this.toDay-this.fromDay)+1),this.progress=0,this.currentDay=this.fromDay;t=this.currentDay>=this.daysInTheYear?this.currentDay-this.daysInTheYear:this.currentDay;this.solar.dayOfYear(t),this.sunriseToSunset?(this.dayStartsAt=pd.snapTo(this.solar.sunriseTime()-.5*this.timeStep,this.timeStep),this.dayEndsAt=pd.snapTo(this.solar.sunsetTime()+.5*this.timeStep,this.timeStep),24.01<this.toTime?(this.dayStartsAt+=24,this.fromTime>this.dayEndsAt?this.currentTime=this.dayStartsAt-this.timeStep:this.currentTime=this.fromTime-this.timeStep):(this.dayStartsAt=Math.max(this.fromTime,this.dayStartsAt),this.dayEndsAt=Math.min(this.toTime,this.dayEndsAt),this.currentTime=this.dayStartsAt-this.timeStep)):(this.currentTime=-this.timeStep,this.dayStartsAt=24,this.dayEndsAt=24);t=24<=this.currentTime?this.currentTime-24:this.currentTime;return this.solar.clockTime(t),this.working=!0,!(this.cancelled=!1)},pd.DateTimeIterator.prototype.next=function(){var t=24.01<this.toTime?this.toTime:this.dayEndsAt;if(this.cancelled)return null;if((this.currentTime+=this.timeStep)>t-this.timeStep){if(++this.progress,++this.currentDay,this.currentDay>this.toDay)return this.working=!1,this.cancelled=!1,this.progress=1,null;var e=this.currentDay>=this.daysInTheYear?this.currentDay-this.daysInTheYear:this.currentDay;this.solar.dayOfYear(e),this.dayStartsAt=pd.snapTo(this.solar.sunriseTime()-.5*this.timeStep,this.timeStep),this.dayEndsAt=pd.snapTo(this.solar.sunsetTime()+.5*this.timeStep,this.timeStep),this.fromTime>=this.toTime?(this.dayStartsAt+=23.99,this.fromTime>this.dayEndsAt?this.currentTime=this.dayStartsAt-this.timeStep:this.currentTime=this.fromTime-this.timeStep):(this.dayStartsAt=Math.max(this.fromTime,this.dayStartsAt),this.dayEndsAt=Math.min(this.toTime,this.dayEndsAt),this.currentTime=this.dayStartsAt-this.timeStep)}e=24<=this.currentTime?this.currentTime-24:this.currentTime;return this.solar.clockTime(e),this},pd.DateTimeIterator.prototype.getProgress=function(){return this.progress/this.progressMax},function(){var Z=2*Math.PI,Q=Math.PI/180,J=180/Math.PI,tt=[0,-.014543897651582,-.104528463267654,-.207911690817759,-.309016994374947];function et(t,e,r){return t<e?t+(r-e):r<t?t-(r-e):t}function e(t){return"ERROR: '"+t+"' property is read-only."}function a(t){return(357.52911+t*(35999.05029-1537e-7*t))*Q}function o(t){t=(280.46646+t*(36000.76983+3032e-7*t))%360;return(t<0?360+t:t)*Q}function r(t){return o(t)+(t=a(e=t),(Math.sin(t)*(1.914602-e*(.004817+14e-6*e))+Math.sin(t+t)*(.019993-101e-6*e)+289e-6*Math.sin(t+t+t))*Q);var e}function s(t){return(23+(26+(21.448-(e=t)*(46.815+e*(59e-5-.001813*e)))/60)/60)*Q+.00256*Math.cos((125.04-1934.136*t)*Q)*Q;var e}function rt(t,e,r){++e<=2&&(e+=12,--r);var n=Math.floor(--r/100),n=2-n+Math.floor(n/4);return(Math.floor(365.25*(r+4716))+Math.floor(30.6001*(e+1))+t+n-1524.5-2451545)/36525}function nt(t){return Math.asin(Math.sin(s(t))*Math.sin(r(t=t)-(.00569+.00478*Math.sin((125.04-1934.136*t)*Q))*Q))}function it(t){var e=.016708634-(i=t)*(42037e-9+1.267e-7*i),r=a(t),n=o(t),i=Math.tan(s(t)/2);i*=i;t=Math.sin(r);return 4*(i*Math.sin(2*n)-2*e*t+4*e*i*t*Math.cos(2*n)-.5*i*i*Math.sin(4*n)-1.25*e*e*Math.sin(2*r))}function n(t){var e=Math.floor(t+.5),r=t+.5-e,n=e<2299161?e:e+1+(o=Math.floor((e-1867216.25)/36524.25))-Math.floor(o/4),i=n+1524,a=Math.floor((i-122.1)/365.25),t=Math.floor(365.25*a),e=Math.floor((i-t)/30.6001),o=i-t-Math.floor(30.6001*e)+r,n=e-(e<13.5?1:13),i=a-(2.5<n?4716:4715),t=Math.floor(o),r=24*(o-t),e=Math.floor(r),a=60*(r-e),o=Math.floor(a),r=Math.floor(60*(a-o)),a=pd.DateTime.getDOY(t,n-1,i),o=e+o/60+(r-(e=[121,112,103,95,88,82,77,72,68,63,60,56,53,51,48,46,44,42,40,38,35,33,31,29,26,24,22,20,18,16,14,12,11,10,9,8,7,7,7,7,7,7,8,8,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,12,12,12,12,13,13,13,14,14,14,14,15,15,15,15,15,16,16,16,16,16,16,16,16,15,15,14,13,13.1,12.5,12.2,12,12,12,12,12,12,11.9,11.6,11,10.2,9.2,8.2,7.1,6.2,5.6,5.4,5.3,5.4,5.6,5.9,6.2,6.5,6.8,7.1,7.3,7.5,7.6,7.7,7.3,6.2,5.2,2.7,1.4,-1.2,-2.8,-3.8,-4.8,-5.5,-5.3,-5.6,-5.7,-5.9,-6,-6.3,-6.5,-6.2,-4.7,-2.8,-.1,2.6,5.3,7.7,10.4,13.3,16,18.2,20.2,21.1,22.4,23.5,23.8,24.3,24,23.9,23.9,23.7,24,24.3,25.3,26.2,27.3,28.2,29.1,30,30.7,31.4,32.2,33.1,34,35,36.5,38.3,40.2,42.2,44.5,46.5,48.5,50.5,52.5,53.8,54.9,55.8,56.9,58.3,60,61.6,63,63.8,64.3],o=0,i=((r=i)-2e3)/100,1620<=r&&r<=2002?o=r%2?(e[(r-1620-1)/2]+e[(r-1620+1)/2])/2:e[(r-1620)/2]:r<948?o=2177+497*i+44.1*Math.pow(i,2):948<=r&&(o=102+102*i+25.3*Math.pow(i,2),2e3<=r&&r<=2100&&(o+=.37*(r-2100))),o))/3600;return 24<o&&(o-=24,a++,t++),o<0&&(o+=24,a--,t--),{dayOfYear:a,timeOfDay:o,month:n-1,day:t}}function at(t,e){var r=0,e=(e-2e3)/1e3;switch(t){case 0:r=2451623.80984+365242.37404*e+.05169*Math.pow(e,2)-.00411*Math.pow(e,3)-57e-5*Math.pow(e,4);break;case 1:r=2451716.56767+365241.62603*e+.00325*Math.pow(e,2)+.00888*Math.pow(e,3)-3e-4*Math.pow(e,4);break;case 2:r=2451810.21715+365242.01767*e-.11575*Math.pow(e,2)+.00337*Math.pow(e,3)+78e-5*Math.pow(e,4);break;case 3:r=2451900.05952+365242.74049*e-.06223*Math.pow(e,2)-.00823*Math.pow(e,3)+32e-5*Math.pow(e,4)}t=(r-2451545)/36525,e=35999.373*t-2.47,e=1+.0334*pd.cosDegrees(e)+7e-4*pd.cosDegrees(2*e);return n(r+1e-5*function(t){for(var e=[485,203,199,182,156,136,77,74,70,58,52,50,45,44,29,18,17,16,14,12,12,12,9,8],r=[324.96,337.23,342.08,27.85,73.14,171.52,222.54,296.72,243.58,119.81,297.17,21.02,247.54,325.15,60.93,155.12,288.79,198.04,199.76,95.39,287.11,320.81,227.73,15.45],n=[1934.136,32964.467,20.186,445267.112,45036.886,22518.443,65928.934,3034.906,9037.513,33718.147,150.678,2281.226,29929.562,31555.956,4443.417,67555.328,4562.452,62894.029,31436.921,14577.848,31931.756,34777.259,1222.114,16859.074],i=0,a=0;a<24;++a)i+=e[a]*pd.cosDegrees(r[a]+n[a]*t);return i}(t)/e)}pd.Location=function(t){this.latitude=-38.71739391,this.longitude=-62.26561546,this.timezone=0,this.northOffset=0,this.elevation=75,t&&this.copyFrom(t)},pd.Location.prototype.copyFrom=function(t){return t&&pd.isObject(t)&&("latitude"in t&&(this.latitude=pd.constrainTo(pd.toNumber(t.latitude,this.latitude),-90,90)),"longitude"in t&&(this.longitude=pd.constrainTo(pd.toNumber(t.longitude,this.longitude),-180,180)),"timezone"in t&&(this.timezone=pd.constrainTo(pd.toNumber(t.timezone,this.timezone),-13,13)),"northOffset"in t&&(this.northOffset=pd.constrainTo(pd.toNumber(t.northOffset,this.northOffset),-180,180)),"elevation"in t&&(this.elevation=pd.constrainTo(pd.toNumber(t.elevation,this.elevation),-400,1e4))),this},pd.Location.prototype.JSONSchema=function(){return{type:"object",description:"Defines a terrestrial location.",properties:{latitude:{description:"The terrestrial latitude of the current location, in decimal degrees.",type:"number",minimum:-90,maximum:90},longitude:{description:"The terrestrial longitude of the current location, in decimal degrees.",type:"number",minimum:-180,maximum:180},timezone:{description:"The local time zone at the current location, in decimal hours.",type:"number",minimum:-13,maximum:13},northOffset:{description:"The angle between north and the +Y axis, in decimal degrees.",type:"number",minimum:-180,maximum:180},elevation:{description:"The average height of the site above sea level, in metres.",type:"number",minimum:-400,maximum:1e4}}}},pd.SolarPosition=function(t){t=t||{};var h=this,i=!0,a=!0,o=pd.toNumber(t.latitude,-38.71739391),s=pd.toNumber(t.longitude,-62.26561546),d=pd.toNumber(t.timezone,0),l=pd.toNumber(t.northOffset,0),n=15*d,c=n/15,u=(s-n)/15,p=s*Q,f=o*Q,m=Math.cos(f),g=Math.sin(f),y=0,v=1,D=3,b=(new Date).getFullYear(),x=10,M=90,T=0,A=0,w=0,O=0,V=0,C=0,S=[0,0,0,0,0],N=[24,24,24,24,24],k=pd.toBoolean(t.interpolateDeclination,!1),I=0,P=0,E=0,_=0,L=0,R=0,B=0,F=0,z=0,Y=0,U=0,q=0,r=null,H=null,j=null,G=null;function W(){k?(I=rt(v,D,b),E=nt(I),z=it(I),L=Math.cos(E),R=Math.sin(E),P=rt(v+1,D,b),_=nt(P),Y=it(P),B=Math.cos(_),F=Math.sin(_),T=.5*(I+P),A=.5*(E+_),w=.5*(L+B),O=.5*(R+F),V=.5*(z+Y)):(T=rt(v,D,b),A=nt(T),V=it(T),w=Math.cos(A),O=Math.sin(A)),C=12-V-u+y;for(var t,e=g*O,r=m*w,n=0;n<5;++n)(t=(t=(tt[n]-e)/r)<=-1?12:1<=t?0:Math.acos(t)/.26179938779915)<11.999?(S[n]=pd.constrainTo(C-t,0,24),N[n]=pd.constrainTo(C+t,0,24)):(S[n]=0,N[n]=24);i=!1}function K(){r=x,k&&(T=(r=1-(n=r/24))*I+n*P,A=r*E+n*_,w=r*L+n*B,O=r*R+n*F,V=r*z+n*Y);var t=((x-c+V)/24*Z+p)%Z-Math.PI,e=Math.acos(Math.max(-1,Math.min(1,g*O+m*w*Math.cos(t)))),r=m*Math.sin(e);t<-Math.PI&&(t+=Z),1e-6<Math.abs(r)&&(t=(0<t?-1:1)*(Math.PI-Math.acos(Math.max(-1,Math.min(1,(g*Math.cos(e)-O)/r))))),t<0&&(t+=Z);var n=90-e*J;n<=85&&(r=Math.tan(n*Q),e-=(5<n?58.1/r-.07/(r*r*r)+86e-6/(r*r*r*r*r):-.575<n?1735+n*(n*(103.4+n*(.711*n-12.79))-518.2):-20.774/r)/3600*Q),U=et(90-e*J,-180,180),q=et(t*J,-180,180),a=!1}function X(){i?(W(),K()):a&&K()}function $(t,e,r,n){r*=Q,n*=Q;var i=e*Math.cos(n);return[t[0]+i*Math.sin(r),t[1]+i*Math.cos(r),t[2]+e*Math.sin(n)]}this.calculate=function(){return X(),this},this.getSunAnglesArray=function(t){return X(),t?(t[0]=q,t[1]=U):t=[q,U],t},this.getSunAnglesObject=function(){return X(),{azi:q,alt:U}},this.getSunDirection=function(t){X();var e=q*Q,r=U*Q,n=Math.cos(r);return pd.isArray(t)||(t=[]),t[0]=n*Math.sin(e),t[1]=n*Math.cos(e),t[2]=Math.sin(r),t},this.getSunDirectionWithNorthOffset=function(t){X();var e=(q+l)*Q,r=U*Q,n=Math.cos(r);return pd.isArray(t)||(t=[]),t[0]=n*Math.sin(e),t[1]=n*Math.cos(e),t[2]=Math.sin(r),t},this.getDateObject=function(){var t=b,e=pd.constrainTo(D,0,11),r=v,n=x-d;n<0?(n=et(n,0,24),--r<0&&(--e<0&&(e=11,--t),r=(pd.DateTime.isLeapYear(t)?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT)[e]-1)):24<=n&&(n=et(n,0,24),++r>=(pd.DateTime.isLeapYear(t)?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT)[e]&&(11<++e&&(e=0,++t),r=0));var i=pd.constrainTo(Math.floor(n),0,24),n=pd.constrainTo(Math.round(60*(n-i)),0,60);return 59.5<n&&(i=i<23?i+1:0,n=0),new Date(Date.UTC(t,e,r,i,n,0))},this.copyLocation=function(t){var e,r,n;return t&&pd.isObject(t)&&(t instanceof pd.SolarPosition?(this.setLocation(t.latitude(),t.longitude(),t.timezone()),this.northOffset(t.northOffset()),this.setDayMonthYear(t.dayOfMonth(),t.monthOfYear(),t.year())):(e=o,r=s,n=d,"latitude"in t&&(e=pd.constrainTo(pd.toNumber(t.latitude,e),-90,90)),"longitude"in t&&(r=pd.constrainTo(pd.toNumber(t.longitude,r),-180,180)),"timezone"in t&&(n=pd.constrainTo(pd.toNumber(t.timezone,n),-13,13)),"northOffset"in t&&(t=pd.constrainTo(pd.toNumber(t.northOffset,this.northOffset()),-180,180),this.northOffset(t)),this.setLocation(o,s,d))),this},this.setLocation=function(t,e,r){if(arguments.length<2)throw new Error("This method requires at least latitude and longitude as arguments.");return t=pd.constrainTo(pd.toNumber(t,o),-89.9,89.9),e=et(pd.toNumber(e,s),-180,180),r=pd.toNumber(r,this.calcDefaultTimezone(e)),pd.closeTo(o,t,1e-6)&&pd.closeTo(s,e,1e-6)&&pd.closeTo(d,r,1/3600)||(i=!0),c=(n=15*(d=r))/15,u=((s=e)-n)/15,p=s*Q,f=(o=t)*Q,m=Math.cos(f),g=Math.sin(f),y=0,this},this.setDateTime=function(t){return t&&!isNaN(t.getTime())&&(h.setDayMonthYear(t.getDate(),t.getMonth(),t.getFullYear()),h.setTime(t)),this},this.setDate=function(t){return t&&!isNaN(t.getTime())&&h.setDayMonthYear(t.getDate(),t.getMonth(),t.getFullYear()),this},this.setTime=function(t){return t&&!isNaN(t.getTime())&&h.setTimeOfDay(t.getHours()+t.getMinutes()/60+t.getSeconds()/3600),this},this.setDayOfYear=function(t,e){e=pd.toNumber(e,b),t=pd.constrainTo(t,0,pd.DateTime.isLeapYear(e)?365:364);for(var r=pd.constrainTo(Math.ceil(t/30)+1,0,11),n=pd.DateTime.isLeapYear(e)?pd.DateTime.DAY_COUNT_LEAP_YEAR:pd.DateTime.DAY_COUNT,i=r;0<=i;i--)if(t>=n[i]){h.setDayMonthYear(t-n[i]+1,i,e);break}return this},this.setDayMonthYear=function(t,e,r){return r=Math.floor(pd.constrainTo(r,-4712,3500)),e=Math.floor(e),t=Math.floor(t),v==t&&D==e&&b==r||(M=-1,i=!0),v=t,D=e,b=r,this},this.setTimeOfDay=function(t){return t=pd.constrainTo(t,0,24),pd.closeTo(x,t,1/3600)||(a=!0),x=t,this},this.setDateTimeAndGetArray=function(t){return t&&!isNaN(t.getTime())&&(h.setDayMonthYear(t.getDate(),t.getMonth(),t.getFullYear()),h.setTime(t)),this.getSunAnglesArray()},this.setTimeAndGetArray=function(t){return this.setTime(t).getSunAnglesArray()},this.setTimeOfDayAndGetArray=function(t){return this.setTimeOfDay(t).getSunAnglesArray()},this.getSolarPosition=function(t,e){return $(t,e,q+l,U)},this.getDailyApphelionSegmentsAsArray=function(t,e,r){var n=[[]],i=n[0];r=pd.constrainTo(pd.toNumber(r,.25),1/60,6),t=pd.constrainTo(pd.toNumber(t,0),0,24),(e=pd.constrainTo(pd.toNumber(e,24),0,24))<=t&&(e=24),X();for(var a=t;a<e;a+=r)h.setTimeOfDay(a),K(),i.push([q,U]);return h.setTimeOfDay(e),K(),i.push([q,U]),n},this.getAnalemmaApphelionsAsArray=function(t,e,r,n){var i=[];t=pd.constrainTo(pd.toInteger(t,7),1,90),n=pd.constrainTo(pd.toNumber(n,1),1/60,6),e=pd.constrainTo(pd.toNumber(e,0),0,24),(r=pd.constrainTo(pd.toNumber(r,24),0,24))<=e&&(r=24);for(var a,o=e;o<r;o+=n)i.push([]),0;for(var s=pd.DateTime.isLeapYear(b)?365:364,d=0;d<=s;d+=t){this.setDayOfYear(d,b),X(),a=0;for(o=e;o<r;o+=n)h.setTimeOfDay(et(o,0,24)),K(),i[a].push([q,U]),a++}this.setDayOfYear(0,b),X(),a=0;for(o=e;o<r;o+=n)h.setTimeOfDay(et(o,0,24)),K(),i[a].push([q,U]),a++;return i},this.getHourlyApphelionAsArray=function(t,e,r){var n=[];r=pd.constrainTo(pd.toNumber(r,.25),1/60,6),t=pd.constrainTo(pd.toNumber(t,0),0,24),(e=pd.constrainTo(pd.toNumber(e,24),0,24))<=t&&(e=24),this.setTimeOfDay(t),X(),n.push([q,U]);for(var i=t=pd.snapTo(t+r,r);i<e;i+=r)this.setTimeOfDay(i),K(),n.push([q,U]);return this.setTimeOfDay(end),K(),n.push([q,U]),n},this.getHourlyApphelionAsPositions3D=function(t,e,r,n,i){var a=(i=i||{vertices:[],lines:[]}).vertices.length;t=pd.constrainTo(pd.toNumber(t,.25),1/60,6),this.setTimeOfDay(0),X(),i.vertices.push($(e,r,q,U));for(var o=t;o<24;o+=t)this.setTimeOfDay(o),K(),i.vertices.push($(e,r,q,U)),(n||a%2)&&i.lines.push([a,a+1]),a++;return this.setTimeOfDay(24),K(),i.vertices.push($(e,r,q,U)),i.lines.push([a,++a]),i},this.reuseHourlyApphelionAsPositions3D=function(t,e,r,n,i){var a,o;if(!i||!i.vertices)return this.getHourlyApphelionAsPositions3D(t,e,r,n,null);t=pd.constrainTo(pd.toNumber(t,.25),1/60,6),this.setTimeOfDay(0),X(),a=i.addVertex($(e,r,q,U));for(var s=t;s<24;s+=t)this.setTimeOfDay(s),K(),o=i.addVertex($(e,r,q,U)),(n||a%2)&&i.addLine(a,o),a=o;return(n||a%2)&&(this.setTimeOfDay(24),K(),o=i.addVertex($(e,r,q,U)),i.addLine(a,o)),i},this.getAnalemmaApphelionAsArray=function(t){var e=[];t=pd.constrainTo(pd.toInteger(t,7),1,90),this.setDayOfYear(0,b),X(),e.push([q,U]);for(var r=t;r<=364;r+=t)this.setDayOfYear(r,b),W(),K(),e.push([q,U]);return this.setDayOfYear(0,b),W(),K(),e.push([q,U]),e},this.getAnalemmaApphelionAsPositions3D=function(t,e,r,n,i){t=pd.constrainTo(pd.toInteger(t,7),1,90);var a=(i=i||{vertices:[],lines:[]}).vertices.length;this.setDayOfYear(0,b),W(),K();var o=$(e,r,q,U);i.vertices.push(o);for(var s=0;s<=364;s+=t)this.setDayOfYear(s,b),W(),K(),i.vertices.push($(e,r,q,U)),(n||a%2)&&i.lines.push([a,a+1]),a++;return i.vertices.push(o),i.lines.push([a,++a]),i},this.getSunriseSunsetAsObjectArray=function(t,e){t=pd.constrainTo(pd.toInteger(t,7),1,90);var r=pd.DateTime.isLeapYear(b)?365:364;e=e||[];for(var n=0;n<r;n+=t)this.setDayOfYear(n,b),W(),e.push({dayOfYear:n,solarNoon:C,sunrise:S[1],sunset:N[1],civilDawn:S[2],civilDusk:N[2],nauticalDawn:S[3],nauticalDusk:N[3],astronomicalDawn:S[4],astronomicalDusk:N[4]});return this.setDayOfYear(r,b),W(),e.push({dayOfYear:n,solarNoon:C,sunrise:S[1],sunset:N[1],civilDawn:S[2],civilDusk:N[2],nauticalDawn:S[3],nauticalDusk:N[3],astronomicalDawn:S[4],astronomicalDusk:N[4]}),e},this.twilight={SOLAR_DISK_CENTER:0,SOLAR_DISK_TOP_WITH_ATM_REFRACTION:1,CIVIL:2,NAUTICAL:3,ASTRONOMICAL:4},this.getDuskDawnData=function(){return X(),{solarNoon:C,sunrise:S[1],sunset:N[1],civilDawn:S[2],civilDusk:N[2],nauticalDawn:S[3],nauticalDusk:N[3],astronomicalDawn:S[4],astronomicalDusk:N[4]}},this.getDawnTime=function(t){if(t<this.twilight.SOLAR_DISK_CENTER||t>this.twilight.ASTRONOMICAL)throw"ERROR: 'stage' parameter must be between twilight.SOLAR_DISK_CENTER and twilight.ASTRONOMICAL, inclusive.";return X(),S[t]},this.getDuskTime=function(t){if(t<this.twilight.SOLAR_DISK_CENTER||t>this.twilight.ASTRONOMICAL)throw"ERROR: 'stage' parameter must be between twilight.SOLAR_DISK_CENTER and twilight.ASTRONOMICAL, inclusive.";return X(),N[t]},this.latitude=function(t){if(!arguments.length)return o;var e=pd.constrainTo(pd.toNumber(t,o),-89.9,89.9);return pd.closeTo(o,e,1e-6)||(i=!0),f=(o=e)*Q,m=Math.cos(f),g=Math.sin(f),this},this.longitude=function(t){if(!arguments.length)return s;var e=et(pd.toNumber(t,s),-180,180);return pd.closeTo(s,e,1e-6)||(i=!0),s=e,d=this.calcDefaultTimezone(s),c=(n=15*d)/15,u=(s-n)/15,p=s*Q,this},this.timezone=function(t){if(!arguments.length)return d;var e=pd.constrainTo(pd.toNumber(t,d),-14,14);return pd.closeTo(d,e,1/3600)||(i=!0),c=(n=15*(d=e))/15,u=(s-n)/15,this},this.northOffset=function(t){return arguments.length?(l=et(pd.toNumber(t,l),-180,180),this):l},this.dayOfMonth=function(t){if(!arguments.length)return v;var e=pd.constrainTo(pd.toInteger(t,v),1,31);return v!=e&&(M=-1,i=!0),v=e,this},this.monthOfYear=function(t){if(!arguments.length)return D;var e=pd.constrainTo(pd.toInteger(t,D),0,11);return D!=e&&(M=-1,i=!0),D=e,this},this.year=function(t){if(!arguments.length)return b;var e=pd.toInteger(t,b),e=Math.floor(pd.constrainTo(e,-4712,3500));return b!=e&&(j=j&&at(0,e),H=H&&at(1,e),G=G&&at(2,e),r=r&&at(3,e),M=-1,i=!0),b=e,this},this.dayOfYear=function(t){return arguments.length?(h.setDayOfYear(pd.toInteger(t,M),b),this):(M<0&&(M=pd.DateTime.getDOY(v,D,b)),M)},this.clockTime=function(t){return arguments.length?(h.setTimeOfDay(et(pd.toNumber(t,x),0,24)),this):x},this.clockTimeUTC=function(t){return arguments.length?(pd.isNumeric(t)&&h.setTimeOfDay(pd.constrainTo(parseFloat(t)+d,0,24)),this):x-d},this.solarTime=function(t){return X(),arguments.length?(pd.isNumeric(t)&&(e=parseFloat(t)-V-u+y,h.setTimeOfDay(et(e,0,24))),this):x+V+u-y;var e},this.solarTimeUTC=function(t){return arguments.length?(pd.isNumeric(t)&&this.solarTime(parseFloat(t)+d),this):this.solarTime()-d},this.isLeapYear=function(){if(arguments.length)throw e("isLeapYear");return pd.DateTime.isLeapYear(b)},this.dateAsString=function(){if(arguments.length)throw e("dateAsString");return this.formatAsDate(this.dayOfYear(),b)},this.timeAsString=function(){if(arguments.length)throw e("timeAsString");return this.formatAsTime(this.clockTime())},this.datetimeAsString=function(){if(arguments.length)throw e("datetimeAsString");return this.formatAsTime(this.clockTime())+" "+this.formatAsDate(this.dayOfYear(),b)},this.timezoneAsString=function(){if(arguments.length)throw e("timeAsString");var t=d;return 0<=t?"+"+this.formatAsDuration(t):this.formatAsDuration(t)},this.solarNoon=function(){if(arguments.length)throw e("solarNoon");return X(),C},this.timezoneCorrection=function(){if(arguments.length)throw e("timezoneCorrection");return u-y},this.sunriseTime=function(){if(arguments.length)throw e("sunriseTime");return X(),S[this.twilight.SOLAR_DISK_TOP_WITH_ATM_REFRACTION]},this.sunsetTime=function(){if(arguments.length)throw e("sunsetTime");return X(),N[this.twilight.SOLAR_DISK_TOP_WITH_ATM_REFRACTION]},this.azimuthAngle=function(){if(arguments.length)throw e("azimuthAngle");return X(),q},this.altitudeAngle=function(){if(arguments.length)throw e("altitudeAngle");return X(),U},this.declinationAngle=function(){if(arguments.length)throw e("declinationAngle");return X(),A*J},this.hourAngle=function(){if(arguments.length)throw e("hourAngle");return(12-h.solarTime())/24*360},this.hourAngleSolarUTC=function(){if(arguments.length)throw e("hourAngleWithTimeZoneOffset");return(12-(x+V-d))/24*360},this.eqnOfTime=function(){if(arguments.length)throw e("eqnOfTime");return V},this.calcDefaultTimezone=function(t){return pd.snapTo(t,15)/15},this.calcDayOfYearIndex=function(t,e,r){return pd.DateTime.getDOY(t,e,r)},this.formatAsTime=function(t,e){return t=pd.toNumber(t,x),pd.DateTime.formatTime(t,e)},this.formatAsDuration=function(t,e){return t=pd.toNumber(t,x),pd.DateTime.formatDuration(t,e)},this.formatAsTimezone=function(t){t=pd.toNumber(t,d),pd.DateTime.formatTimezone(t)},this.formatAsDate=function(t,e){return pd.DateTime.formatDate(t,e||b,null!=e)},this.getEquinoxMar=function(){return null==j&&(j=at(0,b)),j},this.getSolsticeJun=function(){return null==H&&(H=at(1,b)),H},this.getEquinoxSep=function(){return null==G&&(G=at(2,b)),G},this.getSolsticeDec=function(){return null==r&&(r=at(3,b)),r}}}();var libtess={DEBUG:!0,assert:function(e,t){if(libtess.DEBUG&&!e)throw new Error("Assertion failed"+(t?": "+t:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,TESS_MAX_CACHE:100,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901}};libtess.PQHandle,libtess.PQKey,libtess.geom={},libtess.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},libtess.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},libtess.geom.edgeEval=function(e,t,i){libtess.assert(libtess.geom.vertLeq(e,t)&&libtess.geom.vertLeq(t,i));var n=t.s-e.s,s=i.s-t.s;return 0<n+s?n<s?t.t-e.t+(e.t-i.t)*(n/(n+s)):t.t-i.t+(i.t-e.t)*(s/(n+s)):0},libtess.geom.edgeSign=function(e,t,i){libtess.assert(libtess.geom.vertLeq(e,t)&&libtess.geom.vertLeq(t,i));var n=t.s-e.s,s=i.s-t.s;return 0<n+s?(t.t-i.t)*n+(t.t-e.t)*s:0},libtess.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},libtess.geom.transEval=function(e,t,i){libtess.assert(libtess.geom.transLeq(e,t)&&libtess.geom.transLeq(t,i));var n=t.t-e.t,s=i.t-t.t;return 0<n+s?n<s?t.s-e.s+(e.s-i.s)*(n/(n+s)):t.s-i.s+(i.s-e.s)*(s/(n+s)):0},libtess.geom.transSign=function(e,t,i){libtess.assert(libtess.geom.transLeq(e,t)&&libtess.geom.transLeq(t,i));var n=t.t-e.t,s=i.t-t.t;return 0<n+s?(t.s-i.s)*n+(t.s-e.s)*s:0},libtess.geom.edgeGoesLeft=function(e){return libtess.geom.vertLeq(e.dst(),e.org)},libtess.geom.edgeGoesRight=function(e){return libtess.geom.vertLeq(e.org,e.dst())},libtess.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},libtess.geom.vertCCW=function(e,t,i){return 0<=e.s*(t.t-i.t)+t.s*(i.t-e.t)+i.s*(e.t-t.t)},libtess.geom.interpolate_=function(e,t,i,n){return(e=e<0?0:e)<=(i=i<0?0:i)?0===i?(t+n)/2:t+e/(e+i)*(n-t):n+i/(e+i)*(t-n)},libtess.geom.edgeIntersect=function(e,t,i,n,s){var a,r,o;libtess.geom.vertLeq(e,t)||(o=e,e=t,t=o),libtess.geom.vertLeq(i,n)||(o=i,i=n,n=o),libtess.geom.vertLeq(e,i)||(o=e,e=i,i=o,o=t,t=n,n=o),libtess.geom.vertLeq(i,t)?libtess.geom.vertLeq(t,n)?((a=libtess.geom.edgeEval(e,i,t))+(r=libtess.geom.edgeEval(i,t,n))<0&&(a=-a,r=-r),s.s=libtess.geom.interpolate_(a,i.s,r,t.s)):((a=libtess.geom.edgeSign(e,i,t))+(r=-libtess.geom.edgeSign(e,n,t))<0&&(a=-a,r=-r),s.s=libtess.geom.interpolate_(a,i.s,r,n.s)):s.s=(i.s+t.s)/2,libtess.geom.transLeq(e,t)||(o=e,e=t,t=o),libtess.geom.transLeq(i,n)||(o=i,i=n,n=o),libtess.geom.transLeq(e,i)||(o=e,e=i,i=o,o=t,t=n,n=o),libtess.geom.transLeq(i,t)?libtess.geom.transLeq(t,n)?((a=libtess.geom.transEval(e,i,t))+(r=libtess.geom.transEval(i,t,n))<0&&(a=-a,r=-r),s.t=libtess.geom.interpolate_(a,i.t,r,t.t)):((a=libtess.geom.transSign(e,i,t))+(r=-libtess.geom.transSign(e,n,t))<0&&(a=-a,r=-r),s.t=libtess.geom.interpolate_(a,i.t,r,n.t)):s.t=(i.t+t.t)/2},libtess.mesh={},libtess.mesh.makeEdge=function(e){var t=libtess.mesh.makeEdgePair_(e.eHead);return libtess.mesh.makeVertex_(t,e.vHead),libtess.mesh.makeVertex_(t.sym,e.vHead),libtess.mesh.makeFace_(t,e.fHead),t},libtess.mesh.meshSplice=function(e,t){var i=!1,n=!1;e!==t&&(t.org!==e.org&&(n=!0,libtess.mesh.killVertex_(t.org,e.org)),t.lFace!==e.lFace&&(i=!0,libtess.mesh.killFace_(t.lFace,e.lFace)),libtess.mesh.splice_(t,e),n||(libtess.mesh.makeVertex_(t,e.org),e.org.anEdge=e),i||(libtess.mesh.makeFace_(t,e.lFace),e.lFace.anEdge=e))},libtess.mesh.deleteEdge=function(e){var t=e.sym,i=!1;e.lFace!==e.rFace()&&(i=!0,libtess.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?libtess.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,libtess.mesh.splice_(e,e.oPrev()),i||libtess.mesh.makeFace_(e,e.lFace)),t.oNext===t?(libtess.mesh.killVertex_(t.org,null),libtess.mesh.killFace_(t.lFace,null)):(e.lFace.anEdge=t.oPrev(),t.org.anEdge=t.oNext,libtess.mesh.splice_(t,t.oPrev())),libtess.mesh.killEdge_(e)},libtess.mesh.addEdgeVertex=function(e){var t=libtess.mesh.makeEdgePair_(e),i=t.sym;return libtess.mesh.splice_(t,e.lNext),t.org=e.dst(),libtess.mesh.makeVertex_(i,t.org),t.lFace=i.lFace=e.lFace,t},libtess.mesh.splitEdge=function(e){var t=libtess.mesh.addEdgeVertex(e).sym;return libtess.mesh.splice_(e.sym,e.sym.oPrev()),libtess.mesh.splice_(e.sym,t),e.sym.org=t.org,t.dst().anEdge=t.sym,t.sym.lFace=e.rFace(),t.winding=e.winding,t.sym.winding=e.sym.winding,t},libtess.mesh.connect=function(e,t){var i=!1,n=libtess.mesh.makeEdgePair_(e),s=n.sym;return t.lFace!==e.lFace&&(i=!0,libtess.mesh.killFace_(t.lFace,e.lFace)),libtess.mesh.splice_(n,e.lNext),libtess.mesh.splice_(s,t),n.org=e.dst(),s.org=t.org,n.lFace=s.lFace=e.lFace,e.lFace.anEdge=s,i||libtess.mesh.makeFace_(n,e.lFace),n},libtess.mesh.zapFace=function(e){var t=e.anEdge,i=t.lNext;do{var n,s,i=(s=i).lNext}while((s.lFace=null)===s.rFace()&&(s.oNext===s?libtess.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,libtess.mesh.splice_(s,s.oPrev())),(n=s.sym).oNext===n?libtess.mesh.killVertex_(n.org,null):(n.org.anEdge=n.oNext,libtess.mesh.splice_(n,n.oPrev())),libtess.mesh.killEdge_(s)),s!==t);var a=e.prev,e=e.next;(e.prev=a).next=e},libtess.mesh.meshUnion=function(e,t){var i=e.fHead,n=e.vHead,s=e.eHead,a=t.fHead,r=t.vHead,t=t.eHead;return a.next!==a&&(i.prev.next=a.next,a.next.prev=i.prev,(a.prev.next=i).prev=a.prev),r.next!==r&&(n.prev.next=r.next,r.next.prev=n.prev,(r.prev.next=n).prev=r.prev),t.next!==t&&(s.sym.next.sym.next=t.next,t.next.sym.next=s.sym.next,(t.sym.next.sym.next=s).sym.next=t.sym.next),e},libtess.mesh.deleteMesh=function(e){},libtess.mesh.makeEdgePair_=function(e){var t=new libtess.GluHalfEdge,i=new libtess.GluHalfEdge,n=e.sym.next;return(((i.next=n).sym.next=t).next=e).sym.next=i,t.sym=i,((t.oNext=t).lNext=i).sym=t,(i.oNext=i).lNext=t},libtess.mesh.splice_=function(e,t){var i=e.oNext,n=t.oNext;i.sym.lNext=t,(n.sym.lNext=e).oNext=n,t.oNext=i},libtess.mesh.makeVertex_=function(e,t){var i=t.prev,n=new libtess.GluVertex(t,i);i.next=n;for(var s=(t.prev=n).anEdge=e;s.org=n,(s=s.oNext)!==e;);},libtess.mesh.makeFace_=function(e,t){var i=t.prev,n=new libtess.GluFace(t,i);i.next=n,(t.prev=n).anEdge=e,n.inside=t.inside;for(var s=e;s.lFace=n,(s=s.lNext)!==e;);},libtess.mesh.killEdge_=function(e){var t=e.next,e=e.sym.next;(t.sym.next=e).sym.next=t},libtess.mesh.killVertex_=function(e,t){for(var i=e.anEdge,n=i;n.org=t,(n=n.oNext)!==i;);var s=e.prev,e=e.next;(e.prev=s).next=e},libtess.mesh.killFace_=function(e,t){for(var i=e.anEdge,n=i;n.lFace=t,(n=n.lNext)!==i;);var s=e.prev,e=e.next;(e.prev=s).next=e},libtess.normal={},libtess.normal.S_UNIT_X_=1,libtess.normal.S_UNIT_Y_=0,libtess.normal.projectPolygon=function(e){var t=!1,i=[e.normal[0],e.normal[1],e.normal[2]];0===i[0]&&0===i[1]&&0===i[2]&&(libtess.normal.computeNormal_(e,i),t=!0);var n,s=e.sUnit,a=e.tUnit,r=libtess.normal.longAxis_(i);libtess.TRUE_PROJECT?(libtess.normal.normalize_(i),s[r]=0,s[(r+1)%3]=libtess.normal.S_UNIT_X_,s[(r+2)%3]=libtess.normal.S_UNIT_Y_,n=libtess.normal.dot_(s,i),s[0]-=n*i[0],s[1]-=n*i[1],s[2]-=n*i[2],libtess.normal.normalize_(s),a[0]=i[1]*s[2]-i[2]*s[1],a[1]=i[2]*s[0]-i[0]*s[2],a[2]=i[0]*s[1]-i[1]*s[0],libtess.normal.normalize_(a)):(s[r]=0,s[(r+1)%3]=libtess.normal.S_UNIT_X_,s[(r+2)%3]=libtess.normal.S_UNIT_Y_,a[r]=0,a[(r+1)%3]=0<i[r]?-libtess.normal.S_UNIT_Y_:libtess.normal.S_UNIT_Y_,a[(r+2)%3]=0<i[r]?libtess.normal.S_UNIT_X_:-libtess.normal.S_UNIT_X_);for(var o=e.mesh.vHead,l=o.next;l!==o;l=l.next)l.s=libtess.normal.dot_(l.coords,s),l.t=libtess.normal.dot_(l.coords,a);t&&libtess.normal.checkOrientation_(e)},libtess.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},libtess.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];libtess.assert(0<t),t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},libtess.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},libtess.normal.computeNormal_=function(e,t){for(var i=[-2*libtess.GLU_TESS_MAX_COORD,-2*libtess.GLU_TESS_MAX_COORD,-2*libtess.GLU_TESS_MAX_COORD],n=[2*libtess.GLU_TESS_MAX_COORD,2*libtess.GLU_TESS_MAX_COORD,2*libtess.GLU_TESS_MAX_COORD],s=[],a=[],r=e.mesh.vHead,o=r.next;o!==r;o=o.next)for(var l=0;l<3;++l){var d=o.coords[l];d<n[l]&&(n[l]=d,a[l]=o),d>i[l]&&(i[l]=d,s[l]=o)}var h=0;if(i[1]-n[1]>i[0]-n[0]&&(h=1),i[2]-n[2]>i[h]-n[h]&&(h=2),n[h]>=i[h])return t[0]=0,t[1]=0,void(t[2]=1);var c=0,e=a[h],p=s[h],u=[0,0,0],g=[e.coords[0]-p.coords[0],e.coords[1]-p.coords[1],e.coords[2]-p.coords[2]],m=[0,0,0];for(o=r.next;o!==r;o=o.next){m[0]=o.coords[0]-p.coords[0],m[1]=o.coords[1]-p.coords[1],m[2]=o.coords[2]-p.coords[2],u[0]=g[1]*m[2]-g[2]*m[1],u[1]=g[2]*m[0]-g[0]*m[2],u[2]=g[0]*m[1]-g[1]*m[0];var f=u[0]*u[0]+u[1]*u[1]+u[2]*u[2];c<f&&(c=f,t[0]=u[0],t[1]=u[1],t[2]=u[2])}c<=0&&(t[0]=t[1]=t[2]=0,t[libtess.normal.longAxis_(g)]=1)},libtess.normal.checkOrientation_=function(e){for(var t=0,i=e.mesh.fHead,n=i.next;n!==i;n=n.next){var s=n.anEdge;if(!(s.winding<=0))for(;t+=(s.org.s-s.dst().s)*(s.org.t+s.dst().t),(s=s.lNext)!==n.anEdge;);}if(t<0){for(var a=e.mesh.vHead,r=a.next;r!==a;r=r.next)r.t=-r.t;e.tUnit[0]=-e.tUnit[0],e.tUnit[1]=-e.tUnit[1],e.tUnit[2]=-e.tUnit[2]}},libtess.render={},libtess.render.renderMesh=function(e,t,i){for(var n=!1,s=-1,a=t.fHead.prev;a!==t.fHead;a=a.prev)if(a.inside){n||(e.callBeginOrBeginData(libtess.primitiveType.GL_TRIANGLES),n=!0);var r,o=a.anEdge;libtess.assert(o.lNext.lNext.lNext===o,"renderMesh called with non-triangulated mesh");do{}while(!i||s!==(r=o.rFace().inside?0:1)&&(s=r,e.callEdgeFlagOrEdgeFlagData(!!s)),e.callVertexOrVertexData(o.org.data),(o=o.lNext)!==a.anEdge)}n&&e.callEndOrEndData()},libtess.render.renderBoundary=function(e,t){for(var i=t.fHead.next;i!==t.fHead;i=i.next)if(i.inside){e.callBeginOrBeginData(libtess.primitiveType.GL_LINE_LOOP);for(var n=i.anEdge;e.callVertexOrVertexData(n.org.data),(n=n.lNext)!==i.anEdge;);e.callEndOrEndData()}},libtess.sweep={},libtess.sweep.SENTINEL_COORD_=4*libtess.GLU_TESS_MAX_COORD,libtess.sweep.TOLERANCE_NONZERO_=!1,libtess.sweep.computeInterior=function(e){var t;for(e.fatalError=!1,libtess.sweep.removeDegenerateEdges_(e),libtess.sweep.initPriorityQ_(e),libtess.sweep.initEdgeDict_(e);null!==(t=e.pq.extractMin());){for(;;){var i=e.pq.minimum();if(null===i||!libtess.geom.vertEq(i,t))break;i=e.pq.extractMin(),libtess.sweep.spliceMergeVertices_(e,t.anEdge,i.anEdge)}libtess.sweep.sweepEvent_(e,t)}var n=e.dict.getMin().getKey();e.event=n.eUp.org,libtess.sweep.doneEdgeDict_(e),libtess.sweep.donePriorityQ_(e),libtess.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},libtess.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},libtess.sweep.edgeLeq_=function(e,t,i){e=e.event,t=t.eUp,i=i.eUp;if(t.dst()===e)return i.dst()===e?libtess.geom.vertLeq(t.org,i.org)?libtess.geom.edgeSign(i.dst(),t.org,i.org)<=0:0<=libtess.geom.edgeSign(t.dst(),i.org,t.org):libtess.geom.edgeSign(i.dst(),e,i.org)<=0;if(i.dst()===e)return 0<=libtess.geom.edgeSign(t.dst(),e,t.org);t=libtess.geom.edgeEval(t.dst(),e,t.org);return libtess.geom.edgeEval(i.dst(),e,i.org)<=t},libtess.sweep.deleteRegion_=function(e,t){t.fixUpperEdge&&libtess.assert(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},libtess.sweep.fixUpperEdge_=function(e,t){libtess.assert(e.fixUpperEdge),libtess.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,(e.eUp=t).activeRegion=e},libtess.sweep.topLeftRegion_=function(e){for(var t,i=e.eUp.org;(e=e.regionAbove()).eUp.org===i;);return e.fixUpperEdge&&(t=libtess.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext),libtess.sweep.fixUpperEdge_(e,t),e=e.regionAbove()),e},libtess.sweep.topRightRegion_=function(e){for(var t=e.eUp.dst();(e=e.regionAbove()).eUp.dst()===t;);return e},libtess.sweep.addRegionBelow_=function(e,t,i){var n=new libtess.ActiveRegion;return n.eUp=i,n.nodeUp=e.dict.insertBefore(t.nodeUp,n),i.activeRegion=n},libtess.sweep.isWindingInside_=function(e,t){switch(e.windingRule){case libtess.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&t);case libtess.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==t;case libtess.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<t;case libtess.windingRule.GLU_TESS_WINDING_NEGATIVE:return t<0;case libtess.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=t||t<=-2}return libtess.assert(!1),!1},libtess.sweep.computeWinding_=function(e,t){t.windingNumber=t.regionAbove().windingNumber+t.eUp.winding,t.inside=libtess.sweep.isWindingInside_(e,t.windingNumber)},libtess.sweep.finishRegion_=function(e,t){var i=t.eUp,n=i.lFace;n.inside=t.inside,n.anEdge=i,libtess.sweep.deleteRegion_(e,t)},libtess.sweep.finishLeftRegions_=function(e,t,i){for(var n=t,s=t.eUp;n!==i;){n.fixUpperEdge=!1;var a=n.regionBelow(),r=a.eUp;if(r.org!==s.org){if(!a.fixUpperEdge){libtess.sweep.finishRegion_(e,n);break}r=libtess.mesh.connect(s.lPrev(),r.sym),libtess.sweep.fixUpperEdge_(a,r)}s.oNext!==r&&(libtess.mesh.meshSplice(r.oPrev(),r),libtess.mesh.meshSplice(s,r)),libtess.sweep.finishRegion_(e,n),s=a.eUp,n=a}return s},libtess.sweep.addRightEdges_=function(e,t,i,n,s,a){for(var r=!0,o=i;libtess.assert(libtess.geom.vertLeq(o.org,o.dst())),libtess.sweep.addRegionBelow_(e,t,o.sym),(o=o.oNext)!==n;);null===s&&(s=t.regionBelow().eUp.rPrev());for(var l,d=t,h=s;(o=(l=d.regionBelow()).eUp.sym).org===h.org;)o.oNext!==h&&(libtess.mesh.meshSplice(o.oPrev(),o),libtess.mesh.meshSplice(h.oPrev(),o)),l.windingNumber=d.windingNumber-o.winding,l.inside=libtess.sweep.isWindingInside_(e,l.windingNumber),d.dirty=!0,!r&&libtess.sweep.checkForRightSplice_(e,d)&&(libtess.sweep.addWinding_(o,h),libtess.sweep.deleteRegion_(e,d),libtess.mesh.deleteEdge(h)),r=!1,d=l,h=o;d.dirty=!0,libtess.assert(d.windingNumber-o.winding===l.windingNumber),a&&libtess.sweep.walkDirtyRegions_(e,d)},libtess.sweep.callCombine_=function(e,t,i,n,s){var a=[t.coords[0],t.coords[1],t.coords[2]];t.data=null,t.data=e.callCombineOrCombineData(a,i,n),null===t.data&&(s?e.fatalError||(e.callErrorOrErrorData(libtess.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):t.data=i[0])},libtess.sweep.spliceMergeVertices_=function(e,t,i){var n=[null,null,null,null];n[0]=t.org.data,n[1]=i.org.data,libtess.sweep.callCombine_(e,t.org,n,[.5,.5,0,0],!1),libtess.mesh.meshSplice(t,i)},libtess.sweep.vertexWeights_=function(e,t,i,n,s){var a=libtess.geom.vertL1dist(t,e),r=libtess.geom.vertL1dist(i,e),o=s,s=s+1;n[o]=.5*r/(a+r),n[s]=.5*a/(a+r),e.coords[0]+=n[o]*t.coords[0]+n[s]*i.coords[0],e.coords[1]+=n[o]*t.coords[1]+n[s]*i.coords[1],e.coords[2]+=n[o]*t.coords[2]+n[s]*i.coords[2]},libtess.sweep.getIntersectData_=function(e,t,i,n,s,a){var r=[0,0,0,0],o=[i.data,n.data,s.data,a.data];t.coords[0]=t.coords[1]=t.coords[2]=0,libtess.sweep.vertexWeights_(t,i,n,r,0),libtess.sweep.vertexWeights_(t,s,a,r,2),libtess.sweep.callCombine_(e,t,o,r,!0)},libtess.sweep.checkForRightSplice_=function(e,t){var i=t.regionBelow(),n=t.eUp,s=i.eUp;if(libtess.geom.vertLeq(n.org,s.org)){if(0<libtess.geom.edgeSign(s.dst(),n.org,s.org))return!1;libtess.geom.vertEq(n.org,s.org)?n.org!==s.org&&(e.pq.remove(n.org.pqHandle),libtess.sweep.spliceMergeVertices_(e,s.oPrev(),n)):(libtess.mesh.splitEdge(s.sym),libtess.mesh.meshSplice(n,s.oPrev()),t.dirty=i.dirty=!0)}else{if(libtess.geom.edgeSign(n.dst(),s.org,n.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,libtess.mesh.splitEdge(n.sym),libtess.mesh.meshSplice(s.oPrev(),n)}return!0},libtess.sweep.checkForLeftSplice_=function(e,t){var i,n=t.regionBelow(),s=t.eUp,a=n.eUp;if(libtess.assert(!libtess.geom.vertEq(s.dst(),a.dst())),libtess.geom.vertLeq(s.dst(),a.dst())){if(libtess.geom.edgeSign(s.dst(),a.dst(),s.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,i=libtess.mesh.splitEdge(s),libtess.mesh.meshSplice(a.sym,i),i.lFace.inside=t.inside}else{if(0<libtess.geom.edgeSign(a.dst(),s.dst(),a.org))return!1;t.dirty=n.dirty=!0,i=libtess.mesh.splitEdge(a),libtess.mesh.meshSplice(s.lNext,a.sym),i.rFace().inside=t.inside}return!0},libtess.sweep.checkForIntersect_=function(e,t){var i=t.regionBelow(),n=t.eUp,s=i.eUp,a=n.org,r=s.org,o=n.dst(),l=s.dst(),d=new libtess.GluVertex;if(libtess.assert(!libtess.geom.vertEq(l,o)),libtess.assert(libtess.geom.edgeSign(o,e.event,a)<=0),libtess.assert(0<=libtess.geom.edgeSign(l,e.event,r)),libtess.assert(a!==e.event&&r!==e.event),libtess.assert(!t.fixUpperEdge&&!i.fixUpperEdge),a===r)return!1;var h=Math.min(a.t,o.t);if(Math.max(r.t,l.t)<h)return!1;if(libtess.geom.vertLeq(a,r)){if(0<libtess.geom.edgeSign(l,a,r))return!1}else if(libtess.geom.edgeSign(o,r,a)<0)return!1;libtess.geom.edgeIntersect(o,a,l,r,d),libtess.assert(Math.min(a.t,o.t)<=d.t),libtess.assert(d.t<=Math.max(r.t,l.t)),libtess.assert(Math.min(l.s,o.s)<=d.s),libtess.assert(d.s<=Math.max(r.s,a.s)),libtess.geom.vertLeq(d,e.event)&&(d.s=e.event.s,d.t=e.event.t);h=libtess.geom.vertLeq(a,r)?a:r;if(libtess.geom.vertLeq(h,d)&&(d.s=h.s,d.t=h.t),libtess.geom.vertEq(d,a)||libtess.geom.vertEq(d,r))return libtess.sweep.checkForRightSplice_(e,t),!1;if(!libtess.geom.vertEq(o,e.event)&&0<=libtess.geom.edgeSign(o,e.event,d)||!libtess.geom.vertEq(l,e.event)&&libtess.geom.edgeSign(l,e.event,d)<=0){if(l===e.event)return libtess.mesh.splitEdge(n.sym),libtess.mesh.meshSplice(s.sym,n),n=(t=libtess.sweep.topLeftRegion_(t)).regionBelow().eUp,libtess.sweep.finishLeftRegions_(e,t.regionBelow(),i),libtess.sweep.addRightEdges_(e,t,n.oPrev(),n,n,!0),!0;if(o!==e.event)return 0<=libtess.geom.edgeSign(o,e.event,d)&&(t.regionAbove().dirty=t.dirty=!0,libtess.mesh.splitEdge(n.sym),n.org.s=e.event.s,n.org.t=e.event.t),libtess.geom.edgeSign(l,e.event,d)<=0&&(t.dirty=i.dirty=!0,libtess.mesh.splitEdge(s.sym),s.org.s=e.event.s,s.org.t=e.event.t),!1;libtess.mesh.splitEdge(s.sym),libtess.mesh.meshSplice(n.lNext,s.oPrev()),i=t;h=(t=libtess.sweep.topRightRegion_(t)).regionBelow().eUp.rPrev();return i.eUp=s.oPrev(),s=libtess.sweep.finishLeftRegions_(e,i,null),libtess.sweep.addRightEdges_(e,t,s.oNext,n.rPrev(),h,!0),!0}return libtess.mesh.splitEdge(n.sym),libtess.mesh.splitEdge(s.sym),libtess.mesh.meshSplice(s.oPrev(),n),n.org.s=d.s,n.org.t=d.t,n.org.pqHandle=e.pq.insert(n.org),libtess.sweep.getIntersectData_(e,n.org,a,o,r,l),!(t.regionAbove().dirty=t.dirty=i.dirty=!0)},libtess.sweep.walkDirtyRegions_=function(e,t){for(var i=t.regionBelow();;){for(;i.dirty;)i=(t=i).regionBelow();if(!(t.dirty||null!==(t=(i=t).regionAbove())&&t.dirty))return;t.dirty=!1;var n=t.eUp,s=i.eUp;if(n.dst()!==s.dst()&&libtess.sweep.checkForLeftSplice_(e,t)&&(i.fixUpperEdge?(libtess.sweep.deleteRegion_(e,i),libtess.mesh.deleteEdge(s),s=(i=t.regionBelow()).eUp):t.fixUpperEdge&&(libtess.sweep.deleteRegion_(e,t),libtess.mesh.deleteEdge(n),n=(t=i.regionAbove()).eUp)),n.org!==s.org)if(n.dst()===s.dst()||t.fixUpperEdge||i.fixUpperEdge||n.dst()!==e.event&&s.dst()!==e.event)libtess.sweep.checkForRightSplice_(e,t);else if(libtess.sweep.checkForIntersect_(e,t))return;n.org===s.org&&n.dst()===s.dst()&&(libtess.sweep.addWinding_(s,n),libtess.sweep.deleteRegion_(e,t),libtess.mesh.deleteEdge(n),t=i.regionAbove())}},libtess.sweep.connectRightVertex_=function(e,t,i){var n=i.oNext,s=t.regionBelow(),a=t.eUp,r=s.eUp,o=!1;a.dst()!==r.dst()&&libtess.sweep.checkForIntersect_(e,t),libtess.geom.vertEq(a.org,e.event)&&(libtess.mesh.meshSplice(n.oPrev(),a),n=(t=libtess.sweep.topLeftRegion_(t)).regionBelow().eUp,libtess.sweep.finishLeftRegions_(e,t.regionBelow(),s),o=!0),libtess.geom.vertEq(r.org,e.event)&&(libtess.mesh.meshSplice(i,r.oPrev()),i=libtess.sweep.finishLeftRegions_(e,s,null),o=!0),o?libtess.sweep.addRightEdges_(e,t,i.oNext,n,n,!0):(a=libtess.geom.vertLeq(r.org,a.org)?r.oPrev():a,a=libtess.mesh.connect(i.lPrev(),a),libtess.sweep.addRightEdges_(e,t,a,a.oNext,a.oNext,!1),a.sym.activeRegion.fixUpperEdge=!0,libtess.sweep.walkDirtyRegions_(e,t))},libtess.sweep.connectLeftDegenerate_=function(e,t,i){var n,s,a,r,o=t.eUp;return libtess.geom.vertEq(o.org,i)?(libtess.assert(libtess.sweep.TOLERANCE_NONZERO_),void(libtess.sweep.TOLERANCE_NONZERO_&&libtess.sweep.spliceMergeVertices_(e,o,i.anEdge))):libtess.geom.vertEq(o.dst(),i)?(libtess.assert(libtess.sweep.TOLERANCE_NONZERO_),void(libtess.sweep.TOLERANCE_NONZERO_&&(r=a=(s=(n=(t=libtess.sweep.topRightRegion_(t)).regionBelow()).eUp.sym).oNext,n.fixUpperEdge&&(libtess.assert(a!==s),libtess.sweep.deleteRegion_(e,n),libtess.mesh.deleteEdge(s),s=a.oPrev()),libtess.mesh.meshSplice(i.anEdge,s),libtess.geom.edgeGoesLeft(a)||(a=null),libtess.sweep.addRightEdges_(e,t,s.oNext,r,a,!0)))):(libtess.mesh.splitEdge(o.sym),t.fixUpperEdge&&(libtess.mesh.deleteEdge(o.oNext),t.fixUpperEdge=!1),libtess.mesh.meshSplice(i.anEdge,o),void libtess.sweep.sweepEvent_(e,i))},libtess.sweep.connectLeftVertex_=function(e,t){var i=new libtess.ActiveRegion;i.eUp=t.anEdge.sym;var n=e.dict.search(i).getKey(),s=n.regionBelow(),a=n.eUp,i=s.eUp;0!==libtess.geom.edgeSign(a.dst(),t,a.org)?(s=libtess.geom.vertLeq(i.dst(),a.dst())?n:s,n.inside||s.fixUpperEdge?(i=s===n?libtess.mesh.connect(t.anEdge.sym,a.lNext):libtess.mesh.connect(i.dNext(),t.anEdge).sym,s.fixUpperEdge?libtess.sweep.fixUpperEdge_(s,i):libtess.sweep.computeWinding_(e,libtess.sweep.addRegionBelow_(e,n,i)),libtess.sweep.sweepEvent_(e,t)):libtess.sweep.addRightEdges_(e,n,t.anEdge,t.anEdge,null,!0)):libtess.sweep.connectLeftDegenerate_(e,n,t)},libtess.sweep.sweepEvent_=function(e,t){for(var i=(e.event=t).anEdge;null===i.activeRegion;)if((i=i.oNext)===t.anEdge)return void libtess.sweep.connectLeftVertex_(e,t);var n=libtess.sweep.topLeftRegion_(i.activeRegion),s=n.regionBelow(),a=s.eUp,s=libtess.sweep.finishLeftRegions_(e,s,null);s.oNext===a?libtess.sweep.connectRightVertex_(e,n,s):libtess.sweep.addRightEdges_(e,n,s.oNext,a,a,!0)},libtess.sweep.addSentinel_=function(e,t){var i=new libtess.ActiveRegion,n=libtess.mesh.makeEdge(e.mesh);n.org.s=libtess.sweep.SENTINEL_COORD_,n.org.t=t,n.dst().s=-libtess.sweep.SENTINEL_COORD_,n.dst().t=t,e.event=n.dst(),i.eUp=n,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},libtess.sweep.initEdgeDict_=function(e){e.dict=new libtess.Dict(e,libtess.sweep.edgeLeq_),libtess.sweep.addSentinel_(e,-libtess.sweep.SENTINEL_COORD_),libtess.sweep.addSentinel_(e,libtess.sweep.SENTINEL_COORD_)},libtess.sweep.doneEdgeDict_=function(e){for(var t,i=0;null!==(t=e.dict.getMin().getKey());)t.sentinel||(libtess.assert(t.fixUpperEdge),libtess.assert(1==++i)),libtess.assert(0===t.windingNumber),libtess.sweep.deleteRegion_(e,t);e.dict=null},libtess.sweep.removeDegenerateEdges_=function(e){for(var t,i=e.mesh.eHead,n=i.next;n!==i;n=t){t=n.next;var s=n.lNext;libtess.geom.vertEq(n.org,n.dst())&&n.lNext.lNext!==n&&(libtess.sweep.spliceMergeVertices_(e,s,n),libtess.mesh.deleteEdge(n),s=(n=s).lNext),s.lNext===n&&(s!==n&&(s!==t&&s!==t.sym||(t=t.next),libtess.mesh.deleteEdge(s)),n!==t&&n!==t.sym||(t=t.next),libtess.mesh.deleteEdge(n))}},libtess.sweep.initPriorityQ_=function(e){var t=new libtess.PriorityQ(libtess.geom.vertLeq);e.pq=t;for(var i=e.mesh.vHead,n=i.next;n!==i;n=n.next)n.pqHandle=t.insert(n);t.init()},libtess.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},libtess.sweep.removeDegenerateFaces_=function(e){for(var t,i=e.fHead.next;i!==e.fHead;i=t){t=i.next;var n=i.anEdge;libtess.assert(n.lNext!==n),n.lNext.lNext===n&&(libtess.sweep.addWinding_(n.oNext,n),libtess.mesh.deleteEdge(n))}},libtess.tessmono={},libtess.tessmono.tessellateMonoRegion_=function(e){var t=e.anEdge;for(libtess.assert(t.lNext!==t&&t.lNext.lNext!==t);libtess.geom.vertLeq(t.dst(),t.org);t=t.lPrev());for(;libtess.geom.vertLeq(t.org,t.dst());t=t.lNext);for(var i=t.lPrev();t.lNext!==i;)if(libtess.geom.vertLeq(t.dst(),i.org)){for(;i.lNext!==t&&(libtess.geom.edgeGoesLeft(i.lNext)||libtess.geom.edgeSign(i.org,i.dst(),i.lNext.dst())<=0);)i=libtess.mesh.connect(i.lNext,i).sym;i=i.lPrev()}else{for(;i.lNext!==t&&(libtess.geom.edgeGoesRight(t.lPrev())||0<=libtess.geom.edgeSign(t.dst(),t.org,t.lPrev().org));)t=libtess.mesh.connect(t,t.lPrev()).sym;t=t.lNext}for(libtess.assert(i.lNext!==t);i.lNext.lNext!==t;)i=libtess.mesh.connect(i.lNext,i).sym},libtess.tessmono.tessellateInterior=function(e){for(var t,i=e.fHead.next;i!==e.fHead;i=t)t=i.next,i.inside&&libtess.tessmono.tessellateMonoRegion_(i)},libtess.tessmono.discardExterior=function(e){for(var t,i=e.fHead.next;i!==e.fHead;i=t)t=i.next,i.inside||libtess.mesh.zapFace(i)},libtess.tessmono.setWindingNumber=function(e,t,i){for(var n,s=e.eHead.next;s!==e.eHead;s=n)n=s.next,s.rFace().inside!==s.lFace.inside?s.winding=s.lFace.inside?t:-t:i?libtess.mesh.deleteEdge(s):s.winding=0},libtess.Dict=function(e,t){this.head_=new libtess.DictNode,this.frame_=e,this.leq_=t},libtess.Dict.prototype.deleteDict_=function(){},libtess.Dict.prototype.insertBefore=function(e,t){for(;null!==(e=e.prev).key&&!this.leq_(this.frame_,e.key,t););var i=new libtess.DictNode(t,e.next,e);return e.next.prev=i,e.next=i},libtess.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},libtess.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},libtess.Dict.prototype.search=function(e){for(var t=this.head_;null!==(t=t.next).key&&!this.leq_(this.frame_,e,t.key););return t},libtess.Dict.prototype.getMin=function(){return this.head_.next},libtess.Dict.prototype.getMax=function(){return this.head_.prev},libtess.DictNode=function(e,t,i){this.key=e||null,this.next=t||this,this.prev=i||this},libtess.DictNode.prototype.getKey=function(){return this.key},libtess.DictNode.prototype.getSuccessor=function(){return this.next},libtess.DictNode.prototype.getPredecessor=function(){return this.prev},libtess.CachedVertex=function(){this.coords=[0,0,0],this.data=null},libtess.GluTesselator=function(){this.state=libtess.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.callError_=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.relTolerance=libtess.GLU_TESS_DEFAULT_TOLERANCE,this.windingRule=libtess.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.callCombine_=null,this.boundaryOnly=!1,this.callBegin_=null,this.callEdgeFlag_=null,this.callVertex_=null,this.callEnd_=null,this.callMesh_=null,this.callBeginData_=null,this.callEdgeFlagData_=null,this.callVertexData_=null,this.callEndData_=null,this.callErrorData_=null,this.callCombineData_=null,this.polygonData_=null,this.emptyCache=!1,this.cacheCount=0,this.cache=new Array(libtess.TESS_MAX_CACHE);for(var e=0;e<libtess.TESS_MAX_CACHE;e++)this.cache[e]=new libtess.CachedVertex},libtess.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},libtess.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(libtess.GluTesselator.tessState_.T_DORMANT)},libtess.GluTesselator.prototype.gluTessProperty=function(e,t){switch(e){case libtess.gluEnum.GLU_TESS_TOLERANCE:if(t<0||1<t)break;return void(this.relTolerance=t);case libtess.gluEnum.GLU_TESS_WINDING_RULE:e=t;switch(e){case libtess.windingRule.GLU_TESS_WINDING_ODD:case libtess.windingRule.GLU_TESS_WINDING_NONZERO:case libtess.windingRule.GLU_TESS_WINDING_POSITIVE:case libtess.windingRule.GLU_TESS_WINDING_NEGATIVE:case libtess.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=e)}break;case libtess.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly=!!t);default:return void this.callErrorOrErrorData(libtess.gluEnum.GLU_INVALID_ENUM)}this.callErrorOrErrorData(libtess.gluEnum.GLU_INVALID_VALUE)},libtess.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case libtess.gluEnum.GLU_TESS_TOLERANCE:return libtess.assert(0<=this.relTolerance&&this.relTolerance<=1),this.relTolerance;case libtess.gluEnum.GLU_TESS_WINDING_RULE:e=this.windingRule;return libtess.assert(e===libtess.windingRule.GLU_TESS_WINDING_ODD||e===libtess.windingRule.GLU_TESS_WINDING_NONZERO||e===libtess.windingRule.GLU_TESS_WINDING_POSITIVE||e===libtess.windingRule.GLU_TESS_WINDING_NEGATIVE||e===libtess.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),e;case libtess.gluEnum.GLU_TESS_BOUNDARY_ONLY:return libtess.assert(!0===this.boundaryOnly||!1===this.boundaryOnly),this.boundaryOnly;default:this.callErrorOrErrorData(libtess.gluEnum.GLU_INVALID_ENUM)}return!1},libtess.GluTesselator.prototype.gluTessNormal=function(e,t,i){this.normal[0]=e,this.normal[1]=t,this.normal[2]=i},libtess.GluTesselator.prototype.gluTessCallback=function(e,t){t=t||null;switch(e){case libtess.gluEnum.GLU_TESS_BEGIN:return void(this.callBegin_=t);case libtess.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.callBeginData_=t);case libtess.gluEnum.GLU_TESS_EDGE_FLAG:return void(this.callEdgeFlag_=t);case libtess.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.callEdgeFlagData_=t);case libtess.gluEnum.GLU_TESS_VERTEX:return void(this.callVertex_=t);case libtess.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.callVertexData_=t);case libtess.gluEnum.GLU_TESS_END:return void(this.callEnd_=t);case libtess.gluEnum.GLU_TESS_END_DATA:return void(this.callEndData_=t);case libtess.gluEnum.GLU_TESS_ERROR:return void(this.callError_=t);case libtess.gluEnum.GLU_TESS_ERROR_DATA:return void(this.callErrorData_=t);case libtess.gluEnum.GLU_TESS_COMBINE:return void(this.callCombine_=t);case libtess.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.callCombineData_=t);case libtess.gluEnum.GLU_TESS_MESH:return void(this.callMesh_=t);default:return void this.callErrorOrErrorData(libtess.gluEnum.GLU_INVALID_ENUM)}},libtess.GluTesselator.prototype.gluTessVertex=function(e,t){var i=!1,n=[0,0,0];this.requireState_(libtess.GluTesselator.tessState_.T_IN_CONTOUR),this.emptyCache&&(this.emptyCache_(),this.lastEdge_=null);for(var s=0;s<3;++s){var a=e[s];a<-libtess.GLU_TESS_MAX_COORD&&(a=-libtess.GLU_TESS_MAX_COORD,i=!0),a>libtess.GLU_TESS_MAX_COORD&&(a=libtess.GLU_TESS_MAX_COORD,i=!0),n[s]=a}if(i&&this.callErrorOrErrorData(libtess.errorType.GLU_TESS_COORD_TOO_LARGE),null===this.mesh){if(this.cacheCount<libtess.TESS_MAX_CACHE)return void this.cacheVertex_(n,t);this.emptyCache_()}this.addVertex_(n,t)},libtess.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(libtess.GluTesselator.tessState_.T_DORMANT),this.state=libtess.GluTesselator.tessState_.T_IN_POLYGON,this.cacheCount=0,this.emptyCache=!1,this.mesh=null,this.polygonData_=e},libtess.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(libtess.GluTesselator.tessState_.T_IN_POLYGON),this.state=libtess.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null,0<this.cacheCount&&(this.emptyCache=!0)},libtess.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(libtess.GluTesselator.tessState_.T_IN_CONTOUR),this.state=libtess.GluTesselator.tessState_.T_IN_POLYGON},libtess.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(libtess.GluTesselator.tessState_.T_IN_POLYGON),this.state=libtess.GluTesselator.tessState_.T_DORMANT,null===this.mesh&&this.emptyCache_(),libtess.normal.projectPolygon(this),libtess.sweep.computeInterior(this),!this.fatalError){var e=this.mesh;if(this.boundaryOnly?libtess.tessmono.setWindingNumber(e,1,!0):libtess.tessmono.tessellateInterior(e),this.mesh.checkMesh(),(this.callBegin_||this.callEnd_||this.callVertex_||this.callEdgeFlag_||this.callBeginData_||this.callEndData_||this.callVertexData_||this.callEdgeFlagData_)&&(this.boundaryOnly?libtess.render.renderBoundary(this,this.mesh):(e=!(!this.callEdgeFlag_&&!this.callEdgeFlagData_),libtess.render.renderMesh(this,this.mesh,e))),this.callMesh_)return libtess.tessmono.discardExterior(this.mesh),this.callMesh_(this.mesh),this.mesh=null,void(this.polygonData_=null)}libtess.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},libtess.GluTesselator.prototype.makeDormant_=function(){this.mesh&&libtess.mesh.deleteMesh(this.mesh),this.state=libtess.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null},libtess.GluTesselator.prototype.requireState_=function(e){this.state!==e&&this.gotoState_(e)},libtess.GluTesselator.prototype.gotoState_=function(e){for(;this.state!==e;)if(this.state<e)switch(this.state){case libtess.GluTesselator.tessState_.T_DORMANT:this.callErrorOrErrorData(libtess.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case libtess.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(libtess.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state){case libtess.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorOrErrorData(libtess.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case libtess.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(libtess.errorType.GLU_TESS_MISSING_END_POLYGON),this.makeDormant_()}},libtess.GluTesselator.prototype.addVertex_=function(e,t){var i=this.lastEdge_;null===i?(i=libtess.mesh.makeEdge(this.mesh),libtess.mesh.meshSplice(i,i.sym)):(libtess.mesh.splitEdge(i),i=i.lNext),i.org.data=t,i.org.coords[0]=e[0],i.org.coords[1]=e[1],i.org.coords[2]=e[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},libtess.GluTesselator.prototype.cacheVertex_=function(e,t){var i=this.cache[this.cacheCount];i.data=t,i.coords[0]=e[0],i.coords[1]=e[1],i.coords[2]=e[2],++this.cacheCount},libtess.GluTesselator.prototype.emptyCache_=function(){this.mesh=new libtess.GluMesh;for(var e=0;e<this.cacheCount;e++){var t=this.cache[e];this.addVertex_(t.coords,t.data)}this.cacheCount=0,this.emptyCache=!1},libtess.GluTesselator.prototype.callBeginOrBeginData=function(e){this.callBeginData_?this.callBeginData_(e,this.polygonData_):this.callBegin_&&this.callBegin_(e)},libtess.GluTesselator.prototype.callVertexOrVertexData=function(e){this.callVertexData_?this.callVertexData_(e,this.polygonData_):this.callVertex_&&this.callVertex_(e)},libtess.GluTesselator.prototype.callEdgeFlagOrEdgeFlagData=function(e){this.callEdgeFlagData_?this.callEdgeFlagData_(e,this.polygonData_):this.callEdgeFlag_&&this.callEdgeFlag_(e)},libtess.GluTesselator.prototype.callEndOrEndData=function(){this.callEndData_?this.callEndData_(this.polygonData_):this.callEnd_&&this.callEnd_()},libtess.GluTesselator.prototype.callCombineOrCombineData=function(e,t,i){var n;return this.callCombineData_?n=this.callCombineData_(e,t,i,this.polygonData_):this.callCombine_&&(n=this.callCombine_(e,t,i)),void 0===n&&(n=null),n},libtess.GluTesselator.prototype.callErrorOrErrorData=function(e){this.callErrorData_?this.callErrorData_(e,this.polygonData_):this.callError_&&this.callError_(e)},libtess.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},libtess.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},libtess.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},libtess.GluHalfEdge.prototype.dst=function(){return this.sym.org},libtess.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},libtess.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},libtess.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},libtess.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},libtess.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},libtess.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},libtess.GluMesh=function(){this.vHead=new libtess.GluVertex,this.fHead=new libtess.GluFace,this.eHead=new libtess.GluHalfEdge,this.eHeadSym=new libtess.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},libtess.GluMesh.prototype.checkMesh=function(){if(libtess.DEBUG){for(var e,t,i,n=this.fHead,s=this.vHead,a=this.eHead,r=n,r=n;(t=r.next)!==n;r=t)for(libtess.assert(t.prev===r),e=t.anEdge;libtess.assert(e.sym!==e),libtess.assert(e.sym.sym===e),libtess.assert(e.lNext.oNext.sym===e),libtess.assert(e.oNext.sym.lNext===e),libtess.assert(e.lFace===t),(e=e.lNext)!==t.anEdge;);libtess.assert(t.prev===r&&null===t.anEdge&&null===t.data);for(var o=s,o=s;(i=o.next)!==s;o=i)for(libtess.assert(i.prev===o),e=i.anEdge;libtess.assert(e.sym!==e),libtess.assert(e.sym.sym===e),libtess.assert(e.lNext.oNext.sym===e),libtess.assert(e.oNext.sym.lNext===e),libtess.assert(e.org===i),(e=e.oNext)!==i.anEdge;);libtess.assert(i.prev===o&&null===i.anEdge&&null===i.data);for(var l=a,l=a;(e=l.next)!==a;l=e)libtess.assert(e.sym.next===l.sym),libtess.assert(e.sym!==e),libtess.assert(e.sym.sym===e),libtess.assert(null!==e.org),libtess.assert(null!==e.dst()),libtess.assert(e.lNext.oNext.sym===e),libtess.assert(e.oNext.sym.lNext===e);libtess.assert(e.sym.next===l.sym&&e.sym===this.eHeadSym&&e.sym.sym===e&&null===e.org&&null===e.dst()&&null===e.lFace&&null===e.rFace())}},libtess.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=null},libtess.PQHandleElem=function(){this.key=null,this.node=0},libtess.PQHandleElem.realloc=function(e,t){var i=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)i[n]=e[n];for(;n<t;n++)i[n]=new libtess.PQHandleElem;return i},libtess.PQNode=function(){this.handle=0},libtess.PQNode.realloc=function(e,t){var i=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)i[n]=e[n];for(;n<t;n++)i[n]=new libtess.PQNode;return i},libtess.PriorityQ=function(e){this.keys_=libtess.PriorityQ.prototype.PQKeyRealloc_(null,libtess.PriorityQ.INIT_SIZE_),this.order_=null,this.size_=0,this.max_=libtess.PriorityQ.INIT_SIZE_,this.initialized_=!1,this.leq_=e,this.heap_=new libtess.PriorityQHeap(this.leq_)},libtess.PriorityQ.INIT_SIZE_=32,libtess.PriorityQ.prototype.deleteQ=function(){this.heap_.deleteHeap(),this.heap_=null,this.order_=null,this.keys_=null},libtess.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var i,n,t=(i=this.keys_,n=this.leq_,function(e,t){return n(i[e],i[t])?1:-1});if(this.order_.sort(t),this.max_=this.size_,this.initialized_=!0,this.heap_.init(),libtess.DEBUG)for(var s=0+this.size_-1,e=0;e<s;++e)libtess.assert(this.leq_(this.keys_[this.order_[e+1]],this.keys_[this.order_[e]]))},libtess.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=libtess.PriorityQ.prototype.PQKeyRealloc_(this.keys_,this.max_)),this.keys_[t]=e,-(t+1)},libtess.PriorityQ.prototype.PQKeyRealloc_=function(e,t){var i=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)i[n]=e[n];for(;n<t;n++)i[n]=null;return i},libtess.PriorityQ.prototype.keyLessThan_=function(e,t){e=this.keys_[e],t=this.keys_[t];return!this.leq_(t,e)},libtess.PriorityQ.prototype.keyGreaterThan_=function(e,t){e=this.keys_[e],t=this.keys_[t];return!this.leq_(e,t)},libtess.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return this.heap_.extractMin()}for(;--this.size_,0<this.size_&&null===this.keys_[this.order_[this.size_-1]];);return e},libtess.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return t}return e},libtess.PriorityQ.prototype.isEmpty_=function(){return 0===this.size_&&this.heap_.isEmpty()},libtess.PriorityQ.prototype.remove=function(e){if(0<=e)this.heap_.remove(e);else for(e=-(e+1),libtess.assert(e<this.max_&&null!==this.keys_[e]),this.keys_[e]=null;0<this.size_&&null===this.keys_[this.order_[this.size_-1]];)--this.size_},libtess.PriorityQHeap=function(e){this.nodes_=libtess.PQNode.realloc(null,libtess.PriorityQHeap.INIT_SIZE_+1),this.handles_=libtess.PQHandleElem.realloc(null,libtess.PriorityQHeap.INIT_SIZE_+1),this.size_=0,this.max_=libtess.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.leq_=e,this.nodes_[1].handle=1},libtess.PriorityQHeap.INIT_SIZE_=32,libtess.PriorityQHeap.prototype.deleteHeap=function(){this.handles_=null,this.nodes_=null},libtess.PriorityQHeap.prototype.init=function(){for(var e=this.size_;1<=e;--e)this.floatDown_(e);this.initialized_=!0},libtess.PriorityQHeap.prototype.insert=function(e){var t,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.nodes_=libtess.PQNode.realloc(this.nodes_,this.max_+1),this.handles_=libtess.PQHandleElem.realloc(this.handles_,this.max_+1)),0===this.freeList_?t=i:(t=this.freeList_,this.freeList_=this.handles_[t].node),this.nodes_[i].handle=t,this.handles_[t].node=i,this.handles_[t].key=e,this.initialized_&&this.floatUp_(i),t},libtess.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},libtess.PriorityQHeap.prototype.minimum=function(){return this.handles_[this.nodes_[1].handle].key},libtess.PriorityQHeap.prototype.extractMin=function(){var e=this.nodes_,t=this.handles_,i=e[1].handle,n=t[i].key;return 0<this.size_&&(e[1].handle=e[this.size_].handle,t[e[1].handle].node=1,t[i].key=null,t[i].node=this.freeList_,this.freeList_=i,0<--this.size_&&this.floatDown_(1)),n},libtess.PriorityQHeap.prototype.remove=function(e){var t=this.nodes_,i=this.handles_;libtess.assert(1<=e&&e<=this.max_&&null!==i[e].key);var n=i[e].node;t[n].handle=t[this.size_].handle,(i[t[n].handle].node=n)<=--this.size_&&(n<=1||this.leq_(i[t[n>>1].handle].key,i[t[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),i[e].key=null,i[e].node=this.freeList_,this.freeList_=e},libtess.PriorityQHeap.prototype.floatDown_=function(e){for(var t=this.nodes_,i=this.handles_,n=t[e].handle;;){var s=e<<1;s<this.size_&&this.leq_(i[t[s+1].handle].key,i[t[s].handle].key)&&++s,libtess.assert(s<=this.max_);var a=t[s].handle;if(s>this.size_||this.leq_(i[n].key,i[a].key)){i[t[e].handle=n].node=e;break}i[t[e].handle=a].node=e,e=s}},libtess.PriorityQHeap.prototype.floatUp_=function(e){for(var t=this.nodes_,i=this.handles_,n=t[e].handle;;){var s=e>>1,a=t[s].handle;if(0==s||this.leq_(i[a].key,i[n].key)){i[t[e].handle=n].node=e;break}i[t[e].handle=a].node=e,e=s}},libtess.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},libtess.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},libtess.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},"undefined"!=typeof module&&(module.exports=libtess),function(){function J(e){if(pdGL&&pdGL.Scene3D&&pdGL.Scene3D.getActiveEnvironment()){var t=pdGL.Scene3D.getActiveEnvironment().surfaceMaterial;if(t)return t}else if(pdGL)return pdGL.Material.VariableColorUniformPointSize(e.materialOptions);return new pd3D.Material}pd3D.parseOBJ=function(e,i){if(!e||!e.result||!e.result.length)throw new TypeError("ERROR: File is empty or invalid.");(i=i||{}).meshOptions=i.meshOptions||{normals:!0,colors:!0,defaultColor:[.55,.55,.55,1],twoSided:!0},i.progressIncrement=pd.toNumber(i.progressIncrement,.1),i.callbackComplete=i.callbackComplete||null,i.callbackProgress=i.callbackProgress||null,i.materialOptions=i.materialOptions||{},i.materials=i.materials||{},i.groups=i.groups||{};var t,n,s,a,r,o,l,d,h,c=null,p=[],u=[],g=[],m=[],f=0,_=0,x=0,v=[],b=[.65,.65,.65,1],y=[0,0,0],S=[0,0,1],M=[0,0],w=0,L=null,D=0,T=new pd3D.Mesh(i.meshOptions),E=i.node||new pd3D.Node("OBJ_File"),A=i.defaultMaterial||null,P=!!T.normals,C=!!T.coords,O=!!T.colors,N=E,G=i.flipY?1:-1;function R(e){e=parseInt(e,10);return isNaN(e)?NaN:0<=e?e-1:e+p.length}function I(e){e=parseInt(e,10);return isNaN(e)?NaN:0<=e?e-1:e+g.length}function k(e){var t=T.color();T=new pd3D.Mesh(i.meshOptions),N.addMesh(T,A),P=!!T.normals,C=!!T.coords,O=!!T.colors,T.color(t),T.name=e}A=A||J(i),E.addMesh(T,A);var V,B=e.result.split("\n"),U=B.length,F=0;i.debug&&console.time("parseOBJ");for(var H,z=0;z<U;z++){var W,j,Y=B[z].trim();if(1<Y.length)switch(Y.charAt(0)){case"#":break;case"v":case"V":switch(Y.charAt(1)){case" ":case"\t":3<(W=Y.match(/\S+/g)).length&&(p.push([parseFloat(W[1]),parseFloat(W[3])*G,parseFloat(W[2])]),O&&6<W.length&&m.push([parseFloat(W[4]),parseFloat(W[5]),parseFloat(W[6]),pd.toNumber(W[7],1)]));break;case"n":3<(W=Y.match(/\S+/g)).length&&u.push([parseFloat(W[1]),parseFloat(W[3])*G,parseFloat(W[2])]);break;case"t":2<(W=Y.match(/\S+/g)).length&&g.push([parseFloat(W[1]),parseFloat(W[2])])}break;case"f":case"F":if(x=0,v.length=0,65500<T.vertices.length&&k("ext"+pd.toStringWithLeadingZeros(++D,4)),2<(w=(X=Y.match(/\S+/g)).length)){for(h=1;h<w;h++)0<(l=X[h].split("/")).length&&(t=R(l[0]),isNaN(t)||(s=I(l[1]),H=l[2],H=parseInt(H,10),n=isNaN(H)?NaN:0<=H?H-1:H+u.length,isNaN(n)||x++,v.push({vtx:t,tex:s,nrm:n})));if(2<v.length){if(_=m.length,L=null,x<(f=v.length))for(h=2;h<f;h++)if(pd3D.VectorArray.calcNormalFromTriangle(y,p[v[+h].vtx],p[v[h-1].vtx],p[v[h-2].vtx])){L=y.slice(),T.defaultNormal=L;break}if(4<f){for(r=[],h=0;h<f;h++)r.push(p[v[h].vtx]);var q=new this.Polygon;q.setBoundary(r),q.tesselate3D(),q.copyTrianglesToMeshIndexed(T)}else{for(o=T.vertices.length,h=0;h<f;h++)a=v[h].vtx,T.vertices.push(p[a]),O&&(a<_?T.colors.push(m[a]):T.colors.push(T.defaultColor)),C&&(isNaN(v[h].tex)?T.coords.push(M):T.coords.push(g[v[h].tex])),P&&(isNaN(v[h].nrm)?L?T.normals.push(L):T.normals.push(T.defaultNormal):T.normals.push(u[v[h].nrm]));4==f?(T.triangles.push([o,o+1,o+2]),T.triangles.push([o,o+2,o+3])):3==f&&T.triangles.push([o,o+1,o+2])}}}break;case"l":case"L":if(f=0,65500<T.vertices.length&&k("ext"+pd.toStringWithLeadingZeros(++D,4)),T.lines||T.addIndexBuffer("lines"),1<(w=(X=Y.match(/\S+/g)).length))for(o=T.vertices.length,h=1;h<w;h++)0<(l=X[h].split("/")).length&&(t=R(l[0]),isNaN(t)||(T.vertices.push(p[t]),O&&(t<_?T.colors.push(m[t]):T.colors.push(T.defaultLineColor)),C&&(s=I(l[1]),isNaN(s)?T.coords.push(M):T.coords.push(g[s])),P&&T.normals.push(S),1<h&&T.lines.push([o+(h-2),o+(h-1)]),f++));break;case"p":case"P":if(65500<T.vertices.length&&k("ext"+pd.toStringWithLeadingZeros(++D,4)),T.points||T.addIndexBuffer("points"),1<(w=(X=Y.match(/\S+/g)).length))for(o=T.vertices.length,h=1;h<w;h++)0<(l=X[h].split("/")).length&&(t=R(l[0]),isNaN(t)||(T.vertices.push(p[t]),O&&(t<_?T.colors.push(m[t]):T.colors.push(T.defaultColor)),C&&T.coords.push(M),P&&T.normals.push(S),T.points.push(o+h)));break;case"o":case"O":var X,q=1<(X=Y.match(/\S+/g)).length&&0<X[1].length?X[1]:"obj"+pd.toStringWithLeadingZeros(++D,4);k(q);break;case"g":case"G":d=1<(X=Y.match(/\S+/g)).length&&0<X[1].length?X[1]:"grp"+pd.toStringWithLeadingZeros(++D,4),i.groups[d]?N=i.groups[d]:(N=new pd3D.Node(d),E.addChild(N),k(d),i.groups[d]=N);break;case"m":case"M":!pd.startsWith(Y,"mtllib")||(j=Y.substring(6).trim().split("/").pop())&&0<j.length&&(i.materials[j]||(i.materials[j]={}),c=i.materials[j]);break;case"u":case"U":1<(X=Y.match(/\S+/g)).length&&"usemtl"==X[0]&&0<X[1].length&&(c?(c[j=X[1]]||(c[j]={diffuseColor:b,specularColor:[.85,.85,.85,1],ambientColor:[.45,.45,.45,1],shininess:25,opacity:1}),i.meshOptions.colors||k(d),Y=c[j].diffuseColor,T.color([Y[0],Y[1],Y[2],c[j].opacity])):T.color(b))}F<=(V=z/U)&&(i.callbackProgress&&i.callbackProgress(V),F+=i.progressIncrement)}return i.debug&&console.timeEnd("parseOBJ"),i.callbackProgress&&i.callbackProgress(1),i.callbackComplete&&i.callbackComplete(),E.compile(),c&&(E.materials=c),E},pd3D.parseMTL=function(e,t){if(e&&e.result&&e.result.length){t=t||{};for(var i,n=e.result.split("\n"),s=n.length,a=null,r=0;r<s;r++){var o=n[r].trim();if(1<o.length)switch(o.charAt(0)){case"#":break;case"n":case"N":"e"==o.charAt(1)?1<(i=o.match(/\S+/g)).length&&"newmtl"==i[0]&&0<i[1].length&&(a=t[i[1]]={diffuseColor:[Math.random(),Math.random(),Math.random(),1],specularColor:[.85,.85,.85,1],ambientColor:[.45,.45,.45,1],shininess:25,opacity:1}):"s"==o.charAt(1)&&a&&1<(i=o.match(/\S+/g)).length&&(a.shininess=pd.constrainTo(parseFloat(i[1]),0,1e9));break;case"k":case"K":if(a&&3<(i=o.match(/\S+/g)).length){var l=1,d=1,h=1,c=1;switch(o.charAt(1)){case"a":l=parseFloat(i[1]),d=parseFloat(i[2]),h=parseFloat(i[3]),c=4<i.length?parseFloat(i[4]):1,a.ambientColor=[l,d,h,c];break;case"d":l=parseFloat(i[1]),d=parseFloat(i[2]),h=parseFloat(i[3]),c=4<i.length?parseFloat(i[4]):1,a.diffuseColor=[l,d,h,c];break;case"s":l=parseFloat(i[1]),d=parseFloat(i[2]),h=parseFloat(i[3]),c=4<i.length?parseFloat(i[4]):1,a.specularColor=[l,d,h,c]}}break;case"t":case"T":a&&"r"==o.charAt(1)&&1<(i=o.match(/\S+/g)).length&&(a.opacity=1-pd.constrainTo(parseFloat(i[1]),0,1));break;case"d":case"D":a&&1<(i=o.match(/\S+/g)).length&&(a.opacity=pd.constrainTo(parseFloat(i[1]),0,1))}}return t}},pd3D.formatAsOBJ=function(e,t){if(t=t||{},!(e&&e instanceof pd3D.Mesh))throw new TypeError("The given mesh must be a valid instance of 'pd3D.Mesh'.");var i,n,s=pd.toBoolean(t.triangles,!1)&&pd.isArray(e.triangles)&&0<e.triangles.length,a=pd.toBoolean(t.outlines,!1)&&e.hasLines&&pd.isArray(e.lines)&&0<e.lines.length,r=pd.toBoolean(t.normals,!1)&&e.hasVertexNormals&&pd.isArray(e.normals)&&0<e.normals.length,o=pd.toBoolean(t.coords,!1)&&e.hasVertexCoords&&pd.isArray(e.coords)&&0<e.coords.length,l=pd.toBoolean(t.colors,!1)&&e.hasVertexColors&&pd.isArray(e.colors)&&0<e.colors.length,d=pd.toBoolean(t.alpha,l),h=o||r,c="# PerformativeDesign.com - OBJ Export.\n";if(l&&(c+="# Vertex format:  v x y z r g b",d&&(c+=" a"),c+="\n"),c+="o "+(t.name||"pd3D.Mesh")+"\n",e.vertices)for(var p=0,u=e.vertices.length;p<u;++p)i=e.vertices[p],c+="v "+pd.toStringWithPrecisionRange(i[0],1,9)+" "+pd.toStringWithPrecisionRange(i[2],1,9)+" "+pd.toStringWithPrecisionRange(i[1],1,9),l&&(c+=" "+(i=e.colors[p])[0].toFixed(5)+" "+i[1].toFixed(5)+" "+i[2].toFixed(5),d&&(c+=" "+i[3].toFixed(5))),c+="\n";if(r)for(p=0,u=e.normals.length;p<u;++p)c+="vn "+(i=e.normals[p])[0].toFixed(5)+" "+i[2].toFixed(5)+" "+i[1].toFixed(5)+"\n";if(o)for(p=0,u=e.coords.length;p<u;++p)c+="vt "+(i=e.coords[p])[0].toFixed(5)+" "+i[1].toFixed(5)+"\n";if(s)for(p=0,u=e.triangles.length;p<u;++p)if(i=e.triangles[p],h){c+="f";for(var g=0;g<3;++g)c+=" "+(n=(i[g]+1).toFixed(0))+"/"+(o?n:"")+"/"+(r?n:"");c+="\n"}else c+="f "+(i[0]+1).toFixed(0)+" "+(i[1]+1).toFixed(0)+" "+(i[2]+1).toFixed(0)+"\n";if(a)for(p=0,u=e.lines.length;p<u;++p)c+="l "+((i=e.lines[p])[0]+1).toFixed(0)+" "+(i[1]+1).toFixed(0)+"\n";return c},pd3D.parseSTL=function(e,t){if(!e||!e.result||!e.result.length)throw new TypeError("ERROR: File is empty or invalid.");(t=t||{}).meshOptions=t.meshOptions||{normals:!0,defaultColor:[.55,.55,.55,1],twoSided:!0},t.progressIncrement=pd.toNumber(t.progressIncrement,.1),t.callbackComplete=t.callbackComplete||null,t.callbackProgress=t.callbackProgress||null,t.materialOptions=t.materialOptions||{};var i,n,s=0,a=e.result.split("\n"),r=a.length,o=0,l=!1,d=new pd3D.Mesh(t.meshOptions),h=t.node||new pd3D.Node("STL_File"),c=t.defaultMaterial||null,p=[0,0,1],u=[0,0,1],g=0,m=[];c=c||J(t),h.addMesh(d,c),t.debug&&console.time("parseSTL");for(var f,_,x=0;x<r;x++){var v=a[x].trim();if(1<v.length)switch(v.charAt(0)){case"#":break;case"e":pd.startsWith(v,"endloop")&&(l&&2<g&&(65500<d.vertices.length&&(f="ext"+pd.toStringWithLeadingZeros(++s,4),_=void 0,_=d.color(),d=new pd3D.Mesh(t.meshOptions),h.addMesh(d,c),d.color(_),d.name=f),pd3D.VectorArray.calcNormalFromTriangle(u,m[0],m[1],m[2])?d.normal(u[0],u[1],u[2]):d.normal(p),d.addTriangle(d.addVertex(m[0]),d.addVertex(m[1]),d.addVertex(m[2]))),g=0,l=!1);break;case"v":case"V":l&&pd.startsWith(v,"vertex")&&3<(n=v.match(/\S+/g)).length&&g<3&&(m[g++]=[pd.toNumber(n[1],0),pd.toNumber(n[2],0),pd.toNumber(n[3],0)]);break;case"o":case"O":pd.startsWith(v,"outer")&&(l=!(g=0));break;case"f":case"F":pd.startsWith(v,"facet")&&(3<(n=v.match(/\S+/g)).length&&"normal"==n[1]?u=[pd.toNumber(n[1],0),pd.toNumber(n[2],0),pd.toNumber(n[3],0)]:0)}o<=(i=x/r)&&(t.callbackProgress&&t.callbackProgress(i),o+=t.progressIncrement)}return t.debug&&console.timeEnd("parseSTL"),t.callbackProgress&&t.callbackProgress(1),t.callbackComplete&&t.callbackComplete(),h.compile(),h},pd3D.formatAsSTL=function(e,t){if(t=t||{},!(e&&e instanceof pd3D.Mesh))throw new TypeError("The given mesh must be a 'pd3D.Mesh' or variant");var i,n,s,a,r,o,l,d=pd.toBoolean(t.flip,!0),h=pd.toBoolean(t.normals,!0),c="solid "+(t.name||"pd3D.Mesh")+"\n",p=[0,0,0],u=[0,0,0],g=[],t=e.getAABB();if(t.min.x<0&&(u[0]=-t.min.x),t.min.y<0&&(u[1]=-t.min.y),t.min.z<0&&(u[2]=-t.min.z),pd.isArray(e.triangles))for(var m=0,f=e.triangles.length;m<f;++m){d?(g[0]=e.triangles[m][2],g[1]=e.triangles[m][1],g[2]=e.triangles[m][0]):(g[0]=e.triangles[m][0],g[0]=e.triangles[m][1],g[0]=e.triangles[m][2]),n=e.vertices[g[0]],s=e.vertices[g[1]],a=e.vertices[g[2]],h&&pd3D.VectorArray.calcNormalFromTriangle(p,n,s,a)?(r=p[0],o=p[1],l=p[2]):r=o=l=0,c+="\tfacet normal "+r.toExponential()+" "+o.toExponential()+" "+l.toExponential()+"\n",c+="\t\touter loop\n";for(var _=0;_<3;++_)r=(i=e.vertices[g[_]])[0]+u[0],o=i[1]+u[1],l=i[2]+u[2],c+="\t\t\tvertex "+r.toExponential()+" "+o.toExponential()+" "+l.toExponential()+"\n";c+="\t\tendloop\n",c+="\tendfacet\n"}return c+="endsolid\n"},pd3D.parsePLY=function(e,t){if(!e||!e.result||!e.result.length)throw new TypeError("ERROR: File is empty or invalid.");(t=t||{}).meshOptions=t.meshOptions||{normals:!0,colors:!0,defaultColor:[.55,.55,.55,1],twoSided:!0},t.progressIncrement=pd.toNumber(t.progressIncrement,.1),t.callbackComplete=t.callbackComplete||null,t.callbackProgress=t.callbackProgress||null,t.materialOptions=t.materialOptions||{};var i,n,s,a,r=e.result.split("\n"),o=r.length,l=0,d=0,h=new pd3D.Mesh(t.meshOptions),c=t.node||new pd3D.Node("PLY_File"),p=0,u=0,g=0,m=0,f=0,_=0,x=-1,v=-1,b=-1,y=-1,S=-1,M=-1,w=-1,L=-1,D=-1,T=-1,E=1,A=-1,P=-1,e=(e=t.defaultMaterial||null)||J(t);t.debug&&console.time("parsePLY");for(var C=0;C<o;C++){if(1<(G=r[C].trim()).length)switch(G.charAt(0)){case"c":case"#":break;case"e":if(pd.startsWith(G,"element"))2<(O=G.match(/\S+/g)).length&&(pd.startsWith(O[1],"vert")?(m=pd.toInteger(O[2],0),g=1,p=0):pd.startsWith(O[1],"face")||pd.startsWith(O[1],"poly")||pd.startsWith(O[1],"tri")?(f=pd.toInteger(O[2],0),g=2,p=0):(pd.startsWith(O[1],"edg")||pd.startsWith(O[1],"lin"))&&(_=pd.toInteger(O[2],0),g=3,p=0));else if(pd.startsWith(G,"end_header")){u=C;break}break;case"f":if(pd.startsWith(G,"format")&&2<(O=G.match(/\S+/g)).length&&!pd.startsWith(O[1],"asci"))throw new Error("Sorry, binary PLY files are not currently supported.");break;case"p":if(pd.startsWith(G,"property")){if(2<(O=G.match(/\S+/g)).length&&1===g)switch(O[2].charAt(0)){case"x":case"X":x=p;break;case"y":case"Y":v=p;break;case"z":case"Z":b=p;break;case"n":case"N":"x"==(i=O[2].charAt(1))||"X"==i?y=p:"y"==i||"Y"==i?S=p:"z"!=i&&"Z"!=i||(M=p);break;case"r":case"R":w=p,"u"!=(i=O[1].charAt(0))&&"U"!=i&&"c"!=i&&"C"!=i||(E=1/255);break;case"g":case"G":L=p;break;case"b":case"B":D=p;break;case"a":case"A":T=p;break;case"u":case"U":case"s":case"S":A=p;break;case"v":case"V":case"t":case"T":P=p}p++}}}if(n=0<=y&&0<=S&&0<=M,s=0<=w&&0<=L&&0<=D,a=0<=A&&0<=P,u<1||!(0<=x&&0<=v&&0<=b))throw new Error("ERROR: File does not match PLY format.");c.addMesh(h,e);for(var O,N=0;N<m;++N){0<(O=(G=r[++u].trim()).match(/\S+/g)).length&&(n&&h.normal([pd.toNumber(O[y],0),pd.toNumber(O[S],0),pd.toNumber(O[M],0)]),s&&h.color([pd.toNumber(O[w],0)*E,pd.toNumber(O[L],0)*E,pd.toNumber(O[D],0)*E,pd.toNumber(O[T],1/E)]),a&&h.texCoord([pd.toNumber(O[A],0),pd.toNumber(O[P],0)]),h.vertex([pd.toNumber(O[x],0),pd.toNumber(O[v],0),pd.toNumber(O[b],0)])),l<=(d=u/o)&&(t.callbackProgress&&t.callbackProgress(d),l+=t.progressIncrement)}0<f&&!h.triangles&&h.addIndexBuffer("triangles");for(N=0;N<f;++N){if(1<(G=r[++u].trim()).length&&(O=G.match(/\S+/g),m=pd.toInteger(O[0],0),O.length>m))switch(m){case 3:h.addTriangle(pd.toInteger(O[1],0),pd.toInteger(O[2],0),pd.toInteger(O[3],0));break;case 4:h.addQuad(pd.toInteger(O[1],0),pd.toInteger(O[2],0),pd.toInteger(O[3],0),pd.toInteger(O[4],0))}l<=(d=u/o)&&(t.callbackProgress&&t.callbackProgress(d),l+=t.progressIncrement)}0<_&&!h.lines&&h.addIndexBuffer("lines");for(var G,N=0;N<_;++N){1<(G=r[++u].trim()).length&&1<(O=G.match(/\S+/g)).length&&h.addLine(pd.toInteger(O[0],0),pd.toInteger(O[1],0)),l<=(d=u/o)&&(t.callbackProgress&&t.callbackProgress(d),l+=t.progressIncrement)}return t.debug&&console.timeEnd("parsePLY"),t.callbackProgress&&t.callbackProgress(1),t.callbackComplete&&t.callbackComplete(),c.compile(),c},pd3D.formatAsPLY=function(e,t){if(t=t||{},!(e&&e instanceof pd3D.Mesh))throw new TypeError("The given mesh must be a 'pd3D.Mesh' or variant");var i,n=pd.toBoolean(t.triangles,!1)&&pd.isArray(e.triangles)&&0<e.triangles.length,s=pd.toBoolean(t.outlines,!1)&&e.hasLines&&pd.isArray(e.lines)&&0<e.lines.length,a=pd.toBoolean(t.normals,!1)&&e.hasVertexNormals&&pd.isArray(e.normals)&&0<e.normals.length,r=pd.toBoolean(t.coords,!1)&&e.hasVertexCoords&&pd.isArray(e.coords)&&0<e.coords.length,o=pd.toBoolean(t.colors,!1)&&e.hasVertexColors&&pd.isArray(e.colors)&&0<e.colors.length,l=pd.toBoolean(t.alpha,o),d="ply\nformat ascii 1.0\ncomment PerformativeDesign.com - PLY Export.\nelement vertex "+e.vertices.length+"\nproperty float x\nproperty float y\nproperty float z\n";if(a&&(d+="property float nx\nproperty float ny\nproperty float nz\n"),o&&(d+="property float r\nproperty float g\nproperty float b\nproperty float a\n"),r&&(d+="property float u\nproperty float v\n"),n&&(d+="element face "+e.triangles.length+"\nproperty list uchar uint vertex_indices\n"),s&&(d+="element edge "+e.lines.length+"\nproperty int vertex1\nproperty int vertex2\n"),d+="end_header\n",e.vertices)for(var h=0,c=e.vertices.length;h<c;++h)i=e.vertices[h],d+=pd.toStringWithPrecisionRange(i[0],1,9)+" "+pd.toStringWithPrecisionRange(i[1],1,9)+" "+pd.toStringWithPrecisionRange(i[2],1,9),a&&(d+=" "+(i=e.normals[h])[0].toFixed(5)+" "+i[1].toFixed(5)+" "+i[2].toFixed(5)),o&&(d+=" "+(i=e.colors[h])[0].toFixed(5)+" "+i[1].toFixed(5)+" "+i[2].toFixed(5),l&&(d+=" "+i[3].toFixed(5))),r&&(d+=" "+(i=e.coords[h])[0].toFixed(5)+" "+i[1].toFixed(5)),d+="\n";if(n)for(h=0,c=e.triangles.length;h<c;++h)d+="3 "+(i=e.triangles[h])[2].toFixed(0)+" "+i[1].toFixed(0)+" "+i[0].toFixed(0)+"\n";if(s)for(h=0,c=e.lines.length;h<c;++h)d+=+(i=e.lines[h])[0].toFixed(0)+" "+i[1].toFixed(0)+"\n";return d},pd3D.parseMOD=function(e,t){if(!e||!e.result||!e.result.length)throw new TypeError("ERROR: File is empty or invalid.");(t=t||{}).meshOptions=t.meshOptions||{lines:!0,normals:!0,defaultColor:[.55,.55,.55,1],twoSided:!0},t.progressIncrement=pd.toNumber(t.progressIncrement,.1),t.callbackComplete=t.callbackComplete||null,t.callbackProgress=t.callbackProgress||null,t.materialOptions=t.materialOptions||{};var i,n,s,a,r,o=e.result.split("\n"),l=o.length,d=0,h=0,c=t.node||new pd3D.Node("MOD_File"),p=[0,0,1],u={},g=0,m={name:"",flags:0,color:null,node:null,mesh:null},f={zone:"",node:null,vertices:[],normal:[],flags:0},_=(_=t.defaultMaterial||null)||J(t);t.debug&&console.time("parseMOD");for(var x=0;x<l;x++){var v=o[x].trim();if(0<v.length&&"/"!=(s=v.charAt(0)))if(1==h){if("}"==s)16&m.flags&&!t.includeAllZones||(m.node=new pd3D.Node(m.name),m.mesh=new pd3D.Mesh(t.meshOptions),m.node.addMesh(m.mesh,_),m.mesh.color(m.color),c.addChild(m.node),(16&m.flags||128&m.flags)&&(m.node.visible=!1),m.mesh.name=m.name,u[m.name]={name:m.name,flags:m.flags,color:m.color,node:m.node,mesh:m.mesh},g++),h=0;else if(1<(n=v.match(/\S+/g)).length)switch(n[0]){case"name:":n.shift(),m.name=n.join(" ").trim()||"Zone_"+pd.toStringWithLeadingZeros(g,3);break;case"flags:":m.flags=pd.toInteger(n[1]);break;case"colors:":r=pd.toInteger(n[1]),m.color=[(255&r)/255,((65280&r)>>8)/255,((16711680&r)>>16)/255,1]}}else if(2==h){if("}"==s){if(f.node=u[f.zone],f.node&&f.node.mesh)if(16384&f.flags&&f.vertices.reverse(),2<f.vertices.length&&4&f.flags&&8&f.flags)new pd3D.Polygon({contours:[f.vertices]}).copyToMeshIndexed(f.node.mesh,!1);else if(1&f.flags){(a=f.node.mesh).begin(gl.POINTS),a.normal(p);for(var b=0,y=f.vertices.length;b<y;++b)a.vertex(f.vertices[b]);a.end()}else if(!(2&f.flags)){a=f.node.mesh,r=8&f.flags?gl.LINE_LOOP:gl.LINE_STRIP,a.begin(r),a.normal(p);for(b=0,y=f.vertices.length;b<y;++b)a.vertex(f.vertices[b]);a.end()}h=0}else if(1<(n=v.match(/\S+/g)).length)switch(n[0]){case"zone:":n.shift(),f.zone=n.join(" ").trim();break;case"flags:":f.flags=pd.toInteger(n[1]);break;case"vertex:":3<n.length&&f.vertices.push([parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])]);break;case"normal:":3<n.length&&(f.normal[0]=parseFloat(n[1]),f.normal[1]=parseFloat(n[2]),f.normal[2]=parseFloat(n[3]))}}else"Z"==s&&pd.startsWith(v,"ZONE")?(m.name="Zone_"+pd.toStringWithLeadingZeros(g,3),h=1):"E"==s&&pd.startsWith(v,"ENTITY")&&(f.normal[0]=p[0],f.normal[1]=p[1],f.normal[2]=p[2],f.vertices.length=0,h=2);d<=(i=x/l)&&(t.callbackProgress&&t.callbackProgress(i),d+=t.progressIncrement)}return t.debug&&console.timeEnd("parseMOD"),t.callbackProgress&&t.callbackProgress(1),t.callbackComplete&&t.callbackComplete(),c.compile(),c}}();var pdGL=pdGL||{};!function(){var h,c=305397760,a=Math.PI/180,r=180/Math.PI;function o(e){e=Object.prototype.toString.call(e);return"[object Array]"==e||"[object Float32Array]"==e}pdGL.version="1.0.8",pdGL.keys={},pdGL.keyCount=0;var p=[],u=!0,g=null;function m(e,t,i){e.addEventListener(t,i)}function f(e){pdGL.keys.SHIFT=e.shiftKey,pdGL.keys.CONTROL=e.ctrlKey,pdGL.keys.META=e.metaKey,pdGL.keys.ALT=e.altKey}pdGL.create=function(e){var s,t,d,r,i,n,a,o,l=(e=e||{}).canvas;l||((l=document.createElement("canvas")).height=e.height||600,l.width=e.width||800),e.antialias=pd.toBoolean(e.antialias,!1),e.alpha=pd.toBoolean(e.alpha,!1);try{h=l.getContext("webgl",e)}catch(e){}try{h=h||l.getContext("experimental-webgl",e)}catch(e){}if(!h)throw new Error("WebGL is either not supported or is disabled.");return p[0]=h.TRIANGLES,p[1]=h.LINES,p[2]=h.POINTS,d=new pd3D.Matrix,r=new pd3D.Matrix,i=new pd3D.Matrix,n=[],o=!(a=[]),h.MODELVIEW=1|c,h.PROJECTION=2|c,h.modelviewMatrix=new pd3D.Matrix,h.projectionMatrix=new pd3D.Matrix,h.getModelviewProjectionMatrix=function(){return o&&(i=pd3D.Matrix.multiply(h.projectionMatrix,h.modelviewMatrix,i),o=!1),i},h.matrixMode=function(e){switch(e){case h.MODELVIEW:s=h.modelviewMatrix,t=a;break;case h.PROJECTION:s=h.projectionMatrix,t=n;break;default:throw new TypeError("invalid matrix mode "+e)}},h.loadIdentity=function(){pd3D.Matrix.identity(s),o=!0},h.loadMatrix=function(e){for(var t=e.m,i=s.m,n=0;n<16;++n)i[n]=t[n];o=!0},h.multMatrix=function(e){h.loadMatrix(pd3D.Matrix.multiply(s,e,r))},h.perspective=function(e,t,i,n){h.multMatrix(pd3D.Matrix.perspective(e,t,i,n,d))},h.frustum=function(e,t,i,n,s,a){h.multMatrix(pd3D.Matrix.frustum(e,t,i,n,s,a,d))},h.ortho=function(e,t,i,n,s,a){h.multMatrix(pd3D.Matrix.ortho(e,t,i,n,s,a,d))},h.scale=function(e,t,i){1==arguments.length?pd.isNumeric(e)?h.multMatrix(pd3D.Matrix.scale(e,e,e,d)):pd.isArray(e)&&h.multMatrix(pd3D.Matrix.scale(+e[0]||0,+e[1]||0,+e[2]||0,d)):3==arguments.length&&h.multMatrix(pd3D.Matrix.scale(+e||0,+t||0,+i||0,d))},h.translate=function(e,t,i){h.multMatrix(pd3D.Matrix.translate(e,t,i,d))},h.rotate=function(e,t,i,n){h.multMatrix(pd3D.Matrix.rotate(e,t,i,n,d))},h.lookAt=function(e,t,i,n,s,a,r,o,l){h.multMatrix(pd3D.Matrix.lookAt(e,t,i,n,s,a,r,o,l,d))},h.pushMatrix=function(){t.push(Array.prototype.slice.call(s.m))},h.popMatrix=function(){var e=t.pop();s=pd3D.Matrix.fromArray(e,s),o=!0},h.project=function(e,t,i,n,s,a){n=n||h.modelviewMatrix,s=s||h.projectionMatrix,a=a||h.getParameter(h.VIEWPORT);i=s.transformPoint(n.transformPoint(new pd3D.Vector(e,t,i)));return new pd3D.Vector(a[0]+a[2]*(.5*i.x+.5),a[1]+a[3]*(.5*i.y+.5),.5*i.z+.5)},h.unproject=function(e,t,i,n,s,a){n=n||h.modelviewMatrix,s=s||h.projectionMatrix,a=a||h.getParameter(h.VIEWPORT);i=new pd3D.Vector((e-a[0])/a[2]*2-1,(t-a[1])/a[3]*2-1,2*i-1);return pd3D.Matrix.inverse(pd3D.Matrix.multiply(s,n,d),r).transformPoint(i)},h.cleanup=function(){g&&g.endRender()},h.matrixMode(h.MODELVIEW),function(){var t=h;function i(e){(h=t).onlongpress&&h.onlongpress(e)}t.frameIndex=0,m(document,"keydown",function(e){f(e),27!=(e.keyCode||event.which)||e.altKey||e.ctrlKey||e.metaKey||h.canvas.focus()}),m(document,"keyup",function(e){f(e)});var n=pdDOM.Interaction.makeInteractive(h.canvas,{onmove:function(e){h.onmousemove&&h.onmousemove(e)},onpress:function(e){(h=t).canvas.focus(),h.onmousedown&&h.onmousedown(e)},ondrag:function(e){(h=t).onmousedrag&&h.onmousedrag(e)},onrelease:function(e){(h=t).onmouseup&&h.onmouseup(e)},ondoubletap:function(e){(h=t).ondoubletap&&h.ondoubletap(e)},onlongclick:function(e){(h=t).onlongclick&&h.onlongclick(e)},onscroll:function(e){(h=t).onmousewheel&&h.onmousewheel(e)},onkeydown:function(e){var t;f(e),h.onkeydown&&h.onkeydown(e),e.altKey||e.ctrlKey||e.metaKey||((t=_(e.keyCode))&&(pdGL.keys[t]=!0),pdGL.keys[e.keyCode]||pdGL.keyCount++,pdGL.keys[e.keyCode]=!0,x(e))},onkeyup:function(e){if(f(e),h.onkeyup&&h.onkeyup(e),27==e.keyCode&&1<pdGL.keyCount)for(var t in pdGL.keyCount=0,pdGL.keys)0<+t&&pdGL.keys[t]&&pdGL.keyCount++;var i;e.altKey||e.ctrlKey||e.metaKey||((i=_(e.keyCode))&&(pdGL.keys[i]=!1),pdGL.keys[e.keyCode]&&pdGL.keyCount--,pdGL.keys[e.keyCode]=!1,x(e))}});h.addLongPress=function(e){n.setCallback("onlongpress",i),h.onlongpress=e}}(),function(){!function(e){h.makeCurrent=function(){h=e}}(h);var t=!0,i=!0;h.setCullFace=function(e){null==e&&(e=t),i!=e&&(e?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),i=e)},h.setCullFaceDefault=function(e){0<arguments.length&&(t=!!e,h.setCullFace())};var n=[],e=h.getParameter(h.ALIASED_LINE_WIDTH_RANGE);function s(e){return e.preventDefault(),e.stopPropagation(),!1}h.minLineWidth=e[0],h.maxLineWidth=e[1],h.activeLineWidth=1,h.readActiveLineWidth=function(){return h.activeLineWidth=h.getParameter(h.LINE_WIDTH),h.activeLineWidth},h.pushLineWidth=function(e){n.push(h.activeLineWidth),1024<=n.length&&(1024==n.length&&console.warn("ADVERTENCIA: Líneas pdGL con pila son extremadamente grandes."),2048<n.length&&n.shift()),e&&0<e&&(h.activeLineWidth=e,h.lineWidth(e))},h.popLineWidth=function(){var e=0<n.length?n.pop():1;e&&.1<e&&(h.activeLineWidth=e,h.lineWidth(e))},h.getCanvasLineWidthThin=function(){return pdDOM.devicePixelRatio<1.25?.75:pdDOM.devicePixelRatio<2.25?1.5:2},h.getCanvasLineWidth=function(){return pdDOM.devicePixelRatio},h.getCanvasLineWidthThick=function(){return pdDOM.devicePixelRatio<1.25?1.55:pdDOM.devicePixelRatio<2.25?2.5:4},h.getCanvasLineWidthThicker=function(){return pdDOM.devicePixelRatio<1.25?3:pdDOM.devicePixelRatio<2.25?5:6},h.frameIndex=0,h.animationQueue=pdDOM.getGlobalAnimationQueue(),h.animate=function(){var i=h;return h.canvas.focus(),h.animationQueue.add(function(e,t){return(h=i).onupdate&&(h.onupdate(e,t)||u)&&(u=!1,h.frameIndex=t,h.ondraw&&h.ondraw()),!1}),h.animationQueue.start(),h.animationQueue},h.fullscreen=function(e){var t=(e=e||{}).paddingTop||0,i=e.paddingLeft||0,n=e.paddingRight||0,s=e.paddingBottom||0;if(!document.body)throw new Error("document.body doesn't exist yet (call gl.fullscreen() from window.onload() or from inside the <body> tag)");function a(){h.canvas.width=window.innerWidth-i-n,h.canvas.height=window.innerHeight-t-s,h.viewport(0,0,h.canvas.width,h.canvas.height),h.orbitalView?h.orbitalView.applyProjection():!e.camera&&"camera"in e||(h.matrixMode(h.PROJECTION),h.loadIdentity(),h.perspective(e.fov||90,h.canvas.width/h.canvas.height,e.near||.1,e.far||1e3),h.matrixMode(h.MODELVIEW)),h.onresize&&h.onresize(),h.ondraw&&h.ondraw()}document.body.appendChild(h.canvas),document.body.style.overflow="hidden",h.canvas.style.position="absolute",h.canvas.style.left=i+"px",h.canvas.style.top=t+"px",h.canvas.style.msTouchAction="none",h.canvas.style.touchAction="none",m(window,"resize",a),a()},h.QUADS=7,h.QUAD_STRIP=8,h.HALF_FLOAT=h.HALF_FLOAT||36193,h.update=function(){u=!0},h.useOrbitalView=function(e){h.orbitalView=new pdGL.OrbitalView(e)},h.disableContextMenu=function(e){var t,i;h.canvas&&(e?m(h.canvas,"contextmenu",s):(t=h.canvas,i="contextmenu",e=s,t.removeEventListener(i,e)))}}(),h.enable(h.DEPTH_TEST),h.frontFace(h.CCW),h.enable(h.CULL_FACE),h.cullFace(h.BACK),h.enable(h.POLYGON_OFFSET_FILL),h.polygonOffset(1,1),h.enable(h.BLEND),h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA),h.canvas.setAttribute("tabindex","0"),pd3D.canUse32BitBuffers=null!=h.getExtension("OES_element_index_uint"),h};var t={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};function _(e){return t[e]||(65<=e&&e<=90?String.fromCharCode(e):null)}function x(e,t){e.getModifierState&&(t=t||"CapsLock",pdGL.keys[t]=e.getModifierState(t))}var e=null;pdGL.getDefaultMaterialFixedColor=function(){return e=e||pdGL.Material.FixedColorUniformPointSize({name:"pdGL.DefaultMaterialFixedColor",uniforms:{color:[1,0,0,1],opacity:1}})};var i=null;pdGL.getDefaultMaterialMeshColor=function(){return i=i||pdGL.Material.VariableColorUniformPointSize({name:"pdGL.DefaultMaterialMeshColor",uniforms:{color:[1,0,0,1],opacity:1}})},pdGL.OrbitalView=function(e){return e=e||{},this.defaultTarget=e.defaultTarget||new pd3D.Vector(0,0,0),this.defaultDistance=pd.toNumber(e.defaultDistance,8),this.defaultAzi=pd.toNumber(e.defaultAzi,60),this.defaultAlt=pd.toNumber(e.defaultAlt,30),this.defaultFOV=pd.toNumber(e.defaultFOV,45),this.zoomByDollying=pd.toBoolean(e.zoomByDollying,!1),this.animationSpeed=pd.toNumber(e.animationSpeed,2),this.farFieldFactor=pd.toNumber(e.farFieldFactor,2.5),this.farFieldMin=pd.toNumber(e.farFieldMin,0),this.kbdNav={active:!1,moveInOut:0,moveLeftRight:0,moveUpDown:0,lookLeftRight:0,lookUpDown:0,slowDown:.9,speedUp:.03,maxSpeed:.5},this.orbitMode=!0,this.handlePointerMove=e.handlePointerMove||null,this.handlePointerDown=e.handlePointerDown||null,this.handlePointerDrag=e.handlePointerDrag||null,this.handlePointerUp=e.handlePointerUp||null,this.target=new pd3D.Vector(this.defaultTarget.x,this.defaultTarget.y,this.defaultTarget.z),this.cameraDistance=this.defaultDistance,this.cameraAzi=this.defaultAzi,this.cameraAlt=this.defaultAlt,this.cameraFOV=this.defaultFOV,this.camera=new pd3D.Vector(0,this.defaultDistance,0),this.eyePos=new pd3D.Vector(0,this.defaultDistance,0),this.eyePosAsArray=[0,0,0],this.zoomFactor=1,this.mouseWheelIncrement=1,this.aspectRatio=0<h.canvas.height?h.canvas.width/h.canvas.height:1,this.snapGrid=pd.toNumber(e.snapGrid,0),this.hasChanged=h.PROJECTION,this.orthoMode=0,this._unprojectMatrix=new pd3D.Matrix,this._unprojectViewport=[0,0,640,480],this._unprojectValid=!1,this._localProjectionMatrix=null,this._localModelViewMatrix=null,this._localHUD=!1,this._zoomFactorMin=pd.toNumber(e.zoomFactorMin,.01),this._viewAngleMin=pd.toNumber(e._viewAngleMin,.01),this._nearField=.1,this._farField=1,this._inertiaAction=0,this._inertiaThresholdTime=50,this._inertiaThresholdDelta=2,this._inertiaDampingFactor=.9,this._inertiaMinimumValue=.05,this._inertiaTimeStamp=0,this._inertiaDeltaX=0,this._inertiaDeltaY=0,this._inertiaZoom=0,this._rotationLock=!0,this._rotationThreshold=5,this._rotationAccum=0,this._animateSourceView=null,this._animateTargetView=null,this._animating=!1,pd.addSimpleEventHandling(this),e.callbackOnChange&&this.on("change",e.callbackOnChange),this.initialise(),this},pdGL.OrbitalView.prototype={getOrthoModeFieldOfView:function(){var e;switch(this.orthoMode){default:e=this.cameraFOV;break;case 1:e=this.defaultFOV*Math.abs(pd.cosDegrees(this.cameraAlt));break;case 2:e=this.defaultFOV*Math.abs(pd.sinDegrees(this.cameraAlt))}return pd.constrainTo(e,.1,160)},getFieldOfViewFactor:function(){var e=pd.constrainTo(this.cameraFOV,this._viewAngleMin,160),e=.25/(this.zoomFactor*Math.tan(.25*e*a));return pd.constrainTo(e,.01,1e5)},apply:function(e){var t=this.getFieldOfViewFactor();(e||this.hasChanged>h.MODELVIEW)&&this.applyProjection(t),this._localHUD=!1,h.matrixMode(h.MODELVIEW),h.loadIdentity();var i=this.cameraAzi*a,n=pd.constrainTo(this.cameraAlt,-89.99,89.99)*a,s=this.cameraDistance*Math.cos(n),e=s*Math.cos(i),i=s*Math.sin(i),n=this.cameraDistance*Math.sin(n);return this.camera.init(this.target.x+e*t,this.target.y+i*t,this.target.z+n*t),this.eyePos.init(this.eyePosAsArray[0]=this.target.x+e,this.eyePosAsArray[1]=this.target.y+i,this.eyePosAsArray[2]=this.target.z+n),h.lookAt(this.camera.x,this.camera.y,this.camera.z,this.target.x,this.target.y,this.target.z,0,0,1),this.hasChanged&&(this.emit("change"),this.callbackOnChange&&this.callbackOnChange(this),this.hasChanged=0),this},applyProjection:function(e){var t=h.canvas.width,i=h.canvas.height;h.matrixMode(h.PROJECTION),h.loadIdentity(),this.aspectRatio=0<i?t/i:1,this._unprojectViewport[2]=t,this._unprojectViewport[3]=i,e=pd.toNumber(e,this.getFieldOfViewFactor());i=this.farFieldFactor/pd.constrainTo(this.zoomFactor,.001,1)*this.defaultDistance,e*=this.cameraDistance;return this._nearField=Math.max(e-i,.0025*this.defaultDistance),this._farField=e+Math.max(i,this.farFieldMin),h.perspective(pd.constrainTo(this.cameraFOV,this._viewAngleMin,160),this.aspectRatio,this._nearField,this._farField),this._unprojectValid=!1,h.setCullFace(),this},startOverlay2D:function(e,t){e=e||h.canvas.width,t=t||h.canvas.height;return this._localProjectionMatrix=pd3D.Matrix.clone(h.projectionMatrix,this._localProjectionMatrix),this._localModelViewMatrix=pd3D.Matrix.clone(h.modelviewMatrix,this._localModelViewMatrix),this._localHUD=!0,h.matrixMode(h.PROJECTION),h.loadIdentity(),h.ortho(.5,e+.5,.5,t+.5,-100,100),h.matrixMode(h.MODELVIEW),h.loadIdentity(),this},endOverlay2D:function(){return pd3D.Matrix.clone(this._localProjectionMatrix,h.projectionMatrix),pd3D.Matrix.clone(this._localModelViewMatrix,h.modelviewMatrix),this._localHUD=!1,this},copyViewDataTo:function(e,t){return e=e||{},null!=(t=t||this).defaultAzi&&(e.defaultAzi=t.defaultAzi),null!=t.defaultAlt&&(e.defaultAlt=t.defaultAlt),null!=t.defaultFOV&&(e.defaultFOV=t.defaultFOV),null!=t.defaultDistance&&(e.defaultDistance=t.defaultDistance),null!=t.cameraAzi&&(e.cameraAzi=t.cameraAzi),null!=t.cameraAlt&&(e.cameraAlt=t.cameraAlt),null!=t.cameraFOV&&(e.cameraFOV=t.cameraFOV),null!=t.cameraDistance&&(e.cameraDistance=t.cameraDistance),pd.isNumeric(t.zoom)&&(e.zoomFactor=t.zoom),null!=t.zoomFactor&&(e.zoomFactor=t.zoomFactor),null!=t.farFieldFactor&&(e.farFieldFactor=t.farFieldFactor),null!=t.farFieldMin&&(e.farFieldMin=t.farFieldMin),null!=t.snapGrid&&(e.snapGrid=t.snapGrid),null!=t.defaultTarget&&(pd.isArray(t.defaultTarget)?e.defaultTarget=pd3D.Vector.fromArray(t.defaultTarget):t.defaultTarget instanceof pd3D.Vector&&(e.defaultTarget?e.defaultTarget.init(t.defaultTarget):e.defaultTarget=new pd3D.Vector(t.defaultTarget))),null!=t.target&&(pd.isArray(t.target)?e.target=pd3D.Vector.fromArray(t.target):t.target instanceof pd3D.Vector&&(e.target?e.target.init(t.target):e.target=new pd3D.Vector(t.target))),null!=t.camera&&(pd.isArray(t.camera)?e.camera=pd3D.Vector.fromArray(t.camera):t.camera instanceof pd3D.Vector&&(e.camera?e.camera.init(t.camera):e.camera=new pd3D.Vector(t.camera))),e},interpolateBetween:function(e,t,i){var n,s;return t&&e&&(n=1-(i=pd.constrainTo(i,0,1)),this.orbitMode=!0,null!=t.defaultDistance?(this.defaultDistance=n*e.defaultDistance+i*t.defaultDistance,this.cameraDistance=n*e.cameraDistance+i*t.defaultDistance):null!=t.cameraDistance&&(this.cameraDistance=n*e.cameraDistance+i*t.cameraDistance),null!=t.defaultAzi?(this.defaultAzi=pd.wrapAt(n*e.defaultAzi+i*t.defaultAzi,-180,180),this.cameraAzi=pd.wrapAt(n*e.cameraAzi+i*t.defaultAzi,-180,180)):null!=t.cameraAzi&&(this.cameraAzi=pd.wrapAt(n*e.cameraAzi+i*t.cameraAzi,-180,180)),null!=t.defaultAlt?(this.defaultAlt=pd.constrainTo(n*e.defaultAlt+i*t.defaultAlt,-90,90),this.cameraAlt=pd.constrainTo(n*e.cameraAlt+i*t.defaultAlt,-90,90)):null!=t.cameraAlt&&(this.cameraAlt=pd.constrainTo(n*e.cameraAlt+i*t.cameraAlt,-90,90)),null!=t.defaultFOV?(this.defaultFOV=n*e.defaultFOV+i*t.defaultFOV,this.cameraFOV=n*e.cameraFOV+i*t.defaultFOV):null!=t.cameraFOV&&(this.cameraFOV=n*e.cameraFOV+i*t.cameraFOV),null!=t.zoomFactor&&(this.zoomFactor=Math.max(this._zoomFactorMin,n*e.zoomFactor+i*t.zoomFactor)),null!=t.farFieldFactor&&(this.farFieldFactor=n*e.farFieldFactor+i*t.farFieldFactor),null!=t.farFieldMin&&(this.farFieldMin=n*e.farFieldMin+i*t.farFieldMin),null!=t.snapGrid&&(this.snapGrid=n*e.snapGrid+i*t.snapGrid),null!=t.defaultTarget?(this.defaultTarget.x=n*e.target.x+i*t.defaultTarget.x,this.defaultTarget.y=n*e.target.y+i*t.defaultTarget.y,this.defaultTarget.z=n*e.target.z+i*t.defaultTarget.z,this.target.init(this.defaultTarget)):null!=t.target&&(this.target.x=n*e.target.x+i*t.target.x,this.target.y=n*e.target.y+i*t.target.y,this.target.z=n*e.target.z+i*t.target.z),null!=t.camera&&(s=this.getFieldOfViewFactor(),this.camera.x=n*e.camera.x+i*t.camera.x,this.camera.y=n*e.camera.y+i*t.camera.y,this.camera.z=n*e.camera.z+i*t.camera.z,this.cameraDistance=this.camera.distanceTo(this.target)/s,this.cameraAlt=(i=this.target,t=this.camera,s=t.z-i.z,Math.abs(s)<1e-6?0:(i=Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)),Math.abs(i)<1e-6?s<0?-90:90:Math.atan2(s,i)*r)),this.cameraAzi=(t=this.target,s=this.camera,i=s.x-t.x,t=s.y-t.y,Math.abs(i)<1e-6?Math.abs(t)<1e-6?0:t<0?-90:90:Math.atan2(t,i)*r),this.orbitMode=!1),this.hasChanged=h.PROJECTION,this._unprojectValid=!1),this},animateTo:function(e,t){var i=this,n=0;if(this._animating)return this;this._animateSourceView=this.copyViewDataTo(this._animateSourceView),this._animateTargetView=this.copyViewDataTo(null,e),this._animating=!0;e=pd.toNumber(e.cameraFOV,this.cameraFOV);return pd.closeTo(e,0,1e-4)?this._rotationThreshold=15:this._rotationThreshold=5,this._rotationLock=!0,h.animationQueue.addOrReplace(function(e){return 1<(n+=i.animationSpeed*pd.constrainTo(e,.001,.2))&&(n=1),i.interpolateBetween(i._animateSourceView,i._animateTargetView,pd.Easing.inOutSine(n)),t&&t(i,n),h.update(),.999<n&&(i._animating=!1,!(i._animateTargetView=null))}).start(),this},setView:function(e){e=e||{};var t={target:this.defaultTarget,cameraDistance:this.defaultDistance,zoomFactor:1};return this.copyViewDataTo(t,e),this.interpolateBetween(this,t,1),this._unprojectValid=!1,h.update(),this},setCamera:function(e,t,i,n){return pd.isNumeric(e)&&(e=pd.wrapAt(e,-180,180),pd.closeTo(this.cameraAzi,e,.01)||(this.hasChanged=h.MODELVIEW,this.cameraAzi=e)),pd.isNumeric(t)&&(t=pd.constrainTo(t,-90,90),pd.closeTo(this.cameraAlt,t,.01)||(this.hasChanged=h.MODELVIEW,this.cameraAlt=t)),pd.isNumeric(i)&&(i=pd.constrainTo(i,0,160),pd.closeTo(this.cameraFOV,i,.01)||(this.hasChanged=h.PROJECTION,this.cameraFOV=i)),pd.isNumeric(n)&&(n=pd.constrainTo(n,.001,1e3),pd.closeTo(this.zoomFactor,n,1e-4)||(this.zoomFactor=Math.max(this._zoomFactorMin,n),this.hasChanged=h.PROJECTION)),pd.closeTo(this.cameraFOV,0,1e-4)?this._rotationThreshold=15:this._rotationThreshold=5,this._rotationLock=!0,this.hasChanged&&(this._unprojectValid=!1,this._animating=!1,h.update()),0!=this.hasChanged},setZoomFactor:function(e){return e=pd.constrainTo(pd.toNumber(e,0),.01,3),this.zoomFactor=Math.max(this._zoomFactorMin,e),this.zoomByDollying&&(this.cameraDistance=this.defaultDistance/this.zoomFactor),this.hasChanged=h.PROJECTION,this._unprojectValid=!1,h.update(),this},reset:function(e,t){return this._unprojectValid=!1,this._animating=!1,e?(this.cameraAzi=this.defaultAzi,this.cameraAlt=this.defaultAlt,this.cameraFOV=this.defaultFOV,this.hasChanged=h.PROJECTION,h.update()):this.animateTo({cameraAzi:this.defaultAzi,cameraAlt:this.defaultAlt,cameraFOV:this.defaultFOV,cameraDistance:this.defaultDistance,target:this.defaultTarget,zoomFactor:1},t),this},center:function(e,t){e=e||{};var i={target:this.defaultTarget,cameraDistance:this.defaultDistance,zoomFactor:1};return this.copyViewDataTo(i,e),this._unprojectValid=!1,this._animating=!1,this.orbitMode=!0,e.noAnimation?(this.interpolateBetween(this,i,1),h.update()):this.animateTo(i,t),this},isCenter:function(){return(!this.zoomByDollying||this.cameraDistance==this.defaultDistance)&&(this.target.equals(this.defaultTarget)&&1==this.zoomFactor)},redraw:function(){return h.update(),this},getPointSize:function(){return.01*this.defaultDistance},getVectorToCamera:function(e,t,i){arguments.length<1&&(e=this.target.x,t=this.target.y,i=this.target.z);var n=this.camera.x-e,s=this.camera.y-t,a=this.camera.z-i,r=n*n+s*s+a*a;return 0<r&&(n*=r=1/Math.sqrt(r),s*=r,a*=r),[n,s,a]},checkUnprojectMatrix:function(e){return this._unprojectValid&&!e||(this._localHUD?pd3D.Matrix.inverse(pd3D.Matrix.multiply(this._localProjectionMatrix,this._localModelViewMatrix),this._unprojectMatrix):pd3D.Matrix.inverse(pd3D.Matrix.multiply(h.projectionMatrix,h.modelviewMatrix),this._unprojectMatrix),this._unprojectValid=!0),this},modelToCanvas:function(e,t){var i,n=this._unprojectViewport;return this.checkUnprojectMatrix(),this._localHUD?(i=this._localProjectionMatrix.transformPoint(this._localModelViewMatrix.transformPoint(new pd3D.Vector(t[0],t[1],t[2]))),e[0]=n[0]+n[2]*(.5*i.x+.5),e[1]=n[1]+n[3]*(.5*i.y+.5)):(i=h.projectionMatrix.transformPoint(h.modelviewMatrix.transformPoint(new pd3D.Vector(t[0],t[1],t[2]))),e[0]=(n[0]+n[2]*(.5*i.x+.5))/pdDOM.devicePixelRatio,e[1]=(n[3]-(n[1]+n[3]*(.5*i.y+.5)))/pdDOM.devicePixelRatio),e[2]=.5*i.z+.5,e},canvasToModel:function(e,t,i){this.checkUnprojectMatrix();var n=this._unprojectViewport;return e*=pdDOM.devicePixelRatio,t=n[3]-t*pdDOM.devicePixelRatio,this._unprojectMatrix.transformPoint(new pd3D.Vector((e-n[0])/n[2]*2-1,(t-n[1])/n[3]*2-1,2*i-1))},zoom:function(e){return e*=.5,this.zoomFactor=Math.max(this._zoomFactorMin,this.zoomFactor+e),this.zoomByDollying&&(this.cameraDistance=this.defaultDistance/this.zoomFactor),this.hasChanged=h.PROJECTION,this._unprojectValid=!1,h.update(),this},walk:function(e){e=this.target.subtract(this.camera).normalize().multiply(.25*e*this.cameraDistance*this.getFieldOfViewFactor());return this.camera.init(this.camera.x+e.x,this.camera.y+e.y,this.camera.z+e.z),this.target.init(this.target.x+e.x,this.target.y+e.y,this.target.z+e.z),this.hasChanged=h.PROJECTION,this._unprojectValid=!1,this.orbitMode=!1,h.update(),this},rotate:function(e,t){return this.cameraAzi=pd.wrapAt(this.cameraAzi-e,-180,180),this.cameraAlt=Math.max(-90,Math.min(90,this.cameraAlt+t)),this.orbitMode||(e=this.camera.distanceTo(this.target),t=pd.wrapAt(this.cameraAzi+180,-180,180),pd3D.Vector.sphericalToCartesian3D(t*a,-this.cameraAlt*a,e,this.target),pd3D.Vector.add(this.target,this.camera,this.target)),this.hasChanged=h.MODELVIEW,this._unprojectValid=!1,h.update(),this},pan:function(e,t,i){var n,s=!1,a=.25*this.defaultDistance/this.zoomFactor,r=this.target.subtract(this.camera).normalize();return 1e-4<Math.abs(t)&&(t*=a,t=(n=pd3D.Vector.UnitZ.cross(r).normalize()).cross(r).normalize().multiply(t),this.target.init(this.target.x-t.x,this.target.y-t.y,this.target.z-t.z),this.camera.init(this.camera.x-t.x,this.camera.y-t.y,this.camera.z-t.z),s=!0),1e-4<Math.abs(e)&&(e*=a,n=pd3D.Vector.UnitZ.cross(r).normalize().multiply(e),this.target.init(this.target.x+n.x,this.target.y+n.y,this.target.z+n.z),this.camera.init(this.camera.x+n.x,this.camera.y+n.y,this.camera.z+n.z),s=!0),s&&i&&(this.hasChanged=h.MODELVIEW,this._unprojectValid=!1,h.update()),this},clearInertia:function(){return this._inertiaAction=0,this._inertiaTimeStamp=0,this._inertiaDeltaX=0,this._inertiaDeltaY=0,this._inertiaZoom=0,this},updateView:function(e){return 1==this._inertiaAction?this.rotate(.25*this._inertiaDeltaX,.25*this._inertiaDeltaY):2==this._inertiaAction?this.pan(.0075*this._inertiaDeltaX,.0075*this._inertiaDeltaY,!0):3==this._inertiaAction?this.zoom(this._inertiaZoom):4==this._inertiaAction?(this.pan(.0075*this._inertiaDeltaX,.0075*this._inertiaDeltaY,!1),e&&this.rotate(e,0),this.zoom(this._inertiaZoom)):5!=this._inertiaAction||(e=pd.constrainTo(this.cameraFOV-150*this._inertiaZoom,this._viewAngleMin,160))!=this.cameraFOV&&(this.cameraFOV=e,this.zoom(this.zoomFactor*this._inertiaZoom)),this},updateInertia:function(){return 0<this._inertiaAction&&(Math.abs(this._inertiaDeltaX)>this._inertiaMinimumValue||Math.abs(this._inertiaDeltaY)>this._inertiaMinimumValue||1e-4<Math.abs(this._inertiaZoom))?(this._inertiaDeltaX=this._inertiaDeltaX*this._inertiaDampingFactor,this._inertiaDeltaY=this._inertiaDeltaY*this._inertiaDampingFactor,this._inertiaZoom=this._inertiaZoom*this._inertiaDampingFactor,this.updateView(),!1):(this.clearInertia(),!0)},handleKbdNavigation:function(e){var t,i,n,s,a=!1;return(pdGL.keyCount||this.kbdNav.active)&&(this.orbitMode?((pdGL.keys.CapsLock||pdGL.keys.SHIFT)&&(e*=5),(pdGL.keys.A||pdGL.keys.D||pdGL.keys.Q||pdGL.keys.Z)&&(this.pan(e*((pdGL.keys.A||0)-(pdGL.keys.D||0)),e*((pdGL.keys.Q||0)-(pdGL.keys.Z||0)),!0),a=!0),(pdGL.keys.LEFT||pdGL.keys.RIGHT||pdGL.keys.UP||pdGL.keys.DOWN)&&(this.rotate(25*e*((pdGL.keys.LEFT||0)-(pdGL.keys.RIGHT||0)),25*e*((pdGL.keys.UP||0)-(pdGL.keys.DOWN||0))),a=!0),(pdGL.keys.W||pdGL.keys.S)&&(this.walk(e*this.kbdNav.speedUp*((pdGL.keys.W||0)-(pdGL.keys.S||0))),a=!0)):(s=(t=this.kbdNav).slowDown,i=t.speedUp,n=this.kbdNav.maxSpeed,(pdGL.keys.CapsLock||pdGL.keys.SHIFT)&&(n*=10),pdGL.keys.W||pdGL.keys.S?(t.moveInOut+=i*((pdGL.keys.W||0)-(pdGL.keys.S||0)),t.moveInOut=pd.constrainTo(t.moveInOut,-n,n)):t.moveInOut*=s,pdGL.keys.A||pdGL.keys.D?(t.moveLeftRight+=i*((pdGL.keys.A||0)-(pdGL.keys.D||0)),t.moveLeftRight=pd.constrainTo(t.moveLeftRight,-n,n)):t.moveLeftRight*=s,pdGL.keys.Q||pdGL.keys.Z?(t.moveUpDown+=i*((pdGL.keys.Q||0)-(pdGL.keys.Z||0)),t.moveUpDown=pd.constrainTo(t.moveUpDown,-n,n)):t.moveUpDown*=s,pdGL.keys.LEFT||pdGL.keys.RIGHT?(t.lookLeftRight+=25*i*((pdGL.keys.RIGHT||0)-(pdGL.keys.LEFT||0)),t.lookLeftRight=pd.constrainTo(t.lookLeftRight,-100*n,100*n)):t.lookLeftRight*=s,pdGL.keys.UP&&pdGL.keys.DOWN?t.lookUpDown=this.cameraAlt/e*-.1:pdGL.keys.UP||pdGL.keys.DOWN?(t.lookUpDown+=15*i*((pdGL.keys.DOWN||0)-(pdGL.keys.UP||0)),t.lookUpDown=pd.constrainTo(t.lookUpDown,-100*n,100*n)):t.lookUpDown*=s,t.active=!1,(1e-4<Math.abs(t.moveLeftRight)||1e-4<Math.abs(t.moveUpDown))&&(this.pan(.5*e*t.moveLeftRight,.5*e*t.moveUpDown,!0),a=t.active=!0),(1e-4<Math.abs(t.lookLeftRight)||1e-4<Math.abs(t.lookUpDown))&&(this.cameraFOV<1?(s=Math.max(.05,this.cameraFOV),this.pan(e*s*-t.lookLeftRight,e*s*-t.lookUpDown,!0)):this.rotate(e*t.lookLeftRight,e*t.lookUpDown),a=t.active=!0),1e-4<Math.abs(t.moveInOut)&&(this.cameraFOV<1?this.zoom(e*t.moveInOut):this.walk(e*t.moveInOut),a=t.active=!0))),a},initialise:function(){var n=this,s=-1,a=!1,r=0;function t(){return n.updateInertia()}return h.onmousemove=function(e){n.handlePointerMove&&n.handlePointerMove(e)},h.onmousedown=function(e){n.clearInertia(),r=e.touchCount,n.handlePointerDown&&(a=n.handlePointerDown(e)),n._rotationAccum=0,s=e.button},h.onmousedrag=function(e){var t,i=e.button;e.button<0&&(i=e.button=s),r<e.touchCount&&(r=e.touchCount),a&&n.handlePointerDrag&&n.handlePointerDrag(e)||((n._inertiaAction=0)==i||2==i&&!e.touchCount?e.ctrlKey||e.metaKey?(e.shiftKey?(n._inertiaAction=5,n._inertiaTimeStamp=e.timeStamp,n._inertiaDeltaX=e.dragX,n._inertiaDeltaY=e.dragY,n._inertiaZoom=.0015*-(n._inertiaDeltaX-n._inertiaDeltaY)):(n._inertiaAction=3,n._inertiaTimeStamp=e.timeStamp,n._inertiaDeltaX=e.dragX,n._inertiaDeltaY=e.dragY,n._inertiaZoom=.005*(n._inertiaDeltaX-n._inertiaDeltaY)),n.updateView()):e.shiftKey?(t=1,n._inertiaAction=2,n._inertiaTimeStamp=e.timeStamp,n._inertiaDeltaX=t*e.dragX,n._inertiaDeltaY=t*e.dragY,n._inertiaZoom=0,n.updateView()):e.hasMoved(e.isTouchEvent?10:4)&&(t=n.orbitMode?1:pd.mapAndConstrainTo(n.cameraFOV,0,90,.001,1),n._inertiaAction=1,n._inertiaTimeStamp=e.timeStamp,n._inertiaDeltaX=t*e.dragX,n._inertiaDeltaY=t*e.dragY,n._inertiaZoom=0,n.updateView()):1==i?(n._inertiaTimeStamp=e.timeStamp,n._inertiaDeltaX=e.dragX,n._inertiaDeltaY=e.dragY,n._inertiaAction=4,n._inertiaZoom=1.5*(e.scale-1),.25<Math.abs(n._inertiaZoom)&&(n._inertiaZoom=0,e.rotation=0),n._rotationLock&&n.orbitMode&&!pd.closeTo(e.rotation,0,1e-4)&&(n._rotationAccum+=e.rotation,Math.abs(n._rotationAccum)>n._rotationThreshold?n._rotationLock=!1:e.rotation=0),n.updateView(e.rotation)):2==i&&(2<e.touchCount?n._inertiaAction=2:n._inertiaAction=1,n._inertiaTimeStamp=e.timeStamp,n._inertiaDeltaX=e.dragX,n._inertiaDeltaY=e.dragY,n._inertiaZoom=0,n.updateView()))},h.onmouseup=function(e){a&&n.handlePointerUp&&n.handlePointerUp(e)||(a=!1,pdDOM.Interaction.hasMoved(5*pdDOM.devicePixelRatio)&&e.timeStamp-n._inertiaTimeStamp<n._inertiaThresholdTime&&(Math.abs(n._inertiaDeltaX)>n._inertiaThresholdDelta||Math.abs(n._inertiaDeltaY)>n._inertiaThresholdDelta||.01<Math.abs(n._inertiaZoom))&&h.animationQueue.addOrReplace(t).start(),h.oncontextmenu&&2==event.button&&!pdDOM.Interaction.hasMoved()&&h.oncontextmenu(e),s=-1,n._rotationLock||(n._rotationThreshold=5))},h.onmousewheel=function(e){var t;e.delta&&(t=e.delta<0?-1:1,e.shiftKey?t*=10:(e.ctrlKey||e.metaKey)&&(t*=.1),e.timeStamp-n._inertiaTimeStamp<n._inertiaThresholdTime?(n.mouseWheelIncrement+=.1,0<=t?t+=n.mouseWheelIncrement:t-=n.mouseWheelIncrement):n.mouseWheelIncrement=0,n._inertiaTimeStamp=e.timeStamp,n.zoom(.05*t))},this}};var n=0,s={};function l(e){return e in s||(s[e]=h.getExtension(e)),s[e]}pdGL.Texture=function(e,t,i){i=i||{},n=n||h.getParameter(h.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.width=pd.toInteger(e,64),this.height=pd.toInteger(t,64),this.unit=pd.toInteger(i.unit,0),this.type=pd.toInteger(i.type,h.UNSIGNED_BYTE),this.format=pd.toInteger(i.format,h.RGBA),this.type==h.FLOAT?(l("OES_texture_float")||console.warn("ERROR: Device or browser does not support 'OES_texture_float'."),l("OES_texture_float_linear")||(i.filter=h.NEAREST)):this.type==h.HALF_FLOAT&&(l("OES_texture_half_float")||console.warn("ERROR: Device or browser does not support 'OES_texture_half_float'."),l("OES_texture_half_float_linear")||(i.filter=h.NEAREST)),i.imageData||(i.imageData=null),this.textureId=h.createTexture(),h.activeTexture(h.TEXTURE0+this.unit),h.bindTexture(h.TEXTURE_2D,this.textureId),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i.filter||i.magFilter||h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,i.filter||i.minFilter||h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i.wrap||i.wrapS||h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i.wrap||i.wrapT||h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this.format,this.width,this.height,0,this.format,this.type,i.imageData),this.bound=!1};var d,v=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];pdGL.Texture.prototype={_frameBuffer:null,_depthBuffer:null,_setUpFramebuffer:function(e){var t=!1;return h.viewport(0,0,this.width,this.height),this._frameBuffer||(this._frameBuffer=h.createFramebuffer(),t=!0),h.bindFramebuffer(h.FRAMEBUFFER,this._frameBuffer),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,this.textureId,0),!1!==e&&(this._depthBuffer||(this._depthBuffer=h.createRenderbuffer()),e=this._depthBuffer,h.bindRenderbuffer(h.RENDERBUFFER,e),this.width==e.width&&this.height==e.height||(e.width=this.width,e.height=this.height,h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,this.width,this.height)),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,e)),t},bind:function(e){return 0<=(e=e||this.unit||0)&&e<16?v[e]!=this.textureId&&(h.activeTexture(h.TEXTURE0+e),h.bindTexture(h.TEXTURE_2D,this.textureId),v[e]=this.textureId):(h.activeTexture(h.TEXTURE0+e),h.bindTexture(h.TEXTURE_2D,this.textureId)),this.bound=!0,this},unbind:function(e){return 0<=(e=e||this.unit||0)&&e<16?v[e]==this.textureId&&(h.activeTexture(h.TEXTURE0+e),h.bindTexture(h.TEXTURE_2D,null),v[e]=-1):(h.activeTexture(h.TEXTURE0+e),h.bindTexture(h.TEXTURE_2D,null)),this.bound=!1,this},drawTo:function(e,t){t=t||{};var i=h.getParameter(h.VIEWPORT);return this._setUpFramebuffer(t.depth),e&&e(),h.bindFramebuffer(h.FRAMEBUFFER,null),h.bindRenderbuffer(h.RENDERBUFFER,null),h.viewport(i[0],i[1],i[2],i[3]),this},drawToCanvas:function(e,t,i){i=i||{};var n=h.getParameter(h.VIEWPORT);return this._setUpFramebuffer(i.depth),t&&t(),e&&e.getContext&&this._frameBuffer&&(i=new Uint8Array(this.width*this.height*4),h.readPixels(0,0,this.width,this.height,h.RGBA,h.UNSIGNED_BYTE,i),(e=(t=e.getContext("2d")).createImageData(this.width,this.height)).data.set(i),t.putImageData(e,0,0)),h.bindFramebuffer(h.FRAMEBUFFER,null),h.bindRenderbuffer(h.RENDERBUFFER,null),h.viewport(n[0],n[1],n[2],n[3]),this},swapWith:function(e){var t=e.textureId;return e.textureId=this.textureId,this.textureId=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,this},destroy:function(){return this._frameBuffer&&(h.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null),this._depthBuffer&&(h.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=null),this.unbind(),h.deleteTexture(this.textureId),this}};var b=null;pdGL.Texture.placeholder=function(){return b=b||new pdGL.Texture(1,1,{imageData:new Uint8Array([0,0,0,0])})},pdGL.Texture.fromImage=function(e,t){t=t||{};var i=new pdGL.Texture(e.width,e.height,t);try{h.texImage2D(h.TEXTURE_2D,0,i.format,i.format,i.type,e)}catch(e){throw"file:"==window.location.protocol?new Error('Image not loaded for security reasons (serve this page over "http://" instead)'):new Error("Image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)")}return t.minFilter&&t.minFilter!=h.NEAREST&&t.minFilter!=h.LINEAR&&h.generateMipmap(h.TEXTURE_2D),i},pdGL.Texture.fromCanvas=function(e,t){e=e.getContext("2d");return pdGL.Texture.fromImage(e.canvas,t)},pdGL.Texture.fromURL=function(e,t){d=d||function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var t=0;t<e.canvas.height;t+=16)for(var i=0;i<e.canvas.width;i+=16)e.fillStyle=16&(i^t)?"#FFF":"#DDD",e.fillRect(i,t,16,16);return e.canvas}();var i=pdGL.Texture.fromImage(d,t),n=new Image,s=h;return n.onload=function(){s.makeCurrent(),pdGL.Texture.fromImage(n,t).swapWith(i)},n.src=e,i},pdGL.Material=function(e){e=e||{},pd3D.Material.call(this,e),this._mode=pd.toInteger(e.mode,h.TRIANGLES),this._shader=e.shader||pdGL.Material.DefaultShader(),this._shadowMap=e.shadowMap||null,this._textureUnit=pd.toInteger(e.textureUnit,-1),this._texture=e.texture||null,this._uniforms=e.uniforms||{},this._callbackOnDrawMesh=null,this._cachedUniforms=null,this._rendering=!1,this._shadowMap&&(this._uniforms.shadowMap=0),this._texture&&(this._uniforms.texture=this._textureUnit)},pdGL.Material.prototype=Object.create(pd3D.Material.prototype),pdGL.Material.prototype.constructor=pdGL.Material,pdGL.Material.prototype.shader=function(e){return 0==arguments.length?this._shader:(this._shader=e,this)},pdGL.Material.prototype.uniform=function(e,t){if(1==arguments.length)return this._uniforms[e];if(2<=arguments.length&&(this._uniforms[e]=t,this._cachedUniforms)){if(!this._shader)throw'Attempted to set uniform "'+e+'" before assigning a valid shader.';var i=this._cachedUniforms[e];this._cachedUniforms[e]=this._shader.createCachedUniform(e,t,i),this._rendering&&this._shader.setCachedUniformValue(this._cachedUniforms[e])}return this},pdGL.Material.prototype.uniforms=function(e){return 0==arguments.length?this._uniforms:(this._uniforms=e||{},this._cachedUniforms=null,this)},pdGL.Material.prototype.createUniformCache=function(){var e,t={},i=this._uniforms,n=this._shader;for(e in i)i.hasOwnProperty(e)&&(t[e]=n.createCachedUniform(e,i[e],t[e]));return this._cachedUniforms=t,this},pdGL.Material.prototype.getCachedUniform=function(e){return this._cachedUniforms||this.createUniformCache(),this._cachedUniforms[e]},pdGL.Material.prototype.setCachedUniform=function(e,t){return t&&(this._cachedUniforms||this.createUniformCache(),this._cachedUniforms[e]=t),this},pdGL.Material.prototype.setCachedUniforms=function(e){var t,i={},n=this._uniforms,s=this._shader;for(t in n)n.hasOwnProperty(t)&&(t in e?i[t]=e[t]:i[t]=s.createCachedUniform(t,n[t]));return this._cachedUniforms=i,this},pdGL.Material.prototype.pushUniform=function(e,t){return pdGL.Material.pushUniform(this,e,t),this},pdGL.Material.prototype.popUniform=function(){return pdGL.Material.popUniform(),this},pdGL.Material.prototype.texture=function(e,t){return 0==arguments.length?this._texture:(this._texture=e,this._textureUnit=0<t?t:1,this._texture?this._uniforms.texture=this._textureUnit:delete this._uniforms.texture,this)},pdGL.Material.prototype.shadowMap=function(e){return 0==arguments.length?this._shadowMap:(this._shadowMap=e,this._shadowMap?this._uniforms.shadowMap=0:delete this._uniforms.shadowMap,this)},pdGL.Material.prototype.mode=function(e){return 0==arguments.length?this._mode:(this._mode=e,this)};var y=-1;function S(e,t){return(e=pd.toNumber(e,t))<0?t:e}pdGL.Material.prototype.isRendering=function(){return this._rendering},pdGL.Material.prototype.startRender=function(){return g&&g.id==this.id||(g&&g.endRender(),this._shadowMap&&this._shadowMap.bind(0),0<this._textureUnit&&(this._texture||pdGL.Texture.placeholder()).bind(this._textureUnit),this._cachedUniforms||this.createUniformCache(),this._shader.setCachedUniformValues(this._cachedUniforms),this._shader.prepareMatrices(),this._rendering=!0,g=this),this},pdGL.Material.prototype.endRender=function(){return g=null,this._rendering=!1,this},pdGL.Material.prototype.unbindTextures=function(){return this._texture&&this._texture.unbind(this._textureUnit),this._shadowMap&&this._shadowMap.unbind(0),this},pdGL.Material.prototype._renderMesh=function(e,t,i){return i=i||pdGL.Shader.getIndexBufferName(t),e.checkToCompile(),this._callbackOnDrawMesh&&this._callbackOnDrawMesh(e,t),t>=h.TRIANGLES&&null!=e.twoSided&&h.setCullFace(!e.twoSided),e.callbackOnDraw&&e.callbackOnDraw(e,t,this),this._shader.renderPrimitive(e.vertexBuffers,e.indexBuffers[i],t),0<y&&(y=-1,h.popLineWidth()),this},pdGL.Material.prototype.renderMeshes=function(e,t){if(this._shader&&e){var i,n,s,a=pd.isArray(e)?e:[e];if(this._rendering||this.startRender(),this._cachedUniforms||(this.createUniformCache(),this._shader.setCachedUniformValues(this._cachedUniforms)),t===pd3D.RENDER_ALL&&(t=p),pd.isArray(t)){for(var r=t,o=0,l=a.length;o<l;++o)if((i=a[o])&&i.visible)for(var d=0;d<r.length;++d)t=S(r[d],this._mode),n=i[s=pdGL.Shader.getIndexBufferName(t)],(!t||n&&n.length)&&this._renderMesh(i,t,s)}else{t=S(t,this._mode),s=pdGL.Shader.getIndexBufferName(t);for(o=0,l=a.length;o<l;++o)n=(i=a[o])[s],i&&i.visible&&(!t||n&&n.length)&&this._renderMesh(i,t,s)}h.setCullFace()}return this},pdGL.Material.prototype.renderSurfaces=function(e){return this.renderMeshes(e,h.TRIANGLES)},pdGL.Material.prototype.renderOutlines=function(e){return this.renderMeshes(e,h.LINES)},pdGL.Material.prototype.renderPoints=function(e){return this.renderMeshes(e,h.POINTS)},pdGL.Material.prototype.renderNode3D=function(e,t){if(this.startRender(),pd.isArray(e))for(var i=0,n=e.length;i<n;++i)e[i].drawWithMaterial(this,t);else e.drawWithMaterial(this,t);return this.endRender(),this},pdGL.Material.prototype.draw=function(e,t){return this._shader&&e&&(this.startRender(),this.renderMeshes(e,t),this.endRender()),this},pdGL.Material.prototype.drawSurface=function(e){return this.draw(e,h.TRIANGLES)},pdGL.Material.prototype.drawOutline=function(e){return this.draw(e,h.LINES)},pdGL.Material.prototype.drawPoints=function(e){return this.draw(e,h.POINTS)},pdGL.Material.prototype.drawAll=function(e){return this.draw(e,pd3D.RENDER_ALL)};var M=[];function w(e,t){for(var i=e.length,n="",s=0;s<i;++s)e[s].vertHead&&(n+=e[s].vertHead);for(n+=pdGL.ShaderComponent.mainFunc+pdGL.ShaderComponent.position.vertMain,s=0;s<i;++s)e[s].vertMain&&(n+=e[s].vertMain);n+=pdGL.ShaderComponent.endFunc;var a="";for(s=0;s<i;++s)e[s].fragHead&&(a+=e[s].fragHead);for(a+=pdGL.ShaderComponent.mainFunc,s=0;s<i;++s)e[s].fragMain&&(a+=e[s].fragMain);if(t&&t.length)for(s=0,i=t.length;s<i;++s)t[s].fragColor&&(a+=t[s].fragColor);else for(s=0;s<i;++s)e[s].fragColor&&(a+=e[s].fragColor);return a+=pdGL.ShaderComponent.endFunc,new pdGL.Shader(n,a)}function L(e,t){this._shader.uniforms({color:t<h.TRIANGLES?e.defaultLineColor:e.defaultColor,useVertexColors:!(!e||!e.hasVertexColors)})}function D(e,t){this._shader.uniforms({useTexture:!(!this._texture||!e.coords),color:t<h.TRIANGLES?e.defaultLineColor:e.defaultColor,useVertexColors:!(!e||!e.hasVertexColors)})}function T(e){e&&(e.uniforms=e.uniforms||{},e.uniforms.opacityThreshold=pd.constrainTo(pd.toNumber(e.uniforms.opacityThreshold,1e-4),0,1))}pdGL.Material.pushUniform=function(e,t,i){var n={},s=e._uniforms;s.hasOwnProperty(t)&&s[t]!=i&&(n.material=e,n.old_value=s[t],n.old_cache=null,n.name=t,e._cachedUniforms&&(e._cachedUniforms.hasOwnProperty(t)?(s=e._cachedUniforms[t],n.old_cache={name:s.name,value:s.value,method:s.method,isMatrix:s.isMatrix,stale:s.stale}):n.old_cache=e._shader.createCachedUniform(t,n.old_value)),e.uniform(t,i)),M.push(n)},pdGL.Material.popUniform=function(){var e,t;0<M.length&&((t=(e=M.pop()).material)&&t._uniforms.hasOwnProperty(e.name)&&(t._uniforms[e.name]=e.old_value,t._cachedUniforms&&e.old_cache&&(t._cachedUniforms[e.name]=e.old_cache,t._rendering&&t._shader.setCachedUniformValue(e.old_cache))))},pdGL.ShaderComponent={mainFunc:"\nvoid main() {\n",endFunc:"\n}\n",position:{vertHead:"",vertMain:"\n    gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\n",fragHead:"",fragMain:""},POINT_SIZE_UNIFORM:{vertHead:"\nuniform float pointSize;\n",vertMain:"\n    gl_PointSize = pointSize;\n",fragHead:"",fragMain:"",checkUniforms:function(e){e.uniforms=e.uniforms||{},e.uniforms.pointSize=pd.toNumber(e.uniforms.pointSize,1)}},POINT_SIZE_ATTRIBUTE:{vertHead:"\nattribute float pointSize;\n",vertMain:"\n    gl_PointSize = pointSize;\n",fragHead:"",fragMain:""},COLOR_UNIFORM:{vertHead:"",vertMain:"",fragHead:"\nuniform vec4 color;\nuniform float opacity;\n",fragMain:"\n    float alpha = clamp(opacity * color.a, 0.0, 1.0);\n    gl_FragColor = vec4(color.rgb, alpha);\n    if (alpha < 0.001)\n        discard;\n",checkUniforms:function(e){e.uniforms=e.uniforms||{},e.uniforms.color=e.uniforms.color||[1,1,1,1],e.uniforms.opacity=pd.toNumber(e.uniforms.opacity,1)}},COLOR_ATTRIBUTE:{vertHead:"\nuniform vec4 color;\nuniform bool useVertexColors;\nvarying vec4 vColor;\n",vertMain:"\n    vColor = (useVertexColors == true) ? gl_Color : color;\n",fragHead:"\nuniform float opacity;\nvarying vec4 vColor;\n",fragMain:"\n    float alpha = clamp(opacity * vColor.a, 0.0, 1.0);\n    gl_FragColor = vec4(vColor.rgb, alpha);\n    if (alpha < 0.001)\n        discard;\n",checkUniforms:function(e){e.uniforms=e.uniforms||{},e.uniforms.color=e.uniforms.color||[1,1,1,1],e.uniforms.opacity=pd.toNumber(e.uniforms.opacity,1),e.useMeshColors=!0}},COLOR_BLINNPHONG:{vertHead:"\nuniform vec4 color;\nuniform bool useVertexColors;\nuniform vec3 sunPosition;\nvarying vec3 vNormal;\nvarying vec3 vVertex;\nvarying vec3 vLight;\nvarying vec4 vColor;\n",vertMain:"\n    vColor = (useVertexColors == true) ? gl_Color : color;\n    vec4 vtx = gl_ModelViewMatrix * gl_Vertex;\n    vVertex = vec3(vtx) / vtx.w;\n    vNormal = gl_NormalMatrix * gl_Normal;\n    vLight = sunPosition - vVertex;\n",fragHead:"\nuniform float opacity;\nuniform float shininess;\nuniform float sunIntensity;\nuniform vec3 specularColor;\nuniform vec3 ambientColor;\nvarying vec3 vNormal;\nvarying vec3 vVertex;\nvarying vec3 vLight;\nvarying vec4 vColor;\n",fragMain:"\n    float intensity = sunIntensity;\n    float specularCoefficient = 0.0;\n    vec3 normal = normalize(vNormal);\n    vec3 lightDir = normalize(vLight);\n    float alpha = clamp(opacity * vColor.a, 0.0, 1.0);\n    float diffuseCoefficient = max(0.0, dot(lightDir, normal));\n    if (diffuseCoefficient > 0.0) {\n        vec3 viewDir = normalize(-vVertex);\n        vec3 halfDir = normalize(lightDir + viewDir);\n        float specAngle = max(dot(normal, halfDir), 0.0);\n        specularCoefficient = pow(specAngle, shininess);\n    }\n\n    vec3 diffuse = (diffuseCoefficient * vColor.rgb);\n    vec3 specular = (specularCoefficient * specularColor);\n    vec3 ambient = (ambientColor * vColor.rgb);\n",fragColor:"\n    vec3 color = clamp(ambient + (intensity * (diffuse + specular)), 0.0, 1.0);\n\n    gl_FragColor = vec4(color, alpha);\n    if (alpha < 0.001) {\n        discard;\n    }\n",checkUniforms:function(e){e.uniforms=e.uniforms||{},e.uniforms.sunPosition=e.uniforms.sunPosition||[1,1,1],e.uniforms.ambientColor=e.uniforms.ambientColor||[.75,.75,.75],e.uniforms.specularColor=e.uniforms.specularColor||[.85,.85,.85],e.uniforms.sunIntensity=pd.toNumber(e.uniforms.sunIntensity,1),e.uniforms.shininess=pd.toNumber(e.uniforms.shininess,75),e.uniforms.opacity=pd.toNumber(e.uniforms.opacity,1),e.useMeshColors=!0}},SHADOW_MAP:{vertHead:"\nuniform mat4 shadowMatrix;\nvarying vec4 vCoords;\n",vertMain:"\n    vCoords = shadowMatrix * gl_Position;\n",fragHead:"\nuniform vec3 shadowColor;\nuniform sampler2D shadowMap;\nuniform float shadowOpacity;\nvarying vec4 vCoords;\n",fragMain:"\n    if (diffuseCoefficient > 0.0) {\n        if (vCoords.w > 0.0) {\n            float depth = 0.0;\n            vec2 sample = ((vCoords.xy / vCoords.w) * 0.5) + 0.5;\n            if (clamp(sample, 0.0, 1.0) == sample) {\n                float sampleDepth = texture2D(shadowMap, sample).r;\n                depth = (sampleDepth == 1.0) ? 1.0e12 : sampleDepth;\n            }\n            if (depth > 0.0) {\n                float shading = clamp(300.0 * (-0.002 + ((vCoords.z / vCoords.w) * 0.5) + 0.5 - depth), 0.0, 1.0);\n                if (length(shadowColor) > 0.01) {\n                    float mix_factor = intensity * shading * ((shadowOpacity > 0.0) ? shadowOpacity : 0.5);\n                    specular = mix(specular, shadowColor, mix_factor);\n                    diffuse = mix(diffuse, shadowColor, mix_factor);\n                    ambient = mix(ambient, shadowColor, mix_factor);\n                }\n                intensity *= (1.0 - shading);\n                if (shadowOpacity > 0.0) {\n                    alpha = max(alpha, min(shadowOpacity * shading, sunIntensity));\n                }\n            }\n        }\n    } else {\n        intensity = 0.0;\n    }\n",checkUniforms:function(e){e.uniforms=e.uniforms||{},e.uniforms.shadowColor=e.uniforms.shadowColor||[0,0,0],e.uniforms.shadowOpacity=pd.toNumber(e.uniforms.shadowOpacity,-1),e.uniforms.shadowMatrix=e.uniforms.shadowMatrix||null}},TEXTURE:{vertHead:"\nvarying vec4 vTexCoords;\n",vertMain:"\n    vTexCoords = gl_TexCoord;\n",fragHead:"\nuniform sampler2D texture;\nuniform float opacityThreshold;\nvarying vec4 vTexCoords;\n",fragMain:"",fragColor:"\n    gl_FragColor *= (alpha * texture2D(texture, vTexCoords.xy));\n    if (gl_FragColor.a < opacityThreshold) discard;\n",checkUniforms:function(e){e.useTexture=!0}}},pdGL.Material.compose=function(e,t,i){(e=e||{}).shader||(e.shader=w(t,i));for(var n=0,s=t.length;n<s;++n)t[n].checkUniforms&&t[n].checkUniforms(e);i=new pdGL.Material(e);return e.callback?i._callbackOnDrawMesh=e.callback:e.useMeshColors&&(e.useTexture?i._callbackOnDrawMesh=D:i._callbackOnDrawMesh=L),i};var E=null;pdGL.Material.FixedColorVariablePointSize=function(e){(e=e||{}).uniforms=e.uniforms||{},e.uniforms.color=e.uniforms.color||[.5,.5,.5,1],e.name=e.name||"FixedColorVariablePointSize",e.mode=pd.toInteger(e.mode,h.POINTS),e.shader=E;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.POINT_SIZE_ATTRIBUTE,pdGL.ShaderComponent.COLOR_UNIFORM]);return E=E||e._shader,e};var A=null;pdGL.Material.FixedColorUniformPointSize=function(e){(e=e||{}).uniforms=e.uniforms||{},e.uniforms.color=e.uniforms.color||[.2,.2,.2,1],e.name=e.name||"FixedColorUniformPointSize",e.shader=A;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.POINT_SIZE_UNIFORM,pdGL.ShaderComponent.COLOR_UNIFORM]);return A=A||e._shader,e};var P=null;pdGL.Material.TexturedFixedColorUniformPointSize=function(e){T(e=e||{}),e.uniforms.color=e.uniforms.color||[.2,.2,.2,1],e.name=e.name||"TexturedFixedColorUniformPointSize",e.shader=P,e.uniforms.useTexture=!0;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.COLOR_UNIFORM,pdGL.ShaderComponent.TEXTURE]);return P=P||e._shader,e};var C=null;pdGL.Material.VariableColorUniformPointSize=function(e){(e=e||{}).uniforms=e.uniforms||{},e.uniforms.color=e.uniforms.color||[0,0,0,1],e.name=e.name||"VariableColorUniformPointSize",e.shader=C;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.POINT_SIZE_UNIFORM,pdGL.ShaderComponent.COLOR_ATTRIBUTE]);return C=C||e._shader,e};var O=null;pdGL.Material.TexturedVariableColorUniformPointSize=function(e){T(e=e||{}),e.uniforms.color=e.uniforms.color||[0,0,0,1],e.name=e.name||"TexturedVariableColorUniformPointSize",e.shader=O;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.COLOR_ATTRIBUTE,pdGL.ShaderComponent.TEXTURE]);return O=O||e._shader,e};var N=null;pdGL.Material.DefaultShader=function(){return null==N&&(N=w([pdGL.ShaderComponent.COLOR_BLINNPHONG])),N},pdGL.Material.BlinnPhongColor=function(e){(e=e||{}).name=e.name||"BlinnPhongColor",e.shader=N;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.COLOR_BLINNPHONG]);return N=N||e._shader,e};var G=null;pdGL.Material.TexturedBlinnPhongColor=function(e){T(e=e||{}),e.name=e.name||"TexturedBlinnPhongColor",e.shader=G;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.COLOR_BLINNPHONG,pdGL.ShaderComponent.TEXTURE]);return G=G||e._shader,e};var R=null;pdGL.Material.BlinnPhongColorShadow=function(e){(e=e||{}).name=e.name||"BlinnPhongColorShadow",e.shader=R;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.COLOR_BLINNPHONG,pdGL.ShaderComponent.SHADOW_MAP]);return R=R||e._shader,e};var I=null;pdGL.Material.TexturedBlinnPhongColorShadow=function(e){T(e=e||{}),e.name=e.name||"TexturedBlinnPhongColorShadow",e.shader=I;e=pdGL.Material.compose(e,[pdGL.ShaderComponent.COLOR_BLINNPHONG,pdGL.ShaderComponent.SHADOW_MAP,pdGL.ShaderComponent.TEXTURE]);return I=I||e._shader,e};var k=null;function V(e,t,i){for(var n;null!==(n=e.exec(t));)i(n)}pdGL.Material.DepthMapShader=function(e){return(e=e||{}).name=e.name||"DepthMapShader",e.shader=(null==k&&(k=new pdGL.Shader("varying vec4 vWorldPosition;\nvoid main() {\n    gl_Position = vWorldPosition = gl_ModelViewProjectionMatrix * gl_Vertex;\n}\n","varying vec4 vWorldPosition;\nvoid main() {\n    float depth = vWorldPosition.z / vWorldPosition.w;\n    gl_FragColor = vec4(depth * 0.5 + 0.5);\n}\n")),k),new pdGL.Material(e)},pdGL.Material.BlinnPhongWithGrid=function(e){(e=e||{}).name=e.name||"BlinnPhongWithGrid"+(e.useShadowMap?"WithShadows":"");var t={vertHead:"\nvarying vec3 vNrm;\nvarying float vDist;\nvarying vec3 vPos;\n",vertMain:"\n    vNrm = gl_Normal.xyz;\n    vDist = gl_Position.w;\n    vPos = gl_Vertex.xyz;\n",fragHead:"\nuniform float modelSize;\nuniform float gridMinor;\nuniform float gridMajor;\nuniform vec4 gridColor;\n\nvarying vec3 vNrm;\nvarying float vDist;\nvarying vec3 vPos;\n\nfloat lineWidth = 0.0;\n\nfloat map(float value, float from1, float to1, float from2, float to2) {\n    float v = ((value - from1) / (to1 - from1) * (to2 - from2)) + from2;\n    return clamp(v, from2, to2);\n}\n\nfloat gridEffect(float nrm_1, float pos_1, float nrm_2, float pos_2) {\n    float grid1 = 2.5 * (1.0 - abs(nrm_1)) * (mod(pos_1, gridMinor) / lineWidth);\n    float grid2 = 2.5 * (1.0 - abs(nrm_2)) * (mod(pos_2, gridMinor) / lineWidth);\n    float grid3 = (1.0 - abs(nrm_1)) * (mod(pos_1, gridMajor) / lineWidth);\n    float grid4 = (1.0 - abs(nrm_2)) * (mod(pos_2, gridMajor) / lineWidth);\n    float g_max = min(max(grid1, grid2), max(grid3, grid4));\n    return (g_max > 0.99) ? 0.0 : clamp(1.0 - (g_max * g_max), 0.0, 1.0);\n}\n\nfloat gridFactor(in vec3 nrm, in vec3 pos) {\n    float _xy = gridEffect(nrm.x, pos.x, nrm.y, pos.y);\n    float _yz = gridEffect(nrm.y, pos.y, nrm.z, pos.z);\n    float _xz = gridEffect(nrm.x, pos.x, nrm.z, pos.z);\n    _xy = (abs(nrm.z) > 0.5) ? 0.0 : _xy;\n    _yz = (abs(nrm.x) > 0.5) ? 0.0 : _yz;\n    _xz = (abs(nrm.y) > 0.5) ? 0.0 : _xz;\n    return max(_xy, max(_yz, _xz));\n}\n",fragMain:"",fragColor:"\n    lineWidth = 0.00175 * vDist;\n    float grid_factor = gridColor.a * gridFactor(vNrm, vPos);\n    grid_factor = map(lineWidth, modelSize, 0.0, 0.0, grid_factor);\n    color = mix(color, gridColor.xyz, grid_factor);\n    gl_FragColor = vec4(color, alpha);\n",checkUniforms:function(e){e.uniforms=e.uniforms||{},e.uniforms.modelSize=e.uniforms.modelSize||1,e.uniforms.gridMajor=e.uniforms.gridMajor||1e3,e.uniforms.gridMinor=e.uniforms.gridMinor||200,pd.isArray(e.uniforms.gridColor)?e.uniforms.gridColor.length<4&&(e.uniforms.gridColor[3]=1):e.uniforms.gridColor=[0,0,0,1]}},i=[pdGL.ShaderComponent.COLOR_BLINNPHONG];return e.useShadowMap&&i.push(pdGL.ShaderComponent.SHADOW_MAP),i.push(t),pdGL.Material.compose(e,i)},pdGL.Material.RectangularBlockWithGrid=function(e){e=e||{};var t=[pdGL.ShaderComponent.COLOR_BLINNPHONG];return e.useShadowMap&&t.push(pdGL.ShaderComponent.SHADOW_MAP),t.push({vertHead:"\nvarying vec3 vNrm;\nvarying vec3 vPos;\n",vertMain:"\n    vNrm = gl_Normal.xyz;\n    vPos = gl_Vertex.xyz;\n",fragHead:"\nuniform float lineWidth;\nuniform float edgeEffect;\nuniform float gridMinor;\nuniform float gridMajor;\nuniform vec3 gridColor;\n\nvarying vec3 vNrm;\nvarying vec3 vPos;\n\nconst vec3 darkColor = vec3(0.0, 0.0, 0.0);\n\nfloat gridEffect(float nrm_1, float pos_1, float nrm_2, float pos_2) {\n    float grid1 = 2.5 * (1.0 - abs(nrm_1)) * (mod(pos_1, gridMinor) / lineWidth);\n    float grid2 = 2.5 * (1.0 - abs(nrm_2)) * (mod(pos_2, gridMinor) / lineWidth);\n    float grid3 = (1.0 - abs(nrm_1)) * (mod(pos_1, gridMajor) / lineWidth);\n    float grid4 = (1.0 - abs(nrm_2)) * (mod(pos_2, gridMajor) / lineWidth);\n    float g_max = min(max(grid1, grid2), max(grid3, grid4));\n    return (g_max > 0.95) ? 0.0 : clamp(1.0 - g_max, 0.0, 1.0);\n}\n\nfloat gridFactor(in vec3 nrm, in vec3 pos) {\n    float _xy = gridEffect(nrm.x, pos.x, nrm.y, pos.y);\n    float _yz = gridEffect(nrm.y, pos.y, nrm.z, pos.z);\n    float _xz = gridEffect(nrm.x, pos.x, nrm.z, pos.z);\n    _xy = (abs(nrm.z) > 0.5) ? 0.0 : _xy;\n    _yz = (abs(nrm.x) > 0.5) ? 0.0 : _yz;\n    _xz = (abs(nrm.y) > 0.5) ? 0.0 : _xz;\n    return max(_xy, max(_yz, _xz));\n}\n",fragMain:"\n    float darken = 0.0;\n    if ((abs(vNrm.z) < 0.5) || (abs(vPos.z) > edgeEffect)) {\n        darken = 1.0 - clamp(vPos.z / edgeEffect, 0.0, 1.0);\n    }\n",fragColor:"\n    color = mix(color, darkColor, 0.35 * (1.0 - (0.5 * ambientColor)) * darken * darken);\n    float grid_factor = (lineWidth > 1e-3) ? 0.35 * gridFactor(vNrm, vPos) : 0.0;\n    color = mix(color, gridColor, grid_factor);\n    gl_FragColor = vec4(color, alpha);\n",checkUniforms:function(e){e.uniforms=e.uniforms||{},e.uniforms.lineWidth=e.uniforms.lineWidth||1,e.uniforms.edgeEffect=e.uniforms.edgeEffect||1e3,e.uniforms.gridColor=e.uniforms.gridColor||[0,0,0],e.uniforms.gridMajor=e.uniforms.gridMajor||1e3,e.uniforms.gridMinor=e.uniforms.gridMinor||200}}),pdGL.Material.compose(e,t)},pd3D.Node.prototype.drawWithMaterial=function(e,t){if(this.visible&&e){for(var i in this.callbackOnDraw&&this.callbackOnDraw(this,t,e),this.transformMatrix&&(h.pushMatrix(),h.multMatrix(this.transformMatrix),e._rendering&&e._shader.prepareMatrices()),this.geometry)this.geometry.hasOwnProperty(i)&&e.renderMeshes(this.geometry[i].meshes,t);for(var n,s=0,a=this.children.length;s<a;++s)(n=this.children[s])&&n.drawWithMaterial&&n.drawWithMaterial(e,t);this.transformMatrix&&h.popMatrix()}return this},pd3D.Node.prototype._render=function(e){for(var t in this.callbackOnDraw&&this.callbackOnDraw(this,e),this.transformMatrix&&(h.pushMatrix(),h.multMatrix(this.transformMatrix)),this.geometry){var i;this.geometry.hasOwnProperty(t)&&(i=this.geometry[t]).material.draw(i.meshes,e)}for(var n,s=0,a=this.children.length;s<a;++s)(n=this.children[s])&&n.draw&&n.draw(e);return this.callbackOnAfterDraw&&this.callbackOnAfterDraw(this,e),this.transformMatrix&&h.popMatrix(),this},pd3D.Node.prototype.drawOutlines=function(e){return e?this.drawWithMaterial(e,h.LINES):this.visible&&this._render(h.LINES),this},pd3D.Node.prototype.drawSurfaces=function(e){return e?this.drawWithMaterial(e,h.TRIANGLES):this.visible&&this._render(h.TRIANGLES),this},pd3D.Node.prototype.draw=function(e){return this.visible&&this._render(e),this},pdGL.CachedUniform=function(e){e=e||{},this.name=e.name||"",this.value=e.value||null,this.method=e.method||null,this.isMatrix=pd.toBoolean(e.isMatrix,!1),this.stale=pd.toBoolean(e.stale,!0)},pdGL.CachedUniform.createOrUpdate=function(e,t,i){if((i=i||new pdGL.CachedUniform).stale=!0,i.name=e,t instanceof pd3D.Vector?t=[t.x,t.y,t.z]:t instanceof pd3D.Matrix&&(t=t.m),o(t))switch(t.length){case 1:i.method=h.uniform1fv,i.value=new Float32Array(t);break;case 2:i.method=h.uniform2fv,i.value=new Float32Array(t);break;case 3:i.method=h.uniform3fv,i.value=new Float32Array(t);break;case 4:i.method=h.uniform4fv,i.value=new Float32Array(t);break;case 9:i.isMatrix=!0,i.method=h.uniformMatrix3fv,i.value=new Float32Array([t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]);break;case 16:i.isMatrix=!0,i.method=h.uniformMatrix4fv,i.value=new Float32Array([t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]);break;default:throw'Cannot pre-process uniform "'+e+'" of length '+t.length}else if("boolean"==typeof t)i.method=h.uniform1i,i.value=!0===t?1:0;else{if(!pd.isNumeric(t))throw'Attempted to set uniform "'+e+'" to invalid value '+t;i.method=h.uniform1f,i.value=t}return i},pdGL.CachedUniform.createOrUpdateTexture=function(e,t,i){return(i=i||new pdGL.CachedUniform).name=e,i.value=pd.toInteger(t,1),i.method=h.uniform1i,i.isMatrix=!1,i.stale=!0,i};var B="pd_web",U=-1;pdGL.Shader=function(e,t){var i=this;function n(e){if(/\s/.test(e))return e;var t=document.getElementById(e);return t?t.text:e}e=n(e),t=n(t);var s="uniform mat3 gl_NormalMatrix;\nuniform mat4 gl_ModelViewMatrix;\nuniform mat4 gl_ProjectionMatrix;\nuniform mat4 gl_ModelViewProjectionMatrix;\nuniform mat4 gl_ModelViewMatrixInverse;\nuniform mat4 gl_ProjectionMatrixInverse;\nuniform mat4 gl_ModelViewProjectionMatrixInverse;\n";this.usedMatrices={};var a=e+t;function r(e,t){var i={},n=/^((\s*\/\/.*\n|\s*#extension.*\n)+)\^*$/.exec(t);return t=n?n[1]+e+t.substr(n[1].length):e+t,V(/\bgl_\w+\b/g,e,function(e){e in i||(t=t.replace(new RegExp("\\b"+e+"\\b","g"),B+e),i[e]=!0)}),t}function o(e,t){e=h.createShader(e);if(h.shaderSource(e,t),h.compileShader(e),!h.getShaderParameter(e,h.COMPILE_STATUS))throw new Error("compile error: "+h.getShaderInfoLog(e));return e}if(V(/\b(gl_[^;]*)\b;/g,s,function(e){var t=e[1];-1!=a.indexOf(t)&&(e=t.replace(/[a-z_]/g,""),i.usedMatrices[e]=B+t)}),e=r("uniform mat3 gl_NormalMatrix;\nuniform mat4 gl_ModelViewMatrix;\nuniform mat4 gl_ProjectionMatrix;\nuniform mat4 gl_ModelViewProjectionMatrix;\nuniform mat4 gl_ModelViewMatrixInverse;\nuniform mat4 gl_ProjectionMatrixInverse;\nuniform mat4 gl_ModelViewProjectionMatrixInverse;\nattribute vec4 gl_Vertex;\nattribute vec4 gl_TexCoord;\nattribute vec3 gl_Normal;\nattribute vec4 gl_Color;\n",e),t=r("precision highp float;\nuniform mat3 gl_NormalMatrix;\nuniform mat4 gl_ModelViewMatrix;\nuniform mat4 gl_ProjectionMatrix;\nuniform mat4 gl_ModelViewProjectionMatrix;\nuniform mat4 gl_ModelViewMatrixInverse;\nuniform mat4 gl_ProjectionMatrixInverse;\nuniform mat4 gl_ModelViewProjectionMatrixInverse;\n",t),this.attributes={},this.uniformLocations={},this.program=h.createProgram(),h.attachShader(this.program,o(h.VERTEX_SHADER,e)),h.attachShader(this.program,o(h.FRAGMENT_SHADER,t)),h.bindAttribLocation(this.program,0,B+"gl_Vertex"),this.attributes.gl_Vertex=0,h.linkProgram(this.program),!h.getProgramParameter(this.program,h.LINK_STATUS))throw"link error: "+h.getProgramInfoLog(this.program);this.isSampler={},V(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+t,function(e){i.isSampler[e[2]]=1})},pdGL.Shader.prototype={makeCurrent:function(){return U!=this.program&&(U=this.program,h.useProgram(this.program)),this},createCachedUniform:function(e,t,i){return pd.isInteger(t)&&this.isSampler[e]?pdGL.CachedUniform.createOrUpdateTexture(e,t,i):pdGL.CachedUniform.createOrUpdate(e,t,i)},setCachedUniformValue:function(e){var t=e.name,i=this.uniformLocations[t];return i||(i=h.getUniformLocation(this.program,t),this.uniformLocations[t]=i),i&&(e.isMatrix?e.method.call(h,i,!1,e.value):e.method.call(h,i,e.value)),e.stale=!1,this},setCachedUniformValues:function(e){for(var t in this.makeCurrent(),e)this.setCachedUniformValue(e[t]);return this},uniforms:function(e){for(var t in this.makeCurrent(),e){var i=this.uniformLocations[t];if(i||(i=h.getUniformLocation(this.program,t),this.uniformLocations[t]=i),i){var n=e[t];if("function"==typeof n&&(n=n()),n instanceof pd3D.Vector?n=[n.x,n.y,n.z]:n instanceof pd3D.Matrix&&(n=n.m),o(n))switch(n.length){case 1:h.uniform1fv(i,new Float32Array(n));break;case 2:h.uniform2fv(i,new Float32Array(n));break;case 3:h.uniform3fv(i,new Float32Array(n));break;case 4:h.uniform4fv(i,new Float32Array(n));break;case 9:h.uniformMatrix3fv(i,!1,new Float32Array([n[0],n[3],n[6],n[1],n[4],n[7],n[2],n[5],n[8]]));break;case 16:h.uniformMatrix4fv(i,!1,new Float32Array([n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]]));break;default:throw"don't know how to load array uniform \""+t+'" of length '+n.length}else if("boolean"==typeof n)h.uniform1i(i,!0===n?1:0);else{if(s=n,"[object Number]"!=(s=Object.prototype.toString.call(s))&&"[object Boolean]"!=s)throw'attempted to set uniform "'+t+'" to invalid value '+n;(this.isSampler[t]?h.uniform1i:h.uniform1f).call(h,i,n)}}}var s;return this},prepareMatrices:function(){this.makeCurrent();var e,t,i={},n=this.usedMatrices;for(t in n.MVM&&(i[n.MVM]=h.modelviewMatrix),(n.MVMI||n.NM)&&(i[n.MVMI]=h.modelviewMatrix.inverse()),n.PM&&(i[n.PM]=h.projectionMatrix),n.PMI&&(i[n.PMI]=h.projectionMatrix.inverse()),n.MVPM&&(i[n.MVPM]=h.getModelviewProjectionMatrix()),n.MVPMI&&(i[n.MVPMI]=h.getModelviewProjectionMatrix().inverse()),n.NM&&(e=i[n.MVMI].m,i[n.NM]=[e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]]),this.lastFrameIndex=h.frameIndex,i){var s,a=this.uniformLocations[t];a||(a=h.getUniformLocation(this.program,t),this.uniformLocations[t]=a),a&&((s=i[t])instanceof pd3D.Matrix&&(s=s.m),s&&(9==s.length?h.uniformMatrix3fv(a,!1,new Float32Array([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]])):16==s.length&&h.uniformMatrix4fv(a,!1,new Float32Array([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]]))))}return this},prepareAttributes:function(e){var t,i=0;for(t in e){var n=e[t],s=this.attributes[t];(null==s||s<0)&&(s=h.getAttribLocation(this.program,t.replace(/^(gl_.*)$/,B+"$1"))),0<=s&&n.buffer&&(this.attributes[t]=s,h.bindBuffer(h.ARRAY_BUFFER,n.buffer),h.enableVertexAttribArray(s),h.vertexAttribPointer(s,n.spacing,h.FLOAT,!1,0,0),i<(n=n.length/n.spacing)&&(i=n))}for(t in this.attributes)t in e||0==this.attributes[t]||h.disableVertexAttribArray(this.attributes[t]);return i},renderPrimitive:function(e,t,i){var n;return null!=t&&!t.buffer||0<(n=this.prepareAttributes(e))&&(t?(e=pd3D.canUse32BitBuffers&&65535<n?h.UNSIGNED_INT:h.UNSIGNED_SHORT,h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,t.buffer),h.drawElements(i,t.length,e,0)):h.drawArrays(i,0,n)),this},renderIndexBuffer:function(e,t,i){return 0<t&&e&&e.buffer&&(t=pd3D.canUse32BitBuffers&&65535<items?h.UNSIGNED_INT:h.UNSIGNED_SHORT,h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,e.buffer),h.drawElements(i,e.length,t,0)),this},draw:function(e,t){return e&&e.visible&&(e.checkToCompile(),this.prepareMatrices(),t=pd.toInteger(t,h.TRIANGLES),this.renderPrimitive(e.vertexBuffers,e.indexBuffers[pdGL.Shader.getIndexBufferName(t)],t)),this},drawModes:function(e,t){var i,n;if(e&&e.visible)if(e.checkToCompile(),this.prepareMatrices(),t===pd3D.RENDER_ALL&&(t=p),pd.isArray(t))for(var s=this.prepareAttributes(e.vertexBuffers),a=0;a<t.length;++a)i=S(t[a],h.TRIANGLES),n=pdGL.Shader.getIndexBufferName(i),this.renderIndexBuffer(e.indexBuffers[n],s,i);else i=S(t,h.TRIANGLES),n=pdGL.Shader.getIndexBufferName(i),this.renderPrimitive(e.vertexBuffers,e.indexBuffers[n],i);return this},destroy:function(){if(this.program){for(var e=h.getAttachedShaders(this.program),t=0,i=e.length;t<i;++t)h.detachShader(this.program,e[t]),h.deleteShader(e[t]);h.deleteProgram(this.program)}return this}},pdGL.Shader.getIndexBufferName=function(e){switch(e=pd.toInteger(e,h.TRIANGLES)){case h.POINTS:return"points";case h.LINES:case h.LINE_LOOP:case h.LINE_STRIP:return"lines";case h.TRIANGLES:case h.TRIANGLE_STRIP:case h.TRIANGLE_FAN:return"triangles";default:return"index"}},pdGL.Shader.fromURL=function(e,t){function i(e){var t=new XMLHttpRequest;if(t.open("GET",e,!1),t.send(null),200!==t.status)throw"could not load "+e;return t.responseText}e=i(e),t=i(t);return new pdGL.Shader(e,t)},pdGL.Shader.from=function(t,i){try{return new pdGL.Shader(t,i)}catch(e){return pdGL.Shader.fromURL(t,i)}}}(),function(){var l=pd3D.VectorArray;pdGL.PHASE={SHADOWS:0,BACKGROUND:1,OUTLINES:2,OUTLINES_MESH:3,RENDER_FIRST:4,GROUND_GRID:5,SURFACES:6,TRANSPARENT_SURFACES:7,RENDER_LAST:8,RENDER_OVERLAY:9,HUD:10};var n=null;function s(e,t){gl.setCullFaceDefault(!1),gl.clearColor(1,1,1,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),function e(t,i,n){if(t&&t.visible&&n&&!1!==t.castShadows){for(var s in t.callbackOnDraw&&t.callbackOnDraw(t,i,n),t.transformMatrix&&(gl.pushMatrix(),gl.multMatrix(t.transformMatrix),n._rendering&&n._shader.prepareMatrices()),t.geometry)t.geometry.hasOwnProperty(s)&&n.renderMeshes(t.geometry[s].meshes,i);for(var a,r=0,o=t.children.length;r<o;++r)null!=(a=t.children[r])&&e(a,i,n);t.transformMatrix&&gl.popMatrix()}}(e,gl.TRIANGLES,t),gl.setCullFaceDefault(!0)}pdGL.Environment=function(e){e=e||{},this.outlineOpacity=pd.toNumber(e.outlineOpacity,.5),this.outlineWidth=pd.toNumber(e.outlineWidth,gl.getCanvasLineWidthThin()),this.outlineColor=e.outlineColor||[0,0,0,1],this.outlineMaterial=e.outlineMaterial||pdGL.Material.FixedColorUniformPointSize({name:"Scene3D.outlineMaterial"}).uniform("color",this.outlineColor),this.meshColorMaterial=e.meshColorMaterial||pdGL.Material.VariableColorUniformPointSize({name:"Scene3D.meshColorMaterial"}),this.specularFactor=pd.toNumber(e.specularFactor,.75),this.ambientFactor=pd.toNumber(e.ambientFactor,.75),this.surfaceOpacity=pd.toNumber(e.surfaceOpacity,1),this.surfaceShininess=pd.toNumber(e.surfaceShininess,75),this.surfaceMaterial=e.surfaceMaterial||(e.shadowMap||e.shadows?pdGL.Material.BlinnPhongColorShadow({name:"Scene3D.surfaceMaterialShadow"}):pdGL.Material.BlinnPhongColor({name:"Scene3D.surfaceMaterial"})),this.backgroundColor=e.backgroundColor||[.702,.82,1,1],this.backgroundColor.length<4&&(this.backgroundColor[3]=1),this.sunDirection=e.sunDirection||new pd3D.Vector(1,1,1).normalize(),this.sunPosition=e.sunPosition||new pd3D.Vector,this.projectedSunPosition=e.projectedSunPosition||new pd3D.Vector,this.skyModel=e.skyModel||null,this.shadowMap=e.shadowMap||null,this.shadowMatrix=e.shadowMatrix||null,this.shadowMatrixProjected=null,this.depthMapMaterial=e.depthMapMaterial||null,this.updateShadows=null!=this.shadowMap,this.showGroundPlane=pd.toBoolean(e.showGroundPlane,!0),this.groundPlaneOpacity=pd.toNumber(e.groundPlaneOpacity,.25),this.groundPlaneColor=e.groundPlaneColor||null,this.groundPlaneColor||(this.groundPlaneColor=this.backgroundColor.slice(),this.groundPlaneColor[3]=.25),pd.isNumeric(e.groundPlaneOpacity)&&(this.groundPlaneColor[3]=pd.constrainTo(this.groundPlaneOpacity,0,1)),this.showGroundGrid=pd.toBoolean(e.showGroundGrid,!0),this.groundGridMajorColor=e.groundGridMajorColor||[0,.3,.6,1],this.groundGridMinorColor=e.groundGridMinorColor||[.2,.4,.8,.55],this.groundGridCenter=e.groundGridCenter||l.create(),this.groundGridLevel=pd.toNumber(e.groundGridLevel,null),this._groundGridSizeMajor=1e3,this._groundGridSizeMinor=200,this._groundMesh=null,this.showSkyBox=pd.toBoolean(e.showSkyBox,!1),this._skyBrightness=1,this._skyboxMesh=null,this._shareDynamicUniformsList=[],this._cachedUniforms={},this.shareDynamicUniforms(this.surfaceMaterial),e=null},pdGL.Environment.prototype.updateDynamicShading=function(e){var t,i,n=!1;return!this.hasOwnShadowMap||!this.shadowMap||!this.updateShadows&&this.shadowMatrix||(t=e.nodes[pdGL.PHASE.SHADOWS]||e)&&0<=this.sunDirection.z&&(i=this,!t.hasChanged&&t.boundingBox||(t.boundingBox=t.getAABB(t.boundingBox),t.hasChanged=!1),pdGL.Environment.fitViewToBoundingBox(this.sunDirection,t.boundingBox,100*e.modelSize),this.shadowMatrix=pd3D.Matrix.multiply(gl.projectionMatrix,gl.modelviewMatrix,this.shadowMatrix),this.shadowMap.drawTo(function(){s(t,i.depthMapMaterial)}),n=!0),this.updateShadows&&(this.sunPosition=pd3D.Vector.multiply(this.sunDirection,100*e.modelSize,this.sunPosition),this.updateShadows=!1),n},pdGL.Environment.prototype.updateDynamicSky=function(){var e,t,i,n=this.surfaceMaterial._shader,s=this._cachedUniforms,a=this.ambientFactor,r=this.sunDirection.z,o=.10452846<r?1:0<r?pd.mapAndConstrainTo(r,0,.10452846,.5,1):pd.mapAndConstrainTo(r,-.30901699,0,0,.5);return this.skyModel?(a=(e=this.skyModel.directBeamIlluminance+1)<1e3?pd.mapAndConstrainTo(e,0,1e3,1,.85):pd.mapAndConstrainTo(e,1e3,65e3,.85,.25),o*=pd.mapAndConstrainTo(e,0,65e3,.85,1.1)):this.showSkyBox&&(a=(e=1-this.ambientFactor)<.25?pd.mapAndConstrainTo(e,0,.25,1,.85):pd.mapAndConstrainTo(e,.25,1,.85,.25),o*=pd.mapAndConstrainTo(e,0,1,.85,1.1)),gl.clearColor(o*this.backgroundColor[0],o*this.backgroundColor[1],o*this.backgroundColor[2],this.backgroundColor[3]),t=this.specularFactor*o,s[i="specularColor"]?((e=s[i].value)[0]=t,e[1]=t,e[2]=t):(e=s[i]=n.createCachedUniform(i,[t,t,t])).shared=!0,t=a*o,s[i="ambientColor"]?((e=s[i].value)[0]=t,e[1]=t,e[2]=t):(e=s[i]=n.createCachedUniform(i,[t,t,t])).shared=!0,t=this.surfaceShininess,s[i="shininess"]?s[i].value=t:(e=s[i]=n.createCachedUniform(i,t)).shared=!0,t=pd.constrainTo(o*(1-a*a)*pd.mapAndConstrainTo(r,0,.10471975512,0,2),0,1),s[i="sunIntensity"]?s[i].value=t:(e=s[i]=n.createCachedUniform(i,t)).shared=!0,this._skyBrightness=o,this},pdGL.Environment.prototype.updateDynamicUniforms=function(){var e,t,i,n=this.surfaceMaterial._shader,s=this._cachedUniforms;this.projectedSunPosition=gl.modelviewMatrix.transformPoint(this.sunPosition,this.projectedSunPosition),s[t="sunPosition"]?((e=s[t].value)[0]=this.projectedSunPosition.x,e[1]=this.projectedSunPosition.y,e[2]=this.projectedSunPosition.z):(e=s[t]=n.createCachedUniform(t,this.projectedSunPosition)).shared=!0,this.shadowMap&&this.shadowMatrix&&(i=gl.getModelviewProjectionMatrix().inverse(),this.shadowMatrixProjected=pd3D.Matrix.multiply(this.shadowMatrix,i,this.shadowMatrixProjected),s[t="shadowMatrix"]?this.shadowMatrixProjected.copyToColumnMajorArray(s[t].value):(e=s[t]=n.createCachedUniform(t,this.shadowMatrixProjected)).shared=!0),s[t="opacity"]?s[t].value=this.surfaceOpacity:(e=s[t]=n.createCachedUniform(t,this.surfaceOpacity)).shared=!0,this.meshColorMaterial.uniform("opacity",this.outlineOpacity),this.outlineMaterial.uniform("opacity",this.outlineOpacity)},pdGL.Environment.prototype.shareDynamicUniforms=function(e){if(1==arguments.length){if(!(e instanceof pdGL.Material))throw new Error("Only pdGL.Material objects can share an environment's dynamic uniforms.");this._shareDynamicUniformsList.indexOf(e)<0&&this._shareDynamicUniformsList.push(e)}else if(this._shareDynamicUniformsList.length){for(var t=0,i=this._shareDynamicUniformsList.length;t<i;++t)this._shareDynamicUniformsList[t].setCachedUniforms(this._cachedUniforms);this._shareDynamicUniformsList.length=0}return this},pdGL.Environment.prototype.updateViewChange=function(){},pdGL.Environment.prototype.calculateGridSizeAndCenter=function(e){var t,i,n,s,a,r,o;e&&(this.showGroundGrid||this.showGroundPlane)&&(t=pd.Dimension.type==pd.DimensionType.IMPERIAL,i=1,o=.2,o=(n=e.preferredGroundGridSize)<.001*e.modelSize||n>.499*e.modelSize?(r=(s=Math.log10(e.modelSize))<0?Math.ceil(s):Math.floor(s),a=Math.pow(10,r),r=s-r,t?(a*=.3048,r<.397940008672038?(i=.5*a)/5:r<.698970004336019?(i=+a)/6:(i=3*a)/6):r<.397940008672038?(i=.25*a,.05*a):r<.698970004336019?(i=.5*a,.1*a):(i=+a,.2*a)):(i=n)/(t?3:5),gl.orbitalView&&0<gl.orbitalView.snapGrid?(this._groundGridSizeMinor=pd.snapTo(o,gl.orbitalView.snapGrid),this._groundGridSizeMajor=pd.snapTo(i,this._groundGridSizeMinor)):(this._groundGridSizeMajor=i,this._groundGridSizeMinor=o),l.set(this.groundGridCenter,pd.snapTo(e.modelCenter.x,i),pd.snapTo(e.modelCenter.y,i),pd.toNumber(this.groundGridLevel,e.boundingBox.min.z)))},pdGL.Environment.prototype.updateGroundPlane=function(e){if(e&&(this.showGroundGrid||this.showGroundPlane)){this.calculateGridSizeAndCenter(e);var t=this._groundGridSizeMajor,i=this._groundGridSizeMinor,t=Math.max(1,e.modelSize/t),n=(Math.ceil(1.4*t)+.001)/t;this._groundMesh||(this._groundMesh=new pd3D.Mesh({triangles:!0,normals:!0,colors:!0,lines:!0,twoSided:!1}));var s=this._groundMesh;if(s.reuseStart(),s.normal([0,0,1]),s.color(this.groundPlaneColor,this.groundPlaneOpacity),s.addVertex([-n,-n,0]),s.addVertex([n,-n,0]),s.addVertex([n,n,0]),s.addVertex([-n,n,0]),s.addTriangle(0,1,2),s.addTriangle(0,2,3),s.normal([0,0,-1]),s.color([.5*this.groundPlaneColor[0],.5*this.groundPlaneColor[1],.5*this.groundPlaneColor[2],.5]),s.addVertex([-n,-n,0]),s.addVertex([n,-n,0]),s.addVertex([n,n,0]),s.addVertex([-n,n,0]),s.addTriangle(4,6,5),s.addTriangle(4,7,6),this.showGroundGrid){var a=1/t;s.color(this.groundGridMajorColor),s.normal([0,0,1]);for(var r=0;r<=n;r+=a)s.addLine(s.addVertex([r,-n,0]),s.addVertex([r,n,0])),s.addLine(s.addVertex([-n,r,0]),s.addVertex([n,r,0])),0<r&&(s.addLine(s.addVertex([-r,-n,0]),s.addVertex([-r,n,0])),s.addLine(s.addVertex([-n,-r,0]),s.addVertex([n,-r,0])));(a=i/e.modelSize)<.01&&(a=.2/t),s.color(this.groundGridMinorColor);for(r=0;r<=n;r+=a)s.addLine(s.addVertex([r,-n,0]),s.addVertex([r,n,0])),s.addLine(s.addVertex([-r,-n,0]),s.addVertex([-r,n,0])),s.addLine(s.addVertex([-n,r,0]),s.addVertex([n,r,0])),s.addLine(s.addVertex([-n,-r,0]),s.addVertex([n,-r,0]))}s.reuseEnd(),s.compile()}return this.updateSkyBox(e),this},pdGL.Environment.prototype.renderGroundPlane=function(e,t){var i,n,s;return e&&(this.showGroundGrid||this.showGroundPlane)&&(this._groundMesh||this.updateGroundPlane(e),i=e.modelSize,n=this.groundGridCenter,s=this._groundMesh,t=gl.orbitalView.camera.z<n[2],gl.pushMatrix(),gl.depthMask(!1),gl.translate(n[0],n[1],n[2]-(t?.001*i:0)),gl.scale(i,i,1),this.showGroundPlane&&1e-6<this.groundPlaneOpacity&&e.environment.surfaceMaterial.pushUniform("shadowOpacity",pd.mapAndConstrainTo(this.surfaceOpacity,0,1,.5,.75)).renderSurfaces(s).endRender().popUniform(),this.showGroundGrid&&e.environment.meshColorMaterial.pushUniform("opacity",pd.mapAndConstrainTo(this.groundPlaneOpacity*this.surfaceOpacity,0,1,.2,.6)).renderOutlines(s).endRender().popUniform(),gl.depthMask(!0),gl.popMatrix()),this},pdGL.Environment.prototype.updateSkyBox=function(e){return e&&this.showSkyBox&&(n=n||(n||new pdGL.Shader("\nvarying vec3 vRayDir;\n\nvoid main() {\n    gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\n    vRayDir = gl_Vertex.xyz;\n}\n","\nconst float PI = 3.141592653589793238463;\n#define iSteps 16\n#define jSteps 8\n\nuniform vec3 uSunDir;\nuniform float uSkyBrightness;\nvarying vec3 vRayDir;\n\nfloat atan2(in float y, in float x) {\n    return x == 0.0 ? sign(y) * (PI / 2.0) : atan(y, x);\n}\nfloat map(float value, float vstart, float vstop, float ostart, float ostop) {\n    float diff = vstop - vstart;\n    return diff == 0.0 ? (ostart + ostop) * 0.5 : ostart + ((ostop - ostart) * ((value - vstart) / diff));\n}\n\nvec2 rsi(vec3 r0, vec3 rd, float sr) {\n    float a = dot(rd, rd);\n    float b = 2.0 * dot(rd, r0);\n    float c = dot(r0, r0) - (sr * sr);\n    float d = (b*b) - 4.0*a*c;\n    if (d < 0.0) return vec2(1e5,-1e5);\n    return vec2(\n        (-b - sqrt(d))/(2.0*a),\n        (-b + sqrt(d))/(2.0*a)\n    );\n}\n\nvec3 atmosphere(vec3 r, vec3 r0, vec3 pSun, float iSun, float rPlanet, float rAtmos, vec3 kRlh, float kMie, float shRlh, float shMie, float g) {\n\n    pSun = normalize(pSun);\n    r = normalize(r);\n\n    vec2 p = rsi(r0, r, rAtmos);\n    if (p.x > p.y) return vec3(0,0,0);\n    p.y = min(p.y, rsi(r0, r, rPlanet).x);\n    float iStepSize = (p.y - p.x) / float(iSteps);\n\n    float iTime = 0.0;\n\n    vec3 totalRlh = vec3(0,0,0);\n    vec3 totalMie = vec3(0,0,0);\n\n    float iOdRlh = 0.0;\n    float iOdMie = 0.0;\n\n    float mu = dot(r, pSun);\n    if (mu > 0.99996) return vec3(iSun, iSun, iSun * 0.5);\n\n    float mumu = mu * mu;\n    float gg = g * g;\n    float pRlh = 3.0 / (16.0 * PI) * (1.0 + mumu);\n    float pMie = 3.0 / (8.0 * PI) * ((1.0 - gg) * (mumu + 1.0)) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));\n\n    for (int i = 0; i < iSteps; i++) {\n\n        vec3 iPos = r0 + r * (iTime + iStepSize * 0.5);\n\n        float iHeight = length(iPos) - rPlanet;\n\n        float odStepRlh = exp(-iHeight / shRlh) * iStepSize;\n        float odStepMie = exp(-iHeight / shMie) * iStepSize;\n\n        iOdRlh += odStepRlh;\n        iOdMie += odStepMie;\n\n        float jStepSize = rsi(iPos, pSun, rAtmos).y / float(jSteps);\n\n        float jTime = 0.0;\n\n        float jOdRlh = 0.0;\n        float jOdMie = 0.0;\n\n        for (int j = 0; j < jSteps; j++) {\n\n            vec3 jPos = iPos + pSun * (jTime + jStepSize * 0.5);\n\n            float jHeight = length(jPos) - rPlanet;\n\n            jOdRlh += exp(-jHeight / shRlh) * jStepSize;\n            jOdMie += exp(-jHeight / shMie) * jStepSize;\n\n            jTime += jStepSize;\n\n        }\n\n        vec3 attn = exp(-(kMie * (iOdMie + jOdMie) + kRlh * (iOdRlh + jOdRlh)));\n\n        totalRlh += odStepRlh * attn;\n        totalMie += odStepMie * attn;\n\n        iTime += iStepSize;\n\n    }\n\n    return iSun * ((pRlh * kRlh * totalRlh) + (pMie * kMie * totalMie));\n\n}\n\nvoid main() {\n\n    vec3 color = atmosphere(\n        vRayDir.xzy,                    // Ray direction.\n        vec3(0,6372e3,0),               // Ray origin.\n        uSunDir.xzy,                    // Direction of the sun.\n        22.0,                           // Intensity of the sun.\n        6371e3,                         // Radius of the planet in meters.\n        6471e3,                         // Radius of the atmosphere in meters.\n        vec3(5.5e-6, 13.0e-6, 22.4e-6), // Rayleigh scattering coefficient.\n        21e-6,                          // Mie scattering coefficient.\n        8e3,                            // Rayleigh scale height.\n        1.2e3,                          // Mie scale height.\n        0.758                           // Mie preferred scattering direction.\n    );\n\n    color = 1.0 - exp(-color);\n\n    float a = atan2(vRayDir.z, length(vRayDir.xy));\n\n    color = (sin(a) * 0.5 * uSkyBrightness) + color;\n\n    gl_FragColor = vec4(clamp(color, 0.0, 1.0), 1.0);\n\n}\n")),this._skyboxMesh||(this._skyboxMesh=new pd3D.Mesh({twoSided:!1,defaultColor:[1,1,1,1],triangles:!0,normals:!1,colors:!1,lines:!1}),(e=this._skyboxMesh).reuseStart(),e.addVertex([-1,-1,0]),e.addVertex([1,-1,0]),e.addVertex([1,1,0]),e.addVertex([-1,1,0]),e.addVertex([-1,-1,1]),e.addVertex([1,-1,1]),e.addVertex([1,1,1]),e.addVertex([-1,1,1]),e.addTriangle(0,4,5),e.addTriangle(0,5,1),e.addTriangle(1,5,6),e.addTriangle(1,6,2),e.addTriangle(2,6,7),e.addTriangle(2,7,3),e.addTriangle(3,7,4),e.addTriangle(3,4,0),e.addTriangle(4,7,6),e.addTriangle(4,6,5),e.reuseEnd(),e.compile())),this},pdGL.Environment.prototype.renderSkyBox=function(e){var t,i;return e&&this.showSkyBox&&this._skyboxMesh&&(t=gl.orbitalView.camera,i=.45*gl.orbitalView._farField,this._skyboxMesh||this.updateSkyBox(e),gl.pushMatrix(),gl.translate(t.x,t.y,t.z),gl.scale(i,i,i),n.uniforms({uSkyBrightness:this._skyBrightness,uSunDir:this.sunDirection}).draw(this._skyboxMesh,gl.TRIANGLES),gl.popMatrix()),this},pdGL.Environment.fitViewToBoundingBox=function(e,t,i){for(var n=e.multiply(i),i=t.min.add(t.max).divide(2),s=i.subtract(n).unit(),a=s.cross(new pd3D.Vector(0,1,0)).unit(),r=a.cross(s),o=Number.MAX_VALUE,l=-Number.MAX_VALUE,d=0,h=0,c=0,p=0,u=0;u<8;++u)var g=pd3D.Vector.lerp(t.min,t.max,new pd3D.Vector(!!(1&u),!!(2&u),!!(4&u))).subtract(n),m=g.dot(s),f=g.dot(a)/m,g=g.dot(r)/m,d=Math.min(d,f),c=Math.min(c,g),h=Math.max(h,f),p=Math.max(p,g),o=Math.min(o,m),l=Math.max(l,m);o*=.999,l*=1.001,gl.matrixMode(gl.PROJECTION),gl.loadIdentity(),gl.frustum(d*o,h*o,c*o,p*o,o,l),gl.matrixMode(gl.MODELVIEW),gl.loadIdentity(),gl.lookAt(n.x,n.y,n.z,i.x,i.y,i.z,0,1,0)};var i=null;pdGL.Scene3D=function(e,t){t=t||{},pd3D.Node.call(this,e,"Scene"),this.active=!1,this.nodes=[],this.nodes[pdGL.PHASE.SHADOWS]=null,this.nodes[pdGL.PHASE.BACKGROUND]=null,this.nodes[pdGL.PHASE.OUTLINES]=null,this.nodes[pdGL.PHASE.OUTLINES_MESH]=null,this.nodes[pdGL.PHASE.RENDER_FIRST]=null,this.nodes[pdGL.PHASE.GROUND_GRID]=null,(this.nodes[pdGL.PHASE.SURFACES]=this).nodes[pdGL.PHASE.TRANSPARENT_SURFACES]=null,this.nodes[pdGL.PHASE.RENDER_LAST]=null,this.nodes[pdGL.PHASE.RENDER_OVERLAY]=null,this.nodes[pdGL.PHASE.HUD]=null,this.environment=t.environment||new pdGL.Environment(t),t.useOwnView&&(this._previousOrbitalView=gl.orbitalView,this.orbitalView=new pdGL.OrbitalView(t),this.useOwnView=!0),this.boundingBox=t.boundingBox||null,this._aabbList=[],this.selectRadius=pd.toNumber(t.selectRadius,20),this.modelSize=1,this.defaultZoom=pd.toNumber(t.defaultZoom,1),this.modelUnit=.01,this.modelCenter=t.modelCenter||new pd3D.Vector(0,0,0),this.modelCenterHeight=pd.toNumber(t.modelCenterHeight,.25),this.preferredModelSnap=pd.toNumber(t.preferredModelSnap,0),this.preferredGroundGridSize=pd.toNumber(t.preferredGroundGridSize,0),this.hotspots=[],this.hoveredHotspotIndex=-1,this.activeHotspotIndex=-1,this.activeHotspot=null,this._preSelectedHotspot=null,this.dimensionManager=t.dimensionManager||null,this.handleRenderGroundPlane=t.handleRenderGroundPlane||null,this.handleUpdateDynamicShading=t.handleUpdateDynamicShading||null,this.handleUpdateDynamicUniforms=t.handleUpdateDynamicUniforms||null,this.handleUpdateDynamicSky=t.handleUpdateDynamicSky||null,this.callbackOnSelectHotspot=t.callbackOnSelectHotspot||null,this.callbackOnDraw=t.callbackOnDraw||null,this.ignoreSelection=pd.toBoolean(t.ignoreSelection,!1),this.enhanceHiddenLines=pd.toBoolean(t.enhanceHiddenLines,!1),this._activeSelectionType=0,pd.addSimpleEventHandling(this),t=null},pdGL.Scene3D.prototype=Object.create(pd3D.Node.prototype),pdGL.Scene3D.prototype.constructor=pdGL.Scene3D;var a=[.85,.85,.85,1];pdGL.Scene3D.prototype.createShadowMap=function(e,t){var i=this.environment;return t=t||gl.RGB,e=pd.constrainTo(pd.toInteger(e,1024),8,4096),i.shadowMap=new pdGL.Texture(e,e,{format:t}),"shadowMatrix"in i.surfaceMaterial._uniforms||((t=pdGL.Material.BlinnPhongColorShadow({name:"Scene3D.surfaceMaterialShadow"})).uniform("color",a),this.swapMaterials(i.surfaceMaterial,t),this.emit("shadow:mtl:changed",i.surfaceMaterial,t),i.shareDynamicUniforms(t),i.surfaceMaterial=t),i.depthMapMaterial||(i.depthMapMaterial=pdGL.Material.DepthMapShader({name:"Scene3D.depthMapMaterial"})),i.shadowMap&&i.shadowMap.bind(),i.hasOwnShadowMap=!0,i.updateShadows=!0,this},pdGL.Scene3D.prototype.clearShadowMap=function(){var e,t=this.environment;return t.hasOwnShadowMap&&t.shadowMap&&"shadowMatrix"in t.surfaceMaterial._uniforms&&((e=pdGL.Material.BlinnPhongColor({name:"Scene3D.surfaceMaterial"})).uniform("color",a),this.swapMaterials(t.surfaceMaterial,e),this.emit("shadow:mtl:changed",t.surfaceMaterial,e),t.shareDynamicUniforms(e),t.surfaceMaterial=e),t.shadowMap&&t.shadowMap.unbind(),t.shadowMap=null,t.hasOwnShadowMap=!1,t.updateShadows=!1,this},pdGL.Scene3D.prototype.getSurfaceMaterial=function(){return this.environment.surfaceMaterial},pdGL.Scene3D.prototype.getOutlineMaterial=function(){return this.environment.outlineMaterial},pdGL.Scene3D.prototype.getMeshColorMaterial=function(){return this.environment.meshColorMaterial},pdGL.Scene3D.prototype.getModelSnap=function(e){return(e=e||0)<.01*this.modelUnit||e>10*this.modelUnit?pd.Dimension.type==pd.DimensionType.IMPERIAL?this.modelSize<1e3?1.5875:this.modelSize<2500?6.35:this.modelSize<1e5?25.4:this.modelSize<25e4?304.8:914.4:this.modelSize<100?.1:this.modelSize<1e3?1:this.modelSize<2500?5:this.modelSize<5e3?10:this.modelSize<5e4?50:this.modelSize<15e4?100:this.modelSize<25e4?500:1e3:e},pdGL.Scene3D.prototype.setModelSnap=function(e){return gl.orbitalView&&(gl.orbitalView.snapGrid=this.getModelSnap(e)),this.preferredModelSnap=e,this},pdGL.Scene3D.prototype.cancelPreSelection=function(){var e;return null!=this._preSelectedHotspot&&(e=this._preSelectedHotspot,this._activeSelectionType=0,this._preSelectedHotspot=null,e&&e._preSelected&&(e.cancelPreSelection(),pd.isNumeric(e._preSelectedBoxIndex)&&(e._preSelectedBoxIndex=-1)),gl.update()),this.activeHotspot&&this.activeHotspot.isPreSelected()&&(this.activeHotspot._preSelectedBoxIndex=this.activeHotspot.selectedBoxIndex,gl.update()),this};var d=0;pdGL.Scene3D.prototype.handlePointerMove=function(e){var t=e.x,i=e.y,n=0;if(this.dimensionManager&&this.dimensionManager.visible&&this.dimensionManager.active&&this.dimensionManager.isOver(t,i,this.selectRadius)&&(n=1),!n&&0<this.hotspots.length){for(var s=null,a=-1,r=0,o=this.hotspots.length;r<o;++r)if((s=this.hotspots[r]).active&&s.isOver(t,i,this.selectRadius)){a=r,n=1;break}this.setHoveredHotspotByIndex(a)}return d!=n&&(gl.canvas.style.cursor=0<n?"pointer":"inherit",d=n),!1},pdGL.Scene3D.prototype.handlePointerDown=function(e){if(0==e.button){if(e.isTouchEvent?pdGL.Hotspot3D.selectRadiusModifier=1:pdGL.Hotspot3D.selectRadiusModifier=.6,this._activeSelectionType=0,this.activeHotspot&&this.activeHotspot.visible&&this.activeHotspot.active&&this.activeHotspot.handleSelectEvent(e,!0,this.ignoreSelection))return this._activeSelectionType=1,!0;if(this.dimensionManager){var t=e.x,i=e.y;if(this.dimensionManager.visible&&this.dimensionManager.active&&this.dimensionManager.isOver(t,i,this.selectRadius))return this._activeSelectionType=2,!0}if(!this.ignoreSelection){for(var n=0,s=this.hotspots.length;n<s;++n)if(n!=this.activeHotspotIndex&&this.hotspots[n].handleSelectEvent(e,!1)){var a=this.hotspots[n];return this._preSelectedHotspot=a,this._activeSelectionType=3,a._preSelected=!0,a._selected=!1,gl.update(),!0}return!(this._preSelectedHotspot=null)}}return!1},pdGL.Scene3D.prototype.handlePointerDrag=function(e){if(!this.ignoreSelection){if(null!=this._preSelectedHotspot||this.activeHotspot&&this.activeHotspot.isPreSelected())return pdDOM.Interaction.hasMoved()&&(this.cancelPreSelection(),null!=pdGL.Hotspot3D&&pdGL.Hotspot3D.captureEvent(!1)),!0;if(2==this._activeSelectionType){if(!pdDOM.Interaction.hasMoved())return!0;this._activeSelectionType=0}if(0==e.button&&this.activeHotspot)return!pdDOM.Interaction.hasMoved()||this.activeHotspot.handleDragEvent(e)}return!1},pdGL.Scene3D.prototype.handlePointerUp=function(e){if(e.longPress)1==this._activeSelectionType&&this.activeHotspot&&this.activeHotspot.handleReleaseEvent(e),0==e.button&&this.cancelPreSelection();else if(!this.ignoreSelection&&(0==e.button||e.isTouchEvent)){var t=e.x,i=e.y;if(1==this._activeSelectionType&&this.dimensionManager&&!pdDOM.Interaction.hasMoved()&&this.dimensionManager.visible&&this.dimensionManager.active&&this.dimensionManager.isOver(t,i,this.selectRadius)&&(this._activeSelectionType=2),2==this._activeSelectionType&&!e.shiftKey&&this.dimensionManager&&this.dimensionManager.visible&&this.dimensionManager.active){this.activeHotspot&&this.activeHotspot.cancelPreSelection();var n=this.dimensionManager.findClickPoint(t,i,this.selectRadius);return n&&this.dimensionManager.handleClickEvent(e,n),gl.canvas.style.cursor="pointer",d=0,!1}null!=this._preSelectedHotspot&&3==this._activeSelectionType?((n=this._preSelectedHotspot)._preSelected&&this.selectHotspot(n),n._preSelected=!1):this.activeHotspot&&(this.activeHotspot.handleReleaseEvent(e),this.activeHotspot&&!this.activeHotspot.getSelected()&&this.selectHotspotByIndex(-1))}return this._preSelectedHotspot&&(this._preSelectedHotspot=null,gl.update()),this.emit("pointer:up",e),!1},pdGL.Scene3D.prototype.includeInBoundingBoxList=function(e){return e&&"function"==typeof e.getAABB&&this._aabbList.indexOf(e)<0&&this._aabbList.push(e),this},pdGL.Scene3D.prototype.removeFromBoundingBoxList=function(e){e=this._aabbList.indexOf(e);return-1<e&&this._aabbList.splice(e,1),this},pdGL.Scene3D.prototype.clearBoundingBoxList=function(){return this._aabbList.length=0,this};var r={min:new pd3D.Vector,max:new pd3D.Vector};pdGL.Scene3D.prototype.updateBoundingBox=function(e,t){var i=!1;if(e||this.hasChanged||!this.boundingBox){if(t=t||this,r.min.init(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.max.init(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=this.getAABB(r),0<t._aabbList.length)for(var n=0,s=t._aabbList.length;n<s;++n)t._aabbList[n].getAABB&&t._aabbList[n].getAABB(r);r.max.x<r.min.x&&(r.max.x=r.max.y=6e3,r.min.x=r.min.y=-6e3,r.max.z=5e3,r.min.z=0),t.emit("bbox:changing",r),t.boundingBox?r.min.closeTo(t.boundingBox.min)&&r.max.closeTo(t.boundingBox.max)||(t.boundingBox.min.init(r.min),t.boundingBox.max.init(r.max),i=!0):(t.boundingBox={min:new pd3D.Vector(r.min),max:new pd3D.Vector(r.max)},i=!0),i&&t.emit("bbox:changed",t.boundingBox)}return i},pdGL.Scene3D.prototype.checkBoundingBox=function(e,t){if(e||this.hasChanged||!this.boundingBox){e=(t=t||this).updateBoundingBox(e,t);return t.modelSize=t.boundingBox.max.distanceTo(t.boundingBox.min),t.modelUnit=.01*t.modelSize,t.hasChanged=!1,t.modelCenter||(t.modelCenter=new pd3D.Vector),t.modelCenter.init(.5*(t.boundingBox.max.x+t.boundingBox.min.x),.5*(t.boundingBox.max.y+t.boundingBox.min.y),Math.max(0,t.boundingBox.min.z+this.modelCenterHeight*(t.boundingBox.max.z-t.boundingBox.min.z))),e}return!1},pdGL.Scene3D.prototype.fitGroundPlane=function(e){return this.checkBoundingBox(e),this.environment._groundMesh&&this.environment.updateGroundPlane(this),this},pdGL.Scene3D.prototype.fitViewAnimated=function(e,n){var s=this,a=this.environment.showGroundGrid,r={},o={modelCenter:this.modelCenter.clone(),modelSize:this.modelSize,modelUnit:this.modelUnit,boundingBox:{min:this.boundingBox.min.clone(),max:this.boundingBox.max.clone()}};return this.checkBoundingBox(e,r),pd.closeTo(o.modelSize,r.modelSize,s.modelUnit)||(this.environment.showGroundGrid=!1),gl.orbitalView.hasChanged=gl.PROJECTION,gl.orbitalView.center({defaultTarget:r.modelCenter,defaultDistance:s.defaultZoom*r.modelSize,farFieldFactor:2.5/s.defaultZoom,noAnimation:!1},function(e,t){var i=1-t;return pd3D.Vector.lerp(o.modelCenter,r.modelCenter,t,s.modelCenter),pd3D.Vector.lerp(o.boundingBox.min,r.boundingBox.min,t,s.boundingBox.min),pd3D.Vector.lerp(o.boundingBox.max,r.boundingBox.max,t,s.boundingBox.max),s.modelSize=i*o.modelSize+t*r.modelSize,s.modelUnit=.01*s.modelSize,.999<t&&(s.environment.showGroundGrid=a,s.environment._groundMesh&&s.environment.updateGroundPlane(s),n&&!pd.closeTo(o.modelSize,r.modelSize,s.modelUnit)&&n(s),!0)}),this},pdGL.Scene3D.prototype.fitView=function(e,t){return this.checkBoundingBox(e),this.environment._groundMesh&&this.environment.updateGroundPlane(this),this.setModelSnap(this.preferredModelSnap),gl.orbitalView.hasChanged=gl.PROJECTION,gl.orbitalView.center({defaultTarget:this.modelCenter,defaultDistance:this.defaultZoom*this.modelSize,farFieldFactor:2.5/this.defaultZoom,noAnimation:!!t}),this},pdGL.Scene3D.prototype.attachToOrbitalView=function(e){var t=this;return!this.useOwnView&&gl.orbitalView||(this._previousOrbitalView=gl.orbitalView,this.orbitalView||(this.checkBoundingBox(),(e=e||{}).defaultTarget=this.modelCenter,e.defaultDistance=this.defaultZoom*this.modelSize,e.farFieldFactor=2.5/this.defaultZoom,this.orbitalView=new pdGL.OrbitalView(e)),gl.orbitalView=this.orbitalView),gl.orbitalView.handlePointerMove=function(e){return!!t.hotspots.length&&t.handlePointerMove(e)},gl.orbitalView.handlePointerDown=function(e){return t.handlePointerDown(e)},gl.orbitalView.handlePointerDrag=function(e){return t.handlePointerDrag(e)},gl.orbitalView.handlePointerUp=function(e){return t.handlePointerUp(e)},this.setModelSnap(this.preferredModelSnap),this.modelUnit<gl.orbitalView.snapGrid&&(gl.orbitalView.snapGrid=this.modelUnit),gl.orbitalView.scene=this},pdGL.Scene3D.prototype.detachFromOrbitalView=function(){return gl.orbitalView&&(this.hasOwnView&&this._previousOrbitalView&&gl.orbitalView.scene&&gl.orbitalView.scene.id==this.id&&(gl.orbitalView=this._previousOrbitalView),gl.orbitalView.callbackOnChange=null,gl.orbitalView.handlePointerMove=null,gl.orbitalView.handlePointerDown=null,gl.orbitalView.handlePointerDrag=null,gl.orbitalView.handlePointerUp=null,gl.orbitalView.scene=null),this},pdGL.Scene3D.prototype.activate=function(e){var t=this.environment;if(i){if(i.id==this.id&&this.active)return this;i.detachFromOrbitalView(),i.active=!1}return t.updateShadows=!0,this.attachToOrbitalView(e),this.fitView(!0,!0),this.nodes[pdGL.PHASE.GROUND_GRID]||this.handleRenderGroundPlane||!t.showGroundGrid&&!t.showGroundPlane||t._groundMesh||t.calculateGridSizeAndCenter(this),this.active=!0,i=this},pdGL.Scene3D.prototype.isValidHotspotIndex=function(e){return 0<=e&&e<this.hotspots.length},pdGL.Scene3D.prototype.setHoveredHotspotByIndex=function(e){return this.isValidHotspotIndex(this.hoveredHotspotIndex)&&(this.hotspots[this.hoveredHotspotIndex].isHovered=!1),this.hoveredHotspotIndex=e,this.isValidHotspotIndex(e)&&(this.hotspots[e].isHovered=!0),this},pdGL.Scene3D.prototype.selectHotspotByIndex=function(e){var t=null;return this.isValidHotspotIndex(e)&&(t=this.hotspots[e]),this.activeHotspot!=t&&(this.activeHotspot&&this.activeHotspot.getSelected()&&this.activeHotspot.setSelected(!1),t?(this.activeHotspotIndex=e,(this.activeHotspot=t).setSelected(!0)):(this.activeHotspotIndex=-1,this.activeHotspot=null),this.callbackOnSelectHotspot&&this.callbackOnSelectHotspot(this,this.activeHotspot),gl.update()),this},pdGL.Scene3D.prototype.selectHotspot=function(e){return this.selectHotspotByIndex(this.hotspots.indexOf(e))},pdGL.Scene3D.prototype.addHotspot=function(e,t){if(!e||!e.isHotspot)throw new Error("ERROR: Only valid pdGL.Hotspot3D objects can be added to a scene.");return this.hotspots.push(e),t&&this.selectHotspotByIndex(this.hotspots.length-1),this},pdGL.Scene3D.prototype.removeHotspot=function(e){return!e||-1<(e=this.hotspots.indexOf(e))&&(this.hotspots.splice(e,1),this.hoveredHotspotIndex==e&&(this.hoveredHotspotIndex=-1),this.activeHotspotIndex==e&&(this.activeHotspotIndex=-1,this.activeHotspot=null)),this},pdGL.Scene3D.prototype.findHotspotById=function(e,t){for(var i=t||[],n=0,s=this.hotspots.length;n<s;++n)this.hotspots[n].id==e&&i.push(this.hotspots[n]);return i},pdGL.Scene3D.prototype.findHotspotByName=function(e,t){for(var i=t||[],n=0,s=this.hotspots.length;n<s;++n)this.hotspots[n].name==e&&i.push(this.hotspots[n]);return i},pdGL.Scene3D.prototype.clearHotspots=function(){for(var e=0,t=this.hotspots.length;e<t;++e)this.hotspots[e].clear();return this.hotspots.length=0,this.hoveredHotspotIndex=-1,this.activeHotspotIndex=-1,this.activeHotspot=null,this},pdGL.Scene3D.prototype.setDimensionManager=function(e){if(e&&!(e instanceof pdGL.DimensionManager3D))throw new Error("ERROR: Only valid pdGL.DimensionManager3D objects can be added to a scene.");return this.dimensionManager=e,this},pdGL.Scene3D.prototype.clearModel=function(){return this.clearChildren(),this.clearGeometry(),this.hasChanged=!0,this},pdGL.Scene3D.prototype.clear=function(){return this.clearHotspots(),this.clearChildren(),this.clearGeometry(),this.transformMatrix=null,this.inverseMatrix=null,this.hasChanged=!0,this},pdGL.Scene3D.prototype.addNode=function(e,t){if(e)if(2!=arguments.length)for(var i=0,n=arguments.length;i<n;++i)this.addNode(e,arguments[i]);else if(pd.isArray(t))for(i=0,n=t.length;i<n;++i)this.addNode(e,t[i]);else{((t=pd.toInteger(t,pdGL.PHASE.SURFACES))<pdGL.PHASE.SHADOWS||t>pdGL.PHASE.HUD)&&(t=pdGL.PHASE.SURFACES),this.nodes[t]||(this.nodes[t]=new pd3D.Node(null,"RenderPhase"));var s=this.nodes[t];e instanceof pd3D.Mesh?s.addMesh(e,this.environment.surfaceMaterial):s.findChildrenById(e.id).length||s.addChild(e)}return this};var o=!(pdGL.Scene3D.prototype.removeNode=function(e,t){if(e)if(pd.isArray(t))for(var i=0,n=t.length;i<n;++i)this.removeNode(e,t[i]);else if((t=pd.toNumber(t,-1))>=pdGL.PHASE.SHADOWS&&t<=pdGL.PHASE.HUD)this.nodes[t]&&this.nodes[t].removeChild(e);else for(i=pdGL.PHASE.SHADOWS;i<=pdGL.PHASE.HUD;++i)this.nodes[i]&&this.nodes[i].removeChild(e);return this});pdGL.Scene3D.prototype.draw=function(){var e=this.environment,t=.001<e.surfaceOpacity,i=.001<e.outlineOpacity&&.001<e.outlineWidth,n=!1;if(!o&&gl.orbitalView){if(o=!0,this.checkBoundingBox(),pdGL.Hotspot3D.setRelativeSize(this.modelUnit),this.handleUpdateDynamicShading&&this.handleUpdateDynamicShading(this)||(this.renderPhase=pdGL.PHASE.SHADOWS,n=e.updateDynamicShading(this)),this.handleUpdateDynamicSky&&this.handleUpdateDynamicSky(this)||e.updateDynamicSky(this),gl.orbitalView.apply(n),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.enable(gl.BLEND),this.handleUpdateDynamicUniforms&&this.handleUpdateDynamicUniforms(this)||e.updateDynamicUniforms(this),e.shareDynamicUniforms(),this.callbackOnDraw&&this.callbackOnDraw(this),gl.depthMask(!1),e.showSkyBox&&e.renderSkyBox(this),null!=(n=this.nodes[pdGL.PHASE.BACKGROUND])&&(this.renderPhase=pdGL.PHASE.BACKGROUND,n.draw(pd3D.RENDER_ALL)),this.enhanceHiddenLines&&gl.depthMask(!0),i&&(gl.lineWidth(e.outlineWidth),this.renderPhase=pdGL.PHASE.OUTLINES,this.drawOutlines(e.outlineMaterial),null!=(n=this.nodes[pdGL.PHASE.OUTLINES])&&n.drawOutlines(e.outlineMaterial)),this.enhanceHiddenLines||gl.depthMask(!0),null!=(n=this.nodes[pdGL.PHASE.RENDER_FIRST])&&(this.renderPhase=pdGL.PHASE.RENDER_FIRST,n.draw(pd3D.RENDER_FIRST)),null!=(n=this.nodes[pdGL.PHASE.GROUND_GRID])?(this.renderPhase=pdGL.PHASE.GROUND_GRID,n.draw(pd3D.RENDER_ALL)):gl.orbitalView.camera.z>e.groundGridCenter[2]&&e.renderGroundPlane(this,!1),t&&(e.meshColorMaterial.uniform("opacity",e.surfaceOpacity),this.renderPhase=pdGL.PHASE.SURFACES,this.drawSurfaces(),null!=(n=this.nodes[pdGL.PHASE.TRANSPARENT_SURFACES])&&(this.renderPhase=pdGL.PHASE.TRANSPARENT_SURFACES,n.drawSurfaces())),!this.nodes[pdGL.PHASE.GROUND_GRID]&&gl.orbitalView.camera.z<e.groundGridCenter[2]&&(this.renderPhase=pdGL.PHASE.GROUND_GRID,this.handleRenderGroundPlane?this.handleRenderGroundPlane(this,!0):e.renderGroundPlane(this,!0)),i&&(gl.lineWidth(e.outlineWidth),this.renderPhase=pdGL.PHASE.OUTLINES,this.drawOutlines(e.outlineMaterial),null!=(n=this.nodes[pdGL.PHASE.OUTLINES])&&n.drawOutlines(e.outlineMaterial),null!=(n=this.nodes[pdGL.PHASE.OUTLINES_MESH])&&(e.meshColorMaterial.uniform("opacity",e.outlineOpacity),this.renderPhase=pdGL.PHASE.OUTLINES_MESH,n.drawOutlines(e.meshColorMaterial))),null!=(n=this.nodes[pdGL.PHASE.RENDER_LAST])&&(this.renderPhase=pdGL.PHASE.RENDER_LAST,n.draw(pd3D.RENDER_LAST)),null!=(n=this.nodes[pdGL.PHASE.RENDER_OVERLAY])&&(this.renderPhase=pdGL.PHASE.RENDER_OVERLAY,gl.disable(gl.DEPTH_TEST),n.draw(pd3D.RENDER_ALL),gl.enable(gl.DEPTH_TEST)),0<this.hotspots.length){gl.polygonOffset(-1,1);for(var s=0,a=this.hotspots.length;s<a;++s){var r=this.hotspots[s];r.visible&&r.draw()}this.activeHotspot&&this.activeHotspot.visible&&(gl.disable(gl.DEPTH_TEST),i=this.activeHotspot._opacity,this.activeHotspot._opacity=pd.mapAndConstrainTo(e.surfaceOpacity,.2,1,.5,.9),this.activeHotspot.draw(),this.activeHotspot._opacity=i,gl.enable(gl.DEPTH_TEST)),gl.polygonOffset(1,1)}return null!=(n=this.nodes[pdGL.PHASE.HUD])&&(gl.orbitalView.startOverlay2D(),this.renderPhase=pdGL.PHASE.HUD,n.draw(pd3D.RENDER_ALL),gl.orbitalView.endOverlay2D()),gl.disable(gl.BLEND),gl.cleanup(),o=!1,this}console.warn("REQUEST TO DRAW SCENE WHILST DRAWING...")},pdGL.Scene3D.getActiveEnvironment=function(){return i?i.environment:null},pdGL.Scene3D.getActiveScene=function(){return i}}(),function(){var m=pd3D.VectorArray,r=pd3D.PlaneArray,f=pd3D.BBoxArray,n=Math.PI/1.5,s=Math.PI/3,u=[4,1],o=15,e=null;function g(){return e=e||pdGL.Material.FixedColorUniformPointSize({name:"DefaultMaterialHotspot",uniforms:{color:[1,0,0,1],opacity:1}})}var t=null;function l(){return t=t||pd3D.Shapes.sphere({radius:.075,detail:3})}function p(e,t){var i=t?t.metaKey:pdGL.keys.META,n=t?t.ctrlKey:pdGL.keys.CONTROL,s=t?t.shiftKey:pdGL.keys.SHIFT,a=10*e,r=.2*e,t=pdGL.Scene3D.getActiveScene();return null!=t?a=t.environment._groundGridSizeMinor:pd.Dimension.type==pd.DimensionType.IMPERIAL&&(r=1.5875,900<e?(a=4572,e=25.4):300<e?(a=914.4,e=25.4):15<e?(a=304.8,e=25.4):(e=1.5875,a=25.4)),s?a:n||i?r:e}function c(e,t){pd3D.Node.call(this,t,"Manipulator3D"),this.type=pdGL.MANIPULATOR_TYPE.UNKNOWN,this.parent=e,this.modelPos=[0,0,0],this.canvasPos=[0,0,0],this.flipAngle=0,this.allowSnap=!0,this.axis=0,this.transform=this.transformMatrix=new pd3D.Transform,this.relativeOffset=0,this.fixedPlane=pd3D.AXIS.NONE,this.axialXYOnly=!1,this.getSelectionPlane=this._getSelectionPlaneByView,this.updateRotation=this._updateRotationByView}pdGL.MANIPULATOR_TYPE={UNKNOWN:0,PUSH_PULL:1,SQUARE:2,CIRCLE:3,SECTION:4,TOUCH:5,ARROW:6},((c.prototype=Object.create(pd3D.Node.prototype)).constructor=c).prototype.getSnapWithKeyModifier=function(e,t){var i=t?t.metaKey:pdGL.keys.META,n=t?t.ctrlKey:pdGL.keys.CONTROL,s=t?t.shiftKey:pdGL.keys.SHIFT,a=10*e,r=.2*e,t=pdGL.Scene3D.getActiveScene();return null!=t?a=t.environment._groundGridSizeMinor:pd.Dimension.type==pd.DimensionType.IMPERIAL&&(r=1.5875,900<e?(a=4572,e=25.4):300<e?(a=914.4,e=25.4):15<e?(a=304.8,e=25.4):(e=1.5875,a=25.4)),s?a:n||i?r:e},c.prototype.updatePos=function(){var e,t;return this.parent&&(e=this.parent.modelPos,pd.isArray(this.vector)?(t=this.relativeOffset*this.parent.relativeSize,this.modelPos[0]=e[0]+this.vector[0]*t,this.modelPos[1]=e[1]+this.vector[1]*t,this.modelPos[2]=e[2]+this.vector[2]*t):pd.isArray(this.offsetVector)?(t=this.parent.relativeSize,this.type==pdGL.MANIPULATOR_TYPE.TOUCH?15<this.flipAngle?(this.modelPos[0]=e[0]+this.offsetVector[2]*t,this.modelPos[1]=e[1]+this.offsetVector[0]*t,this.modelPos[2]=e[2]+this.offsetVector[1]*t):5<this.flipAngle?(this.modelPos[0]=e[0]+this.offsetVector[0]*t,this.modelPos[1]=e[1]+this.offsetVector[2]*t,this.modelPos[2]=e[2]+this.offsetVector[1]*t):(this.modelPos[0]=e[0]+this.offsetVector[0]*t,this.modelPos[1]=e[1]+this.offsetVector[1]*t,this.modelPos[2]=e[2]+this.offsetVector[2]*t):(this.modelPos[0]=e[0]+this.offsetVector[0]*t,this.modelPos[1]=e[1]+this.offsetVector[1]*t,this.modelPos[2]=e[2]+this.offsetVector[2]*t)):(this.modelPos[0]=e[0],this.modelPos[1]=e[1],this.modelPos[2]=e[2])),this},c.prototype._getSelectionPlaneByView=function(){if(this.fixedPlane)switch(Math.abs(this.fixedPlane)){case 1:return r.createFromNormalAndPoint(m.unitX,this.modelPos);case 2:return r.createFromNormalAndPoint(m.unitY,this.modelPos);case 3:return r.createFromNormalAndPoint(m.unitZ,this.modelPos)}return function(e,t){if(t){t=Math.abs(gl.orbitalView.cameraAzi);return t<45||135<t?r.createFromNormalAndPoint(m.unitX,e):r.createFromNormalAndPoint(m.unitY,e)}return r.createFromNormalAndPoint(m.unitZ,e)}(this.modelPos,this.parent.isViewedHorizontal)},c.prototype._getSelectionPlaneByVector=function(){if(3==this.axis||-3==this.axis){var e=Math.abs(gl.orbitalView.cameraAzi);if(45<=e&&e<=135)return r.createFromNormalAndPoint(m.unitY,this.modelPos)}return r.createFromNormalAndPoint(this.flipAngle?this.uVector:this.vVector,this.modelPos)},c.prototype._getSelectionPlaneByPlaneEqn=function(){if(this.parent.planeEqn)switch(this.axis){default:return r.createFromNormalAndPoint(this.parent.planeEqn,this.modelPos);case 1:return r.createFromNormalAndPoint(this.uVector,this.modelPos);case 2:return r.createFromNormalAndPoint(this.vVector,this.modelPos)}return this._getSelectionPlaneByView()},c.prototype.setTransform=function(){throw new Error("Please use 'setTranslation()', 'setAxialRotation()' or 'setScale()' methods instead as only these can be accumulated.")},c.prototype.setTranslation=function(e,t,i){return 1==arguments.length?this.transform.setTranslation(e):this.transform.setTranslation(e,t,i),this},c.prototype.setVectorRotation=function(e,t,i,n){return 2==arguments.length?this.transform.setVectorRotation(e,t):this.transform.setVectorRotation(e,t,i,n),this},c.prototype.setAxialRotation=function(e,t,i){return 1==arguments.length?this.transform.setAxialRotation(e):this.transform.setAxialRotation(e,t,i),this},c.prototype.setScale=function(e){return this.transform.setScale(e,e,e),this},c.prototype._updateRotationByView=function(){var e,t=0;if(this.updatePos(),this.fixedPlane)switch(Math.abs(this.fixedPlane)){case 1:t=10;break;case 2:t=20;break;case 3:t=0}else this.parent.isViewedHorizontal&&(t=(e=Math.abs(gl.orbitalView.cameraAzi))<45||135<e?20:10);return this.flipAngle!=t&&(5<t?this.axialXYOnly?15<t?this.transform.setAxialRotation(90,0,0):this.transform.setAxialRotation(0,90,0):15<t?this.transform.setAxialRotation(0,-90,0):this.transform.setAxialRotation(90,0,0):this.transform.setAxialRotation(0,0,0),this.flipAngle=t),this},c.prototype._updateRotationByVector=function(e,t){var i;return this.updatePos(),e||(i=this.flipAngle,1==this.axis||-1==this.axis||2==this.axis||-2==this.axis?i=this.parent.isViewedHorizontal?90:0:3==this.axis||-3==this.axis?i=(e=Math.abs(gl.orbitalView.cameraAzi))<44.99?-90:134.99<e?90:gl.orbitalView.cameraAzi<-44.99?180:0:this.vVector&&(i=(t=m.angleBetweenVectors(t,this.vVector))<s||n<t?0:90),this.flipAngle!=i&&(this.transform.setVectorRotation(i,this.vector),this.flipAngle=i)),this},c.prototype._updateRotationByPlaneEqn=function(e,t){return this.updatePos(),e?this:this.parent.planeEqn?(this.type==pdGL.MANIPULATOR_TYPE.ARROW?(a=(r=m.angleBetweenVectors(t,this.vVector)*pd.Const.RAD2DEG)<o||180-o<r?0:90,this.axis=a<45?2:1,this.flipAngle!=a&&(this.transform.setVectorRotation(a,this.vector),this.flipAngle=a)):(i=0,n=-90,s=this.parent.planeEqn,a=pd3D.VectorArray.length(s),this.axis=0,1e-12<a&&(i=s[0]*s[0]<1e-12?0:90+Math.atan2(s[1],s[0])*pd.Const.RAD2DEG,n=90-Math.asin(s[2]/a)*pd.Const.RAD2DEG),((r=m.angleBetweenVectors(t,this.uVector)*pd.Const.RAD2DEG)<o||180-o<r)&&(this.axis=1,i+=90),((r=m.angleBetweenVectors(t,this.vVector)*pd.Const.RAD2DEG)<o||180-o<r)&&(this.axis=2,n-=90),this.transform.setAxialRotation(n,0,i)),this):this._updateRotationByView(e,t);var i,n,s,a,r},c.prototype.isOver=function(e,t,i){return gl.orbitalView.modelToCanvas(this.canvasPos,this.modelPos),Math.abs(e-this.canvasPos[0])<i&&Math.abs(t-this.canvasPos[1])<i},c.prototype.distanceFromRay=function(e,t,i){return i=i||m.create(),r.intersect(i,e,t,this.getSelectionPlane())?m.distancePointToPoint(this.modelPos,i):Number.MAX_VALUE},c.prototype.distanceFromPoint=function(e){return m.distancePointToPoint(this.modelPos,e)},c.prototype.drag=function(e,t){var i=this.parent;if(i._dragReferencePos&&i._dragIntersection){var n=m.create();if(r.intersect(n,e,t,this.getSelectionPlane())){e=i._dragReferencePos,t=i._dragIntersection,n=[e[0]+(n[0]-t[0]),e[1]+(n[1]-t[1]),e[2]+(n[2]-t[2])];return this.allowSnap&&0<gl.orbitalView.snapGrid&&(t=p(gl.orbitalView.snapGrid),n[0]=pd.snapTo(n[0],t),n[1]=pd.snapTo(n[1],t),this.parent.isViewedHorizontal&&(n[2]=pd.snapTo(n[2],t))),i._checkToMoveModelPos(n,this)}}return!1},c.prototype._dragByVector=function(e,t){var i=this.parent;if(i&&i._dragReferencePos){var n=m.create();if(r.intersect(n,e,t,this.getSelectionPlane())){var s=this.vector,a=i._dragReferencePos,e=m.distanceInVectorDirection(a,s,n)-i._dragDistance,t=p(gl.orbitalView.snapGrid),n=Math.abs(this.axis||0);0==n&&0<t&&(e=pd.snapTo(e,t));s=[a[0]+e*s[0],a[1]+e*s[1],a[2]+e*s[2]];if(this.allowSnap&&0<n&&0<t)switch(n){case 1:s[0]=pd.snapTo(s[0],t);break;case 2:s[1]=pd.snapTo(s[1],t);break;case 3:s[2]=pd.snapTo(s[2],t)}return i._checkToMoveModelPos(s,this)}}return!1},c.prototype._dragToPointer=function(e,t){var i=this.parent;if(i._dragReferencePos&&i._dragIntersection){var n=m.create();if(r.intersect(n,e,t,this.getSelectionPlane()))return this.allowSnap&&0<gl.orbitalView.snapGrid&&(t=p(gl.orbitalView.snapGrid),n[0]=pd.snapTo(n[0],t),n[1]=pd.snapTo(n[1],t),this.parent.isViewedHorizontal&&(n[2]=pd.snapTo(n[2],t))),i._checkToMoveModelPos(n,this)}return!1};var _=[1,1,1,1],x=[1,0,0,1],a=[1,0,0,.15];function d(e,t,i,n){if(e&&t&&0<n){var s,a,r,o,l,d,h,c=[0,0,0,0],p=[0,0,0,0],u=e.vertexCount(),g=.5*n,m=pd.degreesToRadians(10),f=!1,_=18,x=9;switch(e.twoSided=!0,i){default:h=pd.degreesToRadians(0);break;case 1:f=!0,h=pd.degreesToRadians(30),_=12,x=6;break;case 2:f=!0,h=pd.degreesToRadians(120),_=12,x=6}l=Math.sin(h),d=Math.cos(h),s=g*l+t[0],a=g*d+t[1],r=n*l+t[0],o=n*d+t[1],pd.closeTo(h,0)&&(r=1.35*n*l+t[0],o=1.35*n*d+t[1]),c[0]=e.addVertex([s,a,t[2]]),c[1]=e.addVertex([r,o,t[2]]),p[0]=e.addVertex([-s,-a,t[2]]),p[1]=e.addVertex([-r,-o,t[2]]),f&&(e.addLine(c[0],c[1]),e.addLine(p[0],p[1]));for(var v=1;v<=_;++v)h+=m,l=Math.sin(h),d=Math.cos(h),s=g*l+t[0],a=g*d+t[1],r=n*l+t[0],o=n*d+t[1],v%x==0&&(!f||v<_)&&(r=1.35*n*l+t[0],o=1.35*n*d+t[1]),c[2]=e.addVertex([s,a,t[2]]),c[3]=e.addVertex([r,o,t[2]]),e.addTriangle(c[1],c[0],c[2]),e.addTriangle(c[1],c[2],c[3]),e.addLine(c[0],c[2]),e.addLine(c[1],c[3]),c[0]=c[2],c[1]=c[3],p[2]=e.addVertex([-s,-a,t[2]]),p[3]=e.addVertex([-r,-o,t[2]]),e.addTriangle(p[1],p[0],p[2]),e.addTriangle(p[1],p[2],p[3]),e.addLine(p[0],p[2]),e.addLine(p[1],p[3]),p[0]=p[2],p[1]=p[3];if(0<f&&(e.addLine(c[0],c[1]),e.addLine(p[0],p[1])),g=.2*n,e.addLine(e.addVertex([t[0]-g,t[1],t[2]]),e.addVertex([t[0]+g,t[1],t[2]])),e.addLine(e.addVertex([t[0],t[1]-g,t[2]]),e.addVertex([t[0],t[1]+g,t[2]])),3<=i)for(var b,y=e.vertexCount(),v=u;v<y;++v)a=(b=e.vertices[v])[1],b[1]=b[2],b[2]=a;return 1}}function h(e,t,i,n){if(e&&t&&0<n){var s,a,r,o,l=Math.PI/16,d=Math.PI/8,h=Math.PI+.5*l,c=e.vertexCount(),p=c,u=1.8*n,g=.9*n,m=1;e.twoSided=!0,e.addVertex([t[0],t[1]-n,t[2]]),e.addVertex([t[0],t[1]-u,t[2]]),e.addVertex([t[0]+g,t[1]-g,t[2]]),e.addVertex([t[0]+u,t[1],t[2]]),e.addVertex([t[0]+g,t[1]+g,t[2]]),e.addVertex([t[0],t[1]+u,t[2]]),e.addVertex([t[0],t[1]+n,t[2]]),e.addLine(p+0,p+1),e.addLine(p+1,p+2),e.addLine(p+2,p+3),e.addLine(p+3,p+4),e.addLine(p+4,p+5),e.addLine(p+5,p+6),e.addLine(p+6,p+1),p+=7;for(var f=0;f<=h;f+=l)r=Math.sin(f),o=Math.cos(f),s=t[0]+n*r,a=t[1]-n*o,p=e.addVertex([s,a,t[2]]),0<f&&(d<f&&(e.addTriangle(m,p-1,++m),d+=Math.PI/4),e.addTriangle(m,p-1,p),e.addLine(p-1,p));for(f=0;f<=h;f+=l)r=Math.sin(f),o=Math.cos(f),s=t[0]-n*r,a=t[1]+n*o,p=e.addVertex([s,a,t[2]]),0<f&&e.addLine(p-1,p);if(2<=i)for(var _,p=e.vertexCount(),x=c;x<p;++x)a=(_=e.vertices[x])[1],_[1]=_[0],_[0]=a;if(3==i){p=e.vertexCount();for(x=c;x<p;++x)a=(_=e.vertices[x])[1],_[1]=_[2],_[2]=a}return 1}}function v(e,t,i,n,s,a){if(e&&t){var r,o,l=e.vertexCount();i=i||[1,0,0],n=n||[0,1,0],s=pd.toNumber(s,1);for(var d,h=[[-.5,-.25],[-.25,-.25],[-.25,-.5],[.5,0],[-.25,.5],[-.25,.25],[-.5,.25]],c=0,p=h.length;c<p;++c)r=s*(d=h[c])[0],o=s*d[1],e.addVertex([t[0]+r*i[0]+o*n[0],t[1]+r*i[1]+o*n[1],t[2]+r*i[2]+o*n[2]]);if(e.addTriangle(l+0,l+1,l+5),e.addTriangle(l+0,l+5,l+6),e.addTriangle(l+2,l+3,l+4),e.addTriangle(l+0,l+5,l+1),e.addTriangle(l+0,l+6,l+5),e.addTriangle(l+2,l+4,l+3),e.addLine(l+0,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l+3),e.addLine(l+3,l+4),e.addLine(l+4,l+5),e.addLine(l+5,l+6),e.addLine(l+6,l+0),l=e.vertexCount(),-.5<(a=pd.toInteger(a,0))){if(.5<a){for(h=[[-.15,-.125],[.1,-.125],[-.15,.125],[.1,.125]],c=0;c<4;++c)r=s*(d=h[c])[0],o=s*d[1],e.addVertex([t[0]+r*i[0]+o*n[0],t[1]+r*i[1]+o*n[1],t[2]+r*i[2]+o*n[2]]);return e.addLine(l+0,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l+3),1}if(.999<i[0]){for(h=[[-.25,-.125],[0,.125],[-.25,.125],[0,-.125]],c=0;c<4;++c)r=s*(d=h[c])[0],o=s*d[1],e.addVertex([t[0]+r*i[0]+o*n[0],t[1]+r*i[1]+o*n[1],t[2]+r*i[2]+o*n[2]]);return e.addLine(l+0,l+1),e.addLine(l+2,l+3),1}if(.999<i[1]){for(h=[[-.125,0],[0,.125],[0,-.125],[-.25,0]],c=0;c<4;++c)r=s*(d=h[c])[0],o=s*d[1],e.addVertex([t[0]+r*i[0]+o*n[0],t[1]+r*i[1]+o*n[1],t[2]+r*i[2]+o*n[2]]);return e.addLine(l,l+1),e.addLine(l,l+2),e.addLine(l,l+3),1}if(.999<i[2]){for(h=[[0,-.125],[0,.125],[-.25,-.125],[-.25,.125]],c=0;c<4;++c)r=s*(d=h[c])[0],o=s*d[1],e.addVertex([t[0]+r*i[0]+o*n[0],t[1]+r*i[1]+o*n[1],t[2]+r*i[2]+o*n[2]]);return e.addLine(l+0,l+1),e.addLine(l+1,l+2),e.addLine(l+2,l+3),1}}for(h=[[0,0],[-.125,-.125],[-.125,.125]],c=0;c<3;++c)r=s*(d=h[c])[0],o=s*d[1],e.addVertex([t[0]+r*i[0]+o*n[0],t[1]+r*i[1]+o*n[1],t[2]+r*i[2]+o*n[2]]);return e.addLine(l,l+1),e.addLine(l,l+2),1}}function b(e,t){if(e&&t){var i,n,s,a,r=t.min,o=t.max,l=[.5*(r[0]+o[0]),.5*(r[1]+o[1]),.5*(r[2]+o[2])],d=((p=Math.abs(o[0]-r[0]))+(u=Math.abs(o[1]-r[1]))+(g=Math.abs(o[2]-r[2])))/3,h=.1*pdGL.Hotspot3D.getRelativeSize(.02*d),t=.05*h,c=6*h,p=d<p?.75*d:.75*p,u=d<u?.75*d:.75*u,g=d<g?.75*d:.75*g;e.color([1,0,0,1]),s=e.addVertex([r[0]-t,r[1]-t,r[2]-t]),e.addVertex([o[0]+t,r[1]-t,r[2]-t]),e.addVertex([o[0]+t,o[1]+t,r[2]-t]),e.addVertex([r[0]-t,o[1]+t,r[2]-t]),e.addVertex([r[0]-t,r[1]-t,o[2]+t]),e.addVertex([o[0]+t,r[1]-t,o[2]+t]),e.addVertex([o[0]+t,o[1]+t,o[2]+t]),e.addVertex([r[0]-t,o[1]+t,o[2]+t]),e.color([1,0,0,0]);for(var m=0;m<8;++m)n=s+m,i=e.vertices[n],a=e.addVertex([i[0]+(i[0]<l[0]?p:-p),i[1],i[2]]),e.addVertex([i[0],i[1]+(i[1]<l[1]?u:-u),i[2]]),e.addVertex([i[0],i[1],i[2]+(i[2]<l[2]?g:-g)]),e.addVertex([i[0]-(i[0]<l[0]?c:-c),i[1],i[2]]),e.addVertex([i[0],i[1]-(i[1]<l[1]?c:-c),i[2]]),e.addVertex([i[0],i[1],i[2]-(i[2]<l[2]?c:-c)]),e.addVertex([i[0]+(i[0]<l[0]?h:-h),i[1]+(i[1]<l[1]?h:-h),i[2]]),e.addTriangle(n,a+6,a+0),e.addTriangle(n,a+0,a+6),e.addTriangle(n,a+6,a+1),e.addTriangle(n,a+1,a+6),e.addTriangle(n,a+6,a+3),e.addTriangle(n,a+3,a+6),e.addTriangle(n,a+6,a+4),e.addTriangle(n,a+4,a+6),e.addVertex([i[0],i[1]+(i[1]<l[1]?h:-h),i[2]+(i[2]<l[2]?h:-h)]),e.addTriangle(n,a+7,a+1),e.addTriangle(n,a+1,a+7),e.addTriangle(n,a+7,a+2),e.addTriangle(n,a+2,a+7),e.addTriangle(n,a+7,a+4),e.addTriangle(n,a+4,a+7),e.addTriangle(n,a+7,a+5),e.addTriangle(n,a+5,a+7),e.addVertex([i[0]+(i[0]<l[0]?h:-h),i[1],i[2]+(i[2]<l[2]?h:-h)]),e.addTriangle(n,a+8,a+0),e.addTriangle(n,a+0,a+8),e.addTriangle(n,a+8,a+2),e.addTriangle(n,a+2,a+8),e.addTriangle(n,a+8,a+3),e.addTriangle(n,a+3,a+8),e.addTriangle(n,a+8,a+5),e.addTriangle(n,a+5,a+8);return!0}return!1}function y(e,t){var i=!1;return e&&(e.reuseStart(),i=b(e,t),e.reuseEnd(),e.compile()),i}function S(e,t,i,n){if(!e||!e.isHotspot)throw new Error("Must pass a valid pdGL.Hotspot3D object as the 'hotspot' parameter.");var s=new pd3D.Mesh({normals:!1,lines:!0}),e=new c(e);return s.defaultNormal=[0,0,1],e.vVector=s.defaultNormal,e.type=pdGL.MANIPULATOR_TYPE.SQUARE,i=.5*pd.toNumber(i,.6),n=pd.toNumber(n,.9),t=pd.toInteger(t,0),s.addVertex([-i,-i,0]),s.addVertex([i,-i,0]),s.addVertex([i,i,0]),s.addVertex([-i,i,0]),s.addTriangle(0,1,2),s.addTriangle(0,2,1),s.addTriangle(0,2,3),s.addTriangle(0,3,2),s.addLine(0,1),s.addLine(1,2),s.addLine(2,3),s.addLine(3,0),i*=.5,s.addLine(s.addVertex([-i,0,0]),s.addVertex([i,0,0])),s.addLine(s.addVertex([0,-i,0]),s.addVertex([0,i,0])),t&&1!=t||s.addLine(s.addVertex([0,i,0]),s.addVertex([0,n,0])),t&&2!=t||s.addLine(s.addVertex([i,0,0]),s.addVertex([n,0,0])),s.compile(),e.addMesh(s,g()),e}function M(e,t,i){if(!e||!e.isHotspot)throw new Error("Must pass a valid pdGL.Hotspot3D object as the 'hotspot' parameter.");var n=[0,0,0];i=.5*pd.toNumber(i,.8),pd.isArray(t)&&(m.set(n,t),e.planeEqn=m.normalize(n.slice()),t=0),t=Math.abs(pd.toInteger(t,0));var s=new pd3D.Mesh({normals:!1,lines:!0});d(s,m.origin,Math.min(t,3),i),s.defaultNormal=[0,0,1],s.compile();var a,i=new c(e);return i.type=pdGL.MANIPULATOR_TYPE.CIRCLE,1<=t&&t<=3&&(n[Math.abs(t)-1]=pd.sign(t),i.axis=t),0<t&&(i.vector=m.normalize(n.slice()),i.relativeOffset=0,a=.95<Math.abs(n[2])?[0,1,0]:[0,0,1],i.uVector=m.cross(m.create(),n,a),i.vVector=m.cross(s.defaultNormal,n,i.uVector),i.getSelectionPlane=i._getSelectionPlaneByVector,i.updateRotation=i._updateRotationByVector,i.drag=i._dragByVector),e.planeEqn&&(a=.95<Math.abs(e.planeEqn[2])?[0,1,0]:[0,0,1],i.uVector=m.cross([],e.planeEqn,a),i.vVector=m.cross([],e.planeEqn,i.uVector),i.getSelectionPlane=i._getSelectionPlaneByPlaneEqn,i.updateRotation=i._updateRotationByPlaneEqn),i.addMesh(s,g()),i}function w(e,t,i){if(!e||!e.isHotspot)throw new Error("Must pass a valid pdGL.Hotspot3D object as the 'hotspot' parameter.");i=pd.toNumber(i,.4),t=pd.toInteger(t,0);var n=new pd3D.Mesh({normals:!1,lines:!0});h(n,m.origin,t,i),n.defaultNormal=[0,0,1],n.compile();var s=new c(e);return s.type=pdGL.MANIPULATOR_TYPE.SECTION,1<=t&&t<=3&&(i=[0,0,0],t=Math.round(pd.constrainTo(t,-3,3)),i[Math.abs(t)-1]=pd.sign(t),s.vector=m.normalize(i.slice()),s.relativeOffset=0,e=.95<Math.abs(i[2])?[0,1,0]:[0,0,1],s.uVector=m.cross(m.create(),i,e),s.vVector=m.cross(n.defaultNormal,i,s.uVector),s.getSelectionPlane=s._getSelectionPlaneByVector,s.updateRotation=s._updateRotationByVector,s.drag=s._dragByVector,s.axis=t),s.addMesh(n,g()),s}function L(e,t,i){if(!e||!e.isHotspot)throw new Error("Must pass a valid pdGL.Hotspot3D object as the 'hotspot' parameter.");var n=new pd3D.Mesh({normals:!1,lines:!0}),s=new c(e);t=t||[-1,-1,0],i=pd.toNumber(i,.4),n.defaultNormal=[0,0,1],s.vVector=n.defaultNormal,s.type=pdGL.MANIPULATOR_TYPE.TOUCH,s.modelPos[0]=t[0],s.modelPos[1]=t[1],function(e,t,i){if(e&&t&&0<i){var n,s,a=pd.Const.TWO_PI/24,r=e.vertexCount(),o=r+2;e.addVertex([t[0],t[1],t[2]]),e.addVertex([t[0],t[1]+i,t[2]]);for(var l=a;l<pd.Const.TWO_PI;l+=a)n=i*Math.sin(l)+t[0],s=i*Math.cos(l)+t[1],e.addVertex([n,s,t[2]]),e.addTriangle(r,o-1,o),e.addTriangle(r,o,o-1),e.addLine(o-1,o),o++}}(n,s.offsetVector=t,i);var a=n.vertexCount(),r=pd.sign(t[0]),o=pd.sign(t[1]),l=Math.abs(t[0]),d=Math.abs(t[1]),h=Math.min(l,d),e=Math.max(l,d);return i+.1<e&&d+i<l?(n.addVertex([.1*r,.1*o,0]),n.addVertex([r*h,o*h,0]),n.addVertex([r*(l-i),o*h,0]),n.addLine(a+2,a+1),n.addLine(a+1,a)):i+.1<e&&l+i<d?(n.addVertex([.1*r,.1*o,0]),n.addVertex([r*h,o*h,0]),n.addVertex([r*h,o*(d-i),0]),n.addLine(a+2,a+1),n.addLine(a+1,a)):i<l&&(t=[t[0],t[1],0],i=m.length(t)-i,t=m.normalize(t),n.addVertex([.15*t[0],.15*t[1],0]),n.addVertex([t[0]*i,t[1]*i,0]),n.addLine(a+1,a)),n.compile(),s.addMesh(n,g()),s}function D(e,t,i){if(!e||!e.isHotspot)throw new Error("Must pass a valid pdGL.Hotspot3D object as the 'hotspot' parameter.");i=i||{};var n=pd.toBoolean(i.noLines,!1),s=pd.toNumber(i.offset,1.5);t=t||[1,0,0];var a=new pd3D.Mesh({normals:!1,lines:!0}),r=new c(e);a.defaultNormal=[0,0,1],r.vector=m.normalize(t.slice()),r.type=pdGL.MANIPULATOR_TYPE.ARROW,r.relativeOffset=s,t=r.vector,r.modelPos[0]=s*t[0],r.modelPos[1]=s*t[1],r.modelPos[2]=s*t[2];e=.95<Math.abs(r.vector[2])?[0,1,0]:[0,0,1];return r.uVector=m.cross(m.create(),r.vector,e),r.vVector=m.cross(a.defaultNormal,r.vector,r.uVector),pd.closeTo(s,0)?function(e,t,i,n,s){if(e&&t){var a,r=e.vertexCount();i=i||[1,0,0],n=n||[0,1,0],s=pd.toNumber(s,1);for(var o,l=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]],d=0,h=l.length;d<h;++d)a=s*(o=l[d])[0],o=s*o[1],e.addVertex([t[0]+a*i[0]+o*n[0],t[1]+a*i[1]+o*n[1],t[2]+a*i[2]+o*n[2]]);e.addTriangle(r+0,r+1,r+2),e.addTriangle(r+0,r+2,r+3),e.addTriangle(r+2,r+1,r+0),e.addTriangle(r+3,r+2,r+0),e.addLine(r+0,r+1),e.addLine(r+1,r+2),e.addLine(r+2,r+3),e.addLine(r+3,r+0)}}(a,r.modelPos,r.vector,r.uVector,.5):v(a,r.modelPos,r.vector,r.uVector,1,i.arrow?-1:0),n||(n=s-.5,s=a.vertexCount(),a.addVertex([.25*t[0],.25*t[1],.25*t[2]]),a.addVertex([n*t[0],n*t[1],n*t[2]]),a.addLine(s,s+1)),a.compile(),.999<t[0]?r.axis=1:t[0]<-.999?r.axis=-1:.999<t[1]?r.axis=2:t[1]<-.999?r.axis=-2:.999<t[2]?r.axis=3:t[2]<-.999?r.axis=-3:r.axis=0,r.getSelectionPlane=r._getSelectionPlaneByVector,r.updateRotation=r._updateRotationByVector,r.drag=r._dragByVector,r.addMesh(a,g()),r}function T(e,t,i,n,s){t=t||[1,0,0],i=pd.toNumber(i,1.5),e.vector=m.normalize(t.slice()),e.relativeOffset=i,t=e.vector,e.modelPos[0]=i*t[0],e.modelPos[1]=i*t[1],e.modelPos[2]=i*t[2],n||(i=.95<Math.abs(t[2])?[0,1,0]:[0,0,1],n=m.cross(e.uVector||[],t,i)),s=s||m.cross(e.vVector||[],t,n),e.uVector=m.set(e.uVector||[],n),e.vVector=m.set(e.vVector||[],s);s=e.getMeshesByMaterial(g());return 0<s.length&&((s=s[0]).reuseStart(),v(s,e.modelPos,e.vector,e.uVector,1,-1),s.reuseEnd(),s.compile(),gl.update()),.999<t[0]?e.axis=1:t[0]<-.999?e.axis=-1:.999<t[1]?e.axis=2:t[1]<-.999?e.axis=-2:.999<t[2]?e.axis=3:t[2]<-.999?e.axis=-3:e.axis=0,e.getSelectionPlane=e._getSelectionPlaneByVector,e.updateRotation=e._updateRotationByVector,e.drag=e._dragByVector,e}c.prototype._render=function(e,t){var i,n,s,a=pd3D.RENDER_ALL,r=g(),o=0<t,l=1;if(this.type==pdGL.MANIPULATOR_TYPE.ARROW&&pd.isArray(this.vector)){var d=m.angleBetweenVectors(e,this.vector);if(d<.1745329252?l=pd.mapAndConstrainTo(d,0,.1745329252,0,.25):2.9670597284<d&&(l=pd.mapAndConstrainTo(d,Math.PI,2.9670597284,0,.25)),(l*=l)<.1)return this}for(i in this.updateRotation(o,e),l<1&&(x[3]*=l,_[3]*=l),this.callbackOnDraw&&this.callbackOnDraw(this,a),this.transformMatrix&&(gl.pushMatrix(),gl.multMatrix(this.transformMatrix)),this.geometry){this.geometry.hasOwnProperty(i)&&(n=this.geometry[i],0<=t&&(n.material.id==r.id&&n.material.uniform("color",_),n.material.renderSurfaces(n.meshes)),n.material.id==r.id&&n.material.uniform("color",x),n.material.renderOutlines(n.meshes).endRender())}for(var h=0,c=this.children.length;h<c;++h)(s=this.children[h])&&s.draw&&s.draw(a);return this.transformMatrix&&gl.popMatrix(),l<1&&(x[3]/=l,_[3]/=l),this},pdGL.Hotspot3D=function(e){e=e||{},pd3D.Node.call(this,e.name,"Hotspot"),this.isHotspot=!0,this.modelPos=pd.isArray(e.modelPos)?e.modelPos:[0,0,0],this.canvasPos=[0,0,0],this.planeEqn=null,e.planeEqn&&this.setOrientation(e.planeEqn),1e-6<m.length(this.modelPos)&&this.setTransform(pd3D.Matrix.translate(this.modelPos[0],this.modelPos[1],this.modelPos[2])),this.callbackOnSelect=e.callbackOnSelect||null,this.callbackOnDeselect=e.callbackOnDeselect||null,this.callbackOnChanging=e.callbackOnChanging||null,this.callbackOnChange=e.callbackOnChange||null,this.callbackOnChanged=e.callbackOnChanged||null,this.callbackOnDragStart=e.callbackOnDragStart||null,this.callbackOnDragEnd=e.callbackOnDragEnd||null,this.alwaysCheckSelector=!1,this.relativeSize=pd.toNumber(e.relativeSize,100),this.selectedChildIndex=-1,this.isViewedHorizontal=!1,this.isHovered=!1,this._hasMoved=!1,this._selected=!1,this._dragReferencePos=null,this._dragIntersection=null,this._dragDistance=0,this._opacity=.25,this._ray={start:null,direction:null,end:null},pd.addSimpleEventHandling(this)},pdGL.Hotspot3D.prototype=Object.create(pd3D.Node.prototype),pdGL.Hotspot3D.prototype.constructor=pdGL.Hotspot3D,pdGL.Hotspot3D.getFlipThresholdAngle=function(){return o},pdGL.Hotspot3D.setFlipThresholdAngle=function(e){return o=pd.constrainTo(pd.toNumber(e,20),0,90)},pdGL.Hotspot3D.altBelowFlipThresholdAngle=function(e){e=pd.Const.RAD2DEG*m.angleBetweenVectors(e,m.unitZ);return pd.closeTo(e,90,o)},pdGL.Hotspot3D.arrowSizeFactor=3.5,pdGL.Hotspot3D.selectRadiusModifier=.6;var E=-1;pdGL.Hotspot3D.setRelativeSize=function(e){E=pd.toNumber(e,100)*pdGL.Hotspot3D.arrowSizeFactor},pdGL.Hotspot3D.getRelativeSize=function(e){var t;return E<1e-9&&(t=e,e=pdGL.Scene3D.getActiveScene(),E=e?e.modelUnit*pdGL.Hotspot3D.arrowSizeFactor:gl.orbitalView?gl.orbitalView.getPointSize()*pdGL.Hotspot3D.arrowSizeFactor:pd.toNumber(t,100)),E},pdGL.Hotspot3D.getManipulatorSize=function(){return pdGL.Hotspot3D.getRelativeSize()/Math.max(.1,gl.orbitalView.zoomFactor)};var A=!(pdGL.Hotspot3D.useDetachedCursor=function(e){_[2]=e?.4:1});function P(e,t){var i=gl.orbitalView?1e-6*gl.orbitalView.getPointSize():1e-9;return!m.closeTo(e,t,i)}pdGL.Hotspot3D.captureEvent=function(e){return 0<arguments.length&&(A=pd.toBoolean(e,A)),A},pdGL.Hotspot3D.prototype.getModelSelectionRadius=function(){return pdGL.Hotspot3D.selectRadiusModifier*this.relativeSize},pdGL.Hotspot3D.prototype._isOverManipulator=function(e,t){for(var i=m.create(),n=this.getModelSelectionRadius(),s=gl.orbitalView.canvasToModel(e,t,0).toArray(),a=gl.orbitalView.canvasToModel(e,t,1).toArray(),r=0,o=this.children.length;r<o;++r){var l=this.children[r];if(l&&l.visible&&l.distanceFromRay&&l.distanceFromRay(s,a,i)<n)return!0}return!1},pdGL.Hotspot3D.prototype._isOverSelector=function(e,t,i){return gl.orbitalView.modelToCanvas(this.canvasPos,this.modelPos),Math.abs(e-this.canvasPos[0])<i&&Math.abs(t-this.canvasPos[1])<i},pdGL.Hotspot3D.prototype.isOver=function(e,t,i){if(this.visible&&this.active){if(this._selected&&this._isOverManipulator(e,t))return!0;if(!this._selected||this.alwaysCheckSelector)return this._isOverSelector(e,t,i)}return!1},pdGL.Hotspot3D.prototype._updatePosition=function(){for(var e,t=this.modelPos,i=0,n=this.children.length;i<n;++i){var s=this.children[i];s&&s.visible&&s.updatePos&&s.updatePos()}1e-6<m.length(t)?this.transformMatrix?((e=this.transformMatrix.m)[3]=t[0],e[7]=t[1],e[11]=t[2]):this.setTransform(pd3D.Matrix.translate(t[0],t[1],t[2])):this.transformMatrix&&delete this.transformMatrix,this._hasMoved=!0,gl.update()},pdGL.Hotspot3D.prototype.useNewModelPos=function(e){return!!(pd.isArray(e)&&2<e.length)&&(this.modelPos=e,this._updatePosition(),!0)},pdGL.Hotspot3D.prototype.moveModelPos=function(e,t){return!!P(e,this.modelPos)&&(this.planeEqn&&pd3D.PlaneArray.closestAxialPoint(e,e,this.planeEqn),m.set(this.modelPos,e),this.callbackOnChange&&this.callbackOnChange(this,t),this._updatePosition(),!0)},pdGL.Hotspot3D.prototype._checkToMoveModelPos=function(e,t){return!!P(e,this.modelPos)&&(!(this.callbackOnChanging&&!this.callbackOnChanging(this,t,e))&&this.moveModelPos(e,t))},pdGL.Hotspot3D.prototype.hasMoved=function(){return this._hasMoved},pdGL.Hotspot3D.prototype.isPreSelected=function(){return this._preSelected},pdGL.Hotspot3D.prototype.getSelected=function(){return this._selected},pdGL.Hotspot3D.prototype.setSelected=function(e){return this._selected!=e&&(this._selected=e,this._preSelected=!1,this.selectedChildIndex=-1,this.emit("selected",e),gl.update()),this},pdGL.Hotspot3D.prototype.cancelPreSelection=function(){return this._preSelected&&this.emit("preselect",!1),this._preSelected=!1,this},pdGL.Hotspot3D.prototype.getSelectedChildIndex=function(){return this.selectedChildIndex},pdGL.Hotspot3D.prototype.setSelectedChildIndex=function(e){var t;this.selectedChildIndex!=e&&((t=this.children[e])&&!t.visible||(t=this.selectedChildIndex,this.selectedChildIndex=e,this.emit("select:child",0<=e,e,t),gl.update())),this.selectedChildIndex<0&&(this._dragIntersection=null,this._dragReferencePos=null,this._dragDistance=0)},pdGL.Hotspot3D.prototype.getSelectedManipulator=function(){var e=this.selectedChildIndex;if(0<=e&&e<this.children.length){e=this.children[e];if(e&&e.drag)return e}return null},pdGL.Hotspot3D.prototype._checkProximityToSelector=function(e,t){return m.distancePointToLineSegment(this.modelPos,e.start,e.end)<t},pdGL.Hotspot3D.prototype._selectManipulator=function(e,t,i){for(var n,s=-1,a=Number.MAX_VALUE,r=m.create(),o=1.25*i,l=!1,d=0,h=this.children.length;d<h;++d){var c=this.children[d];c&&c.visible&&c.distanceFromRay&&((n=c.distanceFromRay(e,t,r))<o&&(l=!0),n<i&&n<a&&(s=d,this._dragIntersection=r.slice(),c.vector?this._dragDistance=m.distanceInVectorDirection(this.modelPos,c.vector,r):this._dragDistance=m.distancePointToPoint(this.modelPos,r),a=n))}return this.setSelectedChildIndex(s),0<=this.selectedChildIndex&&(this._dragReferencePos=this.modelPos.slice(),this.boundingBox&&f.set(this._dragBoxOriginalPos,this.boundingBox.min,this.boundingBox.max,this.boundingBox.axis)),l},pdGL.Hotspot3D.prototype.handleSelectEvent=function(e,t,i){if(this.visible&&this.active){var n=this.getModelSelectionRadius();if(this._ray.start=gl.orbitalView.canvasToModel(e.x,e.y,0).toArray(),this._ray.end=gl.orbitalView.canvasToModel(e.x,e.y,1).toArray(),this._hasMoved=!1,this._selected&&(A=this._selectManipulator(this._ray.start,this._ray.end,n))&&this.callbackOnDragStart&&this.callbackOnDragStart(this,e),!this._selected||!A){if((!this._selected||this.alwaysCheckSelector)&&this._checkProximityToSelector(this._ray,n,!1))return i||(A=!0),!0;this.callbackOnSelect&&(A=this.callbackOnSelect(this,e))}return A}return!1},pdGL.Hotspot3D.prototype.handleDragEvent=function(e){var t;return!this._selected||0<=(t=this.selectedChildIndex)&&t<this.children.length&&((t=this.children[t])&&t.drag&&(this._ray.start=gl.orbitalView.canvasToModel(e.x,e.y,0).toArray(),this._ray.end=gl.orbitalView.canvasToModel(e.x,e.y,1).toArray(),t.drag(this._ray.start,this._ray.end))),A},pdGL.Hotspot3D.prototype.handleReleaseEvent=function(e){var t=A;return A=!1,t?(this._hasMoved&&this.callbackOnChanged&&this.callbackOnChanged(this,e),this.callbackOnDragEnd&&this.callbackOnDragEnd(this,e),this.setSelectedChildIndex(-1)):pdDOM.Interaction.hasMoved()||this.callbackOnDeselect&&this.callbackOnDeselect(this,e)||this.setSelected(!1),this._hasMoved=!1,t},pdGL.Hotspot3D.prototype._render=function(){var e,t,i=x[3],n=_[3],s=this._opacity,a=gl.orbitalView.getVectorToCamera(this.modelPos[0],this.modelPos[1],this.modelPos[2]),r=pdGL.Hotspot3D.getManipulatorSize();for(e in this.selectedChildIndex<0&&(this.isViewedHorizontal=pdGL.Hotspot3D.altBelowFlipThresholdAngle(a)),this.relativeSize=r,this.callbackOnDraw&&this.callbackOnDraw(this),gl.pushMatrix(),gl.pushLineWidth(gl.getCanvasLineWidth()),this.transformMatrix&&gl.multMatrix(this.transformMatrix),gl.scale(r),this._preSelected&&!this._selected&&(s*=.6),x[3]=s,g().uniform("color",x),this.geometry){this.geometry.hasOwnProperty(e)&&(t=this.geometry[e]).material.renderMeshes(t.meshes,u).endRender()}if(this._selected||this._preSelected){var o,l=this._preSelected?-1:0,d=this.selectedChildIndex;this._preSelected&&gl.disable(gl.DEPTH_TEST);for(var h=0,c=this.children.length;h<c;++h){var p=this.children[h];p&&p.visible&&p._render&&(o=l||(d==h?1:0),_[3]=o?Math.max(s,.25):.6*s,p._render(a,o))}this._preSelected&&gl.enable(gl.DEPTH_TEST)}x[3]=i,_[3]=n,gl.popLineWidth(),gl.popMatrix()},pdGL.Hotspot3D.prototype.addCenterSphere=function(){return this.addMesh(l(),g()),this},pdGL.Hotspot3D.prototype.addCenterCircle=function(e,t){return this.addChild(M(this,e,t)),this},pdGL.Hotspot3D.prototype.addCenterPushPull=function(e){return this.addChild(function(e,t){if(!e||!e.isHotspot)throw new Error("Must pass a valid pdGL.Hotspot3D object as the 'hotspot' parameter.");var i=new pd3D.Mesh({normals:!1,lines:!0}),n=new c(e);return i.defaultNormal=[0,0,1],n.vVector=i.defaultNormal,n.type=pdGL.MANIPULATOR_TYPE.PUSH_PULL,n.fixedPlane=3,t=.5*pd.toNumber(t,1),e=i.addVertex([.5*t,-t,0]),i.addVertex([1.5*t,0,0]),i.addVertex([.5*t,t,0]),i.addVertex([-.5*t,t,0]),i.addVertex([-1.5*t,0,0]),i.addVertex([-.5*t,-t,0]),i.addTriangle(e+0,e+1,e+2),i.addTriangle(e+3,e+4,e+5),i.addLine(e+0,e+1),i.addLine(e+1,e+2),i.addLine(e+2,e+0),i.addLine(e+3,e+4),i.addLine(e+4,e+5),i.addLine(e+5,e+3),e=i.addVertex([.75*t,.25*t,0]),i.addVertex([+t,0,0]),i.addVertex([.75*t,-.25*t,0]),i.addLine(e+0,e+1),i.addLine(e+1,e+2),e=i.addVertex([-.75*t,.25*t,0]),i.addVertex([-1*t,0,0]),i.addVertex([-.75*t,-.25*t,0]),i.addLine(e+0,e+1),i.addLine(e+1,e+2),i.compile(),n.addMesh(i,g()),n}(this,e)),this.addCenterSphere(),this},pdGL.Hotspot3D.prototype.addArrowVector=function(e,t){t={offset:t,arrow:!0};return this.addChild(D(this,e,t)),this.children[this.children.length-1].updatePos(),this},pdGL.Hotspot3D.prototype.addAxialArrows=function(e,t){var i=this.children.length;i<1&&this.addMesh(l(),g());var n={noLines:!0,offset:1.5};switch(e=pd.toInteger(e,0)){default:case 0:switch(t=Math.abs(pd.toNumber(t,0))){default:this.addChild(D(this,[1,0,0],n)),this.addChild(D(this,[0,1,0],n)),this.addChild(D(this,[0,0,1],n)),t=0;break;case 1:this.addChild(D(this,[0,1,0],n)),this.addChild(D(this,[0,-1,0],n)),this.addChild(D(this,[0,0,1],n)),this.addChild(D(this,[0,0,-1],n));break;case 2:this.addChild(D(this,[1,0,0],n)),this.addChild(D(this,[-1,0,0],n)),this.addChild(D(this,[0,0,1],n)),this.addChild(D(this,[0,0,-1],n));break;case 3:this.addChild(D(this,[1,0,0],n)),this.addChild(D(this,[-1,0,0],n)),this.addChild(D(this,[0,1,0],n)),this.addChild(D(this,[0,-1,0],n));break;case 4:this.addChild(D(this,[1,0,0],n)),this.addChild(D(this,[-1,0,0],n)),this.addChild(D(this,[0,1,0],n)),this.addChild(D(this,[0,-1,0],n)),this.addChild(D(this,[0,0,1],n)),this.addChild(D(this,[0,0,-1],n)),t=0}if(this.addChild(S(this,t,.9)),this.touchChild=L(this).hide(),this.addChild(this.touchChild),0!=t)for(var s=i,a=this.children.length;s<a;++s)this.children[s].fixedPlane=t;break;case 1:n.offset=.85,this.addChild(D(this,[-1,0,0],n)),this.addChild(D(this,[1,0,0],n)),n.offset=0,this.addChild(D(this,[1,0,0],n));break;case-1:this.addChild(w(this,1));break;case 2:n.offset=.85,this.addChild(D(this,[0,-1,0],n)),this.addChild(D(this,[0,1,0],n)),n.offset=0,this.addChild(D(this,[0,1,0],n));break;case-2:this.addChild(w(this,2));break;case 3:n.offset=.85,this.addChild(D(this,[0,0,-1],n)),this.addChild(D(this,[0,0,1],n)),n.offset=0,this.addChild(D(this,[0,0,1],n));break;case-3:this.addChild(w(this,3));break;case 4:n.offset=1.2,this.addChild(D(this,[-1,0,0],n)),this.addChild(D(this,[1,0,0],n)),this.addChild(D(this,[0,-1,0],n)),this.addChild(D(this,[0,1,0],n)),this.addChild(S(this,3,.9))}for(s=0,a=this.children.length;s<a;++s)this.children[s].updatePos();return this},pdGL.Hotspot3D.prototype.setArrowVector=function(e,t,i){return 0<=e&&e<this.children.length&&((e=this.children[e])&&e.vector&&T(e,t=m.normalize(t.slice()),i=pd.toNumber(i,e.relativeOffset))),this},pdGL.Hotspot3D.prototype.setArrowDistance=function(e,t,i){var n;return 0<=e&&e<this.children.length&&((n=this.children[e])&&(e=pdGL.Hotspot3D.getManipulatorSize(),i=pd.toNumber(i,n.relativeOffset),n.relativeOffset=t/e+i,T(n,vector,i))),this},pdGL.Hotspot3D.prototype.setOrientation=function(e,t,i){var n,s,a=0,r=this.modelPos,o=m.set(this.planeEqn||[],e.slice()),l=gl.orbitalView.getVectorToCamera(r[0],r[1],r[2]);m.normalize(o),(this.planeEqn=o)[3]=-(o[0]*r[0]+o[1]*r[1]+o[2]*r[2]),pd.isArray(t)||(r=.95<Math.abs(o[2])?[0,1,0]:[0,0,1],t=m.cross([],o,r)),pd.isArray(i)||(i=m.cross([],o,t)),3<this.children.length&&(n=m.negate([],t),s=m.negate([],i));for(var d=0,h=this.children.length;d<h;++d){var c=this.children[d];c&&(c.type==pdGL.MANIPULATOR_TYPE.ARROW?(0==a?T(c,t,c.relativeOffset,e,i):1==a?T(c,i,c.relativeOffset,e,t):2==a?T(c,n,c.relativeOffset,e,s):3==a&&T(c,s,c.relativeOffset,e,n),c.flipAngle=-999,++a):(c.uVector=m.set(c.uVector||[],t),c.vVector=m.set(c.vVector||[],i)),c.updateRotation=c._updateRotationByPlaneEqn,c.getSelectionPlane=c._getSelectionPlaneByPlaneEqn,c.updateRotation(!1,l))}return this},pdGL.HotspotRect=function(e){e=e||{},pdGL.Hotspot3D.call(this,e),this.isHotspotRect=!0,this.width=pd.toNumber(e.width,0),this.height=pd.toNumber(e.width,0),this.align=pd.toInteger(e.align,pd.Align.CENTER),this.uVector=e.uVector||[1,0,0],this.vVector=e.vVector||[0,1,0],this.addArrowVector([1,0,0],.75),this.addArrowVector([0,1,0],.75),this.addArrowVector([-1,0,0],1.25),this.addArrowVector([0,-1,0],1.25),this.addCenterCircle([1,0,0]),this.setSizeAndPosition(this.width,this.height,this.modelPos)},pdGL.HotspotRect.prototype=Object.create(pdGL.Hotspot3D.prototype),pdGL.HotspotRect.prototype.constructor=pdGL.HotspotRect,pdGL.HotspotRect.prototype.computePosFromUV=function(e,t,i){i=i||[];return m.set(i,this.modelPos),this.uVector&&(pd.Align.isLeft(this.align)?m.translateInVectorDirection(i,this.modelPos,this.uVector,this.width*e):pd.Align.isRight(this.align)||e<.5?m.translateInVectorDirection(i,this.modelPos,this.uVector,-this.width*e):m.translateInVectorDirection(i,this.modelPos,this.uVector,this.width*(e-.5))),this.vVector&&(pd.Align.isBottom(this.align)?m.translateInVectorDirection(i,i,this.vVector,this.height*t):pd.Align.isTop(this.align)||t<.5?m.translateInVectorDirection(i,i,this.vVector,-this.height*t):m.translateInVectorDirection(i,i,this.vVector,this.height*(t-.5))),i},pdGL.HotspotRect.prototype.setSizeAndPosition=function(e,t,i){if(4<this.children.length){var n;e=pd.toNumber(e,this.width),t=pd.toNumber(t,this.height),pd.isArray(i)||(i=this.modelPos.slice());var s,a=pdGL.Hotspot3D.getManipulatorSize(),r=[1.25,1.25,1.25,1.25],o=[0,0,0,0],l=[0,0];pd.Align.isLeft(this.align)?(o[0]=e,r[0]=.75,o[2]=0,r[2]=1.25,l[0]=0):pd.Align.isRight(this.align)?(r[o[0]=0]=1.25,o[2]=e,r[2]=.75,l[0]=e):(s=.5*e,o[0]=s,r[0]=.75,o[2]=s,r[2]=.75,l[0]=s),pd.Align.isBottom(this.align)?(o[1]=t,r[1]=.75,o[3]=0,r[3]=1.25,l[1]=0):pd.Align.isTop(this.align)?(o[1]=0,r[1]=1.25,o[3]=t,r[3]=.75,l[1]=t):(s=.5*t,o[1]=s,r[1]=.75,o[3]=s,r[3]=.75,l[1]=s),this.width=e,this.height=t,m.set(this.modelPos,i);for(var d=0;d<4;++d)null!=(n=this.children[d])&&(n.relativeOffset=o[d]/a+r[d])}return this};var C=-101;function O(){if(this.parent){var e=this.parent.modelPos;if(this.parent.boundingBox){var t=this.parent.boundingBox,i=t.min,n=t.max,s=this.parent.useBotLeft?i.slice():[.5*(i[0]+n[0]),.5*(i[1]+n[1]),.5*(i[2]+n[2])];if(this.axis){var a=E,r=(1.25+this.relativeOffset)*this.parent.relativeSize;switch(t.callbackDynamicOffset&&(r+=t.callbackDynamicOffset(this)),this.axis){case 1:s[0]=Math.max(n[0]+r,s[0]+a);break;case-1:s[0]=Math.min(i[0]-r,s[0]-a);break;case 2:s[1]=Math.max(n[1]+r,s[1]+a);break;case-2:s[1]=Math.min(i[1]-r,s[1]-a);break;case 3:s[2]=Math.max(n[2]+r,s[2]+a);break;case-3:s[2]=Math.min(i[2]-r,s[2]-a)}}m.closeTo(s,this.modelPos)||(m.set(this.modelPos,s),this.transform.setTranslation(s))}else this.modelPos[0]=e[0],this.modelPos[1]=e[1],this.modelPos[2]=e[2]}return this}function N(){var e,t,i,n,s;this.parent&&(e=(n=this.parent).modelPos,t=n.relativeSize,s=n._dragRadius,i=this.offsetVector[0]*s,n=this.offsetVector[1]*s,s=this.offsetVector[2]*s,this.setTranslation(i,n,s),this.transform.setAxialRotation(0,0,-this.parent._angle),m.set(this.modelPos,e[0]+i*t,e[1]+n*t,e[2]+s*t))}pdGL.HotspotBoundingBox=function(e){e=e||{},pdGL.Hotspot3D.call(this,e),this.isHotspotBoundingBox=!0,this.selectedBoxIndex=-1,this.defaultBoundingBox=null,this.useBotLeft=pd.toBoolean(e.useBotLeft,!1),this.allowMultiSelection=pd.toBoolean(e.allowMultiSelection,!1),this.subBoundingBoxes=null,this._preSelectedBoxIndex=-1,this._dragBoxOriginalPos=f.create(),this._dragAxisLock=0,this._preSelectedBoxMesh=null,this._selectedBoxMesh=null,e.boundingBox&&(this.selectedBoxIndex=this._preSelectedBoxIndex=C,this.setBoundingBox(e.boundingBox,e.callbackOnChanging,e.axis),this.defaultBoundingBox=e.boundingBox),e.subBoundingBoxes&&this.setSubBoundingBoxes(e.subBoundingBoxes),this.callbackOnSelectionChanging=e.callbackOnSelectionChanging||null,this.callbackOnSelectionChanged=e.callbackOnSelectionChanged||null},pdGL.HotspotBoundingBox.prototype=Object.create(pdGL.Hotspot3D.prototype),pdGL.HotspotBoundingBox.prototype.constructor=pdGL.HotspotBoundingBox,pdGL.HotspotBoundingBox.MAIN_BBOX=C,pdGL.HotspotBoundingBox.prototype.setBoundingBox=function(e,t,i){var n=this.boundingBox;if(this.callbackOnSelectionChanging&&this.boundingBox!=e&&!this.callbackOnSelectionChanging(this,e))return!1;if(e){this.boundingBox=e,this.callbackOnChanging=t||e.handleChanging,this.callbackOnChange=e.handleChange||null;var s=this.boundingBox.min,t=this.boundingBox.max;if(this.useBotLeft?(this.modelPos[0]=s[0],this.modelPos[1]=s[1],this.modelPos[2]=s[2]):(this.modelPos[0]=.5*(s[0]+t[0]),this.modelPos[1]=.5*(s[1]+t[1]),this.modelPos[2]=.5*(s[2]+t[2])),f.set(this._dragBoxOriginalPos,e.min,e.max,e.axis),this._selectedBoxMesh&&this.highlightSelection(),7!=this.children.length){t={noLines:!0,offset:.01};this.clearChildren(),this.addChild(D(this,[1,0,0],t)),this.addChild(D(this,[-1,0,0],t)),this.addChild(D(this,[0,1,0],t)),this.addChild(D(this,[0,-1,0],t)),this.addChild(D(this,[0,0,1],t)),this.addChild(D(this,[0,0,-1],t)),this.addChild(M(this));for(var a=0;a<7;++a)this.children[a].updatePos=O}e.fixedAxis&&0<e.fixedAxis&&e.fixedAxis<=3?(this.children[0].visible=this.children[1].visible=1==e.fixedAxis,this.children[2].visible=this.children[3].visible=2==e.fixedAxis,this.children[4].visible=this.children[5].visible=3==e.fixedAxis,this.children[6].visible=!1):(pd.isNumeric(i)||(i=Math.abs(pd.toNumber(e.axis,0))),this.children[0].visible=this.children[1].visible=1!=i,this.children[2].visible=this.children[3].visible=2!=i,this.children[4].visible=this.children[5].visible=3!=i,e.showCenter?(this.children[6].visible=!0,this.children[6].axialXYOnly=!1,this.children[6].fixedPlane=0):(this.children[6].visible=1<=i&&i<=3,this.children[6].fixedPlane=Math.abs(i),this.children[6].axialXYOnly=!0));for(a=0;a<7;++a)this.children[a].updatePos();this.setTransform(null),this._selected=!0}else this.boundingBox=null;return this.callbackOnSelectionChanged&&this.boundingBox!=n&&this.callbackOnSelectionChanged(this,this.boundingBox,n),!0},pdGL.HotspotBoundingBox.prototype.updateBoundingBox=function(){return this.boundingBox&&this._selectedBoxMesh&&this.highlightSelection(),this},pdGL.HotspotBoundingBox.prototype.highlightSelection=function(){var e=!1,t=this._selectedBoxMesh;if(this.boundingBox&&t){if(t.reuseStart(),e=b(t,this.boundingBox),this.allowMultiSelection){var i=this.subBoundingBoxes;if(i&&0<i.length)for(var n=0,s=i.length;n<s;++n)i[n].selected&&function(e,t){if(e&&t){var i=t.min,n=t.max,t=e.vertexCount();e.color(a);t=e.addVertex([i[0],i[1],i[2]]);e.addVertex([n[0],i[1],i[2]]),e.addVertex([n[0],n[1],i[2]]),e.addVertex([i[0],n[1],i[2]]),e.addVertex([i[0],i[1],n[2]]),e.addVertex([n[0],i[1],n[2]]),e.addVertex([n[0],n[1],n[2]]),e.addVertex([i[0],n[1],n[2]]),e.addTriangle(t+0,t+4,t+7),e.addTriangle(t+0,t+7,t+3),e.addTriangle(t+1,t+2,t+6),e.addTriangle(t+1,t+6,t+5),e.addTriangle(t+0,t+1,t+5),e.addTriangle(t+0,t+5,t+4),e.addTriangle(t+2,t+3,t+7),e.addTriangle(t+2,t+7,t+6),e.addTriangle(t+0,t+3,t+2),e.addTriangle(t+0,t+2,t+1),e.addTriangle(t+4,t+5,t+6),e.addTriangle(t+4,t+6,t+7)}}(t,i[n])}t.reuseEnd(),t.compile()}return e},pdGL.HotspotBoundingBox.prototype.setSubBoundingBoxes=function(e){return pd.isArray(e)&&0<e.length?(this.subBoundingBoxes=e.slice(),this._preSelectedBoxMesh||(this._preSelectedBoxMesh=new pd3D.Mesh({colors:!0,lines:!0}))):delete this.subBoundingBoxes,0<=this.selectedBoxIndex&&(this.selectedBoxIndex=this._preSelectedBoxIndex=-1),this},pdGL.HotspotBoundingBox.prototype.addSubBoundingBox=function(e){if(pd.isArray(this.subBoundingBoxes)||(this.subBoundingBoxes=[]),this._preSelectedBoxMesh||(this._preSelectedBoxMesh=new pd3D.Mesh({colors:!0,lines:!0})),pd.isArray(e)&&0<e.length)for(var t=0,i=e.length;t<i;++t)this.subBoundingBoxes.push(e[t]);else pd.isObject(e)&&null!=e.min&&this.subBoundingBoxes.push(e);return this},pdGL.HotspotBoundingBox.prototype.selectBoundingBox=function(e,t){var i=null;return e==C?i=this.defaultBoundingBox||this.boundingBox:0<=e&&this.subBoundingBoxes&&e<this.subBoundingBoxes.length&&(i=this.subBoundingBoxes[e]),null!=i?(this.selectedBoxIndex=e,this._preSelectedBoxIndex=e,this.setBoundingBox(i)||(this._preSelectedBoxIndex=-1,this.selectedBoxIndex=-1),this.touchChild&&this.touchChild.show(!!t)):pdGL.keys.SHIFT||this.setBoundingBox(null)&&(this.selectedBoxIndex=this._preSelectedBoxIndex=-1,this.selectedChildIndex=-1,this._selected=!1),this.setDragAxisLock(0),gl.update(),this},pdGL.HotspotBoundingBox.prototype.setSelected=function(e){return this._selected!=e&&(this._selected=e,this.selectedChildIndex=-1,this.setDragAxisLock(0),gl.update()),e?(this._preSelectedBoxIndex<0&&(this.defaultBoundingBox?this._preSelectedBoxIndex=C:this._preSelectedBoxIndex=this.selectedBoxIndex),this.selectedBoxIndex<0&&(this.selectedBoxIndex=this._preSelectedBoxIndex),this.selectBoundingBox(this._preSelectedBoxIndex)):(this.selectedBoxIndex=this._preSelectedBoxIndex=-1,this.setBoundingBox(null)),this},pdGL.HotspotBoundingBox.prototype.isDefaultBoxSelected=function(){return this.selectedBoxIndex==C},pdGL.HotspotBoundingBox.prototype.isSubBoxSelected=function(){return 0<=this.selectedBoxIndex},pdGL.HotspotBoundingBox.prototype.isPreSelected=function(){return this._selected&&0<=this._preSelectedBoxIndex?this._preSelectedBoxIndex!=this.selectedBoxIndex:this._preSelected},pdGL.HotspotBoundingBox.prototype.cancelPreSelection=function(){return this.isPreSelected()&&(this._preSelectedBoxIndex=-1,this.emit("preselect",!1),gl.update()),this._preSelected=!1,this},pdGL.HotspotBoundingBox.prototype.isOver=function(e,t){return!!(this.visible&&this.active&&this._selected)&&this._isOverManipulator(e,t)},pdGL.HotspotBoundingBox.prototype.setDragAxisLock=function(e,t){if(e=pd.toInteger(e,0),!t&&7<=this.children.length&&(t=this.children[6]),t&&this._dragAxisLock!=e){switch(e){default:this._dragAxisLock=e,e=0;break;case 1:this._dragAxisLock=e,e=1;break;case 2:this._dragAxisLock=e,e=2;break;case 3:this._dragAxisLock=e,e=2==t.fixedPlane?2:1}t=t.getMeshesByMaterial(g());0<t.length&&((t=t[0]).reuseStart(),d(t,m.origin,e,.4),t.reuseEnd(),t.compile(),gl.update())}},pdGL.HotspotBoundingBox.prototype.moveModelPos=function(e,t){if(P(e,this.modelPos)){var i=this.modelPos,n=this.boundingBox.min,s=this.boundingBox.max,a=e[0]-i[0],r=e[1]-i[1],o=e[2]-i[2];i[0]=e[0],i[1]=e[1],i[2]=e[2],m.set(n,n[0]+a,n[1]+r,n[2]+o),m.set(s,s[0]+a,s[1]+r,s[2]+o);for(var l=0,d=this.children.length;l<d;++l){var h=this.children[l];h&&h.visible&&h.updatePos&&h.updatePos()}return this.transformMatrix&&((o=this.transformMatrix.m)[3]=i[0],o[7]=i[1],o[11]=i[2]),this._selectedBoxMesh&&this.highlightSelection(),this.callbackOnChange&&this.callbackOnChange(this,t),gl.update(),this._hasMoved=!0}return!1},pdGL.HotspotBoundingBox.prototype._checkToUpdateExtents=function(e,t,i){var n=this.modelPos,s=[.5*(e[0]+t[0]),.5*(e[1]+t[1]),.5*(e[2]+t[2])];if(!P(e,this.boundingBox.min)&&!P(t,this.boundingBox.max))return!1;if(this.callbackOnChanging&&!this.callbackOnChanging(this,i,s,e,t))return!1;if(m.set(this.boundingBox.min,e[0],e[1],e[2]),m.set(this.boundingBox.max,t[0],t[1],t[2]),n[0]=s[0],n[1]=s[1],n[2]=s[2],!i.axis){for(var a=0,r=this.children.length;a<r;++a){var o=this.children[a];o&&o.visible&&o.updatePos&&o.updatePos()}this.transformMatrix&&((s=this.transformMatrix.m)[3]=n[0],s[7]=n[1],s[11]=n[2])}return this._selectedBoxMesh&&this.highlightSelection(),this.callbackOnChange&&this.callbackOnChange(this,i),gl.update(),this._hasMoved=!0},pdGL.HotspotBoundingBox.prototype._checkToMoveModelPos=function(e,t){var i=this._dragReferencePos,n=p(gl.orbitalView.snapGrid),s=this.boundingBox.min.slice(),a=this.boundingBox.max.slice();if(t.axis)switch(t.axis){case 1:a[0]=pd.snapTo(this._dragBoxOriginalPos.max[0]+(e[0]-i[0]),n);break;case-1:s[0]=pd.snapTo(this._dragBoxOriginalPos.min[0]+(e[0]-i[0]),n);break;case 2:a[1]=pd.snapTo(this._dragBoxOriginalPos.max[1]+(e[1]-i[1]),n);break;case-2:s[1]=pd.snapTo(this._dragBoxOriginalPos.min[1]+(e[1]-i[1]),n);break;case 3:a[2]=pd.snapTo(this._dragBoxOriginalPos.max[2]+(e[2]-i[2]),n);break;case-3:s[2]=pd.snapTo(this._dragBoxOriginalPos.min[2]+(e[2]-i[2]),n)}else{var r=this.modelPos,o=gl.orbitalView?1e-6*gl.orbitalView.getPointSize():1e-9,l=+this._dragAxisLock,d=0|this.boundingBox.axis;if(0==d&&this.boundingBox.showCenter)this.isViewedHorizontal&&(d=(c=Math.abs(gl.orbitalView.cameraAzi))<45||135<c?(l=1==l?3:1<l?2:0,1):(l=1==l?1:1<l?3:0,2));else switch(l){case 1:e[1]=i[1],e[2]=i[2];break;case 2:e[0]=i[0],e[2]=i[2];break;case 3:e[0]=i[0],e[1]=i[1]}if(!m.closeTo(e,r,o)){var h=e[0]-this._dragReferencePos[0],c=e[1]-this._dragReferencePos[1],i=e[2]-this._dragReferencePos[2],r=a[0]-s[0],o=a[1]-s[1],e=a[2]-s[2];switch(d){case 1:case-1:l&&2!=l||(s[1]=pd.snapTo(this._dragBoxOriginalPos.min[1]+c,n)),l&&3!=l||(s[2]=pd.snapTo(this._dragBoxOriginalPos.min[2]+i,n));break;case 2:case-2:l&&1!=l||(s[0]=pd.snapTo(this._dragBoxOriginalPos.min[0]+h,n)),l&&3!=l||(s[2]=pd.snapTo(this._dragBoxOriginalPos.min[2]+i,n));break;default:l&&1!=l||(s[0]=pd.snapTo(this._dragBoxOriginalPos.min[0]+h,n)),l&&2!=l||(s[1]=pd.snapTo(this._dragBoxOriginalPos.min[1]+c,n))}a[0]=s[0]+r,a[1]=s[1]+o,a[2]=s[2]+e}}return this._checkToUpdateExtents(s,a,t)},pdGL.HotspotBoundingBox.prototype.handleSelectEvent=function(e,t,i){if(this.visible&&this.active){var n=this.getModelSelectionRadius(),s=this._ray.start=gl.orbitalView.canvasToModel(e.x,e.y,0).toArray(),a=this._ray.end=gl.orbitalView.canvasToModel(e.x,e.y,1).toArray(),r=this._ray.direction=m.normalizedDirectionVector([],s,a);if(this._hasMoved=!1,this._selected&&(A=this._selectManipulator(s,a,n))&&this.callbackOnDragStart&&this.callbackOnDragStart(this,e),i||this._selected&&A)return A&&(0<=this._preSelectedBoxIndex?(g=this.subBoundingBoxes[this._preSelectedBoxIndex],f.set(this._dragBoxOriginalPos,g.min,g.max,g.axis)):this._preSelectedBoxIndex==C&&(g=this.defaultBoundingBox||this.boundingBox,f.set(this._dragBoxOriginalPos,g.min,g.max,g.axis))),A;var o,l,d=[],h=Number.MAX_VALUE;if(this._preSelectedBoxIndex=-1,this.subBoundingBoxes&&0<this.subBoundingBoxes.length){for(var c=this.subBoundingBoxes,p=0,u=c.length;p<u;++p)p!=this.selectedBoxIndex&&null!=(o=(c[p].intersectRay||f.intersectRay)(c[p],s,r,d))&&(l=m.distancePointToPoint(s,o))<h&&(this._preSelectedBoxIndex=p,h=l);0<=this.selectedBoxIndex&&this._preSelectedBoxIndex<0&&null!=(o=(c[this.selectedBoxIndex].intersectRay||f.intersectRay)(c[this.selectedBoxIndex],s,r,d))&&(l=m.distancePointToPoint(s,o))<h&&(this._preSelectedBoxIndex=this.selectedBoxIndex,h=l)}if(this.defaultBoundingBox&&null!=(o=(this.defaultBoundingBox.intersectRay||f.intersectRay)(this.defaultBoundingBox,s,r,d))&&(l=m.distancePointToPoint(s,o))<h&&(this._preSelectedBoxIndex<0||!this.defaultBoundingBox.inactiveFace||o.axis!=this.defaultBoundingBox.inactiveFace)&&(this._preSelectedBoxIndex=C,h=l),this._preSelectedBoxIndex==this.selectedBoxIndex)return!1;var g,t=!t;return 0<=this._preSelectedBoxIndex?(g=this.subBoundingBoxes[this._preSelectedBoxIndex],f.set(this._dragBoxOriginalPos,g.min,g.max,g.axis),y(this._preSelectedBoxMesh,g),t=!0,gl.update()):this._preSelectedBoxIndex==C&&(g=this.defaultBoundingBox||this.boundingBox,f.set(this._dragBoxOriginalPos,g.min,g.max,g.axis),y(this._preSelectedBoxMesh,g),t=!0,gl.update()),t}return!1},pdGL.HotspotBoundingBox.prototype.handleDragEvent=function(e){var t;return!this._selected||0<=(t=this.selectedChildIndex)&&t<this.children.length&&((t=this.children[t])&&t.drag&&(this._ray.start=gl.orbitalView.canvasToModel(e.x,e.y,0).toArray(),this._ray.end=gl.orbitalView.canvasToModel(e.x,e.y,1).toArray(),t.drag(this._ray.start,this._ray.end))),this._preSelectedBoxIndex!=this.selectedBoxIndex&&(this._preSelectedBoxIndex=this.selectedBoxIndex),A},pdGL.HotspotBoundingBox.prototype.handleReleaseEvent=function(e){var t=A;return A=!1,t?(this._hasMoved&&this.callbackOnChanged&&this.callbackOnChanged(this,e),this.callbackOnDragEnd&&this.callbackOnDragEnd(this,e),this.setSelectedChildIndex(-1)):pdDOM.Interaction.hasMoved()||(this._preSelectedBoxIndex!=this.selectedBoxIndex?this.selectBoundingBox(this._preSelectedBoxIndex,e.isTouchEvent):this.allowMultiSelection&&this.callbackOnSelectionChanging&&(e=this.selectedBoxIndex,this.callbackOnSelectionChanging(this,this.boundingBox)||(this.selectedBoxIndex=e,this._preSelectedBoxIndex=-1))),this._hasMoved=!1,t},pdGL.HotspotBoundingBox.prototype.handleDoubleTap=function(e){if(this.active&&this.visible&&this.boundingBox&&this._selected&&7<=this.children.length){var t=this.children[6];if(t&&t.visible)if(this._ray.start||(this._ray.start=gl.orbitalView.canvasToModel(e.x,e.y,0).toArray(),this._ray.end=gl.orbitalView.canvasToModel(e.x,e.y,1).toArray(),this._ray.direction=m.normalizedDirectionVector([],ray_start,ray_end)),null!=(this.boundingBox||f.intersectRay)(this.boundingBox,this._ray.start,this._ray.direction)){switch(t.fixedPlane){case 1:0==this._dragAxisLock?this.setDragAxisLock(2,t):2==this._dragAxisLock?this.setDragAxisLock(3,t):this.setDragAxisLock(0,t);break;case 2:0==this._dragAxisLock?this.setDragAxisLock(1,t):1==this._dragAxisLock?this.setDragAxisLock(3,t):this.setDragAxisLock(0,t);break;case 3:0==this._dragAxisLock?this.setDragAxisLock(1,t):1==this._dragAxisLock?this.setDragAxisLock(2,t):this.setDragAxisLock(0,t)}return!0}}return!1},pdGL.HotspotBoundingBox.prototype.handleDoubleTapCenterManipulator=function(){if(this.active&&this.visible&&this.boundingBox&&this._selected&&7<=this.children.length){var e=this.children[6];if(e&&e.visible){var t=m.create(),i=this.getModelSelectionRadius();if(e.distanceFromRay(this._ray.start,this._ray.end,t)<i){switch(e.fixedPlane){case 1:0==this._dragAxisLock?this.setDragAxisLock(2,e):2==this._dragAxisLock?this.setDragAxisLock(3,e):this.setDragAxisLock(0,e);break;case 2:0==this._dragAxisLock?this.setDragAxisLock(1,e):1==this._dragAxisLock?this.setDragAxisLock(3,e):this.setDragAxisLock(0,e);break;case 3:0==this._dragAxisLock?this.setDragAxisLock(1,e):1==this._dragAxisLock?this.setDragAxisLock(2,e):this.setDragAxisLock(0,e);break;default:this.boundingBox.showCenter&&(0==this._dragAxisLock?this.setDragAxisLock(1,e):1==this._dragAxisLock?this.setDragAxisLock(2,e):this.setDragAxisLock(0,e))}return!0}}}return!1},pdGL.HotspotBoundingBox.prototype._render=function(){if(this._selected){var e,t=x[3],i=_[3],n=this._opacity,s=gl.orbitalView.getVectorToCamera(this.modelPos[0],this.modelPos[1],this.modelPos[2]);this.selectedChildIndex<0&&(this.isViewedHorizontal=pdGL.Hotspot3D.altBelowFlipThresholdAngle(s));var a=pdGL.Hotspot3D.getManipulatorSize();this.relativeSize=a,this.callbackOnDraw&&this.callbackOnDraw(this);var r,o=pdGL.getDefaultMaterialMeshColor();gl.pushLineWidth(gl.getCanvasLineWidthThicker()),this.boundingBox&&(this._selectedBoxMesh||(this._selectedBoxMesh=new pd3D.Mesh({colors:!0,lines:!1}),this.addMesh(this._selectedBoxMesh,o),this.highlightSelection()),0<(r=this.getMeshesByMaterial(o)).length&&o.uniform("opacity",this._opacity).renderMeshes(r,u)),this._preSelectedBoxIndex!=this.selectedBoxIndex&&-1!=this._preSelectedBoxIndex&&this._preSelectedBoxMesh&&o.uniform("opacity",.5*this._opacity).renderMeshes(this._preSelectedBoxMesh,u),o.isRendering()&&o.endRender(),x[3]=n,g().uniform("color",x),gl.lineWidth(gl.getCanvasLineWidth());for(var l=0,d=this.children.length;l<d;++l){var h=this.children[l];h&&h.visible&&(h.setScale(a),e=this.selectedChildIndex==l?1:0,_[3]=e?Math.max(n,.25):.6*n,h._render(s,e))}x[3]=t,_[3]=i,gl.popLineWidth()}else this._preSelected&&this._preSelectedBoxIndex!=this.selectedBoxIndex&&-1!=this._preSelectedBoxIndex&&this._preSelectedBoxMesh&&pdGL.getDefaultMaterialMeshColor().uniform("opacity",.5*this._opacity).renderMeshes(this._preSelectedBoxMesh,u).endRender()},pdGL.HotspotNorthArrow=function(e){var n=this;e=e||{},pdGL.Hotspot3D.call(this,e),this.isHotspotNorthArrow=!0,this._angle=0,this._ringRadius=3.5,this._dragRadius=this._ringRadius,this.manipulatorPosition=null,this.manipulatorAngle=null,this.meshAxis=null,this.meshLines=null,this.callbackOnAngleChanging=e.callbackOnAngleChanging||null,this.transform=this.transformMatrix=new pd3D.Transform,this._createGeometry();var s=new pdDOM.Animation(function(e){n._dragRadius=e,gl.update()},{duration:.75,delay:3});this.cancelShrinkAnimation=function(){s.active&&s.cancel()},this.on("select:child",function(e,t,i){e||1!=i||t==i||n._dragRadius>n._ringRadius+.001&&s.start({fromValue:n._dragRadius,toValue:n._ringRadius})}),this.on("selected",function(){n._dragRadius=n._ringRadius,n.meshAxis.visible=!1,n.cancelShrinkAnimation()})},pdGL.HotspotNorthArrow.prototype=Object.create(pdGL.Hotspot3D.prototype),pdGL.HotspotNorthArrow.prototype.constructor=pdGL.HotspotNorthArrow,pdGL.HotspotNorthArrow.prototype._setAngle=function(e,t){if(e=pd.wrapAt(pd.toNumber(e,this._angle),-180,180),!t&&pd.closeTo(this._angle,e)||this.callbackOnAngleChanging&&!this.callbackOnAngleChanging(this,e))return!1;this._angle=e;t=this.manipulatorAngle,e=pd.degreesToRadians(this._angle);return t.offsetVector[0]=Math.sin(e),t.offsetVector[1]=Math.cos(e),t.updatePos(),!0},pdGL.HotspotNorthArrow.prototype.angle=function(e,t){return arguments.length?(this._setAngle(e),gl.update(),this):this._angle},pdGL.HotspotNorthArrow.prototype._createGeometry=function(){this.addCenterSphere();var e=new pd3D.Mesh({lines:!0,defaultColor:[.4,.4,.4,1]});h(e,m.origin,2,.4),e.addLine(e.addVertex([0,.9,0]),e.addVertex([0,-.9,0])),e.addLine(e.addVertex([-.9,0,0]),e.addVertex([.9,0,0])),pd3D.Shapes.circle({radius:.725,background:!1,border:!0},e),e.compile(),this.addMesh(e,pdGL.getDefaultMaterialMeshColor()),this.manipulatorPosition=M(this),this.manipulatorPosition.axialXYOnly=!1,this.manipulatorPosition.fixedPlane=3,this.addChild(this.manipulatorPosition),this.manipulatorPosition.updatePos(),d(e=new pd3D.Mesh({normals:!1,lines:!0}),m.origin,1,.4),e.compile();var t=new c(this);t.updatePos=N,t.addMesh(e,g()),t.vVector=e.defaultNormal,t.offsetVector=[0,1,0],t.drag=t._dragToPointer,t.axialXYOnly=!1,t.allowSnap=!1,t.fixedPlane=3,t.axis=3,this.manipulatorAngle=t,this.addChild(t),e=new pd3D.Mesh({lines:!0,defaultColor:x});t=.765;pd3D.Shapes.circle({radius:t,radiusInner:t-.0025,segments:72},e),pd3D.Shapes.polygon({type:pd3D.Shapes.Type.SPOKES,size:t,thickness:.0025*t,tickSize:.025*t,segments:72},e),pd3D.Shapes.polygon({type:pd3D.Shapes.Type.SPOKES,size:.745875,thickness:.0025*t,tickSize:.015*t,segments:24},e);var i=.65;pd3D.Shapes.circle({radius:i,radiusInner:i-.0025,segments:72},e),pd3D.Shapes.polygon({type:pd3D.Shapes.Type.SPOKES,size:.66625,thickness:.0025*i,tickSize:.01625,segments:72},e),pd3D.Shapes.polygon({type:pd3D.Shapes.Type.SPOKES,size:.676,thickness:.0025*i,tickSize:.00975,segments:24},e),e.addQuad(e.addVertex([-.0015,0,0]),e.addVertex([.0015,0,0]),e.addVertex([.0015,.676,0]),e.addVertex([-.0015,.676,0])),e.addQuad(e.addVertex([-.0015,.96*t,0]),e.addVertex([.0015,.96*t,0]),e.addVertex([.0015,1.1,0]),e.addVertex([-.0015,1.1,0]));var n=[0,0,0],t=.035*i;pd3D.Font.setSize(t),pd3D.Font.aspectRatio(1),pd3D.Font.weight(300);for(var s=-180;s<180;s+=15)s%45&&(n[0]=.68575*pd.sinDegrees(s),n[1]=.68575*pd.cosDegrees(s),pd3D.Font.setRotation(-s,0,0,1),pd3D.Font.drawText(s.toFixed(0),n,e,pd.Align.CENTER,pd.Align.BOTTOM));pd3D.Font.setSize(1.25*t),pd3D.Font.weight(500);for(s=-135;s<=180;s+=45)n[0]=1.05*i*pd.sinDegrees(s),n[1]=1.05*i*pd.cosDegrees(s),pd3D.Font.setRotation(-s,0,0,1),pd3D.Font.drawText(s.toFixed(0),n,e,pd.Align.CENTER,pd.Align.BOTTOM);return pd3D.Font.clearRotations(),pd3D.Font.aspectRatio(1.25),pd3D.Font.weight(400),(this.meshAxis=e).compile(),(e=new pd3D.Mesh).addQuad(e.addVertex([-.0015,0,0]),e.addVertex([.0015,0,0]),e.addVertex([.0015,1.1,0]),e.addVertex([-.0015,1.1,0])),(this.meshLines=e).compile(),this._setAngle(this._angle,!0),this},pdGL.HotspotNorthArrow.prototype._checkToMoveModelPos=function(e,t){if(t==this.manipulatorAngle){var i=this.modelPos,n=m.normalize([e[0]-i[0],e[1]-i[1],0]),n=-m.azimuthBetweenVectors(m.unitY,n),n=pd.radiansToDegrees(n),n=pdGL.keys.SHIFT?pd.snapTo(n,15):pdGL.keys.CONTROL||pdGL.keys.META?pd.snapTo(n,.01):pd.snapTo(n,1),i=m.distancePointToPoint(e,i)/this.relativeSize;if(this._dragRadius=Math.max(this._ringRadius,i),gl.update(),this._setAngle(n))return this.emit("angle",this._angle),this._hasMoved=!0}else if(P(e,this.modelPos)){if(this.callbackOnChanging&&!this.callbackOnChanging(this,t,e))return!1;m.set(this.modelPos,e);for(var s=0,a=this.children.length;s<a;++s){var r=this.children[s];r&&r.visible&&r.updatePos&&r.updatePos()}return this.callbackOnChange&&this.callbackOnChange(this,t),gl.update(),this._hasMoved=!0}return!1},pdGL.HotspotNorthArrow.prototype._render=function(){var e=x[3],t=_[3],i=this._opacity;gl.pushMatrix(),gl.pushLineWidth(gl.getCanvasLineWidth());var n,s,a=pdGL.Hotspot3D.getRelativeSize();for(n in this.relativeSize=a,this.callbackOnDraw&&this.callbackOnDraw(this),this.transform.setTranslation(this.modelPos),this.transform.setScale(a,a,a),gl.multMatrix(this.transform),gl.pushMatrix(),gl.rotate(-this._angle,0,0,1),this._preSelected&&!this._selected&&(i*=.6),x[3]=i,g().uniform("color",x),pdGL.getDefaultMaterialMeshColor().uniform("opacity",.75),this.geometry){this.geometry.hasOwnProperty(n)&&(s=this.geometry[n]).material.renderMeshes(s.meshes,u).endRender()}if(gl.popMatrix(),this.manipulatorAngle.updatePos(),this._selected||this._preSelected){var r,o=this._preSelected?-1:0,l=this.selectedChildIndex;this._preSelected&&gl.disable(gl.DEPTH_TEST);for(var d=0,h=this.children.length;d<h;++d){var c=this.children[d];c&&c.visible&&c._render&&(r=o||(l==d?1:0),_[3]=r?Math.max(i,.25):.6*i,c._render(null,r,i))}this._preSelected&&gl.enable(gl.DEPTH_TEST)}x[3]=e,_[3]=t,gl.popLineWidth(),gl.popMatrix(),this._selected&&(t=this.modelPos,a=this._dragRadius*this.relativeSize,gl.pushMatrix(),gl.translate(t[0],t[1],t[2]),gl.scale(a,a,a),this.meshAxis.visible=!0,pdGL.getDefaultMaterialMeshColor().renderMeshes(this.meshAxis,gl.TRIANGLES).endRender(),gl.rotate(-this._angle,0,0,1),g().renderMeshes(this.meshLines,gl.TRIANGLES).endRender(),gl.popMatrix(),1==this.selectedChildIndex&&this.cancelShrinkAnimation())}}();var pdSVG=pdSVG||{};pdSVG.Analemma=function(e){var t=this;if(null==(e=e||{}).elementId)throw new Error("A valid 'elementId' is required and must be an existing SVG element in the DOM.");var i=e.elementId,n=e.throttledRescale||0,d=e.solarPosition||new pd.SolarPosition,h=0,s=$(i),i=d3.select(i),a=s[0],r=360,o=365,l=183,c=180,p=3,u=180/Math.PI,g=-25,m=25,f=-30,_=30,x=1,v=1;s.empty();var b,y,S,M,w,L=i.append("g").attr("class","background"),D=i.append("g").attr("class","grid"),T=i.append("g").attr("class","analemma"),E=i.append("g").attr("class","datetime"),A=i.append("g").attr("class","markers"),P=!0,C=d3.format(".0f"),O=function(e){return C(e)+"°"};function N(e){return l+e*v}function G(e){return c-e*x}var R=d3.svg.line().x(function(e){return N(e[0])}).y(function(e){return G(e[1])}).interpolate("linear");function I(){o=+s.width(),r=+s.height(),l=.5*o,c=.5*r,a.setAttributeNS(null,"viewBox","0 0 "+o+" "+r),p=pd.mapAndConstrainTo(r,200,1024,2.5,4),v=o/(m-g),x=r/(_-f),P=!1}function k(){var e,t;P&&I(),L.text(""),L.append("rect").attr("class","background-daylight stroke-none").attr("x",0).attr("y",0).attr("width",o).attr("height",r),D.text("");for(var i=f+5;i<30;i+=5)t=G(i),D.append("line").attr("class","line-grid").attr("x1",N(g)).attr("y1",t).attr("x2",N(m)).attr("y2",t),D.append("line").attr("class","line-axis").attr("x1",l-3).attr("y1",t).attr("x2",l+3).attr("y2",t),D.append("text").text(O(i)).attr("text-anchor","start").attr("class","text-grid").attr("dy","0.4em").attr("x",l+5).attr("y",t);for(var n=o<300?5:1,s=n;s<m;s+=n)e=N(s),D.append("line").attr("class","line-grid").attr("x1",e).attr("y1",G(f)).attr("x2",e).attr("y2",G(_)),s%5||(D.append("line").attr("class","line-axis").attr("x1",e).attr("y1",c-3).attr("x2",e).attr("y2",c+3),D.append("text").text(C(s)).attr("text-anchor","middle").attr("class","text-grid").attr("dy","1.5em").attr("x",e).attr("y",c)),e=N(-s),D.append("line").attr("class","line-grid").attr("x1",e).attr("y1",G(f)).attr("x2",e).attr("y2",G(_)),s%5||(D.append("line").attr("class","line-axis").attr("x1",e).attr("y1",c-3).attr("x2",e).attr("y2",c+3),D.append("text").text(C(-s)).attr("text-anchor","middle").attr("class","text-grid").attr("dy","1.5em").attr("x",e).attr("y",c));D.append("text").text("Equation of Time (mins)").attr("text-anchor","start").attr("class","text-axis").attr("dy","-0.6em").attr("x",5).attr("y",c),t=G(f)-10,D.append("text").text("Declination Angle (degrees)").attr("transform","rotate(-90 "+l+","+t+")").attr("text-anchor","start").attr("class","text-axis").attr("dy","-0.6em").attr("x",l).attr("y",t),D.append("line").attr("class","line-axis").attr("x1",N(g)).attr("y1",c).attr("x2",N(m)).attr("y2",c),D.append("line").attr("class","line-axis").attr("x1",l).attr("y1",G(f)).attr("x2",l).attr("y2",G(_)),E.text(""),b=E.append("line").attr("class","hilite-axis"),y=E.append("circle").attr("class","hilite-circle").attr("r",.5*p),S=E.append("line").attr("class","hilite-axis"),M=E.append("circle").attr("class","hilite-circle").attr("r",.5*p),w=E.append("circle").attr("class","hilite-circle").attr("r",1.5*p),V()}function V(){T.text(""),A.text("");var e,t=[];h=d.year();for(var i,n,s,a,r=0;r<=364;r+=2)e=d.calcJulianCenturies(r,h),t.push([60*d.calcEquationOfTime(e),d.calcSolarDeclination(e)*u]);e=d.calcJulianCenturies(0,h),t.push([60*d.calcEquationOfTime(e),d.calcSolarDeclination(e)*u]),T.append("path").attr("d",R(t)).attr("class","line-marker").attr("fill","none");for(var o=["1 Ene","1 Feb","1 Mar","1 Abr","1 May","1 Jun","1 Jul","1 Ago","1 Sep","1 Oct","1 Nov","1 Dic"],l=0;l<12;++l){switch(e=d.calcJulianCenturiesByMonth(1,l,h),i=N(60*d.calcEquationOfTime(e)),n=G(d.calcSolarDeclination(e)*u),A.append("circle").attr("class","marker-shape").attr("r",p).attr("cx",i).attr("cy",n),l){case 5:a="start",s="-0.75em";break;case 11:a="start",s="1.25em";break;case 10:case 9:case 8:case 4:a="start",s="0.35em",i+=8;break;case 6:a="end",s="-0.75em";break;case 7:case 3:case 2:case 1:a="end",s="0.35em",i-=8;break;case 0:a="end",s="1.25em"}T.append("text").text(o[l]).attr("class","text-marker").attr("text-anchor",a).attr("dy",s).attr("x",i).attr("y",n)}B()}function B(){var e=d.dayOfMonth(),t=d.monthOfYear(),e=d.calcJulianCenturiesByMonth(e,t,h),t=N(60*d.calcEquationOfTime(e)),e=G(d.calcSolarDeclination(e)*u);b.attr("x1",t).attr("y1",e).attr("x2",t).attr("y2",c),y.attr("cx",t).attr("cy",c),S.attr("x1",t).attr("y1",e).attr("x2",l).attr("y2",e),M.attr("cx",l).attr("cy",e),w.attr("cx",t).attr("cy",e)}this.undoManager=function(e){return arguments.length?(undoManager=e,t):undoManager},this.observableDayOfYear=function(e){return arguments.length?(observableDayOfYear=e,t):observableDayOfYear},this.observableMinuteOfDay=function(e){return arguments.length?(observableMinuteOfDay=e,t):observableMinuteOfDay},this.solarPosition=function(e){return arguments.length?(d=e,t.refresh(),t):d},this.width=function(e){return arguments.length?(o=parseInt(e,10),s.width(o),t.refresh(),t):o},this.height=function(e){return arguments.length?(r=parseInt(e,10),s.height(r),t.refresh(),t):r},this.throttledRescale=function(e){return arguments.length?(n=pd.constrainTo(parseInt(e,10),0,5e3),t):n};var U=null;function F(){U=null,I(),k()}return this.rescale=function(){4<n?null==U&&(U=setTimeout(F,n)):F()},this.refresh=function(){k()},this.handleLocationChange=function(){},this.handleDateTimeChange=function(){(h!=d.year()?V:B)()},this.handleDateChange=function(){(h!=d.year()?V:B)()},this.handleTimeChange=function(){},this.activateTooltip=function(){},s.attr("class","svg-chart no-select no-touch"),a.style.cursor="default",this},(pdSVG=pdSVG||{}).DayLength=function(e){var i=this;if(null==(e=e||{}).elementId)throw new Error("A valid 'elementId' is required and must be an existing SVG element in the DOM.");var t=e.elementId,n=e.throttledRescale||0,s=e.solarPosition||new pd.SolarPosition,a=!1!==e.userInteraction,r=e.observableMinuteOfDay||null,o=e.observableDayOfYear||null,l=e.undoManager||null,d=e.isTouch||!1,h=$(t),t=d3.select(t),c=h[0],p=360,u=365,g=80,m=20,f=3,_=15,x=1;h.empty();var v,b,y,S,M,w,L,D=t.append("g").attr("class","bkgnd"),T=t.append("g").attr("class","daytime"),E=t.append("g").attr("class","grid"),A=t.append("g").attr("class","datetime"),P=t.append("g").attr("class","tooltip"),C=!0,O=d3.svg.area().x(function(e){return e.dayOfYear*x}).y0(function(e){return e.sunrise*_}).y1(function(e){return e.sunset*_}).interpolate("linear"),N=d3.svg.area().x(function(e){return e.dayOfYear*x}).y0(function(e){return e.civilDawn*_}).y1(function(e){return e.civilDusk*_}).interpolate("linear"),G=d3.svg.area().x(function(e){return e.dayOfYear*x}).y0(function(e){return e.nauticalDawn*_}).y1(function(e){return e.nauticalDusk*_}).interpolate("linear"),R=d3.svg.area().x(function(e){return e.dayOfYear*x}).y0(function(e){return e.astronomicalDawn*_}).y1(function(e){return e.astronomicalDusk*_}).interpolate("linear");function I(){u=+h.width(),p=+h.height(),c.setAttributeNS(null,"viewBox","0 0 "+u+" "+p),f=pd.mapAndConstrainTo(p,200,1024,2,4),_=p/24,x=u/364,C=!1}function k(){C&&I(),D.text(""),D.append("svg:rect").attr("class","fill-night stroke-none").attr("x",0).attr("y",0).attr("width",u).attr("height",p),E.text(""),E.append("svg:line").attr("class","line-axis stroke-dotted").attr("x1",0).attr("y1",12*_).attr("x2",u).attr("y2",12*_);for(var e=0;e<24;++e)E.append("svg:line").attr("class","line-grid").attr("x1",0).attr("y1",e*_).attr("x2",u).attr("y2",e*_),E.append("svg:text").text(e<10?"0"+e:e).attr("class","text-grid").attr("dy","0.3em").attr("x",5).attr("y",(e+.5)*_);for(var t=1,i=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],n=[0,31,59,90,120,151,181,212,243,273,304,334,364],s=1;s<12;++s)E.append("svg:line").attr("class","line-grid").attr("x1",n[s]*x).attr("y1",0).attr("x2",n[s]*x).attr("y2",p),E.append("svg:text").text(i[t++]).attr("text-anchor","middle").attr("class","text-grid").attr("x",Math.round(.5*(n[s]+n[s+1]))*x).attr("y",p-7);P.text("").style("display","none"),P.append("svg:rect").attr("class","tooltip").attr("x",0).attr("y",0).attr("width",g).attr("height",m),P.append("text").attr("class","tooltip tooltip-datetime").attr("text-anchor","middle").attr("x",.5*g).attr("y",.7*m),A.text(""),v=A.append("svg:line").attr("class","hilite-axis"),b=A.append("svg:line").attr("class","hilite-axis"),y=A.append("svg:circle").attr("class","hilite-circle").attr("r",1.5*f),S=A.append("svg:circle").attr("class","hilite-shape").attr("r",f),M=A.append("svg:text").attr("class","text-hilite"),w=A.append("svg:circle").attr("class","hilite-shape").attr("r",f),L=A.append("svg:text").attr("class","text-hilite"),V()}function V(){var e=s.clockTime(),t=s.dayOfYear();T.text("");var i=s.getSunriseSunsetAsObjectArray(1);T.selectAll("fill-astronomical").data([i]).enter().append("path").attr("class","fill-astronomical").attr("d",function(e){return R(e)}),T.selectAll("fill-nautical").data([i]).enter().append("path").attr("class","fill-nautical").attr("d",function(e){return G(e)}),T.selectAll("fill-civil").data([i]).enter().append("path").attr("class","fill-civil").attr("d",function(e){return N(e)}),T.selectAll("background-daylight").data([i]).enter().append("path").attr("class","background-daylight").attr("d",function(e){return O(e)}),s.dayOfYear(t),s.clockTime(e),B()}function B(){var e=s.dayOfYear(),t=s.clockTime()*_,i=e*x;v.attr("x1",0).attr("y1",t).attr("x2",u).attr("y2",t),b.attr("x1",i).attr("y1",0).attr("x2",i).attr("y2",p),y.attr("cx",i).attr("cy",t);var n=e<183?"start":"end",t=e<183?4:-4;s.latitude()<-10&&31<e&&e<334&&(n=e<183?"end":"start",t=-t);e=s.sunriseTime();S.attr("cx",i).attr("cy",e*_),M.text(s.formatAsTime(e)).attr("text-anchor",n).attr("x",i+t).attr("y",e*_+10);e=s.sunsetTime();w.attr("cx",i).attr("cy",e*_),L.text(s.formatAsTime(e)).attr("text-anchor",n).attr("x",i+t).attr("y",e*_-4),"none"!=P.style("display")&&Q()}this.undoManager=function(e){return arguments.length?(l=e,i):l},this.observableDayOfYear=function(e){return arguments.length?(o=e,i):o},this.observableMinuteOfDay=function(e){return arguments.length?(r=e,i):r},this.solarPosition=function(e){return arguments.length?(s=e,i.refresh(),i):s},this.width=function(e){return arguments.length?(u=parseInt(e,10),h.width(u),i.refresh(),i):u},this.height=function(e){return arguments.length?(p=parseInt(e,10),h.height(p),i.refresh(),i):p},this.throttledRescale=function(e){return arguments.length?(n=pd.constrainTo(parseInt(e,10),0,5e3),i):n},this.userInteraction=function(e){if(!arguments.length)return a;var t=!1!==e;return t&&!a?h.on("mousedown touchstart",i.handlePointerDown).on("mousemove touchmove",i.handlePointerMove):!t&&a&&(c.style.cursor="default",h.off("mousedown touchstart",i.handlePointerDown).off("mousemove touchmove",i.handlePointerMove)),a=t,i};var U=null;function F(){U=null,I(),k()}this.rescale=function(){4<n?null==U&&(U=setTimeout(F,n)):F()},this.refresh=function(){k()},this.handleLocationChange=function(){V()},this.handleDateTimeChange=function(){B()},this.handleDateChange=function(){B()},this.handleTimeChange=function(){B()},this.activateTooltip=function(){"none"==P.style("display")&&(P.style("display","inline"),Q()),null!=j&&clearTimeout(j),j=setTimeout(function(){P.style("display","none"),j=null},1500)};var H=0,z=1,W=2,j=null,Y={minute:-1,day:-1},q={minute:-1,day:-1},X=H,J=!1;function Q(){var e=s.dayOfYear(),t=s.clockTime(),i=e*x-10-g,n=t*_-10-m;i<5&&(i=e*x+10),n<5&&(n=t*_+10),P.select(".tooltip-datetime").text(s.formatAsTime(t)+", "+s.formatAsDate(e)),P.attr("transform",function(){return"translate("+i+", "+n+")"})}function Z(e,t){t=t||{minute:-1,day:-1};var i=c.getBoundingClientRect();return t.minute=Math.round((e.pageY-i.top)/(i.bottom-i.top)*24*60),t.day=Math.round((e.pageX-i.left)/(i.right-i.left)*365),t}function K(e){var t=Z(e);X!=z&&(o?o(t.day):s.setDayOfYear(t.day)),X!=W&&(r?r(t.minute):s.setTimeOfDay(t.minute/60)),e.preventDefault()}function ee(e){var t=Z(e);X=H;e=r?r():60*s.clockTime();pd.closeTo(t.minute,e,30)&&(X+=z);e=o?o():s.dayOfYear();return pd.closeTo(t.day,e,5)&&(X+=W),X}function te(e){var t;J&&(e.preventDefault(),e=pd.preprocessMouseOrTouchEvent(e,c),d&&X==H?((t=Z(e)).minute=Y.minute+(t.minute-q.minute),t.day=Y.day+(t.day-q.day),X!=z&&(o?o(t.day):s.setDayOfYear(t.day)),X!=W&&(r?r(t.minute):s.setTimeOfDay(t.minute/60))):K(e),e.preventDefault())}this.handlePointerDown=function(e){e.preventDefault(),e=pd.preprocessMouseOrTouchEvent(e,c),J=1==e.which&&(Z(e,q),Y.minute=r?r():60*s.clockTime(),Y.day=o?o():s.dayOfYear(),window.addEventListener("mousemove",te,!0),window.addEventListener("touchmove",te,!0),window.addEventListener("touchcancel",ne,!0),window.addEventListener("touchend",ne,!0),window.addEventListener("mouseup",ne,!0),l&&l.storeValues(o,r),ee(e)==H&&(d||K(e)),null!=j&&clearTimeout(j),P.style("display","inline"),!0)};var ie;function ne(e){window.removeEventListener("mousemove",te,!0),window.removeEventListener("touchmove",te,!0),window.removeEventListener("touchcancel",ne,!0),window.removeEventListener("touchend",ne,!0),window.removeEventListener("mouseup",ne,!0),J=!1,l&&l.checkForChanges(),null!=j&&clearTimeout(j),j=setTimeout(function(){P.style("display","none"),j=null},1500),X=-1,i.handlePointerMove(e)}return this.handlePointerMove=function(e){J?d||X!=H?X==H&&(c.style.cursor="cell"):(c.style.cursor="pointer",X=3):(ie=X,ee(e=pd.preprocessMouseOrTouchEvent(e,c))!=ie&&(c.style.cursor=X==z?"ns-resize":X==W?"ew-resize":3==X?"pointer":"default"))},h.attr("class","svg-chart no-select no-touch"),a&&$(document).ready(function(){h.on("mousedown touchstart",i.handlePointerDown).on("mousemove touchmove",i.handlePointerMove)}),this},function(){var c=!1,p=0,u=0,g=0,m=0,f=0;pd.preprocessMouseOrTouchEvent=function(t,e,i){var n,s={};for(n in t)"function"==typeof t[n]?s[n]=function(e){return function(){e.apply(t,arguments)}}(t[n]):s[n]=t[n];var a=0<(s.original=t).type.length&&"p"==t.type.charAt(0)&&t.pointerType&&"touch"==t.pointerType;if(0<s.type.length&&"t"==s.type.charAt(0)){var r=s.targetTouches||s.originalEvent.targetTouches;if(r&&0<r.length){c="touchmove"==s.type,p=r.length,s.button=p,s.which=p,a=!0;var o=0;if(!isNaN(i)&&0<=i)for(var l=0,d=r.length;l<d;++l)if(i==r[l].identifier){o=l;break}var h=r[o];s.pageX=h.pageX,s.pageY=h.pageY}}else switch(s.type){case"pointerdown":if(a){s.which=p+1;break}case"mousedown":0<s.which&&(p=s.which);break;case"pointermove":s.which=p;case"mousemove":c=0<p;break;case"pointerup":if(a){t.isPrimary&&(c=!1),s.which=p;break}case"mouseup":0<s.which&&(p=0,c=!1);break;case"mousewheel":case"DOMMouseScroll":s.delta=pd.sign(pdDOM.getScrollIncrement(t));break;case"keydown":s.delta=pd.sign(pdDOM.getKbdIncrement(t))}return s.x=s.pageX,s.y=s.pageY,e&&e.getBoundingClientRect&&(h=1/pdDOM.pageScale,(e=e.getBoundingClientRect()).left&&(s.x-=Math.round(e.left*h)),e.top&&(s.y-=Math.round(e.top*h))),a?(c?(s.dragX=s.x-u,s.dragY=s.y-g):(s.dragX=0,s.dragY=0),u=s.x,g=s.y):(c?(s.dragX=s.x-m,s.dragY=s.y-f):(s.dragX=0,s.dragY=0),m=s.x,f=s.y),s.dragging=c,s.preventDefault=function(){s.original.preventDefault()},s.stopPropagation=function(){s.original.stopPropagation()},s}}(),pdGL.Apphelion3D=function(n,t){var s=this,i=(t=t||{}).radius||1e3,_=t.arrowSize||1,a=t.arrowStyle||0,x=t.labelAngle||15,v=t.tickOffset||.0075,b=t.textSize||.02,y=t.tickSize||.01,u=t.solarPosition||new pd.SolarPosition,r=!1!==t.horizonClipping,o=t.center||[0,0,0],l=t.lineWidthThin||n.getCanvasLineWidthThin(),d=t.lineWidthThick||n.getCanvasLineWidthThick(),h=t.colorDiagramLines||[.4,.4,.4,1],c=t.colorDiagramText||[.1,.1,.1,1],p=t.colorCurrentDateTime||[1,0,0,1],g=t.colorApphelionLines||[.8,.5,.1,1],m=t.colorApphelionMesh||[1,1,0,1],f=t.colorSolarArrow||[0,0,.75,1],S=t.colorAngleLines||[1,0,0,1],M=t.colorAngleMesh||[1,1,1,.75],w=t.showNorth||!1,L=pd.constrainTo(t.dayIncrement||2,1,30),D=pd.constrainTo(t.timeIncrement||.03125,.01,3),T=t.dayForMonthLine||21,E=!1,A=t.shadingMask||null,P=!1,C=pd.toNumber(t.skyOpacity,.5),O=1,N=1,G=.1,R=(new pd.SolarPosition).setLocation(0,0,0),I=new pd3D.MatrixAccumulator,k=new pd3D.MatrixAccumulator,V=new pd3D.Vector,B=[0,0,0],U=new pd3D.Matrix,F=new pd3D.Matrix,H=new pd3D.Matrix,z=new pd3D.Matrix,W={baseAxis:new pd3D.Mesh({triangles:!1,lines:!0,twoSided:!0}),baseAxisText:new pd3D.Mesh({triangles:!0,twoSided:!0}),annualShell:new pd3D.Mesh({normals:!0,lines:!0,twoSided:!0}),annualApphelion:new pd3D.Mesh({triangles:!1,lines:!0}),solarArrow:new pd3D.Mesh({triangles:!1,colors:!0,lines:!0}),angleLines:new pd3D.Mesh({triangles:!0,lines:!0,colors:!0,twoSided:!0,visible:!1}),dailyApphelion:new pd3D.Mesh({triangles:!0,lines:!0,twoSided:!0}),solarSphere:new pd3D.Shapes.sphere({normals:!0,radius:.0125}),shading:new pd3D.Mesh({triangles:!0,colors:!0,lines:!0,coords:!0,twoSided:!0})};this.PROJ_SPHERICAL=0,this.PROJ_EQUIDISTANT=1,this.PROJ_STEREOGRAPHIC=2,this.PROJ_CARTESIAN=3;var e,j,Y=pd.constrainTo(pd.toInteger(t.projectionType,this.PROJ_SPHERICAL),this.PROJ_SPHERICAL,this.PROJ_CARTESIAN),q=[Y==this.PROJ_SPHERICAL?1:0,Y==this.PROJ_EQUIDISTANT?1:0,Y==this.PROJ_STEREOGRAPHIC?1:0],X=new pdGL.Shader("\nuniform mat4 objMatrix;\nvarying vec4 worldPosition;\n\nvoid main() {\n    gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\n    worldPosition = objMatrix * gl_Vertex;\n}\n","\nuniform vec4 color;\nuniform float opacity;\nvarying vec4 worldPosition;\n\nvoid main() {\n    float alpha = clamp(opacity * color.a, 0.0, 1.0);\n    gl_FragColor = vec4(color.rgb, alpha);\n    if (worldPosition.z < 0.0)\n        discard;\n}\n"),J=new pdGL.Shader("\nvarying vec3 vNormal;\nvarying vec3 vVertexDir;\n\nvoid main() {\n    vNormal = gl_NormalMatrix * gl_Normal;\n    gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\n    vec4 vtx = gl_ModelViewMatrix * gl_Vertex;\n    vVertexDir = vtx.xyz / vtx.w;\n}\n","\nuniform float sunIntensity;\nvarying vec3 vVertexDir;\nvarying vec3 vNormal;\n\nvoid main() {\n    if (sunIntensity > 0.0) {\n        float viewIncidence = abs(dot(normalize(vVertexDir), normalize(vNormal)));\n        float incidence = (viewIncidence > 0.95) ? 1.0 - (20.0 * (viewIncidence - 0.9499)) : viewIncidence;\n        float opacity = sunIntensity * 0.75 * clamp(pow(incidence, 2.5), 0.0, 1.0);\n        gl_FragColor = vec4(1.0, 1.0, 0.0, opacity);\n    } else {\n        discard;\n    }\n}\n"),Q=new pdGL.Shader("\nuniform vec4 color;\nuniform vec3 projection;\nuniform bool useVertexColors;\nvarying vec4 vColor;\n\nconst float DEG2RAD = 0.017453292519943;\nconst float PIon2 = 1.570796326794897;\nconst float PIon4 = 0.785398163397448;\n\nvoid main() {\n    float azi = gl_TexCoord.x * DEG2RAD;\n    float alt = gl_TexCoord.y * DEG2RAD;\n    float radius = projection.x * cos(alt);\n    radius += projection.y * abs(1.0 - (alt / PIon2));\n    radius += projection.z * (1.0 - (atan(clamp(alt / PIon2, 0.0, 1.0)) / PIon4));\n    vColor = (useVertexColors == true) ? gl_Color : color;\n    vec4 pos = vec4(radius * sin(azi), radius * cos(azi), 0.0, 1.0);\n    gl_Position = gl_ModelViewProjectionMatrix * pos;\n}\n","\nuniform float opacity;\nvarying vec4 vColor;\nvarying float zPos;\n\nvoid main() {\n    float alpha = clamp(opacity * vColor.a, 0.0, 1.0);\n    gl_FragColor = vec4(vColor.rgb, alpha);\n    if (alpha < 0.001) {\n        discard;\n    }\n}\n"),Z=pdGL.Material.VariableColorUniformPointSize(),K=pdGL.Material.FixedColorUniformPointSize(),$=r?X:K.shader();function ee(e){return 1e-9<e[0]||e[0]<-1e-9||1e-9<e[1]||e[1]<-1e-9||1e-9<e[2]||e[2]<-1e-9}function te(){if(W.annualShell.visible){var e=W.annualShell;e.triangles.length=0;for(var t,i,n=e.vertices.length=0,s=0,a=u.year(),r=0,o=0,l=0,d=[171,211,231,252,272,292,313,354],h=d.length-1;0<=h;h--){if(i=d[h],R.setDayOfYear(Math.round(i),a).calculate(),R.getHourlyApphelionAsPositions3D(.25,B,1,!1,e),0==r&&(r=e.vertices.length),0<n){l=n,o=s;for(var c=1;c<r-1;++c)e.triangles.push([o,l,l+1]),e.triangles.push([l+1,o+1,o]),o++,l++;e.triangles.push([o,l,n]),e.triangles.push([n,s,o]),s=n}for(var c=n,p=e.vertices.length;c<p;++c)t=e.vertices[c],e.normals.push([t[0],t[1],t[2]]);n=e.vertices.length}e.compile()}}function ie(){if(W.annualApphelion.visible){var e=W.annualApphelion,t=u.year();e.vertices.length=0,e.lines.length=0,R.setDayMonthYear(21,5,t).calculate(),R.getHourlyApphelionAsPositions3D(.25,B,1,!0,e);R.dayOfYear();for(var i in[6,7,8,9,10])R.setDayMonthYear(T,i,t).calculate(),R.getHourlyApphelionAsPositions3D(D,B,1,!1,e);R.setDayMonthYear(21,11,t).calculate(),R.getHourlyApphelionAsPositions3D(.25,B,1,!0,e),R.dayOfYear();for(var n=0;n<24;++n)R.setTimeOfDay(n),R.getAnalemmaApphelionAsPositions3D(12==n?4:L,B,1,12==n,e);e.compile()}}function ne(){var e,t,i;W.solarArrow.visible&&((e=W.solarArrow).vertices.length=0,e.colors.length=0,e.lines.length=0,.1<a?(t=1.5*_,i=.02*_,e.color(f),e.addVertex([0,0,0]),e.addVertex([t,0,0]),t-=a*i,e.addVertex([t,0,-i]),e.addVertex([t,0,i]),e.lines.push([0,1]),e.lines.push([1,2]),e.lines.push([1,3])):(e.color(f),e.addVertex([0,0,0]),e.addVertex([1,0,0]),e.color([f[0],f[1],f[2],0]),e.addVertex([10,0,0]),e.lines.push([0,1]),e.lines.push([1,2])),e.compile())}function se(){var e=W.dailyApphelion;e.reuseStart(),e.visible?R.setDayOfYear(u.dayOfYear(),u.year()):u.latitude()<0?R.setDayOfYear(354,u.year()):R.setDayOfYear(171,u.year()),R.reuseHourlyApphelionAsPositions3D(.25,B,1,!0,e);var t,i=u.latitude()<0?-1.5*b:1.5*b,n=.2*i,s=0,a=e._vtx_index;u.latitude()<0?pd3D.Matrix.scale(-b,-b,-b,F):pd3D.Matrix.scale(b,b,b,F);for(var r=0;r<a;r+=4)s++<24&&(t=e.vertices[r],e.addLine(e.addVertex([t[0],t[1]+n,t[2]]),e.addVertex([t[0],t[1]-n,t[2]])));pd3D.Font.weight(400);for(r=s=0;r<a;r+=4)s<24&&(t=e.vertices[r],pd3D.Matrix.translate(t[0],t[1]+i,t[2],H),H.multiplyBy(pd3D.Matrix.rotate(180+s/24*360,0,-1,0)),H.multiplyBy(F),pd3D.Font.addText(s<10?"0"+s:s.toString(),pd.Align.CENTER,pd.Align.CENTER,H,e)),s++;e.reuseEnd(),e.compile()}function ae(e,t,i){for(var n,s=0,a=i.vertexCount(),r=0;r<=1;r+=.01)n=1-r,i.addVertex([n*e[0]+r*t[0],n*e[1]+r*t[1],n*e[2]+r*t[2]]),a++,++s%2&&i.addLine(a-1,a)}function re(){var e,t,i,n,s,a,r,o,l,d;V.normalize(),pd3D.Matrix.translate(V.x,V.y,V.z,U),k.reset().rotate(90-u.azimuthAngle(),0,0,1).rotate(u.altitudeAngle(),0,-1,0),W.angleLines.visible&&(e=W.angleLines,l=1.25*b,t=u.azimuthAngle(),i=u.altitudeAngle(),n=1.05+4*y+b,e.reuseStart(),e.color(M),pd3D.Matrix.rotate(-t,0,0,1,z),z.multiplyBy(pd3D.Matrix.rotate(-90,0,1,0)),o={width:.025,radius:n,center:B,defaultNormal:[0,0,1],defaultColor:[1,0,0,.5],fromAngle:0,toAngle:t,triangles:!0,colors:!0,lines:!0},pd3D.Shapes.circularArrow(o,e),o.center=[0,0,0],o.toAngle=i,o.transform=z,pd3D.Shapes.circularArrow(o,e),e.color(p),d=n+.025+.1,s=t*pd.Const.DEG2RAD,o=[d*(a=Math.sin(s)),d*(r=Math.cos(s)),0],W.solarArrow.visible||ae(B,pd3D.Vector.multiply(V,d).toArray(),e),ae(B,[0,d,0],e),ae(B,o,e),n+=.025+.6*l,o[0]=n*Math.sin(.5*s),o[1]=n*Math.cos(.5*s),pd3D.Font.weight(400),pd3D.Matrix.scale(l,l,l,F),pd3D.Matrix.translate(o[0],o[1],o[2],H),H.multiplyBy(pd3D.Matrix.rotate(-.5*t,0,0,1)),H.multiplyBy(F),pd3D.Font.addText(t.toFixed(2)+"`",pd.Align.CENTER,pd.Align.CENTER,H,e),l=.5*(i*pd.Const.DEG2RAD),d=n*Math.cos(l),o[0]=d*a,o[1]=d*r,o[2]=n*Math.sin(l),pd3D.Matrix.translate(o[0],o[1],o[2],H),H.multiplyBy(pd3D.Matrix.rotate(-t,0,0,1)),H.multiplyBy(pd3D.Matrix.rotate(.5*i,1,0,0)),H.multiplyBy(pd3D.Matrix.rotate(-90,0,1,0)),H.multiplyBy(F),pd3D.Font.addText(i.toFixed(2)+"`",pd.Align.CENTER,pd.Align.CENTER,H,e),e.reuseEnd(),e.compile())}function oe(){W.shading.visible&&pd.Shading&&(A=A||new pd.Shading(t.shadingOptions)).copyToMesh(W.shading,O)}function le(){I.reset().rotate(u.latitude(),1,0,0).rotate(u.timezoneCorrection()/24*360,0,-1,0),se(),E=!0}function de(e,t){var i=!1;switch(t=!!t,e){case s.Component.AXIS:W.baseAxisText.visible=t,W.baseAxis.visible=t;break;case s.Component.ANNUAL_AREA:(W.annualShell.visible=t)&&W.annualShell.vertices.length<1&&(te(),E||le());break;case s.Component.ANNUAL_LINES:(W.annualApphelion.visible=t)&&W.annualApphelion.vertices.length<1&&(ie(),E||le());break;case s.Component.SUN_DIRECTION:(W.solarArrow.visible=t)&&W.solarArrow.vertices.length<1&&ne(),W.angleLines.visible&&re();break;case s.Component.SUN_ANGLES:i=t&&!W.angleLines.visible,W.angleLines.visible=t,(i||t&&W.angleLines.vertices.length<1)&&re();break;case s.Component.DIURNAL_SUN_PATH:i=t&&!W.dailyApphelion.visible,W.dailyApphelion.visible=t,i&&(se(),E||le());break;case s.Component.SUN_POSITION:W.solarSphere.visible=t;break;case s.Component.SHADING:W.shading.visible!=t&&(W.shading.visible=t,W.shading.visible&&(W.shading.vertices.length<1?oe():P&&s.updateShading()));break;case s.Component.ALL:for(var n=s.Component.ALL-1;0<=n;n--)de(n,t)}}function he(){return"Color values must be given as [r,g,b,a] arrays."}return this.Component={AXIS:0,ANNUAL_AREA:1,ANNUAL_LINES:2,SUN_DIRECTION:3,SUN_ANGLES:4,DIURNAL_SUN_PATH:5,SUN_POSITION:6,SHADING:7,ALL:8},W.baseAxis.visible=void 0===t.showAxis||!!t.showAxis,W.baseAxisText.visible=void 0===t.showAxis||!!t.showAxis,W.annualShell.visible=void 0===t.showAnnualArea||!!t.showAnnualArea,W.annualApphelion.visible=void 0===t.showAnnualLines||!!t.showAnnualLines,W.solarArrow.visible=void 0===t.showSunDirection||!!t.showSunDirection,W.angleLines.visible=void 0!==t.showSunAngles&&!!t.showSunAngles,W.dailyApphelion.visible=void 0===t.showApphelion||!!t.showApphelion,W.solarSphere.visible=void 0===t.showSunPos||!!t.showSunPos,W.shading.visible=void 0!==t.showShading&&!!t.showShading,this.visible=!0,this.show=function(e){for(var t=void 0!==e&&pd.isArray(e)?e:arguments,i=0,n=t.length;i<n;++i)de(+t[i],!0);return s},this.hide=function(e){for(var t=void 0!==e&&pd.isArray(e)?e:arguments,i=0,n=t.length;i<n;++i)de(+t[i],!1);return s},this.isVisible=function(e){switch(e){case s.Component.AXIS:return W.baseAxis.visible;case s.Component.ANNUAL_AREA:return W.annualShell.visible;case s.Component.ANNUAL_LINES:return W.annualApphelion.visible;case s.Component.SUN_DIRECTION:return W.solarArrow.visible;case s.Component.SUN_ANGLES:return W.angleLines.visible;case s.Component.DIURNAL_SUN_PATH:return W.dailyApphelion.visible;case s.Component.SUN_POSITION:return W.solarSphere.visible;case s.Component.ALL:return W.baseAxis.visible&&W.baseAxisText.visible&&W.annualShell.visible&&W.annualApphelion.visible&&W.solarArrow.visible&&W.angleLines.visible&&W.dailyApphelion.visible&&W.solarSphere.visible}return!1},this.showAll=function(){return W.baseAxis.show(!0),W.baseAxisText.show(!0),W.annualShell.show(!0),W.annualApphelion.show(!0),W.solarArrow.show(!0),W.angleLines.show(!0),W.dailyApphelion.show(!0),W.solarSphere.show(!0),s},this.components=function(){return W},this.setCenterAndRadius=function(e,t){return this.center(e),this.radius(t),s},this.moveTo=function(e,t,i){return o[0]=pd.toNumber(e,o[0]),o[1]=pd.toNumber(t,o[1]),o[2]=pd.toNumber(i,o[2]),s},this.radius=function(e){return arguments.length?(i=pd.toNumber(e,i),s):i},this.center=function(e){return arguments.length?(pd.isArray(e)&&3<=e.length&&(o=e),s):o},this.solarPosition=function(e){return arguments.length?(u=e,le(),s):u},this.lineWidthThin=function(e){return arguments.length?(l=pd.toNumber(e,l),s):l},this.lineWidthThick=function(e){return arguments.length?(d=pd.toNumber(e,d),s):d},this.dayForMonthLine=function(e){return arguments.length?((e=pd.constrainTo(parseInt(e,10),1,31))!=T&&(T=e,ie()),s):T},this.horizonClipping=function(e){return arguments.length?(r=pd.toBoolean(e,r),$=r?X:K.shader(),s):r},this.projectionType=function(e){return arguments.length?(e=pd.constrainTo(pd.toInteger(e,s.PROJ_EQUIDISTANT),s.PROJ_SPHERICAL,s.PROJ_CARTESIAN),q[0]=e==this.PROJ_SPHERICAL?1:0,q[1]=e==this.PROJ_EQUIDISTANT?1:0,q[2]=e==this.PROJ_STEREOGRAPHIC?1:0,Y=e,s):Y},this.projectionTransitions=function(){return q},this.colorCurrentDateTime=function(e){if(!arguments.length)return p;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return p=e,s},this.colorDiagramLines=function(e){if(!arguments.length)return h;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return h=e,s},this.colorDiagramText=function(e){if(!arguments.length)return c;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return c=e,s},this.colorSolarArrow=function(e){if(!arguments.length)return f;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return f=e,s},this.colorAngleLines=function(e){if(!arguments.length)return S;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return S=e,s},this.colorAngleMesh=function(e){if(!arguments.length)return M;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return M=e,s},this.colorApphelionLines=function(e){if(!arguments.length)return g;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return g=e,s},this.colorApphelionMesh=function(e){if(!arguments.length)return m;if(!pd.isArray(e)||4!=e.length)throw new Error(he());return m=e,s},this.skyFactorLuminance=0,this.skyFactorUniform=0,this.shadingMask=function(e){return arguments.length?((A=e)||W.shading.clear(),s):A=A||new pd.Shading(t.shadingOptions)},this.newShadingIterator=function(){return A?A.newShadingIterator():null},this.showSkySegments=function(e){return arguments.length?(G=e?.6:.1,s):.2<G},this.getShading=function(){return A?A.getShadingData():null},this.setShadingSegmentValue=function(e,t){return A&&A.setSkyPatchShading(e,t),s},this.setShadingSegmentColor=function(e,t){return A&&A.setSkyPatchColor(e,t),s},this.updateShading=function(e){return A&&(P=!W.shading.visible||(e&&A.copyToMesh(W.shading,O),e=A.updateMesh(W.shading),this.skyFactorLuminance=e.skyFactorLuminance,this.skyFactorUniform=e.skyFactorUniform,!1)),s},this.setShading=function(e,t){return A&&A.setShadingData(e),t||s.updateShading(),s},this.clearShading=function(e){return A&&A.clearShadingData(),e||s.updateShading(),s},this.projectOnDome=function(t){if(A){var i=!1;if(t&&O<1||!t&&0<O)return n.animationQueue.add(function(e){return!t&&0<O?(O-=2*e)<0&&(i=!(O=0)):t&&O<1&&1<(O+=2*e)&&(O=1,i=!0),A.transitionShape(O,W.shading),n.update(),i}),!0}return!1},this.animateShading=function(e){if(A&&e){return A.setShadingData(e),n.animationQueue.add(function(e){return 1<N&&(N=1),A.transitionData(N,W.shading),n.update(),!1}),!(N=0)}return!1},this.handleLocationChange=function(){return le(),s},this.handleDateChange=function(){return se(),s},this.handleTimeChange=function(e){return e?V.init(e):V.fromArray(u.getSunDirection()),re(),s},this.handleDateTimeChange=function(){s.handleDateChange(),s.handleTimeChange()},this.handleNorthChange=function(){return s},this.getAABB=function(e){return this.visible&&(e&&e.min||((e={min:new pd3D.Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}).max=e.min.negative()),e.min.x>o[0]-i&&(e.min.x=o[0]-i),e.min.y>o[1]-i&&(e.min.y=o[1]-i),e.min.z>o[2]&&(e.min.z=o[2]),e.max.x<o[0]+i&&(e.max.x=o[0]+i),e.max.y<o[1]+i&&(e.max.y=o[1]+i),e.max.z<o[2]+i&&(e.max.z=o[2]+i)),e},this.drawOutlines=function(){var e,t;return this.visible&&(n.pushMatrix(),n.pushLineWidth(),n.depthMask(!1),ee(o)&&n.translate(o[0],o[1],o[2]),n.scale(i,i,i),e=u.northOffset(),pd.closeTo(e,0,.001)||n.rotate(-e,0,0,1),W.baseAxis.visible&&(n.lineWidth(l),K.uniform("color",h).drawOutline(W.baseAxis)),W.baseAxisText.visible&&(pd3D.Font.isTriangulated?K.uniform("color",c).drawSurface(W.baseAxisText):(n.lineWidth(d),K.uniform("color",c).drawOutline(W.baseAxisText))),W.solarArrow.visible&&(n.pushMatrix(),n.multMatrix(k.toMatrix()),n.lineWidth(.5*(d+l)),(.1<a?K.uniform("color",f):Z).drawOutline(W.solarArrow),n.popMatrix()),W.angleLines.visible&&(n.lineWidth(l),K.uniform("color",S).drawOutline(W.angleLines)),(W.annualApphelion.visible||W.dailyApphelion.visible)&&(n.pushMatrix(),t=I.toMatrix(),$.uniforms({opacity:1,objMatrix:t}),n.multMatrix(t),W.annualApphelion.visible&&(n.lineWidth(l),$.uniforms({color:g}).draw(W.annualApphelion,n.LINES)),W.dailyApphelion.visible&&(n.lineWidth(W.annualApphelion.visible?d:l),$.uniforms({color:p}).draw(W.dailyApphelion,n.LINES)),n.popMatrix()),W.shading.visible&&(pd.closeTo(e,0,.001)||n.rotate(e,0,0,1),n.depthMask(!1),n.lineWidth(l),K.uniform("color",h).pushUniform("opacity",G).drawOutline(W.shading).popUniform(),Z.pushUniform("opacity",C).drawSurface(W.shading).popUniform(),n.depthMask(!0)),n.popLineWidth(),n.popMatrix()),s},this.drawSurfaces=function(){var e,t;return this.visible&&(n.pushMatrix(),ee(o)&&n.translate(o[0],o[1],o[2]),n.scale(i,i,i),e=u.northOffset(),pd.closeTo(e,0,.001)||n.rotate(-e,0,0,1),W.solarSphere.visible&&(n.pushMatrix(),n.multMatrix(U),K.uniform("color",p).drawSurface(W.solarSphere),n.scale(4,4,4),n.depthMask(!1),J.uniforms({sunIntensity:pd.mapAndConstrainTo(V.z,.0523359,.1564345,0,1)}).draw(W.solarSphere,n.TRIANGLES),n.depthMask(!0),n.popMatrix()),W.angleLines.visible&&Z.uniform("opacity",1).drawSurface(W.angleLines),(W.annualShell.visible||W.dailyApphelion.visible)&&(n.pushMatrix(),t=I.toMatrix(),$.uniforms({objMatrix:t}),n.multMatrix(t),n.depthMask(!1),n.setCullFace(!1),W.dailyApphelion.visible&&$.uniforms({opacity:1,color:p}).draw(W.dailyApphelion,n.TRIANGLES),W.annualShell.visible&&$.uniforms({opacity:.15,color:m}).draw(W.annualShell,n.TRIANGLES),n.depthMask(!0),n.setCullFace(),n.popMatrix()),W.shading.visible&&(pd.closeTo(e,0,.001)||n.rotate(e,0,0,1),n.depthMask(!1),Z.pushUniform("opacity",C).drawSurface(W.shading).popUniform(),n.depthMask(!0)),n.popMatrix()),s},this.draw2D=function(e,t){return n.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),W.shading.visible&&(n.orbitalView.startOverlay2D(1e3,1e3),n.pushMatrix(),n.pushLineWidth(),t=pd.toNumberInRange(t,256,1,Number.POSITIVE_INFINITY),n.translate(+e,+e,0),n.scale(t,-t,1),t=u.northOffset(),pd.closeTo(t,0,.001)||n.rotate(t,0,0,1),Q.uniforms({projection:q}),Q.uniforms({opacity:1,useVertexColors:!0}).draw(W.shading,n.TRIANGLES),n.lineWidth(l),(.2<G?Q.uniforms({opacity:G,color:c,useVertexColors:!1}):Q.uniforms({opacity:1,useVertexColors:!0})).draw(W.shading,n.LINES),n.setCullFace(),n.popLineWidth(),n.popMatrix(),n.orbitalView.endOverlay2D()),s},this.drawWithMaterial=function(e,t){return this.visible&&(t==n.TRIANGLES?s.drawSurfaces():t==n.LINES&&s.drawOutlines()),s},this.draw=function(e){return this.visible&&(e==n.LINES||e==pd3D.RENDER_FIRST?s.drawOutlines():s.drawSurfaces()),s},function(){var e,t=W.baseAxis;t.reuseStart();for(var i,n,s,a,r,o=1+v,l=o+y,d=o+2.5*y,h=o+1.5*y,c=o+3*y+.6*b,p=0;p<=360;++p)e=pd.sinDegrees(p),a=pd.cosDegrees(p),i=p%5?l:p%15==0?d:h,n=t.addVertex([e,a,0]),s=t.addVertex([o*e,o*a,0]),a=t.addVertex([i*e,i*a,0]),t.addLine(s,a),0<p&&t.addLine(r,n),r=n;t.addLine(t.addVertex([0,-d,0]),t.addVertex([0,d,0])),t.addLine(t.addVertex([-d,0,0]),t.addVertex([d,0,0])),t.reuseEnd(),t.compile();var u=W.baseAxisText;u.reuseStart();var g="",m=b;pd3D.Font.weight(400),pd3D.Matrix.scale(m,m,m,F);for(var f,p=0;p<360;p+=x)p%45&&(pd3D.Matrix.translate(c*pd.sinDegrees(p),c*pd.cosDegrees(p),0,H),H.multiplyBy(pd3D.Matrix.rotate(-p,0,0,1)),H.multiplyBy(F),pd3D.Font.addText(p.toString(),pd.Align.CENTER,pd.Align.CENTER,H,u));for(pd3D.Font.weight(600),m*=1.25,w&&(f=b*_,pd3D.Matrix.scale(1.5*m,1.5*m,1.5*m,F),pd3D.Matrix.translate(0,d+1.41421*f+m,0,H),H.multiplyBy(F),pd3D.Font.addText("N",pd.Align.CENTER,pd.Align.CENTER,H,u),u.addTriangle(u.addVertex([0,d+1.41421*f,0]),u.addVertex([-f,d,0]),u.addVertex([f,d,0]))),pd3D.Matrix.scale(m,m,m,F),p=w?45:0;p<360;p+=45){switch(p){case 0:g="N";break;case 45:g="NE";break;case 90:g="E";break;case 135:g="SE";break;case 180:g="S";break;case 225:g="SW";break;case 270:g="W";break;case 315:g="NW"}pd3D.Matrix.translate(c*pd.sinDegrees(p),c*pd.cosDegrees(p),0,H),H.multiplyBy(pd3D.Matrix.rotate(-p,0,0,1)),H.multiplyBy(F),pd3D.Font.addText(g,pd.Align.CENTER,pd.Align.CENTER,H,u)}u.reuseEnd(),u.compile()}(),te(),ie(),W.solarSphere.visible&&(e=W.solarSphere,j=.01*_,e.vertices=e.vertices.map(function(e){return pd3D.Vector.fromArray(e).normalize().scale(j).toArray()}),e.compile()),ne(),re(),oe(),(W.annualShell.visible||W.annualApphelion.visible)&&le(),this.visible=pd.toBoolean(t.visible,!0),this},(pdSVG=pdSVG||{}).Apphelion2D=function(e){var m=this;if(null==(e=e||{}).elementId)throw new Error("A valid 'elementId' is required and must be an existing SVG element in the DOM.");var t=e.elementId||"svg",r=e.solarPosition||new pd.SolarPosition,f=pd.toBoolean(e.showBackground,!0),_=pd.toBoolean(e.fullScreenRect,!1),i=pd.toBoolean(e.userInteraction,!0),o=pd.toInteger(e.dayForMonthlyLines,21),n=pd.toInteger(e.throttledRescale,0),s=pd.toInteger(e.minChartWidth,0),a=pd.toInteger(e.minChartHeight,0),l=pd.toBoolean(e.showSkySegments,!1),d=e.undoManager||null,h=e.observableLatitude||null,c=e.observableLongitude||null,p=e.observableDate||null,u=e.observableTime||null,x=pd.toNumber(e.tooltipHeight,20),v=pd.toNumber(e.tooltipWidth,80),g=e.defaultCursor||"default",b=e.shadingMask||null,y=0,S=0,M=null,w=$(t),L=d3.select(t),D=w[0],T=720,E=720,A=.44,P=T*A,C=3;w.empty(),L.append("style");var O=L.append("g").attr({id:"background",class:"background no-pointer"}),N=L.append("g").attr({id:"world-map",class:"world-map"}),G=L.append("g").attr({id:"shading",class:"shading"}),R=L.append("g").attr({id:"shading-offset",class:"shading offset"}).style("visibility","hidden"),I=L.append("g").attr({id:"diagram",class:"diagram no-pointer"}),k=L.append("g").attr({id:"diagram-text",class:"diagram-text no-pointer"}),V=L.append("g").attr({id:"sun-angles",class:"sun-angles no-pointer"}),B=L.append("g").attr({id:"sun-arc",class:"sun-arc no-pointer"}),U=L.append("g").attr({id:"sun-path",class:"sun-path no-pointer"}),F=L.append("g").attr({id:"sun-pos",class:"sun-pos no-pointer"}),H=L.append("g").attr({id:"sun-line",class:"sun-line no-pointer"}),z=L.append("g").attr({id:"overlay",class:"overlay no-pointer"}),W=L.append("g").attr({id:"tooltip",class:"chart-tooltip no-pointer"}),j=null,Y=null,q=pd.toBoolean(e.showDataOverlay,!1),X=pd.toBoolean(e.showLegend,!1),J=e.callbackDblClickLegend||null,Q=0,Z=null,K=null,ee=null,te=null,ie=null,ne=null,se=null,ae=null,re=null,oe=null,le=null,de=null,he=null,ce=null,pe=null,ue=null,ge=null,me=null,fe=null,_e=!0,xe=!1,ve=new pd.SolarPosition,be=null;this.Component={AXIS:0,ANNUAL_AREA:1,ANNUAL_LINES:2,WORLD_MAP:3,SUN_ANGLES:4,DIURNAL_SUN_PATH:5,SUN_POSITION:6,SHADING:7,ALL:8};var ye=[void 0===e.showAxis||!!e.showAxis,void 0===e.showAnnualArea||!!e.showAnnualArea,void 0===e.showAnnualLines||!!e.showAnnualLines,void 0!==e.showWorldMap&&!!e.showWorldMap,void 0===e.showSunAngles||!!e.showSunAngles,void 0===e.showApphelion||!!e.showApphelion,void 0===e.showSunPos||!!e.showSunPos,void 0!==e.showShading&&!!e.showShading,!1];I.style("visibility",ye[m.Component.AXIS]?"visible":"hidden"),k.style("visibility",ye[m.Component.AXIS]?"visible":"hidden"),N.style("visibility",ye[m.Component.WORLD_MAP]?"visible":"hidden"),B.style("visibility",ye[m.Component.ANNUAL_AREA]?"visible":"hidden"),U.style("visibility",ye[m.Component.ANNUAL_LINES]?"visible":"hidden"),V.style("visibility",ye[m.Component.SUN_ANGLES]?"visible":"hidden"),H.style("visibility",ye[m.Component.DIURNAL_SUN_PATH]?"visible":"hidden"),F.style("visibility",ye[m.Component.SUN_POSITION]?"visible":"hidden"),G.style("visibility",ye[m.Component.SHADING]?"visible":"hidden"),W.style("visibility","display","none"),this.PROJ_SPHERICAL=0,this.PROJ_EQUIDISTANT=1,this.PROJ_STEREOGRAPHIC=2,this.PROJ_CARTESIAN=3;var Se=pd.constrainTo(pd.toInteger(e.projectionType,this.PROJ_SPHERICAL),this.PROJ_SPHERICAL,this.PROJ_CARTESIAN),Me=Se,we=1,Le=1;function De(e,t,i){switch(e){default:case m.PROJ_SPHERICAL:return[Math.cos(i)*Math.sin(t),-Math.sin(i)];case m.PROJ_STEREOGRAPHIC:return[(n=1/(1+(s=Math.cos(t))*(a=Math.cos(i))))*a*Math.sin(t),-n*Math.sin(i)];case m.PROJ_EQUIDISTANT:var n,s=Math.cos(t),a=Math.cos(i),s=Math.acos(s*a);return[(n=.638*(s&&s/Math.sin(s)))*a*Math.sin(t),-n*Math.sin(i)];case m.PROJ_CARTESIAN:return[t/Math.PI*1.134*Le,i/Math.PI*4.54]}}function Te(e,t,i){switch(e){default:case m.PROJ_SPHERICAL:return[Math.cos(i)*Math.sin(t),Math.sin(i)];case m.PROJ_STEREOGRAPHIC:return[(n=1/(1+(s=Math.cos(t))*(a=Math.cos(i))))*a*Math.sin(t),n*Math.sin(i)];case m.PROJ_EQUIDISTANT:var n,s=Math.cos(t),a=Math.cos(i),s=Math.acos(s*a);return[(n=.638*(s&&s/Math.sin(s)))*a*Math.sin(t),n*Math.sin(i)];case m.PROJ_CARTESIAN:return[t*Le,i]}}var Ee=d3.geo.equirectangular().precision(.1).translate([T/2,E]).scale(P),Ae=d3.geo.projection(function(e,t){if(we<.999){var i=1-we,n=De(Me,e,t),s=De(Se,e,t);return[i*n[0]+we*s[0],i*n[1]+we*s[1]]}return De(Se,e,t)}).translate([T/2,E/2]).scale(P).rotate([0,-90]).clipAngle(90.1).precision(.1),Pe=d3.geo.path().projection(Ae),Ce=d3.geo.projection(function(e,t){if(Se===m.PROJ_CARTESIAN)return[e/Math.PI*1.134*Le,t/Math.PI*4.54];var i=Math.cos(e),n=Math.cos(t);return[(i=1/(1+i*n))*n*Math.sin(e),-i*Math.sin(t)]}).translate([T/2,E/2]).scale(P).rotate([0,-90]).clipAngle(91.5).precision(.1),Oe=d3.geo.path().projection(Ce),Ne=d3.geo.projection(function(e,t){if(we<.999){var i=1-we,n=Te(Me,e,t),s=Te(Se,e,t);return[i*n[0]+we*s[0],i*n[1]+we*s[1]]}return Te(Se,e,t)}).translate([T/2,E/2]).rotate([0,-51.5]).scale(P).clipAngle(90.1).precision(.1),Ge=d3.geo.path().projection(Ne),Re=null,Ie=null;function ke(){Re=_||Se!=m.PROJ_CARTESIAN?(Ie=Ce,Ae):Ie=Ee,Pe.projection(Re),Oe.projection(Ie)}function Ve(){T=Math.max(s,+w.width()),E=Math.max(a,+w.height()),D.setAttributeNS(null,"viewBox","0 0 "+(T+1)+" "+(E+1)),Se==m.PROJ_CARTESIAN?_?P=.775*E*A:.305*E<(P=.35*T*A)&&(P=.305*E):P=Math.min(T,E)*A,C=pd.mapAndConstrainTo(P,135,250,2,3);var e=T/2,t=E/2;Le=T/E/.775,Se==m.PROJ_CARTESIAN&&_&&(t=.775*E),Ee.translate([e,t]).scale(P),Ae.translate([e,t]).rotate([0,Se==m.PROJ_CARTESIAN?0:-90]).clipAngle(Se==m.PROJ_CARTESIAN?null:90.1).scale(P),Ce.translate([e,t]).rotate([0,Se==m.PROJ_CARTESIAN?0:-90]).clipAngle(Se==m.PROJ_CARTESIAN?null:91.5).scale(P),Ne.translate([e,E/2]).scale(P),L.selectAll(".land").attr("d",Ge),L.selectAll(".countries path").attr("d",Ge),_e=!1}function Be(e,t){_e&&Ve(),N.text(""),N.append("path").datum(topojson.object(t,t.objects.land)).attr("class","land").attr("d",Ge),N.append("g").attr("class","countries").selectAll("path").data(topojson.object(t,t.objects.countries).geometries).enter().append("path").attr("d",Ge)}function Ue(){_e&&Ve(),I.text(""),k.text(""),O.text(""),Z=I.append("path").datum(d3.geo.graticule()).attr("class","tweenable line-grid").attr("d",Pe);var e=[],t=[],i=P<400?-1.2:-.75,n=5,s=1;Se==m.PROJ_CARTESIAN&&(i=-.3,T<1100&&(n=15,s=5));for(var a,r,o,l=0;l<360;l+=s)l%n?e.push([[l,0],[l,i]]):t.push([[l,0],[l,2*i]]);I.append("path").datum({type:"MultiLineString",coordinates:e}).attr("class","tickable line-axis").attr("d",Oe),I.append("path").datum({type:"MultiLineString",coordinates:t}).attr("class","tickable line-black").attr("d",Oe),I.append("path").datum({type:"MultiLineString",coordinates:[[[0,0],[179.99,0]],[[0,0],[-179.99,0]],[[0,90],[0,0]]]}).attr("class","tweenable line-axis").attr("opacity",.4).attr("d",Pe),Se==m.PROJ_CARTESIAN?(r=Ie([-180,90]),g=(d=Ie([180,0]))[0]-r[0]+1,a=d[1]-r[1],g=" M "+r[0]+" "+r[1]+" l "+g+" 0 l 0 "+a+" l -"+g+" 0 l 0 -"+a+" Z",(f?O.append("path").attr("class","stroke-none background-"+(ye[m.Component.WORLD_MAP]?"map":"daylight")):O.append("path").attr("class","tweenable fade-out line-grid")).attr("d",g),_||(d=Ie([180,-90]),I.append("rect").attr("class","line-axis").attr("x",r[0]).attr("y",r[1]).attr("width",d[0]-r[0]).attr("height",d[1]-r[1])),r=Ie([-180,0]),d=Ie([180,-.83333]),O.append("rect").attr("class","background-map").attr("x",r[0]-1).attr("y",r[1]).attr("width",d[0]-r[0]+2).attr("height",d[1]-r[1]),a=f?1:.75,r=Ie([-180,-.83333]),d=Ie([180,-6]),O.append("line").attr("class","line-axis stroke-dashed").attr("opacity","0.8").attr("x1",r[0]).attr("y1",r[1]).attr("x2",d[0]).attr("y2",r[1]),O.append("rect").attr("class","fill-civil").attr("fill-opacity",a).attr("x",r[0]-1).attr("y",r[1]).attr("width",d[0]-r[0]+2).attr("height",d[1]-r[1]),O.append("text").text("Civil Twilight").attr("text-anchor","middle").attr("class","text-twilight-dark").attr("x",(r[0]+d[0])/2).attr("y",(r[1]+d[1])/2).attr("dy",4),r=Ie([-180,-6]),d=Ie([180,-12]),O.append("rect").attr("class","fill-nautical").attr("fill-opacity",a).attr("x",r[0]-1).attr("y",r[1]).attr("width",d[0]-r[0]+2).attr("height",d[1]-r[1]),O.append("text").text("Nautical Twilight").attr("text-anchor","middle").attr("class","text-twilight-dark").attr("x",(r[0]+d[0])/2).attr("y",(r[1]+d[1])/2).attr("dy",4),r=Ie([-180,-12]),d=Ie([180,-18]),O.append("rect").attr("class","fill-astronomical").attr("fill-opacity",a).attr("x",r[0]-1).attr("y",r[1]).attr("width",d[0]-r[0]+2).attr("height",d[1]-r[1]),O.append("text").text("Astronomical Twilight").attr("text-anchor","middle").attr("class","text-twilight").attr("x",(r[0]+d[0])/2).attr("y",(r[1]+d[1])/2).attr("dy",4),r=Ie([-180,-18]),d=Ie([180,-90]),_&&(d[1]=E),O.append("rect").attr("class","fill-night").attr("fill-opacity",a).attr("x",r[0]-1).attr("y",r[1]).attr("width",d[0]-r[0]+2).attr("height",d[1]-r[1]),O.append("text").text("Night-time").attr("text-anchor","middle").attr("class","text-twilight").attr("x",(r[0]+d[0])/2).attr("y",(r[1]+d[1])/2).attr("dy",4),k.append("g").selectAll("text").data(d3.range(-180,181,30)).enter().append("text").each(function(e){e=Ie([e,0]);d3.select(this).attr("class","text-axis bold3").attr("text-anchor","middle").attr("x",e[0]).attr("y",e[1]-10)}).attr("dy",".35em").text(function(e){return 0===e?"N":90===e?"E":-180===e||180===e?"S":-90===e||270===e?"W":e+"°"}),k.append("g").selectAll(".altitude-markers").data(d3.range(10,81,10)).enter().append("text").each(function(e){e=Re([0,e]);d3.select(this).attr("class","text-grid").attr("text-anchor","start").attr("x",e[0]+4).attr("y",e[1])}).attr("dy","0.4em").text(function(e){return e+"°"}),k.append("g").selectAll(".twilight-markers").data(d3.range(-18,0,6)).enter().append("text").each(function(e){e=Re([0,e]);d3.select(this).attr("class","text-grid").attr("text-anchor","start").attr("x",e[0]+4).attr("y",e[1])}).attr("dy","0.4em").text(function(e){return e+"°"})):(h=d3.geo.circle().origin([0,90]).angle(90),f&&O.append("path").datum(h).attr("class","tweenable stroke-none background-"+(ye[m.Component.WORLD_MAP]?"map":"daylight")).attr("d",Pe),I.append("path").datum(h).attr("class","tweenable fade-out line-black").attr("d",Pe),o=pd.mapAndConstrainTo(P,100,1024,1,.1),I.append("path").datum({type:"MultiLineString",coordinates:[[[0,90],[90,0]],[[0,90],[-90,0]],[[0,90],[180,0]]]}).attr("class","tweenable line-axis").attr("opacity",.4).attr("d",Pe),k.append("g").selectAll("text").data(d3.range(-180,180,15)).enter().append("text").each(function(e){var t=Ie([e,-5*o]);d3.select(this).attr("class","text-axis bold6").attr("transform","rotate("+e+" "+t[0]+" "+t[1]+")").attr("text-anchor","middle").attr("x",t[0]).attr("y",t[1])}).attr("dy",".5em").text(function(e){return 0===e?"N":90===e?"E":-180===e||180===e?"S":-90===e||270===e?"W":e+"°"}),k.append("g").selectAll("text").data(d3.range(10,81,10)).enter().append("text").each(function(e){e=Re([0,e]);d3.select(this).attr("class","text-grid").attr("text-anchor","start").attr("x",e[0]+2).attr("y",e[1])}).attr("dy",".35em").text(function(e){return e+"°"})),(Y=I.append("g")).style("visibility",ye[m.Component.WORLD_MAP]?"visible":"hidden");var d=0,h=0;if(Se==m.PROJ_CARTESIAN){var c=Re([-10,u=_?32:0]),p=Re([10,u]);Y.append("line").attr("class","line-blue").attr("x1",c[0]).attr("y1",c[1]).attr("x2",p[0]).attr("y2",p[1]),d=Math.round(.5*(c[0]+p[0])),h=Math.round(.5*(c[1]+p[1])),c=Re([0,_?28:41]),p=Re([0,_?36:49]),Y.append("line").attr("class","line-blue").attr("x1",c[0]).attr("y1",c[1]).attr("x2",p[0]).attr("y2",p[1])}else{var u=85;switch(Se){case m.PROJ_EQUIDISTANT:u=82.5;break;case m.PROJ_STEREOGRAPHIC:u=80}c=Re([-90,u]),p=Re([90,u]);Y.append("line").attr("class","line-blue").attr("x1",c[0]).attr("y1",c[1]).attr("x2",p[0]).attr("y2",p[1]),d=Math.round(.5*(c[0]+p[0])),h=Math.round(.5*(c[1]+p[1])),c=Re([0,u]),p=Re([-180,u]),Y.append("line").attr("class","line-blue").attr("x1",c[0]).attr("y1",c[1]).attr("x2",p[0]).attr("y2",p[1])}(j=I.append("g")).style("visibility","hidden");var g=" M "+(d+12)+" "+(h-18)+" l -4 10 l 10 -4 M "+(d+8)+" "+(h-8)+" l 20 -20 l 25 0";j.append("path").attr("class","line-blue").attr("d",g),j.append("text").text("Map Location").attr("text-anchor","start").attr("class","text-blue").attr("x",d+58).attr("y",h-28).attr("dy","0.4em"),F.text("");h=.5*C+"px";F.append("circle").attr("fill","none").attr("stroke","yellow").attr("stroke-width",h).attr("r",2.25*C),F.append("circle").attr("fill","none").attr("opacity","0.5").attr("stroke","yellow").attr("stroke-width",h).attr("r",2.75*C),F.append("circle").attr("fill","none").attr("opacity","0.15").attr("stroke","yellow").attr("stroke-width",h).attr("r",3.25*C),F.append("circle").attr("class","hilite-circle").attr("r",1.5*C),V.text(""),ie=V.append("line").attr("class","hilite-axis"),te=V.append("circle").attr("class","hilite-circle").attr("r",.5*C),ee=V.append("line").attr("class","hilite-axis"),K=V.append("circle").attr("class","hilite-circle").attr("r",.5*C),ne=V.append("circle").attr("class","hilite-axis").attr("r",0),q&&(oe||(oe=z.append("text").attr({class:"text-overlay","text-anchor":"start",x:5,y:5,dy:"0.9em"}),le=z.append("text").attr({class:"text-overlay","text-anchor":"start",x:5,y:20,dy:"0.9em"}),de=z.append("text").attr({class:"text-overlay","text-anchor":"start",x:5,y:35,dy:"0.9em"}))),X&&function(){if(!he&&b){var e;Q=115.5,he=z.append("g").attr({id:"sp2d-legend",class:"legend"}),ge=he.append("text").attr({class:"text-overlay","text-anchor":"end",x:0,y:5,dy:"0.9em"}),ce=he.append("text").attr({class:"text-axis","text-anchor":"end",x:-18,y:22,dy:"0.9em"}),pe=he.append("text").attr({class:"text-axis","text-anchor":"end",x:-18,y:68.75,dy:"0.5em"}),ue=he.append("text").attr({class:"text-axis","text-anchor":"end",x:-18,y:115.5,dy:"0.0em"});for(var t=0;t<=30;++t)e=b.luminanceColorScaleAsHex(1-t/30),he.append("rect").attr({fill:e,stroke:"none",x:-15,y:22+3*t,width:15,height:3.5});he.append("rect").attr({class:"line-axis",x:-15,y:22,width:15,height:93.5}),me=he.append("path").attr("d","m3,9v11h14V9M4,9V6c0-3.3 2.7-6 6-6c3.3,0 6,2.7 6,6v3H14V6c0-2.2-1.8-4-4-4-2.2,0-4,1.8-4,4v3").attr("transform","translate(-13.5, 26), scale(0.6)").attr("class","hidden").attr("fill","white")}he.attr("transform","translate("+(T-5)+", 0)")}(),function(){var e=Math.round(v-8),t=Math.round(x-8),i=Math.round(.5*e),n="";re||(W.attr("opacity","0"),re=W.append("path").attr("class","tooltip"),se=W.append("text").text("0.00").attr({class:"tooltip",x:0,y:-Math.round(.5*x)-20,"text-anchor":"middle",dy:"0.4em"}),ae=W.append("path").attr("d","m3,9v11h14V9M4,9V6c0-3.3 2.7-6 6-6c3.3,0 6,2.7 6,6v3H14V6c0-2.2-1.8-4-4-4-2.2,0-4,1.8-4,4v3").attr("transform","translate("+(i+6)+", "+(-Math.round(.5*x)-6-20)+"), scale(0.6)").attr("class","tooltip hidden"),W.append("line").attr({class:"line-black",x1:-5,y1:0,x2:5,y2:0}),W.append("line").attr({class:"line-black",x1:0,y1:-5,x2:0,y2:5}));n+="M"+-i+","+(-x-20),n+=" h"+e,n+=" a4,4 0 0 1 4,4",n+=" v"+t,n+=" a4,4 0 0 1 -4,4",n+=" h"+(5-i),n+=" l-5,12",n+=" l-5,-12",n+=" h"+(5-i),n+=" a4,4 0 0 1 -4,-4",n+=" v"+-t,n+=" a4,4 0 0 1 4,-4",n+=" z",re.attr("d",n)}(),He(),Fe()}function Fe(){if(G.text(""),R.text(""),b&&ye[m.Component.SHADING]){var e=b.getSkyPatchPolygons(),t=e.length;if(y=b.getShadingData().length,0<b.skyType())for(var i=0;i<t;++i)G.append("path").datum({type:"Polygon",coordinates:e[i].polygon}).attr({id:"@"+i,class:"tweenable",stroke:l?"inherit":e[i].color,fill:e[i].color,"fill-opacity":1,d:Pe});else{var i=0,n=1,s="inherit",a="#000000";for(S=b.skyType(),e[0].color?(a=function(){return e[i].color},0<S?l||(s=function(){return e[i].color}):n=function(){return e[i].shading}):n=function(){return e[i].shading},i=0;i<t;++i)G.append("path").datum({type:"Polygon",coordinates:e[i].polygon}).attr({class:"tweenable",stroke:s,"fill-opacity":n,fill:a,d:Pe})}Se==m.PROJ_CARTESIAN&&R.append("use").style("visibility",pd.closeTo(r.northOffset(),0,.001)?"hidden":"visible").attr("xlink:href","#shading")}m.updateSkySegmentOutlines(!0),m.handleNorthChange(),fe=null}function He(){if(r){var e=r.year();ve.setLocation(r.latitude(),r.longitude(),r.timezone()),Ne.rotate([-r.longitude(),-r.latitude()]),L.selectAll(".countries path").attr("d",Ge),L.selectAll(".land").attr("d",Ge),B.text(""),U.text(""),ze(U,new Date(e,11,21),"sun-path-thick solid",!1);for(var t=21==o?12:11,i=21==o?6:5;i<t;++i)ze(U,new Date(e,i,o),"sun-path stroke-dashed",!1);ze(U,new Date(e,5,21),"sun-path-thick solid",!1);for(var n=ve.getAnalemmaApphelionsAsArray(7,0,24,1),s=0,a=n.length;s<a;++s)U.append("path").datum({type:"LineString",coordinates:n[s]}).attr("class","tweenable sun-path stroke-dashed").attr("d",Pe);We()}}function ze(e,t,i,n){ve.setDate(t);for(var s=ve.sunriseTime(),t=ve.sunsetTime(),a=ve.getDailyApphelionSegmentsAsArray(0,24,.25),r=0,o=a.length;r<o;++r)e.append("path").datum({type:"LineString",coordinates:a[r]}).attr("class","tweenable "+i).attr("d",Pe);n&&((t=e.selectAll("g").data(d3.range(Math.ceil(s),Math.ceil(t)),function(e){return+e}).enter().append("g").attr("transform",function(e){return"translate("+Re(ve.setTimeOfDayAndGetArray(e))+")"})).append("circle").attr("class","hilite-shape").attr("r",C),t.append("text").text(function(e){return e<10?"0"+e:e}).attr("class","text-hilite").attr("text-anchor","middle").attr("dy","-0.65em"))}function We(){H.text("");var e=r.clockTime(),t=Math.floor(e),e=Math.floor(60*(e-t)),e=new Date(r.year(),r.monthOfYear(),r.dayOfMonth(),t,e);ze(H,e,"line-hilite",!0),F.datum(ve.setDateTimeAndGetArray(e)).attr("transform",function(e){return"translate("+Re(e)+")"}),q&&oe&&oe.text("Lat: "+r.latitude().toFixed(2)+"°, Lng: "+r.longitude().toFixed(2)+"°, TZ: "+r.timezoneAsString()),je()}function je(){var e=r.azimuthAngle(),t=r.altitudeAngle();Se!=m.PROJ_CARTESIAN&&ye[m.Component.SUN_POSITION]&&(F.attr("opacity",pd.mapAndConstrainTo(t,-6,0,0,1)),F.style("visibility",-1<t?"visible":"hidden"));var i=Re([e,0]),n=Re([e,Se==m.PROJ_CARTESIAN?t:90]);ie&&(ie.attr("x1",i[0]).attr("y1",i[1]).attr("x2",n[0]).attr("y2",n[1]),te.attr("cx",i[0]).attr("cy",i[1]),i=Re([0,t]),n=Re([e,t]),K.attr("cx",i[0]).attr("cy",i[1]),Se==m.PROJ_CARTESIAN?(ne.attr("r",0),ee.attr("x1",i[0]).attr("y1",i[1]).attr("x2",n[0]).attr("y2",n[1])):(n=Re([0,90]),ne.attr("r",t<0?0:Math.abs(i[1]-n[1])).attr("cx",n[0]).attr("cy",n[1]),ee.attr("x1",n[0]).attr("y1",n[1]).attr("x2",n[0]).attr("y2",n[1]))),q&&(le&&le.text("Date: "+r.dateAsString()),de&&de.text("Time: "+r.timeAsString()))}function Ye(e,t){switch(t=!!t,e){case m.Component.AXIS:I.style("visibility",t?"visible":"hidden"),k.style("visibility",t?"visible":"hidden"),ye[e]=t,m.updateSkySegmentOutlines(!0);break;case m.Component.WORLD_MAP:N.style("visibility",t?"visible":"hidden"),Y.style("visibility",t?"visible":"hidden"),O.selectAll("path").attr("class",t?"background-map":"background-daylight"),t&&!xe&&d3.json("data/world-110m.json",Be),D.style.cursor=t?"move":g,ft(ye[e]=t);break;case m.Component.ANNUAL_AREA:B.style("visibility",t?"visible":"hidden"),ye[e]=t,m.refresh();break;case m.Component.ANNUAL_LINES:U.style("visibility",t?"visible":"hidden"),ye[e]=t;break;case m.Component.SUN_ANGLES:V.style("visibility",t?"visible":"hidden"),ye[e]=t;break;case m.Component.DIURNAL_SUN_PATH:H.style("visibility",t?"visible":"hidden"),ye[e]=t;break;case m.Component.SUN_POSITION:F.style("visibility",t?"visible":"hidden"),ye[e]=t,je();break;case m.Component.SHADING:M.isValid?(M.show=Se!=m.PROJ_CARTESIAN,M.canvas.style.display=M.show?"block":"none",ye[e]=!M.show,t?G.style("visibility",M.show?"hidden":"visible"):G.style("visibility","hidden")):(G.style("visibility",t?"visible":"hidden"),ye[e]=t),t&&m.updateShading(!0);break;case m.Component.ALL:for(var i=m.Component.ALL-1;0<=i;i--)Ye(i,t)}}ke(),this.show=function(e){var t=void 0!==e&&e.length?e:arguments;M.isValid&&M.isMaster&&M.apphelion_model.show(t);for(var i=0,n=t.length;i<n;++i)Ye(+t[i],!0);return m},this.hide=function(e){var t=void 0!==e&&e.length?e:arguments;M.isValid&&M.isMaster&&M.apphelion_model.hide(t);for(var i=0,n=t.length;i<n;++i)Ye(+t[i],!1);return m},this.focus=function(){return w&&w.focus(),m},this.isVisible=function(e){return 0<=e&&e<m.Component.ALL&&ye[e]},this.width=function(e){return arguments.length?(T=parseInt(e,10),w.width(T),m.refresh(),m):T},this.height=function(e){return arguments.length?(E=parseInt(e,10),w.height(E),m.refresh(),m):E},this.solarPosition=function(e){return arguments.length?(r=e,m.refresh(),m):r},this.updateLockScale=function(){return b&&me&&me.classed("hidden",!b.lockScale()),m},this.throttledRescale=function(e){return arguments.length?(n=pd.constrainTo(parseInt(e,10),0,5e3),m):n},this.dayForMonthlyLines=function(e){return arguments.length?(o=pd.constrainTo(parseInt(e,10),1,31),m):o},this.projectionType=function(e){return arguments.length?((e=pd.constrainTo(parseInt(e,10),m.PROJ_SPHERICAL,m.PROJ_CARTESIAN))!=Se&&(Se=e,we=1,ke(),Qe()),m):Se},this.updateSkySegmentOutlines=function(e){var t;return Z&&Z.style("visibility",!l&&m.isVisible(m.Component.AXIS)?"visible":"hidden"),G&&(l?(t=b&&0<b.skyType(),G.classed("line-grid",!t),G.classed("line-dark",t)):(G.classed("line-grid",!1),G.classed("line-dark",!1)),e||(fe=fe||G.selectAll("path")).attr("stroke","inherit")),M.isValid&&M.show&&M.update(),m},this.showSkySegments=function(e){if(!arguments.length)return l;var t=!!e,i=l!=t;return l=t,M.isValid&&M.isMaster&&M.apphelion_model.showSkySegments(e),m.updateSkySegmentOutlines(),i&&!l&&0<b.skyType()&&m.updateShading(),m};var qe=!(this.setDateTimeObservables=function(e,t){return p=t,i=(u=e)||p||h||c,pdDOM.toggleClass(D,"interactive",i),ft(i),m});function Xe(){M.apphelion_model.draw2D(500,500*M.size)}this.wasDragged=function(e){return arguments.length?(qe=!!e,m):qe},M={show:!1,isValid:!1,isMaster:!1,apphelion_model:null,texture:null,canvas:null,size:.85,update:function(){this.texture.drawToCanvas(this.canvas,Xe)},showSVGShading:function(e){G.style("visibility",e?"visible":"hidden"),ye[m.Component.SHADING]=e}},this.linkToApphelion3D=function(e){(e=e||{}).apphelion_model&&e.canvas&&e.texture?(M.isValid=!0,M.isMaster=pd.toBoolean(e.isMaster,!1),M.apphelion_model=e.apphelion_model,M.texture=e.texture,M.canvas=e.canvas,M.size=pd.toNumber(e.size,.85),e=pd.toBoolean(e.show,!0)&&Se!=m.PROJ_CARTESIAN,G.style("visibility",e?"hidden":"visible"),M.canvas.style.display=e?"block":"none",ye[m.Component.SHADING]=!e,M.show=e):(M.show=!1,M.isValid=!1,M.isMaster=!1,M.apphelion_model=null,M.texture=null,M.canvas=null,M.size=.85,Ye(m.Component.SHADING,G&&b))},this.animateProjection=function(e){if(Me=Se,Se=pd.constrainTo(parseInt(e,10),m.PROJ_SPHERICAL,m.PROJ_CARTESIAN),Me==Se)return!1;Me!=m.PROJ_CARTESIAN&&Se!=m.PROJ_CARTESIAN||B.style("visibility","hidden"),H.style("visibility","hidden"),F.style("visibility","hidden"),V.style("visibility","hidden");e=d3.geo.circle().origin([0,90]).angle(90);return Me==m.PROJ_CARTESIAN&&I.append("path").datum(e).attr("class","tweenable fade-in line-black").attr("d",Pe),Me==m.PROJ_CARTESIAN||Se==m.PROJ_CARTESIAN?(M.isValid&&(M.canvas.style.display="none",M.showSVGShading(!1),M.show=!1),k.style("visibility","hidden"),ye[m.Component.WORLD_MAP]?(O.text(""),O.append("path").datum(e).attr("class","tweenable stroke-none background-map").attr("d",Pe)):O.style("visibility","hidden")):M.isValid&&(M.showSVGShading(!1),M.show=!0),!(we=0)},this.updateAnimation=function(e){var t;return(we=e)<.999?(Se==m.PROJ_CARTESIAN?(L.selectAll("path.fade-out").attr("stroke-opacity",1-e),P=(e*E*.775+(1-e)*Math.min(T,E))*A,Re.translate([T/2,E/2*(1-e)+e*E*.775]).clipAngle(.9<=we?null:pd.mapAndConstrainTo(we,.5,.9,90.1,180)).rotate([0,-90*(1-e)]).scale(P),Ne.scale(P)):Me==m.PROJ_CARTESIAN&&(L.selectAll("path.fade-in").attr("stroke-opacity",e),P=((1-e)*E*.775+e*Math.min(T,E))*A,Re.translate([T/2,e*(E/2)+(1-e)*E*.775]).clipAngle(.1<=we?pd.mapAndConstrainTo(we,.1,.5,180,90.1):null).rotate([0,-90*e]).scale(P),Ne.scale(P)),Se!=m.PROJ_CARTESIAN&&Me!=m.PROJ_CARTESIAN||L.selectAll("path.tickable[d]").attr("d",Pe),M.isValid&&M.show&&((t=M.apphelion_model.projectionTransitions())[Me]=1-e,t[Se]=e,M.update()),L.selectAll("path.tweenable[d]").attr("d",Pe),L.selectAll(".countries path").attr("d",Ge),L.selectAll(".land").attr("d",Ge)):(Qe(),we=1,V.style("visibility",m.isVisible(m.Component.SUN_ANGLES)?"visible":"hidden"),B.style("visibility",m.isVisible(m.Component.ANNUAL_AREA)?"visible":"hidden"),k.style("visibility",m.isVisible(m.Component.AXIS)?"visible":"hidden"),H.style("visibility",m.isVisible(m.Component.DIURNAL_SUN_PATH)?"visible":"hidden"),F.style("visibility",m.isVisible(m.Component.SUN_POSITION)?"visible":"hidden"),G.style("visibility",m.isVisible(m.Component.SHADING)?"visible":"hidden"),O.style("visibility","visible"),m.handleNorthChange(),M.isValid&&(M.apphelion_model.projectionType(Se),M.show=Se!=m.PROJ_CARTESIAN,M.show?(M.canvas.style.display="block",M.showSVGShading(!1),M.update()):(M.canvas.style.display="none",M.showSVGShading(!0)))),m},this.shadingMask=function(e){return arguments.length?((b=e)?m.updateShading(!0):G.text(""),m):b=b||new pd.Shading},this.newShadingIterator=function(){return b?b.newShadingIterator():null},this.getShading=function(){return b?b.getShadingData():null},this.setShadingSegmentValue=function(e,t){return b&&b.setSkyPatchShading(e,t),m},this.updateShading=function(e){var i,t,n;return G&&b&&(M.isValid&&M.show?(M.isMaster&&M.apphelion_model.updateShading(e),M.update()):ye[m.Component.SHADING]&&(i=b.getShadingData(),e||y!=i.length?(y=i.length,Fe()):(t={},n=b.getSkyLuminanceCSSColors(),X&&he&&b&&(e=b.skyDistributionScale(),b.isCumulative()?ge.text(b.useIlluminance()?"cd.h/m2":"Wh/m2"):ge.text(b.useIlluminance()?"cd/m2":"W/m2"),pe.text((.5*e).toFixed(2)),ce.text(e.toFixed(2)),ue.text("0.00"),m.updateLockScale()),S<=0&&0<b.skyType()&&(t.stroke="inherit"),S=b.skyType(),n&&n.length?(t.fill=function(e,t){return n[t]},0<S?(l||(t.stroke=function(e,t){return n[t]}),t["fill-opacity"]=1):t["fill-opacity"]=function(e,t){return i[t]}):(t["fill-opacity"]=function(e,t){return i[t]},t.fill="#000000"),(fe=fe||G.selectAll("path")).attr(t)))),function(){{var e;0<=et&&(999<(e=b.getSkyPatchContribution(et))?se.text(e.toFixed(1)):9.99<e?se.text(e.toFixed(2)):se.text(e.toFixed(3)))}}(),m},this.setShading=function(e,t){return b&&b.setShadingData(e),t?0:m.updateShading(),m},this.clearShading=function(e){return b&&b.clearShadingData(),e?0:m.updateShading(),m};var Je=null;function Qe(){Je=null,Ve(),Ue()}this.rescale=function(){4<n?null==Je&&(Je=setTimeout(Qe,n)):Qe()},this.refresh=function(){return Ue(),m},this.getExportableText=function(e){var t='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n';M.isValid&&M.show&&(M.showSVGShading(!0),Fe());var i=D.cloneNode(!0);i.setAttributeNS(null,"preserveAspectRatio","xMidYMid"),i.setAttributeNS(null,"style",""),e&&i.setAttribute("xmlns:inkscape","http://www.inkscape.org/namespaces/inkscape"),t+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n';var n=" .svg-chart { font-family: sans-serif; font-size: 14px; } .svg-chart .line-grid { stroke-width: 0.5px; stroke-opacity: 0.5; stroke: #888; fill: none; } .svg-chart .line-dark { stroke-width: 0.5px; stroke-opacity: 1.0; stroke: #444; fill: none; } .svg-chart .line-axis { stroke-width: 1px; stroke: #666; fill: none; } .svg-chart .line-hilite { stroke-width: 1.5px; stroke: #F00; fill: none; } .svg-chart .line-blue { stroke-width: 1px; stroke: #00F; fill: none; } .svg-chart .line-black { stroke-width: 1px; stroke: #000; fill: none; } .svg-chart .text-grid { font-size: 0.6em; stroke: none; fill: #888; } .svg-chart .text-axis { font-size: 0.7em; stroke: none; fill: #000; } .svg-chart .text-hilite { font-size: 0.75em; font-weight: 500; stroke: none; fill: #F00; } .svg-chart .text-blue { font-size: 1.0em; stroke: none; fill: #00F; } .svg-chart text.bold6:nth-of-type(6n + 1) { font-weight: bold; font-size: 1.1em; } .svg-chart .hilite-circle { stroke: #F00; stroke-width: 1px; fill: #F00; } .svg-chart .hilite-shape { stroke: #F00; stroke-width: 1.25px; fill: #FFF; } .svg-chart .hilite-axis { stroke-width: 0.75px; stroke-dasharray: 4, 3; stroke: #F00; fill: none; } .svg-chart .sun-path { stroke-width: 1.25px; stroke: #f90; fill: none; } .svg-chart .sun-path-thick { stroke-width: 1.5px; stroke: #f90; fill: none; } .svg-chart .stroke-dashed { stroke-dasharray: 2, 3; } .svg-chart .background-daylight { fill: none; } .svg-chart .background-map { fill: #b3d1ff; }";return Se==m.PROJ_CARTESIAN&&(n+=" .svg-chart .text-twilight-dark { font-size: 0.76em; fill: #036; } .svg-chart .text-twilight { font-size: 0.76em; fill: #7AE; } .svg-chart .fill-astronomical { fill: #036; } .svg-chart .fill-nautical { fill: #369; } .svg-chart .fill-civil { fill: #69C; } .svg-chart .fill-night { fill: #012; }"),ye[m.Component.WORLD_MAP]&&(n+=" .svg-chart .countries path { stroke: #ccddff; stroke-linejoin: round; stroke-width: 0.75px; fill: none; } .svg-chart .land { stroke-opacity: 1; fill: #fff; }"),t+=i.outerHTML.replace("<style></style>",'<style type="text/css">/* <![CDATA[ */'+n+" /* ]]> */</style>"),e&&(t=t.replace(/<g id=/g,'<g inkscape:groupmode="layer" inkscape:label=')),M.isValid&&M.show&&(M.showSVGShading(!1),Fe()),t},this.handleLocationChange=function(){return He(),m},this.handleDateChange=function(){return We(),m},this.handleTimeChange=function(){return ve.setDayMonthYear(r.dayOfMonth(),r.monthOfYear(),r.year()),F.datum(ve.setTimeOfDayAndGetArray(r.clockTime())).attr("transform",function(e){return"translate("+Re(e)+")"}),je(),m},this.handleDateTimeChange=function(){return We(),m};var Ze=!(this.handleNorthChange=function(){var e,t,i;return b&&(e=Re([0,90]),Se==m.PROJ_CARTESIAN?(t=Re([-r.northOffset(),90]),G.attr("transform",function(){return"translate("+(t[0]-e[0])+", 0.0)"}),Se==m.PROJ_CARTESIAN&&(i=pd.sign(r.northOffset())*T,R.style("visibility",pd.closeTo(r.northOffset(),0,.001)?"hidden":"visible").attr("transform",function(){return"translate("+i+", 0.0)"}))):(G.attr("transform",function(){return"rotate("+-r.northOffset()+", "+e[0]+", "+e[1]+")"}),M.isValid&&M.show&&M.update())),m}),Ke=!1,$e={x:NaN,y:NaN},et=-1,tt=null;function it(){W.attr("opacity","0.0"),Ze=!1,null!=tt&&(clearTimeout(tt),tt=null)}function nt(e){Ke||(W.attr("display","inline"),Ke=!0),Ze||(W.attr("opacity","1.0"),Ze=!0),null!=tt&&(clearTimeout(tt),tt=null),e&&(tt=setTimeout(it,2500))}function st(e,t){var i;if(b&&e.event&&e.event.pageX){var n,s=$e.x,a=$e.y,r=e.event.pageX,o=e.event.pageY,l=e.x-r,d=e.y-o;e.isTouchEvent?(n=0<e.button?.2:1,isNaN(s)?s=r:s+=e.dragX*n,isNaN(a)?a=o:a+=e.dragY*n):(s=r,a=o);o=document.elementFromPoint(Math.round(s),Math.round(a));if(o&&o.id){o=o.id;if("@"==o.charAt(0)&&0<=(i=pd.toNumber(o.substr(1),-1))){W.attr("transform","translate("+(s+l)*pdDOM.pageScale+", "+(a+d)*pdDOM.pageScale+")");d=b.getSkyPatchContribution(i);return 999<d?se.text(d.toFixed(1)):9.99<d?se.text(d.toFixed(2)):se.text(d.toFixed(3)),Ze&&!t||nt(!1),et=i,$e.x=s,$e.y=a,1}}}Ze&&it(),et=-1}this.activateTooltip=function(){return m};var at=[0,0],rt=null,ot=0,lt=0,dt=!1,ht=-1;function ct(e){w&&w.focus(),qe=!1,0<=e.button&&e.button<2&&(ye[m.Component.WORLD_MAP]?(d&&d.storeValues(h,c),rt=Ne.rotate(),at=[e.x,e.y],j.style("visibility","visible"),dt=!0):(ae.classed("hidden",!0),st(e,!0),u&&(ot=u(),ht=0),p&&(lt=p(),ht=0),0==ht&&(D.style.cursor="move")))}function pt(e){if(0<=e.button&&e.button<2)if(dt){var t=rt[0]+.15*(e.x-at[0]),i=rt[1]+.15*(at[1]-e.y),i=pd.constrainTo(i,-90,90);h&&!pd.closeTo(h(),-i,.001)&&(h(-i),qe=!0),t=pd.wrapAt(t,-180,180),c&&!pd.closeTo(c(),-t,.001)&&(c(-t),qe=!0)}else switch(st(e,!1),ht){case 0:e.hasMoved(5)&&(ht=Math.abs(e.getDragDistanceX())>Math.abs(e.getDragDistanceY())?1:2,u&&(ot=u()),p&&(lt=p()),D.style.cursor=2==ht?"ns-resize":"ew-resize");break;case 1:u&&(n=pd.wrapAt(ot-.025*e.getDragDistanceX()*P,0,1440),u(pd.snapTo(n,5)),qe=!0);break;case 2:var n;p&&(n=172<lt&&lt<356?1:-1,e=pd.wrapAt(lt+n*e.getDragDistanceY()*.01*P,0,366),p(Math.round(e)),qe=!0)}}function ut(e){0<=e.button&&e.button<2&&(dt?(j.style("visibility","hidden"),d&&d.checkForChanges(),dt=!1):0<=et&&nt(!0)),0<=ht&&(D.style.cursor=g,ht=-1)}function gt(e){X&&J&&e.x>T-45&&e.y<=Q?J(e):0<=et&&(ae.classed("hidden",!1),nt(!1))}function mt(e){var t;e.delta&&(p&&e.shiftKey?(t=pd.wrapAt(p()+e.delta,0,366),p(Math.round(t))):u&&(e=pd.wrapAt(u()-5*e.delta,0,1440),u(pd.snapTo(e,1))))}function ft(e){be&&(be.dispose(),be=null),e&&i&&(be=pdDOM.Interaction.makeInteractive(D,{onpress:ct,ondrag:pt,onrelease:ut,ondoubletap:gt,onlongpress:gt,onscroll:mt}))}return w.attr("xmlns","http://www.w3.org/2000/svg"),pdDOM.addClass(D,"svg-chart",!0),pdDOM.toggleClass(D,"interactive",i),D.style.cursor=g,$(document).ready(function(){ye[m.Component.WORLD_MAP]&&d3.json("data/world-110m.json",Be),i&&ft(!0)}),this},L.EdgeScaleBar=L.Layer.extend({options:{opacity:1,weight:.8,color:"#000",font:"11px Arial",zoomInterval:[{start:1,end:2,interval:5e6},{start:3,end:3,interval:2e6},{start:4,end:4,interval:1e6},{start:5,end:5,interval:5e5},{start:6,end:7,interval:2e5},{start:8,end:8,interval:1e5},{start:9,end:9,interval:5e4},{start:10,end:10,interval:2e4},{start:11,end:11,interval:1e4},{start:12,end:12,interval:5e3},{start:13,end:13,interval:2e3},{start:14,end:14,interval:1e3},{start:15,end:15,interval:500},{start:16,end:16,interval:200},{start:17,end:17,interval:100},{start:18,end:18,interval:50},{start:19,end:19,interval:20},{start:20,end:20,interval:10}]},initialize:function(e){L.setOptions(this,e),this._a=6378137,this._b=6356752.3142,this._e2=(this._a*this._a-this._b*this._b)/(this._a*this._a),this._n=(this._a-this._b)/(this._a+this._b),this._n2=this._n*this._n,this._A=this._a*(1-this._n)*(1-this._n2)*(1+9/4*this._n2+225/64*this._n2*this._n2),this._ic1=1.5*this._n-29/12*this._n2*this._n+6.9125*this._n2*this._n2*this._n,this._ic2=21/8*this._n2-1537/128*this._n2*this._n2,this._ic3=151/24*this._n2*this._n-32373/640*this._n2*this._n2*this._n,this._ic4=1097/64*this._n2*this._n2,this._ic5=8011/150*this._n2*this._n2*this._n,this._c1=-1.5*this._n+31/24*this._n2*this._n-669/640*this._n2*this._n2*this._n,this._c2=15/18*this._n2-435/128*this._n2*this._n2,this._c3=-35/12*this._n2*this._n+8.1375*this._n2*this._n2*this._n,this._c4=315/64*this._n2*this._n2,this._c5=-8.6625*this._n2*this._n2*this._n,this._LIMIT_PHI=1.484419982},onAdd:function(e){this._map=e,this._container||this._initCanvas(),e._panes.overlayPane.appendChild(this._container),e.on("viewreset",this._reset,this),e.on("move",this._reset,this),e.on("moveend",this._reset,this),this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._container),e.off("viewreset",this._reset,this),e.off("move",this._reset,this),e.off("moveend",this._reset,this)},addTo:function(e){return e.addLayer(this),this},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},bringToFront:function(){return this._canvas&&this._map._panes.overlayPane.appendChild(this._canvas),this},bringToBack:function(){var e=this._map._panes.overlayPane;return this._canvas&&e.insertBefore(this._canvas,e.firstChild),this},getAttribution:function(){return this.options.attribution},_initCanvas:function(){this._container=L.DomUtil.create("div","leaflet-image-layer"),this._canvas=L.DomUtil.create("canvas",""),this._ctx=this._canvas.getContext("2d"),this._vert_gradientFill=this._ctx.createLinearGradient(0,0,0,10),this._vert_gradientFill.addColorStop(0,"rgba(255, 255, 255, 1)"),this._vert_gradientFill.addColorStop(1,"rgba(255, 255, 255, 0)"),this._hor_gradientFill=this._ctx.createLinearGradient(this._map.getSize().x-10,0,this._map.getSize().x,0),this._hor_gradientFill.addColorStop(0,"rgba(255, 255, 255, 0)"),this._hor_gradientFill.addColorStop(1,"rgba(255, 255, 255, 1)"),this._updateOpacity(),this._container.appendChild(this._canvas),L.extend(this._canvas,{onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.bind(this._onCanvasLoad,this)})},_reset:function(){var e=this._container,t=this._canvas,i=this._map.getSize(),n=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(e,n),e.style.width=i.x+"px",e.style.height=i.y+"px",t.width=i.x,t.height=i.y,t.style.width=i.x+"px",t.style.height=i.y+"px",this._ctx.beginPath(),this._ctx.moveTo(0,0),this._ctx.lineTo(i.x,0),this._ctx.lineTo(i.x,i.y),this._ctx.stroke(),this._calcInterval(),this._draw()},_onCanvasLoad:function(){this.fire("load")},_updateOpacity:function(){L.DomUtil.setOpacity(this._canvas,this.options.opacity)},_calcInterval:function(){var e,t=this._map.getZoom();for(e in this.options.zoomInterval){var i=this.options.zoomInterval[e];if(i.start<=t&&i.end&&i.end>=t){this._dd=i.interval;break}}this._currZoom=t},_draw:function(){this._ctx.strokeStyle=this.options.color,this._create_lat_ticks(),this._create_lon_ticks(),this._ctx.fillStyle=this.options.color,this._ctx.font=this.options.font;var e=" m",t=this._dd;1e3<=this._dd&&(e=" km",t=this._dd/1e3),this._ctx.textAlign="right",this._ctx.textBaseline="middle",this._ctx.fillText(t+e,this._map.getSize().x-12,this._map.getSize().y/2),this._ctx.textAlign="center",this._ctx.textBaseline="top",this._ctx.fillText(t+e,this._map.getSize().x/2,12)},_create_lat_ticks:function(){var e,t=this._map.containerPointToLatLng(L.point(0,this._map.getSize().y/2)).lat,n=this._map.containerPointToLatLng(L.point(0,this._map.getSize().y)).lat,s=this._map.containerPointToLatLng(L.point(0,0)).lat,t=this._merLength(t*Math.PI/180),a=this._merLength(s*Math.PI/180),r=this._merLength(n*Math.PI/180);for(i=t+this._dd/2;i<a;i+=this._dd){(e=this._invmerLength(i))<this._LIMIT_PHI&&e>-this._LIMIT_PHI&&this._draw_lat_tick(e,10,1.5*this.options.weight)}for(i=t-this._dd/2;i>r;i-=this._dd){(e=this._invmerLength(i))>-this._LIMIT_PHI&&e<this._LIMIT_PHI&&this._draw_lat_tick(e,10,1.5*this.options.weight)}for(i=t;i<a;i+=this._dd/10){(e=this._invmerLength(i))<this._LIMIT_PHI&&e>-this._LIMIT_PHI&&this._draw_lat_tick(e,4,this.options.weight)}for(i=t-this._dd/10;i>r;i-=this._dd/10){(e=this._invmerLength(i))>-this._LIMIT_PHI&&e<this._LIMIT_PHI&&this._draw_lat_tick(e,4,this.options.weight)}},_create_lon_ticks:function(){var e=this._map.containerPointToLatLng(L.point(this._map.getSize().x/2,0)),t=this._map.containerPointToLatLng(L.point(0,0)),n=this._map.containerPointToLatLng(L.point(this._map.getSize().x,0)),s=Math.sin(e.lat*Math.PI/180),s=this._a/Math.sqrt(1-this._e2*s*s),a=this._dd/(s*Math.cos(e.lat*Math.PI/180))*180/Math.PI;for(i=e.lng+a/2;i<n.lng;i+=a)this._draw_lon_tick(i,10,1.5*this.options.weight);for(i=e.lng-a/2;i>t.lng;i-=a)this._draw_lon_tick(i,10,1.5*this.options.weight);for(i=e.lng;i<n.lng;i+=a/10)this._draw_lon_tick(i,4,this.options.weight);for(i=e.lng-a/10;i>t.lng;i-=a/10)this._draw_lon_tick(i,4,this.options.weight)},_latLngToCanvasPoint:function(e){e=this._map.project(L.latLng(e));return e._subtract(this._map.getPixelOrigin()),L.point(e).add(this._map._getMapPanePos())},_draw_lat_tick:function(e,t,i){e=this._latLngToCanvasPoint(L.latLng(180*e/Math.PI,0)).y;this._ctx.lineWidth=i,this._ctx.beginPath(),this._ctx.moveTo(this._map.getSize().x,e),this._ctx.lineTo(this._map.getSize().x-t,e),this._ctx.stroke()},_draw_lon_tick:function(e,t,i){e=this._latLngToCanvasPoint(L.latLng(0,e)).x;this._ctx.lineWidth=i,this._ctx.beginPath(),this._ctx.moveTo(e,0),this._ctx.lineTo(e,t),this._ctx.stroke()},_merLength:function(e){var t=Math.cos(2*e);return this._A*(e+Math.sin(2*e)*(this._c1+(this._c2+(this._c3+(this._c4+this._c5*t)*t)*t)*t))},_invmerLength:function(e){var t=e/this._A,e=Math.cos(2*t);return t+Math.sin(2*t)*(this._ic1+(this._ic2+(this._ic3+(this._ic4+this._ic5*e)*e)*e)*e)}}),L.edgeScaleBar=function(e){return new L.EdgeScaleBar(e)};function initializeApp(){var initialDate=new Date;var e,solarPosition=new pd.SolarPosition,o=null,scene=null,n=null,r=null,t=null,l=null,h={Location:{latitude:40.416970,longitude:-3.718324,timezone:-3,northOffset:0},DateTime:{clockTime:initialDate.getHours()+initialDate.getMinutes()/60,dayOfMonth:initialDate.getDate(),monthOfYear:initialDate.getMonth(),year:initialDate.getFullYear()},Apphelion:{showSunPos:!0,showSunDirection:!0,showSunAngles:!1,showApphelion:!0,showAnnualArea:!0,showAnnualLines:!0,showAxis:!0,radius:.5691940588456252,solarChart:0},Display:{surfaceOpacity:1,outlineOpacity:.5,surfaceShininess:75,ambientFactor:.5},Model:{shadowsShow:!0,mapTiles:"OSM"},Animation:{animateTime:!0,animateDate:!0,animateLatitude:!1,animateLongitude:!1,daylightOnly:!0,speed:10},updateDateTimeLocation:function(){this.Location.latitude=solarPosition.latitude(),this.Location.longitude=solarPosition.longitude(),this.Location.timezone=solarPosition.timezone(),this.Location.northOffset=solarPosition.northOffset(),this.DateTime.clockTime=solarPosition.clockTime(),this.DateTime.dayOfMonth=solarPosition.dayOfMonth(),this.DateTime.monthOfYear=solarPosition.monthOfYear(),this.DateTime.year=solarPosition.year(),this.Animation.animateTime=o.Animation.animateTime(),this.Animation.animateDate=o.Animation.animateDate(),this.Animation.animateLatitude=o.Animation.animateLatitude(),this.Animation.animateLongitude=o.Animation.animateLongitude(),this.Animation.daylightOnly=o.Animation.daylightOnly(),this.Animation.speed=+o.Animation.speed()},readAppData:function(e){var t,a,n;("Location"in e||"location"in e)&&("latitude"in(t=e.Location||e.location)&&pd.isNumeric(t.latitude)&&(this.Location.latitude=pd.constrainTo(parseFloat(t.latitude),-90,90)),"longitude"in t&&pd.isNumeric(t.longitude)&&(this.Location.longitude=pd.constrainTo(parseFloat(t.longitude),-180,180)),"timezone"in t&&pd.isNumeric(t.timezone)&&(this.Location.timezone=pd.constrainTo(parseFloat(t.timezone),-13,13)),"northOffset"in t&&pd.isNumeric(t.northOffset)&&(this.Location.northOffset=pd.constrainTo(parseFloat(t.northOffset),-180,180))),("DateTime"in e||"datetime"in e)&&("clockTime"in(a=e.DateTime||e.datetime)&&pd.isNumeric(a.clockTime)&&(this.DateTime.clockTime=pd.constrainTo(parseFloat(a.clockTime),0,24)),"dayOfMonth"in a&&pd.isNumeric(a.dayOfMonth)&&(this.DateTime.dayOfMonth=pd.constrainTo(parseInt(a.dayOfMonth,10),0,31)),"monthOfYear"in a&&pd.isNumeric(a.monthOfYear)&&(this.DateTime.monthOfYear=pd.constrainTo(parseInt(a.monthOfYear,10),0,11)),"year"in a&&pd.isNumeric(a.year)&&(this.DateTime.year=parseInt(a.year,10))),("Apphelion"in e||"apphelion"in e)&&("showSunPos"in(a=e.Apphelion||e.apphelion)&&(this.Apphelion.showSunPos="true"===String(a.showSunPos)),"showSunDirection"in a&&(this.Apphelion.showSunDirection="true"===String(a.showSunDirection)),"showSunAngles"in a&&(this.Apphelion.showSunAngles="true"===String(a.showSunAngles)),"showApphelion"in a&&(this.Apphelion.showApphelion="true"===String(a.showApphelion)),"showAnnualArea"in a&&(this.Apphelion.showAnnualArea="true"===String(a.showAnnualArea)),"showAnnualLines"in a&&(this.Apphelion.showAnnualLines="true"===String(a.showAnnualLines)),"showAxis"in a&&(this.Apphelion.showAxis="true"===String(a.showAxis)),"radius"in a&&pd.isNumeric(a.radius)&&(this.Apphelion.radius=pd.constrainTo(parseFloat(a.radius),.005,2)),"center"in a&&pd.isArray(a.center)&&(this.Apphelion.center=[parseFloat(a.center[0]),parseFloat(a.center[1]),parseFloat(a.center[2])]),"solarChart"in a&&!isNaN(a.solarChart)&&(this.Apphelion.solarChart=pd.constrainTo(parseInt(a.solarChart,10),0,5))),("Display"in e||"display"in e)&&("surfaceOpacity"in(n=e.Display||e.display)&&pd.isNumeric(n.surfaceOpacity)&&(this.Display.surfaceOpacity=pd.constrainTo(parseFloat(n.surfaceOpacity),0,1)),"outlineOpacity"in n&&pd.isNumeric(n.outlineOpacity)&&(this.Display.outlineOpacity=pd.constrainTo(parseFloat(n.outlineOpacity),0,1)),"surfaceShininess"in n&&pd.isNumeric(n.surfaceShininess)&&(this.Display.surfaceShininess=pd.constrainTo(parseFloat(n.surfaceShininess),0,500)),"ambientFactor"in n&&pd.isNumeric(n.ambientFactor)&&(this.Display.ambientFactor=pd.constrainTo(parseFloat(n.ambientFactor),0,1))),("Model"in e||"model"in e)&&("shadowsShow"in(n=e.Model||e.model)&&(this.Model.shadowsShow="true"===String(n.shadowsShow)),"mapTiles"in n&&(this.Model.mapTiles=String(n.mapTiles))),("Animation"in e||"animation"in e)&&("animateTime"in(e=e.Animation||e.animation)&&(this.Animation.animateTime="true"===String(e.animateTime)),"animateDate"in e&&(this.Animation.animateDate="true"===String(e.animateDate)),"animateLatitude"in e&&(this.Animation.animateLatitude="true"===String(e.animateLatitude)),"animateLongitude"in e&&(this.Animation.animateLongitude="true"===String(e.animateLongitude)),"daylightOnly"in e&&(this.Animation.daylightOnly="true"===String(e.daylightOnly)),"speed"in e&&!isNaN(e.speed)&&(this.Animation.speed=pd.constrainTo(parseFloat(e.speed),0,20)))},readFromLocalStorage:function(){var e=pdDOM.getLocalStorageItem("appConfig");e&&(e=JSON.parse(e),this.readAppData(e))},writeToLocalStorage:function(){this.updateDateTimeLocation(),pdDOM.setLocalStorageItem("appConfig",JSON.stringify(this))},clearLocalStorage:function(){this.updateDateTimeLocation(),pdDOM.removeLocalStorageItems(["appConfig"])}};h.readFromLocalStorage(),(e=pdDOM.getUrlParams().solarData)&&e.length&&h.readAppData(pdDOM.uriToJSON(e));var d=null;var c={projectionName:"DAY-LENGTH",baseModelSize:-1,updateExtents:!1},glModel=null;try{glModel=pdGL.create({canvas:document.getElementById("canvas"),alpha:pdDOM.isMacintosh&&pdDOM.isSafari&&!pdDOM.isSafariOldVersion,antialias:!0})}catch(e){throw $("#loading-message-title").html("ERROR: "+e.toString()).addClass("error"),new Error("WebGL not supported by this browser:\n"+e.toString())}window.gl=glModel,solarPosition.setLocation(h.Location.latitude,h.Location.longitude,h.Location.timezone).northOffset(h.Location.northOffset),solarPosition.setDayMonthYear(h.DateTime.dayOfMonth,h.DateTime.monthOfYear,h.DateTime.year).setTimeOfDay(h.DateTime.clockTime),scene=new pdGL.Scene3D("MainScene",{surfaceOpacity:h.Display.surfaceOpacity,outlineOpacity:h.Display.outlineOpacity,surfaceShininess:h.Display.surfaceShininess,ambientFactor:h.Display.ambientFactor,defaultZoom:.75}),window.mainScene=scene,window.solar=solarPosition,h.Model.shadowsShow&&scene.createShadowMap(2048,glModel.RGB);scene.checkBoundingBox(!0);c.baseModelSize=scene.modelSize;o=new function(){var s=this;this.UndoManager=new ko.UndoRedoQueue,this.SaveAs=new pdKO.SaveAsViewModel(s),this.Animation=new pdKO.AnimationViewModel(s,h.Animation,solarPosition),this.Camera=new pdKO.CameraViewModel(s,solarPosition),this.Camera.setZoom=function(e){e=pd.toNumber(e,0),c.updateExtents&&Math.abs(e)<=1e-4?g():s.Camera._setZoom(e)},this.Display=new pdKO.DisplayViewModel(s,h.Display,scene),this.Location=new pdKO.LocationViewModel(s,h.Location,solarPosition),this.Location.onLocationChange=function(){D.handleLocationChange(),r.handleLocationChange(),s.DateTime.updateDawnDuskValues(),O()},this.Location.onNorthOffsetChange=function(){r.handleNorthChange(),O()},this.DateTime=new pdKO.DateTimeViewModel(s,h.DateTime,solarPosition),this.DateTime.createSolarPositionObservables(),this.DateTime.createSolarNoonAndDayLengthObservables(),this.DateTime.createTwilightObservables(),this.DateTime.onDateTimeChange=function(e,t){t&&(s.DateTime.updateDawnDuskValues(),r.handleDateChange()),D.handleDateTimeChange(),O()},this.Chart=new function(){var t=this;this.projectionName=ko.observable(c.projectionName),this.projectionType=ko.observable(h.Apphelion.solarChart-2),this.projectionType.subscribe(function(e){v(e),t.projectionName(c.projectionName)}),this.projectionTypeString=ko.pureComputed({read:function(){return t.projectionType().toString()},write:function(e){t.projectionType(parseInt(e,10))},owner:this})},this.Model=new function(){this.shadowsShow=ko.observable(h.Model.shadowsShow),this.shadowsShow.subscribe(function(){scene.environment.hasOwnShadowMap?(h.Model.shadowsShow=!1,scene.clearShadowMap()):(scene.createShadowMap(2048,glModel.RGB),h.Model.shadowsShow=!0),glModel.update()}),this.mapTiles=ko.observable(h.Model.mapTiles),this.mapTiles.subscribe(function(e){s.ModalMap.setMapTileLayer(e)&&s.ModalMap.resize()}),this.reverseNormals=function(){$("body").addClass("waiting"),setTimeout(function(){console.log(n);n.reverseNormals(),$("body").removeClass("waiting"),scene.environment.updateShadows=!0,glModel.update()},50)},this.reverseTriangles=function(){$("body").addClass("waiting"),setTimeout(function(){n.reverseTriangles(),$("body").removeClass("waiting"),scene.environment.updateShadows=!0,glModel.update()},50)},this.sitOnGround=function(){$("body").addClass("waiting"),setTimeout(function(){n.boundingBox=n.getAABB();var e=-n.boundingBox.min.z;n.boundingBox.min.z+=e,n.boundingBox.max.z+=e,n.translate(0,0,e),$("body").removeClass("waiting"),c.baseModelSize=-1,g(!0)},100)},this.swapYZ=function(){$("body").addClass("waiting"),setTimeout(function(){n.swapYZ(),scene.checkBoundingBox(!0),$("body").removeClass("waiting"),c.baseModelSize=-1,g(!0)},50)},this.mirrorY=function(){$("body").addClass("waiting"),setTimeout(function(){n.mirrorY(),scene.checkBoundingBox(!0),$("body").removeClass("waiting"),c.baseModelSize=-1,g(!0)},50)}},this.Manager=new function(){var p=this;function e(e){if(e&&0<e.length){var t="",a=p.tableHeader(),n=p.tableData(),o=0;if(a&&a.length)for(var i=0;i<a.length;++i){var s=a[i];if(s&&s.length){if(0<o){for(var r=0;r<o;++r)t+=",";o=0}for(var l=0;l<s.length;++l){var temp=s[l];if(0<l&&(t+=","),pd.isObject(temp)){if(t+=temp.value?temp.value.toString():"",temp.colspan)for(var h=pd.toNumber(temp.colspan)-1,r=0;r<h;++r)t+=",";temp.rowspan&&(o=1)}else t+=temp?temp.toString():""}t+="\n"}}if(n&&n.length)for(i=0;i<n.length;++i){var d=n[i];if(d&&d.length){for(l=0;l<d.length;++l){var c=d[l];0<l&&(t+=","),t+=c?c.toString():""}t+="\n"}}var glModel=document.createElement("a");return glModel.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),glModel.setAttribute("download",e),glModel.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),!0}return!1}function t(e){if(e&&0<e.length){p.formatParamData(!0);var t=p.paramData(),a=document.createElement("a");return a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),a.click(),!0}return!1}this.tableCols=ko.observable(0),this.tableTitle=ko.observable(""),this.tableSubTitle=ko.observable(""),this.tableHeader=ko.observableArray([]),this.tableData=ko.observableArray([]),this.tableMinutes=ko.observable(5),this.tableMinutesShow=ko.observable(!1),this.tableMinutes.subscribe(function(e){p.showDailySolarTable(e)}),this.tableFixedHeader=ko.observable(!1),this.tableFixedHeader.subscribe(function(e){e?$("#solar-table").addClass("table-fixed-head"):$("#solar-table").removeClass("table-fixed-head")}),this.showAnnualSolarTable=function(){p.tableCols(15),p.tableHeader([[{value:"Fecha",colspan:"1",rowspan:"2"},{value:"Mediodía solar",colspan:"2",rowspan:"1"},{value:"Amanecer",colspan:"2",rowspan:"1"},{value:"Atardecer",colspan:"2",rowspan:"1"},{value:"Duración del día",colspan:"2",rowspan:"1"},{value:"Crepúsculo civil",colspan:"2",rowspan:"1"},{value:"Crepúsculo náutico",colspan:"2",rowspan:"1"},{value:"Crepúsculo astron.",colspan:"2",rowspan:"1"}],["Hora","Altitud","Hora","Acimut","Hora","Acimut","Horas","Cambio","Amanecer","Anochecer","Amanecer","Anochecer","Amanecer","Anochecer"]]),p.tableSubTitle(["Latitud: "+pd.toStringWithPrecisionRange(s.Location.latitude(),2,9)+"°","Longitud: "+pd.toStringWithPrecisionRange(s.Location.longitude(),2,9)+"°","Huso horario: "+s.Location.timezone.formatter()].join(", ")),p.tableMinutesShow(!1),p.tableTitle("Tabla de datos solares anual - "+solarPosition.year().toString()),p.tableData(function(){var e,t,a,n=[],o=[],scene=M,s=pd.DateTime.isLeapYear(solarPosition.year())?366:365;scene.copyLocation(solarPosition);for(var r=0;r<s;++r)scene.setDayOfYear(r),scene.solarTime(12),e=scene.getDuskDawnData(),(n=[]).push(scene.formatAsDate(r)),n.push(scene.formatAsTime(e.solarNoon)),n.push(scene.altitudeAngle().toFixed(2)+"°"),scene.setTimeOfDay(e.sunrise),n.push(scene.formatAsTime(e.sunrise)),n.push(scene.azimuthAngle().toFixed(2)+"°"),scene.setTimeOfDay(e.sunset),n.push(scene.formatAsTime(e.sunset)),n.push(scene.azimuthAngle().toFixed(2)+"°"),a=e.sunset-e.sunrise,n.push(scene.formatAsDuration(a,!0)),n.push(scene.formatAsDuration(0<r?a-t:0,!0)),t=a,n.push(scene.formatAsTime(e.civilDawn)),n.push(scene.formatAsTime(e.civilDusk)),n.push(scene.formatAsTime(e.nauticalDawn)),n.push(scene.formatAsTime(e.nauticalDusk)),n.push(scene.formatAsTime(e.astronomicalDawn)),n.push(scene.formatAsTime(e.astronomicalDusk)),o.push(n);return o}()),$("#modal-solar-table").modal("show")},this.showDailySolarTable=function(){p.tableCols(6),p.tableHeader([[{value:"Hora",colspan:"1",rowspan:"2"},{value:"Posición Solar",colspan:"3",rowspan:"1"},{value:"Proyección de sombra",colspan:"2",rowspan:"1"}],["Altitud","Acimut","Ángulo Hor.","Ángulo Hor.","Longitud"]]),p.tableSubTitle(["Latitud: "+pd.toStringWithPrecisionRange(s.Location.latitude(),2,9)+"°","Longitud: "+pd.toStringWithPrecisionRange(s.Location.longitude(),2,9)+"°","Huso horario: "+s.Location.timezone.formatter()].join(", "));p.tableMinutesShow(!0),p.tableTitle("Tabla de datos de día solar - "+solarPosition.dateAsString()),p.tableData(function(e){var t,a,n=[],o=[],scene=M;scene.copyLocation(solarPosition),e=Math.max(1,pd.toNumber(e,5))/60;for(var s=pd.snapTo(scene.sunriseTime(),e),r=pd.snapTo(scene.sunsetTime(),e),l=s;l<=r;l+=e){scene.setTimeOfDay(l);(n=[]).push(scene.formatAsTime(l));n.push(scene.altitudeAngle().toFixed(2)+"°");n.push(scene.azimuthAngle().toFixed(2)+"°");t=pd.wrapAt(90-(scene.azimuthAngle()+scene.northOffset()),-180,180);n.push(t.toFixed(2)+"°");a=scene.altitudeAngle();a=a<.001?"--":Math.abs(Math.tan(pd.Const.DEG2RAD*(90-scene.altitudeAngle()))).toFixed(5);n.push(pd.wrapAt(t+180,-180,180).toFixed(2)+"°");n.push(a);o.push(n)}return o}(p.tableMinutes()));$("#modal-solar-table").modal("show")},this.showCustomSolarTable=function(e,t,a,n){null==n&&pd.isArray(t)&&0<t.length&&pd.isArray(t[0])&&(n=t[0].length),pd.isString(a)&&p.tableTitle(a),p.tableCols(n),p.tableMinutesShow(!1),p.tableHeader(e),p.tableData(t),$("#modal-solar-table").modal("show")},this.tablePrevDay=function(){s.DateTime.setDayOfYear(solarPosition.dayOfYear()-1),p.showDailySolarTable()},this.tableNextDay=function(){s.DateTime.setDayOfYear(solarPosition.dayOfYear()+1),p.showDailySolarTable()},this.showExportSolarData=function(){$("#modal-save-controls").hide(),s.SaveAs.title("Guardar"),s.SaveAs.message("Ingrese el nombre del archivo a exportar:"),s.SaveAs.filename("datos-solares-"+pd.DateTime.generateDateSuffix()+".csv"),s.SaveAs.action(e),s.SaveAs.extension(".csv"),s.SaveAs.open()},this.paramData=ko.observable("[No hay datos de ubicación disponibles]"),this.paramErrorVisible=!1,this.paramDataChanged=ko.observable(!1),this.paramDataEdited=function(){p.paramDataChanged(!0),p.paramErrorVisible&&($("#modal-data-alert").addClass("hidden"),p.paramErrorVisible=!1)},this.formatParamData=function(e){h.updateDateTimeLocation(),!e&&d?d.setText(JSON.stringify(h,null,"    ")):p.paramData(JSON.stringify(h,null,"    ")),p.paramDataChanged(!1)},this.showTextMode=function(){d&&("text"!=d.getMode()?d.setMode("text"):d.setMode("tree"))},this.shareParamDataAsURI=function(){var e=document.location,t=e.protocol+"//"+e.host+e.pathname,e=l?d?d.get():JSON.parse(p.paramData()):h,t=t+"?solarData="+pdDOM.jsonToURI(e),e=prompt("Al abrir la siguiente URL en una nueva página del navegador, generará el mismo modelo y configuraciones:",t);e&&0<e.length&&window.open(t,"_blank")},this.showSaveSettings=function(){s.SaveAs.title("Guardar configuración"),s.SaveAs.message("Ingrese el nombre del archivo para guardar la configuración del modelo actual::"),s.SaveAs.filename("apphelion-"+pd.DateTime.generateDateSuffix()+".json"),s.SaveAs.action(t),s.SaveAs.extension(".json"),s.SaveAs.open()},this.processParamData=function(e){h.readAppData(e),s.Location.latitude(h.Location.latitude),s.Location.longitude(h.Location.longitude),s.Location.timezone(h.Location.timezone),s.Location.northOffset(h.Location.northOffset),s.DateTime.dayOfYear(solarPosition.calcDayOfYearIndex(h.DateTime.dayOfMonth,h.DateTime.monthOfYear,h.DateTime.year)),s.DateTime.timeOfDay(60*h.DateTime.clockTime),solarPosition.year(h.DateTime.year),s.DateTime.dayOfYear.valueHasMutated(),s.Display.surfaceOpacity(h.Display.surfaceOpacity),s.Display.surfaceShininess(h.Display.surfaceShininess),s.Display.outlineOpacity(h.Display.outlineOpacity),s.Display.ambientFactor(h.Display.ambientFactor),s.Chart.projectionType(h.Apphelion.solarChart-2),s.Apphelion.showSunPos(h.Apphelion.showSunPos),s.Apphelion.showSunDirection(h.Apphelion.showSunDirection),s.Apphelion.showSunAngles(h.Apphelion.showSunAngles),s.Apphelion.showApphelion(h.Apphelion.showApphelion),s.Apphelion.showAnnualArea(h.Apphelion.showAnnualArea),s.Apphelion.showAnnualLines(h.Apphelion.showAnnualLines),s.Apphelion.showAxis(h.Apphelion.showAxis),s.Apphelion.radius(h.Apphelion.radius),s.Model.shadowsShow(h.Model.shadowsShow),s.Model.mapTiles(h.Model.mapTiles),s.Animation.animateTime(h.Animation.animateTime),s.Animation.animateDate(h.Animation.animateDate),s.Animation.animateLatitude(h.Animation.animateLatitude),s.Animation.animateLongitude(h.Animation.animateLongitude),s.Animation.daylightOnly(h.Animation.daylightOnly),s.Animation.speed(h.Animation.speed)},this.parseParamData=function(){try{var e=d?d.get():JSON.parse(p.paramData());p.processParamData(e),$("#modal-data").modal("hide")}catch(e){var t=e.message||"El editor contiene datos incorrectos.";null!=l?($("#modal-data-error").html(t),$("#modal-data-alert").removeClass("hidden"),p.paramErrorVisible=!0):window.alert("ERROR: "+t)}},this.selectModelFile=function(){p.selectFile(".obj,.mtl,.stl,.ply,.mod")},this.selectSettingsFile=function(){p.selectFile(".json")},this.selectFile=function(e){var t=document.getElementById("modal-data-file");e&&0<e.length&&(t.accept=e);try{t.value=null,t.value&&(t.type="text",t.type="file")}catch(e){}t.click()},this.importFile=function(e){function a(){$("body").removeClass("waiting");var e="No se pudo reconocer el formato del archivo.";if(null!=l){$("#modal-data-error").text(e);$("#modal-data-alert").removeClass("hidden");p.paramErrorVisible=!0}else{window.alert("ERROR: "+e)}}$("body").addClass("waiting");pdKO.importFiles(e,{error:a,script:function(){$("body").removeClass("waiting")},model:function(e){scene.clear();n=e;scene.addNode(n);scene.checkBoundingBox(!0);$("body").removeClass("waiting");h.Apphelion.radius=.6;c.updateExtents=!0;c.baseModelSize=-1;g(!0),s.UndoManager.reset()},json:function(e,t){$("body").removeClass("waiting"),e&&e.result?(d?d.setText(e.result):p.paramData(e.result),null!=l?(p.paramDataChanged(!0),$("#file-drop-box-label").html("Archivo cargado correctamente: <em>"+t.name+"</em>"),d&&d.focus()):(p.parseParamData(),c.updateExtents=!0,c.baseModelSize=-1,g(!0))):a()}})},this.storeSettings=function(){!0===confirm("Esta operación almacenará la configuración actual como configuración inicial.\n\n¿Desea continuar?")&&h.writeToLocalStorage()},this.clearSettings=function(){!0===confirm("Esta operación eliminará todos los datos de configuración almacenados y se volverá a la configuración por defecto.\n\n¿Desea continuar?")&&h.clearLocalStorage()}},this.Apphelion=new function(){var t=this;function a(e,t){A&&e!=A.Component.WORLD_MAP&&(t?A.show(e):A.hide(e)),t?r.show(e):r.hide(e),glModel.update()}this.showSunPos=ko.observable(h.Apphelion.showSunPos),this.showSunPos.subscribe(function(e){a(r.Component.SUN_POSITION,e),h.Apphelion.showSunPos=e}),this.showSunDirection=ko.observable(h.Apphelion.showSunDirection),this.showSunDirection.subscribe(function(e){a(r.Component.SUN_DIRECTION,e),h.Apphelion.showSunDirection=e}),this.showSunAngles=ko.observable(h.Apphelion.showSunAngles),this.showSunAngles.subscribe(function(e){a(r.Component.SUN_ANGLES,e),h.Apphelion.showSunAngles=e}),this.showApphelion=ko.observable(h.Apphelion.showApphelion),this.showApphelion.subscribe(function(e){a(r.Component.DIURNAL_SUN_PATH,e),h.Apphelion.showApphelion=e}),this.showAnnualArea=ko.observable(h.Apphelion.showAnnualArea),this.showAnnualArea.subscribe(function(e){a(r.Component.ANNUAL_AREA,e),h.Apphelion.showAnnualArea=e}),this.showAnnualLines=ko.observable(h.Apphelion.showAnnualLines),this.showAnnualLines.subscribe(function(e){a(r.Component.ANNUAL_LINES,e),h.Apphelion.showAnnualLines=e}),this.showAxis=ko.observable(h.Apphelion.showAxis),this.showAxis.subscribe(function(e){a(r.Component.AXIS,e),h.Apphelion.showAxis=e}),this.showAll=ko.pureComputed({read:function(){return t.showAxis()&&t.showAnnualArea()&&t.showAnnualLines()&&t.showSunDirection()&&t.showSunAngles()&&t.showApphelion()&&t.showSunPos()},write:function(e){t.showAxis(e),t.showAnnualArea(e),t.showAnnualLines(e),t.showSunDirection(e),t.showSunAngles(e),t.showApphelion(e),t.showSunPos(e)},owner:this}),this.showShowUndo=ko.pureComputed({read:function(){return[t.showAxis(),t.showAnnualArea(),t.showAnnualLines(),t.showSunDirection(),t.showSunAngles(),t.showApphelion(),t.showSunPos()]},write:function(e){8==e.length&&(t.showAxis(e[0]),t.showAnnualArea(e[1]),t.showAnnualLines(e[2]),t.showSunDirection(e[3]),t.showSunAngles(e[4]),t.showApphelion(e[5]),t.showSunPos(e[6]))},owner:t}),this.radius=ko.observable(h.Apphelion.radius),this.radius.subscribe(function(e){t.radius.undoIgnore||t.radiusSlider.undoIgnore||(h.Apphelion.radius=pd.constrainTo(parseFloat(e),.005,2),r.radius(c.baseModelSize*h.Apphelion.radius),c.updateExtents=!0,glModel.update())}),this.radiusSlider=ko.pureComputed({read:function(){var e=t.radius();return e=.258925411794167<e?pd.mapAndConstrainTo(e,.258925411794167,1.5,100,200):1e3*Math.log10(e+1)},write:function(e){e=100<(e=parseFloat(e))?pd.mapAndConstrainTo(e,100,200,.258925411794167,1.5):Math.pow(10,.001*e)-1,t.radius(e)},owner:this})},this.ModalMap=new function(){var a=null,n=!1,o=null,scene=null;this.dynamicMarkerPosition=ko.observable(),this.dynamicMarkerPosition.formatter=ko.pureComputed(function(){var e=[+s.Location.latitude(),+s.Location.longitude()];return scene&&!n&&scene.setLatLng(e),e[0].toFixed(8)+"°, "+e[1].toFixed(8)+"°"}),this.setMapTileLayer=function(e){if("NONE"!=e){var t=null;switch(e){case"Wikimedia":t=L.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png",{attribution:'<a href="https://foundation.wikimedia.org/wiki/Maps_Terms_of_Use">Wikimedia maps</a> | Map data © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a></div>',minZoom:1,maxZoom:19});break;default:case"OSM":t=new L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:""});break;case"OSM:B&W":t=L.tileLayer("https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{attribution:"",maxZoom:18});break;case"OSM:Mapnik":t=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"",maxZoom:19});break;case"Stamen:Lite":t=L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}",{attribution:"",subdomains:"abcd",maxZoom:20,minZoom:0,ext:"png"});break;case"Stamen:Terrain":t=L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.{ext}",{attribution:"",subdomains:"abcd",maxZoom:18,minZoom:0,ext:"png"});break;case"ESRI:Street":t=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{attribution:""});break;case"ESRI:Satelite":t=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:""});break;case"ESRI:NatGeo":t=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"",maxZoom:16});break;case"CartoDB:Voyager":t=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"",subdomains:"abcd",maxZoom:19});break;case"MapBox":t=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",{attribution:"",id:"mapbox.streets",maxZoom:18})}if(t)return o&&a.hasLayer(o)&&a.removeLayer(o),o=t,a.addLayer(t),!0}return!1},this.initialise=function(e){var t;"L"in window?(t=[solarPosition.latitude(),solarPosition.longitude()],(a=L.map("map",{minZoom:1,keyboard:!0,doubleClickZoom:!1,worldCopyJump:!0})).setView(t,3),this.setMapTileLayer(e),L.edgeScaleBar().addTo(a),(scene=L.marker(t,{keyboard:!1,draggable:!0,autoPan:!0}).addTo(a)).on("dragstart",function(){s.UndoManager.storeValues(s.Location.latitude,s.Location.longitude,s.Location.timezone),s.Location.location.undoIgnore=!0,n=!0}),scene.on("drag",function(){var e=scene.getLatLng();s.Location.longitude(pd.wrapAt(e.lng,-180,180)),s.Location.latitude(e.lat)}),scene.on("move",function(){n||a.getBounds().contains(scene.getLatLng())||a.setView(scene.getLatLng(),a.getZoom())}),scene.on("dragend",function(){s.Location.location.undoIgnore=!1,s.UndoManager.checkForChanges(),n=!1}),a.on("dblclick",function(e){s.Location.longitude(pd.wrapAt(e.latlng.lng,-180,180)),s.Location.latitude(e.latlng.lat)}),L.Control.geocoder({defaultMarkGeocode:!1}).on("markgeocode",function(e){e&&e.geocode&&(s.Location.longitude(pd.wrapAt(e.geocode.center.lng,-180,180)),s.Location.latitude(e.geocode.center.lat),a.fitBounds(e.geocode.bbox))}).addTo(a),a.invalidateSize()):($("#latlng-text").hide(),$("#map").css({background:"url(imgs/world_blue_1024x512.png) no-repeat","-webkit-background-size":"100% 100%","-moz-background-size":"100% 100%","-o-background-size":"100% 100%","background-size":"100% 100%",cursor:"default"})),$("#map").removeClass("loading")},this.reCenter=function(){a&&a.setView(scene.getLatLng(),a.getZoom())},this.resize=function(){a&&a.invalidateSize()}},this.scrollNumericSlider=function(e,t){var a=t.originalEvent,n=a&&(a.wheelDelta||a.detail&&-a.detail);n&&e&&(0<(a=$(e).find("input[type=range]")).length&&((e=$.Event("keydown")).which=n<0?40:38,e.keyCode=e.which,e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,a.trigger(e),t.preventDefault()))}},window.App=o;var p=null;function g(e){c.baseModelSize<0&&(r.visible=!1,scene.checkBoundingBox(!0),c.baseModelSize=scene.modelSize,r.visible=!0,r.setCenterAndRadius([scene.modelCenter.x,scene.modelCenter.y,0],c.baseModelSize*h.Apphelion.radius)),scene.fitView(!0),scene.environment.updateShadows=!0,c.updateExtents=!1,e?O():(r.handleTimeChange(scene.environment.sunDirection),glModel.update())}r=new pdGL.Apphelion3D(glModel,{solarPosition:solarPosition,radius:scene.modelSize*h.Apphelion.radius,center:[scene.modelCenter.x,scene.modelCenter.y,0],showSunPos:h.Apphelion.showSunPos,showSunDirection:h.Apphelion.showSunDirection,showSunAngles:h.Apphelion.showSunAngles,showApphelion:h.Apphelion.showApphelion,showAnnualArea:h.Apphelion.showAnnualArea,showAnnualLines:h.Apphelion.showAnnualLines,showAxis:h.Apphelion.showAxis,showShading:!1,showNorth:!0,arrowStyle:2.5,arrowSize:1}),scene.addNode(r,[pdGL.PHASE.RENDER_FIRST,pdGL.PHASE.RENDER_LAST]),scene.includeInBoundingBoxList(r);var w=d3.format(".2f");function S(e){return w(e)+"°"}function f(e){return new pdSVG.Apphelion2D({elementId:"#svg",solarPosition:solarPosition,userInteraction:!1,fullScreenRect:!0,projectionType:e,showSunPos:h.Apphelion.showSunPos,showSunDirection:h.Apphelion.showSunDirection,showSunAngles:h.Apphelion.showSunAngles,showApphelion:h.Apphelion.showApphelion,showAnnualArea:h.Apphelion.showAnnualArea,showAnnualLines:h.Apphelion.showAnnualLines,showAxis:h.Apphelion.showAxis,showWorldMap:!1,observableLatitude:o.Location.latitude,observableLongitude:o.Location.longitude,showBackground:!0})}var b=null,y=null,A=null,D=null;function v(e){switch(e){default:case-2:h.Apphelion.solarChart=0,c.projectionName="DAY-LENGTH",null==b&&(b=new pdSVG.DayLength({elementId:"#svg",solarPosition:solarPosition,userInteraction:!1,observableDayOfYear:o.DateTime.dayOfYear,observableMinuteOfDay:o.DateTime.timeOfDay,isTouch:!0})),D=b,A=y=null;break;case-1:h.Apphelion.solarChart=1,c.projectionName="ANALEMMA",null==y&&(y=new pdSVG.Analemma({elementId:"#svg",solarPosition:solarPosition,userInteraction:!1})),D=y,A=b=null;break;case 0:h.Apphelion.solarChart=2,c.projectionName="SPHERICAL",null==A?A=f(e):A.projectionType(A.PROJ_SPHERICAL),D=A,y=b=null;break;case 1:h.Apphelion.solarChart=3,c.projectionName="EQUIDISTANT",null==A?A=f(e):A.projectionType(A.PROJ_EQUIDISTANT),D=A,y=b=null;break;case 2:h.Apphelion.solarChart=4,c.projectionName="STEREOGRAPHIC",null==A?A=f(e):A.projectionType(A.PROJ_STEREOGRAPHIC),D=A,y=b=null;break;case 3:h.Apphelion.solarChart=5,c.projectionName="CARTESIAN",null==A?A=f(e):A.projectionType(A.PROJ_SPHERICAL),A.projectionType(A.PROJ_CARTESIAN),D=A,y=b=null}D.rescale()}function T(e){0===h.Apphelion.solarChart&&b&&b.handlePointerDown(e)}function P(e){0===h.Apphelion.solarChart&&b&&b.handlePointerMove(e)}v(h.Apphelion.solarChart-2);var M=new pd.SolarPosition;function O(){var e=pdKO.sunPos;var t=e[0]+solarPosition.northOffset();o.DateTime.timeOfDay.azimuthAngle(S(solarPosition.azimuthAngle()));o.DateTime.timeOfDay.altitudeAngle(S(solarPosition.altitudeAngle()));var a,n=scene.environment;n.sunDirection.fromPolarAngles(t*pd.Const.DEG2RAD,e[1]*pd.Const.DEG2RAD);5==o.Camera.viewType()&&(.5<(a=glModel.orbitalView.cameraFOV)&&(a*=.9),glModel.orbitalView.setCamera(pd.wrapAt(90-t,-180,180),e[1],a),o.Camera.isPopupVisible()&&o.Camera.updateCameraOnViewChange()),r.handleTimeChange(),n.updateShadows=!0,glModel.update()}function C(){null!=t&&t.popoverX("hide")}function x(e){e=$(e);e.prop("disabled",!1),e.removeAttr("disabled"),e.css("opacity",1)}glModel.onkeydown=function(e){var t=e.keyCode||event.which;if(27==t)return glModel.orbitalView.clearInertia(),glModel.orbitalView.orbitMode=!0,o.Animation.playing()&&o.Animation.stop(),void(scene.ignoreSelection=!1);if(70==t&&(c.updateExtents||glModel.orbitalView&&!glModel.orbitalView.isCenter()))return g(),!0;if(!e.ctrlKey&&!e.altKey&&!e.metaKey){if(48<t&&t<58)return void(e.shiftKey?o.Manager.setUsefulTime(t-49):t<55?o.Camera.setViewType(t-49):o.DateTime.setUsefulDate(t-55));if(48==t)return void(e.shiftKey?o.Manager.setUsefulTime(9):o.DateTime.setUsefulDate(3));if(80==t||112==t)return o.Animation.play(),!0;if(84==t||116==t)return o.DateTime.setNextUsefulTime(),!0;if(89==t||121==t)return o.DateTime.setNextUsefulDate(),!0}return!1},glModel.onupdate=function(e){return t||l||!glModel.orbitalView||glModel.orbitalView.handleKbdNavigation(e),!1},glModel.ondraw=function(){scene&&scene.active&&scene.draw()},$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover(),$("div.split-pane").splitPane(),$("#landscape-chart-panel").on("resize",F),$("#portrait-chart-panel").on("resize",F),$("#svg").on("mousedown touchstart",T).on("mousemove touchmove",P).on("mousewheel DOMMouseScroll",function(e){o.scrollNumericSlider("#slider-timeofday",e),D.activateTooltip()}),$(".popover").on("shown.bs.modal",function(){t=$(this)}).on("hidden.bs.modal",function(){t=null,glModel.canvas.focus()}),$(".modal").on("shown.bs.modal",function(){l=$(this)}).on("hidden.bs.modal",function(){l=null,glModel.canvas.focus()}),$("[data-toggle='modal']").on("click",function(){C()}),$(document).on("mousedown touchstart pointerdown",function(e){null!=t&&0===t.has(e.target).length&&(t.popoverX("hide"),e.preventDefault())});$("#popover-apphelion").on("show.bs.modal",function(){o.UndoManager.storeValues(o.Apphelion.showSunPos,o.Apphelion.showSunDirection,o.Apphelion.showSunAngles,o.Apphelion.showApphelion,o.Apphelion.showAnnualArea,o.Apphelion.showAnnualLines,o.Apphelion.showAxis,o.Apphelion.radius,o.Location.northOffset)}).on("hide.bs.modal",function(){o.UndoManager.checkForChanges()});$("#popover-view").on("show.bs.modal",o.Camera.handlePopoverShow).on("hide.bs.modal",o.Camera.handlePopoverHide);$("#popover-display").on("show.bs.modal",o.Display.handlePopoverShow).on("hide.bs.modal",o.Display.handlePopoverHide);$("#popover-datetime").on("show.bs.modal",function(){o.DateTime.datetime.undoIgnore=!0;o.UndoManager.storeValues(o.DateTime.dayOfYear,o.DateTime.timeOfDay)}).on("hide.bs.modal",function(){o.DateTime.datetime.undoIgnore=!1;o.UndoManager.checkForChanges()});$("#popover-location").on("show.bs.modal",function(){o.Location.location.undoIgnore=!0;o.UndoManager.storeValues(o.Location.latitude,o.Location.longitude,o.Location.timezone)}).on("hide.bs.modal",function(){o.Location.location.undoIgnore=!1;o.UndoManager.checkForChanges()});$("#modal-save").on("show.bs.modal",o.SaveAs.handlePopoverShow);$("#modal-solar-table").on("shown.bs.modal",function(){$("#solar-table-container").scrollTop(0)});$("#modal-data").on("show.bs.modal",function(){var e;o.Manager.paramErrorVisible=!1;$("#file-drop-box-label").text("Drag and drop a JSON file anywhere in the app window to load it.");$("#modal-data-alert").addClass("hidden");if(d)o.Manager.formatParamData();else{var e=document.getElementById("jsoneditor");e.addEventListener("load",a,!1);e.classList.add("loading");e.src="./jsonEditor.html"}});pdDOM.enableDragDrop(document.body,o.Manager.importFile)&&$("#file-drop-box").on("click",o.Manager.selectFile).show();o.ModalMap.initialise(h.Model.mapTiles);$("#loading-message").remove();$("#overlay-header").css("display","block");$("#overlay-header").css("background-color","#ddd");$("#overlay-info, #chart-header, .navbar-form").fadeIn("slow");$(window).resize(function(){var e;B();null!=p&&(e=!1,null!=p?e&&!p.hasClass("snackbar-opened")?p.snackbar("show"):!e&&p.hasClass("snackbar-opened")&&p.snackbar("hide"):e&&(p=$.snackbar({content:"<strong>Advertencia: Huso horario inválido</strong><br /> El huso horario seleccionado debe estar debtri de ±4hrs de la longitud actual,<br /> en la cual cada hora equivale a 15 grados <var>(ref = longitud / 15)</var>.",htmlAllowed:!0,style:"warning",timeout:8e3}))),t&&(pdDOM.isAndroid?t.popoverX("show"):C())});B();o.UndoManager.reset();glModel.disableContextMenu(!0);scene.activate();O();glModel.animate();setTimeout(function(){scene.environment.updateShadows=!0,glModel.update()},250),o.UndoManager.add(o.Location.location,o.DateTime.datetime)});var k,N=null;function E(){null==N&&(N=$("#button-location"))}function I(e){var t="";switch(e.code){case e.PERMISSION_DENIED:t="Permisos de acceso a la ubicación denegados.";break;case e.POSITION_UNAVAILABLE:t="Los datos de ubicación no están disponibles.";break;case e.TIMEOUT:t="La solicitud de ubicación superó el tiempo de espera.";break;case e.UNKNOWN_ERROR:t="Ocurrió un error desconocido al obtener la ubicación."}alert("ERROR: "+t),E(),N.val(k),x("#button-location")}function z(e){o.Location.latitude(e.coords.latitude),o.Location.longitude(e.coords.longitude),E(),N.val(k),x("#button-location")}o.getGeoLocation=function(){var e;navigator.geolocation?(E(),k=N.val(),N.val("Soliticando ubicación..."),e="#button-location",(e=$(e)).prop("disabled",!0),e.attr("disabled","disabled"),e.css("opacity",.5),navigator.geolocation.getCurrentPosition(z,I,{maximumAge:6e4,timeout:1e4,enableHighAccuracy:!0})):alert("Este navegador no soporta funcionalidades de geo-posicionamiento.")};var R=0;function F(){var e=document.getElementById("svg").getBoundingClientRect();$("#chart-header").css("width",e.right-e.left+"px").css("left",e.left+"px").css("top",e.top+"px"),D.rescale(),o.ModalMap.resize()}function B(){(e=window.innerHeight>window.innerWidth)&&1==R||!e&&2==R||(R=e?($("#landscape-layout").hide(),$("#map-container").detach().appendTo("#portrait-map-panel"),$("#canvas").detach().appendTo("#portrait-canvas-panel"),$("#svg").detach().appendTo("#portrait-svg-panel"),0==R?$("#portrait-layout").fadeIn("fast"):$("#portrait-layout").show(),F(),1):($("#portrait-layout").hide(),$("#map-container").detach().appendTo("#landscape-map-panel"),$("#canvas").detach().appendTo("#landscape-canvas-panel"),$("#svg").detach().appendTo("#landscape-svg-panel"),0==R?$("#landscape-layout").fadeIn("fast"):$("#landscape-layout").show(),F(),2));var e,t=pdDOM.getClientWidth(),a=pdDOM.getClientHeight();1.0001<pdDOM.pageScale&&($("html").css("zoom",j),pdDOM.isFirefox&&(e=document.getElementById("svg").getBoundingClientRect(),$("#chart-header").css({width:(e.right-e.left)*pdDOM.pageScale+"px",left:e.left*pdDOM.pageScale+"px",top:e.top*pdDOM.pageScale+"px"})),a*=pdDOM.pageScale,t*=pdDOM.pageScale),$("#btns-datestimes").css("display",t<910?"none":"inline-block");t=glModel.canvas.getBoundingClientRect();document.getElementById("overlay-info").style.top=t.top+"px",pdDOM.setFullSizeCanvasByDevice(glModel,1==R?pdDOM.getClientWidth():glModel.canvas.clientWidth,1==R?glModel.canvas.clientHeight:pdDOM.getClientHeight()-40,$.snackbar),glModel.orbitalView&&glModel.orbitalView.applyProjection(),glModel.onresize&&glModel.onresize(),glModel.update()}ko.applyBindings(o)}initializeApp();loadInitialModel();